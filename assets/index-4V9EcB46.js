import{j as e,I as t,X as n,by as r,a2 as i,ab as a,Z as s,bZ as o,b_ as l,bk as c,bl as u,b2 as d,J as h,b$ as p,bh as f,aR as g,c0 as m,bc as x,U as y,z as v,ac as b,ai as S,am as _,ap as C,aj as w,a4 as k,az as j,$ as A,bC as P,bD as T,E as z,bF as I,c1 as E,bj as M,c2 as N,bg as R,bv as D,bw as L,aK as G,an as O,O as F,c3 as W,bn as q,bq as B,b3 as $,a6 as H,a7 as V,a8 as U,bL as Q,bM as Y,N as X,c4 as K,c5 as J,c6 as Z,ad as ee,ae as te,af as ne,ag as re,w as ie,aV as ae,ay as se,c7 as oe,T as le,_ as ce,bN as ue,F as de,bp as he,c8 as pe,c9 as fe,Y as ge,bG as me,ca as xe,bV as ye,al as ve,aX as be,aS as Se,aU as _e,W as Ce,aY as we}from"./mui-vendor-ThRJoe5u.js";import{f as ke,r as je,d as Ae,g as Pe,a as Te,j as ze}from"./react-vendor-jVbyDP5c.js";import{K as Ie,A as Ee,p as Me,L as Ne,M as Re,N as De}from"./index-hUIVqX27.js";import"./auth-vendor-BOyMHjHL.js";import"./state-vendor-BxbV2bHq.js";import"./utils-vendor-S0KZLiBE.js";import"./form-vendor-DG-ZRlco.js";import"./ui-vendor-DL_b4SbO.js";const Le=()=>{const{currentRole:e,getCurrentPermissions:t,availableRoles:n,userInfo:r}=Ie();return{currentRole:e,permissions:t(),availableRoles:n,userInfo:r,hasPermission:e=>t().includes(e),hasAnyPermission:e=>e.some(e=>t().includes(e)),hasAllPermissions:e=>e.every(e=>t().includes(e))}};function Ge(e){const t=[];let n=1;if(e.rawMaterials&&e.rawMaterials.length>0){const r=void 0!==e.prcAggregatedSteps?.rawMaterials;t.push({stepNumber:n++,type:"rawMaterials",title:"Raw Materials Validation",description:"Validate raw materials quantities and batch tracking",status:r?"completed":"pending",ctq:!1,items:e.rawMaterials.map(e=>({id:e.id,name:e.materialName,quantity:e.quantity,uom:e.uom,description:e.materialCode,batching:e.batching}))})}if(e.bom&&e.bom.length>0){const r=void 0!==e.prcAggregatedSteps?.bom;t.push({stepNumber:n++,type:"bom",title:"Catalyst Mixing",description:"Configure catalyst mixing based on temperature, humidity, and material quantities",status:r?"completed":"pending",ctq:!1,items:e.bom.map(e=>({id:e.id,name:e.materialName,quantity:e.quantity,splitQuantity:e.splitQuantity,uom:e.uom,description:e.materialCode,materialType:e.materialCode,materialCode:e.materialCode,materialName:e.materialName,order:e.order,splitting:e.splitting,splittingConfiguration:e.splittingConfiguration}))})}if(e.prcCurrentTemplate?.prcTemplateSteps){const r=[...e.prcCurrentTemplate.prcTemplateSteps].sort((e,t)=>e.sequence-t.sequence);for(const i of r)if("sequence"===i.type&&i.data){const r=i.data;if(r.stepGroups)for(const a of r.stepGroups){const r=Oe(e.prcAggregatedSteps,i.id,a.id,a.steps,a.steps.some(e=>e.ctq)),s=Fe(e.prcAggregatedSteps,i.id,a.id,a.steps,a.steps.some(e=>e.ctq));t.push({stepNumber:n++,type:"sequence",title:a.processName,description:a.processDescription,status:r?"completed":s?"in-progress":"pending",ctq:a.steps.some(e=>e.ctq),prcTemplateStepId:i.id,stepGroup:{id:a.id,processName:a.processName,processDescription:a.processDescription,sequenceTiming:a.sequenceTiming||0,steps:a.steps.map(e=>({...e,minValue:e.minValue,maxValue:e.maxValue,minimumAcceptanceValue:e.minimumAcceptanceValue||e.minValue,maximumAcceptanceValue:e.maximumAcceptanceValue||e.maxValue,stepNumber:e.id,version:1,isLatest:!0,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString(),processStepGroupId:a.id,responsiblePerson:e.responsiblePerson||!1}))}})}}else if("inspection"===i.type&&i.data){const r=i.data,a=We(e.prcAggregatedSteps,i.id,r.inspectionParameters?.some(e=>e.ctq)||!1),s=qe(e.prcAggregatedSteps,i.id,r.inspectionParameters?.some(e=>e.ctq)||!1);t.push({stepNumber:n++,type:"inspection",title:`${r.inspection?.inspectionName||"Inspection"}`,description:r.inspection?.inspectionName||"Quality inspection parameters",status:a?"completed":s?"in-progress":"pending",ctq:r.inspectionParameters?.some(e=>e.ctq)||!1,stepData:{prcTemplateStepId:i.id,stepGroupId:0,stepId:0,stepType:"inspection",targetValueType:"text",uom:"",multipleMeasurements:!1,notes:"",parameterDescription:"",evaluationMethod:"",allowAttachments:!1},inspectionParameters:r.inspectionParameters?.map(e=>({id:e.id,parameterName:e.parameterName,type:e.type,ctq:e.ctq,role:e.role,columns:e.columns||[],specification:e.specification,order:e.order,tolerance:e.tolerance||"",files:e.files||[],version:e.version||1,isLatest:void 0===e.isLatest||e.isLatest,createdAt:e.createdAt||(new Date).toISOString(),updatedAt:e.updatedAt||(new Date).toISOString(),inspectionId:e.inspectionId||i.id}))||[],inspectionMetadata:r.inspection?{id:r.inspection.id||i.id,type:r.inspection.type||"inspection",status:r.inspection.status||"active",version:r.inspection.version||1,isLatest:void 0===r.inspection.isLatest||r.inspection.isLatest,createdAt:r.inspection.createdAt||(new Date).toISOString(),updatedAt:r.inspection.updatedAt||(new Date).toISOString(),inspectionId:r.inspection.inspectionId||i.id.toString(),inspectionName:r.inspection.inspectionName||"Inspection"}:void 0})}}const r=t.findIndex(e=>"pending"===e.status);return r>=0&&(t[r].status="in-progress"),t}function Oe(e,t,n,r,i){if(!e)return!1;const a=e[t.toString()];if(!a)return!1;const s=a[n.toString()];if(!s)return!1;if(!r.every(e=>void 0!==s[e.id.toString()]))return!1;let o=!1,l=!1,c=!1;const u=e[t.toString()];if(u&&u[n.toString()]){const e=u[n.toString()];o=!0===e.productionApproved,l=!i||!0===e.ctqApproved||!0===e.partialCtqApprove,c=!0===e.stepCompleted}return o&&c&&l}function Fe(e,t,n,r,i){if(!e)return!1;const a=e[t.toString()];if(!a)return!1;const s=a[n.toString()];if(!s)return!1;if(!r.every(e=>void 0!==s[e.id.toString()]))return!1;let o=!1,l=!1;const c=e[t.toString()];if(c&&c[n.toString()]){const e=c[n.toString()];o=!0===e.productionApproved,l=!i||!0===e.ctqApproved||!0===e.partialCtqApprove}return o&&l}function We(e,t,n=!1){if(!e)return!1;const r=e[t.toString()];if(!r||0===Object.keys(r).length)return!1;let i=!1,a=!1,s=!1;return i=!0===r.productionApproved,a=!n||!0===r.ctqApproved||!0===r.partialCtqApprove,s=!0===r.stepCompleted,i&&s&&a}function qe(e,t,n=!1){if(!e)return!1;const r=e[t.toString()];if(!r||0===Object.keys(r).length)return!1;let i=!1,a=!1;return i=!0===r.productionApproved,a=!n||!0===r.ctqApproved||!0===r.partialCtqApprove,i&&a}function Be(e,t){if("rawMaterials"===e.type)return{rawMaterials:t};if("bom"===e.type){const e={};return t.entries&&Array.isArray(t.entries)&&t.entries.forEach(n=>{const r=n.materialId.toString(),i=n.order||0;e[r]||(e[r]={}),e[r][i.toString()]={calculatedMax:n.calculatedMax,calculatedMin:n.calculatedMin,catalystQuantity:n.catalystQuantity,validationStatus:n.validationStatus,humidity:n.humidity,temperature:n.temperature,actualQuantity:n.actualQuantity,acknowledged:t.acknowledgments?.[n.id]||!1}}),{bom:e}}if("sequence"===e.type){if(e.stepData){const{prcTemplateStepId:n,stepGroupId:r,stepId:i}=e.stepData;return{[n.toString()]:{[r?.toString()||""]:{[i?.toString()||""]:t}}}}if(e.stepGroup&&e.prcTemplateStepId){if(t.stepId&&t.stepGroupId){const{stepId:n,stepGroupId:r,prcTemplateStepId:i,...a}=t;return{[e.prcTemplateStepId.toString()]:{[t.stepGroupId.toString()]:{[t.stepId.toString()]:a}}}}return{}}}if("inspection"===e.type&&e.inspectionParameters&&e.stepData){const n=e.stepData.prcTemplateStepId,r={};for(const i of e.inspectionParameters){const e=i.id.toString(),n={};if(t[e]&&"object"==typeof t[e]&&null!==t[e]){const r=t[e];void 0!==r.value&&(n.value=r.value),r.annotations&&Array.isArray(r.annotations)&&(n.annotations=r.annotations)}else{if("table"===i.type&&i.columns&&i.columns.length>0&&i.columns){const r=[];let a=-1;Object.keys(t).forEach(t=>{const n=t.match(new RegExp(`^${e}_row_(\\d+)_`));if(n){const e=parseInt(n[1],10);e>a&&(a=e)}});for(let n=0;n<=a;n++){const a={};let s=!1;i.columns.forEach(r=>{const i=`${e}_row_${n}_${r.name}`,o=t[i];null!=o&&""!==String(o).trim()&&(a[r.name]=o,s=!0)}),s&&Object.keys(a).length>0&&r.push(a)}r.length>0&&(n.value=r)}else if(i.columns&&i.columns.length>0){const r={};i.columns.forEach(n=>{const i=`${e}_${n.name}`,a=t[i];null!=a&&(r[n.name]=a)}),Object.keys(r).length>0&&(n.value=r)}else{const r=t[e];"object"==typeof r&&null!==r?(n.value=r.value,r.annotations&&(n.annotations=r.annotations)):n.value=r}if(t[e]&&"object"==typeof t[e]){const r=t[e];r.annotations&&Array.isArray(r.annotations)&&(n.annotations=r.annotations)}}Object.keys(n).length>0&&(r[e]=n)}return{[n.toString()]:r}}return{}}function $e(e,t,n){if("rawMaterials"===e.type)return{rawMaterials:{startTime:t,endTime:n}};if("bom"===e.type)return{bom:{startTime:t,endTime:n}};if("sequence"===e.type){if(e.stepData){const{prcTemplateStepId:r,stepGroupId:i,stepId:a}=e.stepData;return{[r.toString()]:{[i?.toString()||""]:{[a?.toString()||""]:{startTime:t,endTime:n}}}}}if(e.stepGroup&&e.prcTemplateStepId)return{}}if("inspection"===e.type&&e.stepData){const r=e.stepData.prcTemplateStepId;return{[r.toString()]:{startTime:t,endTime:n}}}return{}}function He(e,t){if(!e)return t;const n={...e};for(const[r,i]of Object.entries(t))n[r]&&"object"==typeof n[r]&&"object"==typeof i?Ve(n[r],i)?n[r]=Ue(n[r],i):n[r]=He(n[r],i):n[r]=i;return n}function Ve(e,t){if("object"!=typeof e||"object"!=typeof t||!e||!t)return!1;const n=e,r=t,i=Object.keys(n),a=Object.keys(r);return i.every(e=>!isNaN(Number(e)))&&a.every(e=>!isNaN(Number(e)))&&i.length>0&&a.length>0}function Ue(e,t){const n={...e};for(const[r,i]of Object.entries(t))if(n[r]&&"object"==typeof n[r]&&"object"==typeof i){const e=i,t={...n[r]};for(const[n,r]of Object.entries(e))if(t[n]&&"object"==typeof t[n]&&"object"==typeof r){const e=t[n],i=r;t[n]={...e,...i,responsiblePersons:i.responsiblePersons||e.responsiblePersons}}else t[n]=r;n[r]=t}else n[r]=i;return n}function Qe(e,t){return He(e,t)}function Ye(e,t,n){if("rawMaterials"===e.type)return{rawMaterials:{[t]:n}};if("bom"===e.type)return{bom:{[t]:n}};if("sequence"===e.type){if(e.stepData){const{prcTemplateStepId:r,stepGroupId:i,stepId:a}=e.stepData;return{[r.toString()]:{[i?.toString()||""]:{[a?.toString()||""]:{[t]:n}}}}}if(e.stepGroup&&e.prcTemplateStepId)return{[e.prcTemplateStepId.toString()]:{[e.stepGroup.id.toString()]:{[t]:n}}}}if("inspection"===e.type&&e.stepData){const r=e.stepData.prcTemplateStepId;return{[r.toString()]:{[t]:n}}}return{}}function Xe(e,t,n){if("rawMaterials"===e.type)return{rawMaterials:{[t]:n}};if("bom"===e.type)return{bom:{[t]:n}};if("sequence"===e.type){if(e.stepData){const{prcTemplateStepId:r,stepGroupId:i,stepId:a}=e.stepData;return{[r.toString()]:{[i?.toString()||""]:{[a?.toString()||""]:{[t]:n}}}}}if(e.stepGroup&&e.prcTemplateStepId)return{[e.prcTemplateStepId.toString()]:{[e.stepGroup.id.toString()]:{[t]:n}}}}if("inspection"===e.type&&e.stepData){const r=e.stepData.prcTemplateStepId;return{[r.toString()]:{[t]:n}}}return{}}function Ke(e,t){return He(e,t)}const Je=({executionData:c})=>{const u=ke(),d=(e=>{const t="string"==typeof e.progress?parseInt(e.progress)||0:e.progress;return Math.min(100,Math.max(0,t))})(c),h=e=>e>=100?"#4caf50":e>=50?"#ff9800":"#2196f3";return e.jsx(t,{sx:{backgroundColor:"white",borderBottom:"1px solid #e0e0e0",p:2,boxShadow:"0 2px 4px rgba(0,0,0,0.1)",flexShrink:0},children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:2,flexWrap:"wrap"},children:[e.jsx(n,{startIcon:e.jsx(r,{}),onClick:()=>u("/prc-execution"),sx:{color:"#666"},children:"Back to List"}),e.jsxs(t,{sx:{flex:1,minWidth:"200px"},children:[e.jsxs(i,{variant:"h6",sx:{fontWeight:600,color:"#333"},children:["PRC #",c.id," - ",c.partNumber]}),e.jsxs(i,{variant:"body2",sx:{color:"#666"},children:[c.customer," • ",c.productionSetId," • ",c.mouldId]})]}),e.jsxs(t,{sx:{display:"flex",flexDirection:"column",gap:1,minWidth:"200px"},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(a,{variant:"determinate",value:d,sx:{flex:1,height:8,borderRadius:4,backgroundColor:"#e0e0e0","& .MuiLinearProgress-bar":{backgroundColor:h(d),borderRadius:4}}}),e.jsxs(i,{variant:"body2",sx:{fontWeight:500,color:h(d),minWidth:"40px"},children:[d,"%"]})]}),e.jsxs(i,{variant:"caption",sx:{color:"#666"},children:[c.stepsCompleted," of ",c.totalSteps," steps completed"]})]}),e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(s,{label:`${c.completedCtq}/${c.totalCtq} CTQs`,size:"small",sx:{backgroundColor:c.completedCtq===c.totalCtq?"#e8f5e8":"#fff3e0",color:c.completedCtq===c.totalCtq?"#2e7d32":"#f57c00"}}),e.jsx(s,{label:(p=c.duration,`${Math.floor(p/36e5)}h ${Math.floor(p%36e5/6e4)}m`),size:"small",sx:{backgroundColor:"#e3f2fd",color:"#1976d2"}})]}),e.jsxs(t,{sx:{display:"flex",gap:1},children:[e.jsx(n,{startIcon:e.jsx(o,{}),variant:"outlined",size:"small",sx:{color:"#666",borderColor:"#ddd"},children:"Pause PRC"}),e.jsx(n,{startIcon:e.jsx(l,{}),variant:"outlined",size:"small",sx:{color:"#f57c00",borderColor:"#ffb74d"},children:"Escalate"})]})]})});var p},Ze=({steps:n,currentStepIndex:r,onStepClick:a})=>{const o=je.useRef(null);je.useEffect(()=>{o.current&&o.current.scrollIntoView({behavior:"smooth",block:"center"})},[r]);const l=(t,n)=>"completed"===t.status?e.jsx(f,{sx:{color:"#4caf50"}}):"in-progress"===t.status||n===r?e.jsx(g,{sx:{color:"#2196f3"}}):e.jsx(m,{sx:{color:"#ccc"}}),x=(e,t)=>"completed"===e.status?"#4caf50":"in-progress"===e.status||t===r?"#2196f3":"#ccc",y=(e,t)=>"completed"===e.status||"in-progress"===e.status||t===r,v=e=>{switch(e.type){case"rawMaterials":return"Raw Materials";case"bom":return"BOM";case"sequence":return"Sequence";case"inspection":return"Inspection";default:return e.type}};return e.jsxs(t,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsx(i,{variant:"h6",sx:{p:2,pb:0,fontWeight:600,color:"#333"},children:"Execution Steps"}),e.jsx(t,{sx:{flex:1,overflowY:"auto",p:2,pt:1},children:e.jsx(t,{sx:{display:"flex",flexDirection:"column",gap:2},children:n.map((n,f)=>e.jsx(c,{ref:f===r?o:null,sx:{cursor:y(n,f)?"pointer":"default",opacity:y(n,f)?1:.6,border:f===r?"2px solid #2196f3":"1px solid #e0e0e0","&:hover":y(n,f)?{boxShadow:2,transform:"translateY(-1px)",transition:"all 0.2s ease-in-out"}:{}},onClick:()=>y(n,f)&&a(f),children:e.jsx(u,{sx:{p:2},children:e.jsxs(t,{sx:{display:"flex",alignItems:"flex-start",gap:2},children:[e.jsx(d,{sx:{width:40,height:40,backgroundColor:"white",border:`2px solid ${x(n,f)}`,flexShrink:0},children:l(n,f)}),e.jsxs(t,{sx:{flex:1,minWidth:0},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsxs(i,{variant:"body2",sx:{fontWeight:600,color:y(n,f)?"#333":"#999"},children:["Step ",n.stepNumber]}),n.ctq&&e.jsx(s,{label:"CTQ",size:"small",sx:{backgroundColor:"#fff3e0",color:"#f57c00",fontSize:"0.625rem",height:16}})]}),e.jsx(i,{variant:"body1",sx:{fontWeight:500,color:y(n,f)?"#333":"#999",mb:.5},children:n.title}),e.jsx(i,{variant:"body2",sx:{color:"#666",mb:1,lineHeight:1.4,display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:n.description}),e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(s,{label:v(n),size:"small",sx:{backgroundColor:"#f5f5f5",color:"#666",fontSize:"0.625rem",height:20}}),"completed"===n.status&&e.jsx(s,{label:"Completed",size:"small",sx:{backgroundColor:"#e8f5e8",color:"#4caf50",fontSize:"0.625rem",height:20}}),"in-progress"===n.status&&e.jsx(s,{label:"In Progress",size:"small",sx:{backgroundColor:"#e3f2fd",color:"#2196f3",fontSize:"0.625rem",height:20}})]})]}),y(n,f)&&e.jsx(h,{sx:{color:"#666","&:hover":{color:"#2196f3",backgroundColor:"rgba(33, 150, 243, 0.04)"}},children:e.jsx(p,{})})]})})},f))})})]})},et=({step:r,executionData:a,onStepComplete:s})=>{const[o,l]=je.useState({}),[c,u]=je.useState({});je.useEffect(()=>{"completed"!==r.status&&"in-progress"!==r.status||!a.prcAggregatedSteps?.rawMaterials||setTimeout(()=>{l(a.prcAggregatedSteps?.rawMaterials)},0)},[r.status,a.prcAggregatedSteps]);const d="completed"===r.status;return e.jsx(x,{dateAdapter:Ee,children:e.jsxs(t,{sx:{p:2,backgroundColor:"white"},children:[e.jsxs(t,{sx:{mb:2},children:[e.jsx(i,{variant:"h6",sx:{fontWeight:600,color:"#333",mb:.5,lineHeight:1.3},children:r.title}),r.description&&r.description!==r.title&&e.jsx(i,{variant:"body2",sx:{color:"#666",fontSize:"0.875rem"},children:r.description})]}),e.jsx(y,{component:v,sx:{mb:2},children:e.jsxs(b,{size:"small",children:[e.jsx(S,{children:e.jsxs(_,{sx:{backgroundColor:"#f5f5f5"},children:[e.jsx(C,{sx:{fontWeight:600,fontSize:"0.875rem",py:1},children:"Material Code"}),e.jsx(C,{sx:{fontWeight:600,fontSize:"0.875rem",py:1},children:"Material Name"}),e.jsx(C,{sx:{fontWeight:600,fontSize:"0.875rem",py:1},children:"Required Qty"}),e.jsx(C,{sx:{fontWeight:600,fontSize:"0.875rem",py:1},children:"UOM"}),e.jsx(C,{sx:{fontWeight:600,fontSize:"0.875rem",py:1},children:"Actual Qty Used"}),r.items?.some(e=>e.batching)&&e.jsxs(e.Fragment,{children:[e.jsx(C,{sx:{fontWeight:600,fontSize:"0.875rem",py:1},children:"Batch Number"}),e.jsx(C,{sx:{fontWeight:600,fontSize:"0.875rem",py:1},children:"Expiry Date"})]})]})}),e.jsx(w,{children:r.items?.map(t=>e.jsxs(_,{children:[e.jsx(C,{sx:{py:1},children:e.jsx(i,{variant:"body2",sx:{fontWeight:500,fontSize:"0.875rem"},children:t.description})}),e.jsx(C,{sx:{py:1},children:e.jsx(i,{variant:"body2",sx:{fontSize:"0.875rem"},children:t.name})}),e.jsx(C,{sx:{py:1},children:e.jsx(i,{variant:"body2",sx:{fontWeight:500,fontSize:"0.875rem"},children:t.quantity})}),e.jsx(C,{sx:{py:1},children:e.jsx(i,{variant:"body2",sx:{fontSize:"0.875rem"},children:t.uom})}),e.jsx(C,{sx:{py:1},children:e.jsx(k,{size:"small",type:"number",value:o[t.id.toString()]||"",onChange:e=>{return n=t.id,r=e.target.value,l(e=>({...e,[n.toString()]:r})),void(c[n.toString()]&&u(e=>({...e,[n.toString()]:""})));var n,r},error:!!c[t.id.toString()],helperText:c[t.id.toString()],sx:{width:120},inputProps:{min:0,step:.01},disabled:d})}),r.items?.some(e=>e.batching)&&e.jsxs(e.Fragment,{children:[e.jsx(C,{sx:{py:1},children:t.batching?e.jsx(k,{size:"small",value:o[`${t.id}_batchNumber`]||"",onChange:e=>{return n=t.id,r=e.target.value,l(e=>({...e,[`${n}_batchNumber`]:r})),void(c[`${n}_batchNumber`]&&u(e=>({...e,[`${n}_batchNumber`]:""})));var n,r},error:!!c[`${t.id}_batchNumber`],helperText:c[`${t.id}_batchNumber`],sx:{width:140},disabled:d,placeholder:"Enter batch number"}):e.jsx(i,{variant:"body2",sx:{fontSize:"0.875rem",color:"#999"},children:"-"})}),e.jsx(C,{sx:{py:1},children:t.batching?e.jsx(j,{value:o[`${t.id}_expiryDate`]?Me(o[`${t.id}_expiryDate`]):null,onChange:e=>((e,t)=>{const n=t?t.format("YYYY-MM-DD"):"";l(t=>({...t,[`${e}_expiryDate`]:n})),c[`${e}_expiryDate`]&&u(t=>({...t,[`${e}_expiryDate`]:""}))})(t.id,e),disabled:d,slotProps:{textField:{size:"small",error:!!c[`${t.id}_expiryDate`],helperText:c[`${t.id}_expiryDate`],sx:{width:140}}},minDate:Me()}):e.jsx(i,{variant:"body2",sx:{fontSize:"0.875rem",color:"#999"},children:"-"})})]})]},t.id))})]})}),Object.keys(c).length>0&&e.jsx(A,{severity:"error",sx:{mb:2,py:1},children:"Please fill in all required fields with valid values."}),!d&&e.jsx(t,{sx:{display:"flex",justifyContent:"flex-end",pt:1},children:e.jsx(n,{variant:"contained",onClick:()=>{(()=>{const e={};return r.items?.forEach(t=>{const n=o[t.id.toString()];if(!n||"string"==typeof n&&""===n.trim())e[t.id.toString()]="Actual quantity is required";else{const r=parseFloat(String(n));(isNaN(r)||r<0)&&(e[t.id.toString()]="Please enter a valid positive number")}if(t.batching){const n=o[`${t.id}_batchNumber`];(!n||"string"==typeof n&&""===n.trim())&&(e[`${t.id}_batchNumber`]="Batch number is required");const r=o[`${t.id}_expiryDate`];if(!r||"string"==typeof r&&""===r.trim())e[`${t.id}_expiryDate`]="Expiry date is required";else{const n=Me(String(r));n.isValid()?n.isBefore(Me(),"day")&&(e[`${t.id}_expiryDate`]="Expiry date cannot be in the past"):e[`${t.id}_expiryDate`]="Please enter a valid date"}}}),u(e),0===Object.keys(e).length})()&&s(o)},sx:{backgroundColor:"#1976d2","&:hover":{backgroundColor:"#1565c0"}},children:"Complete step"})})]})})},tt=(e,t,n)=>e<t?"Lesser":e>n?"Greater":"Accepted",nt=({step:r,executionData:a,onStepComplete:o})=>{const[l,h]=je.useState({entries:[]}),[p,g]=je.useState({}),[m,x]=je.useState({}),y="completed"===r.status,b=je.useMemo(()=>{if(!r.items||!a.catalystData?.catalystConfiguration)return[];const e=(e=>{const t={};return e.forEach(e=>{const n=e.materialCode||"Unknown";t[n]||(t[n]=[]),t[n].push(e)}),Object.keys(t).forEach(e=>{t[e].sort((e,t)=>(e.order||0)-(t.order||0))}),t})(r.items),t=[];return Object.entries(e).forEach(([,e])=>{e.forEach(e=>{const n=`${e.id}_${e.order||0}`,r=e.splitting?e.splitQuantity||"0":e.quantity;t.push({id:n,materialId:e.id,materialCode:e.materialCode||"Unknown",materialName:e.materialName||"Unknown Material",quantity:r,uom:e.uom,order:e.order,isSplit:e.splitting||!1,temperature:"",humidity:"",actualQuantity:"",catalystQuantity:"",calculatedMin:0,calculatedMax:0,validationStatus:"Accepted",acknowledged:!1,blocked:!1,requiresSupervisorApproval:!1})})}),t},[r.items,a.catalystData?.catalystConfiguration]);je.useEffect(()=>{if(b.length>0&&0===l.entries.length){const e=a.prcAggregatedSteps?.bom||{},t={entries:b.map(t=>{const n=t.materialId.toString(),r=t.order||0,i=e[n],a=i?.[r.toString()];return a?{...t,calculatedMax:a.calculatedMax||0,calculatedMin:a.calculatedMin||0,catalystQuantity:a.catalystQuantity||"",validationStatus:a.validationStatus||"Accepted",humidity:a.humidity||"",actualQuantity:a.actualQuantity||0,temperature:a.temperature||""}:t})},n={};b.forEach(t=>{const r=t.materialId.toString(),i=t.order||0,a=e[r],s=a?.[i.toString()];s&&s.acknowledged&&(n[t.id]=!0)}),setTimeout(()=>{x(n),h(t)},0)}},[b,l.entries.length,a.prcAggregatedSteps?.bom]);const S=(e,t,n)=>{h(r=>({entries:r.entries.map(r=>{if(r.id===e){const e={...r,[t]:n};if(("temperature"===t||"humidity"===t||"actualQuantity"===t)&&a.catalystData?.catalystConfiguration&&(e.calculatedMin=0,e.calculatedMax=0,e.blocked=!1,e.requiresSupervisorApproval=!1,e.validationStatus="Accepted",e.temperature&&e.humidity)){const t=parseFloat(e.temperature),n=parseFloat(e.humidity);if(!isNaN(t)&&!isNaN(n)){const r=(i=t,s=n,a.catalystData.catalystConfiguration.find(e=>{const t=parseFloat(e.minTemperature),n=parseFloat(e.maxTemperature),r=parseFloat(e.minHumidity),a=parseFloat(e.maxHumidity);return i>=t&&i<=n&&s>=r&&s<=a}));if(r){const t=parseFloat(e.quantity);if(!isNaN(t)){const n=((e,t,n)=>{const r=(e=>{switch(e.toLowerCase()){case"gelcoat":default:return"gelcoat";case"resin":return"resinDosage";case"topcoat":return"topCoat"}})(t),i=`min${r.charAt(0).toUpperCase()}${r.slice(1)}`,a=`max${r.charAt(0).toUpperCase()}${r.slice(1)}`;return{min:parseFloat(n[i]||"0")*e,max:parseFloat(n[a]||"0")*e}})(t,e.materialCode,r);if(e.calculatedMin=n.min,e.calculatedMax=n.max,e.blocked=r.blockCatalystMixing,e.requiresSupervisorApproval=r.requestSupervisorApproval,e.catalystQuantity){const t=parseFloat(e.catalystQuantity);isNaN(t)||(e.validationStatus=tt(t,e.calculatedMin,e.calculatedMax))}}}}}if("catalystQuantity"===t&&n&&e.calculatedMin>0&&e.calculatedMax>0){const t=parseFloat(n);isNaN(t)||(e.validationStatus=tt(t,e.calculatedMin,e.calculatedMax))}return e}var i,s;return r})})),p[e]&&g(t=>({...t,[e]:""}))},_=t=>{switch(t){case"Accepted":return e.jsx(f,{sx:{color:"success.main",fontSize:20}});case"Lesser":return e.jsx(M,{sx:{color:"warning.main",fontSize:20}});case"Greater":return e.jsx(W,{sx:{color:"error.main",fontSize:20}})}},C=t=>{const n=t.validationStatus,r="Accepted"===n?"success":"Lesser"===n?"warning":"error",i=`Range: ${n}`;return e.jsx(s,{icon:_(n),label:i,color:r,size:"small",variant:"outlined"})},w=t=>{switch(t.toLowerCase()){case"gelcoat":default:return e.jsx(G,{});case"resin":return e.jsx(L,{});case"topcoat":return e.jsx(D,{})}},j=e=>{switch(e){case"Accepted":return"#e8f5e8";case"Lesser":return"#fff3e0";case"Greater":return"#ffebee";default:return"#f5f5f5"}},q=e=>{switch(e){case"Accepted":return"#4caf50";case"Lesser":return"#ff9800";case"Greater":return"#f44336";default:return"#e0e0e0"}},B=je.useMemo(()=>{const e={};return l.entries.forEach(t=>{e[t.materialCode]||(e[t.materialCode]=[]),e[t.materialCode].push(t)}),e},[l.entries]);return e.jsxs(t,{sx:{p:3,backgroundColor:"#fafafa"},children:[Object.entries(B).map(([n,r],a)=>e.jsxs(P,{defaultExpanded:0===a,sx:{mb:2,borderRadius:2,"&:before":{display:"none"},boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsx(T,{expandIcon:e.jsx(z,{}),sx:{backgroundColor:"primary.50",borderRadius:"8px 8px 0 0","&.Mui-expanded":{borderRadius:"8px 8px 0 0"}},children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",width:"100%"},children:[e.jsx(d,{sx:{bgcolor:"primary.main",mr:2,width:32,height:32},children:w(n)}),e.jsxs(t,{sx:{flex:1},children:[e.jsx(i,{variant:"h6",sx:{fontWeight:600,color:"primary.main"},children:n}),e.jsxs(i,{variant:"body2",color:"text.secondary",children:[r.length," ",1===r.length?"entry":"entries"," •"," ",r.filter(e=>e.temperature&&e.humidity&&e.catalystQuantity).length," completed"]})]})]})}),e.jsx(I,{sx:{p:0},children:e.jsx(t,{sx:{p:2},children:r.map(n=>e.jsxs(c,{sx:{mb:2,border:"1px solid #e0e0e0",borderRadius:2,overflow:"hidden",position:"relative"},children:[e.jsxs(t,{sx:{backgroundColor:n.blocked?"error.50":"grey.50",p:2,borderBottom:"1px solid #e0e0e0"},children:[e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center"},children:[n.isSplit&&n.order&&e.jsx(s,{label:`Order ${n.order}`,size:"small",color:"primary",variant:"outlined",sx:{mr:2}}),e.jsx(i,{variant:"h6",sx:{fontWeight:500},children:n.materialName})]}),e.jsxs(t,{sx:{display:"flex",gap:1},children:[n.blocked&&e.jsx(s,{icon:e.jsx(E,{}),label:"Blocked",color:"error",size:"small",variant:"filled"}),n.requiresSupervisorApproval&&!n.blocked&&e.jsx(s,{icon:e.jsx(M,{}),label:"Supervisor Approval Required",color:"warning",size:"small",variant:"outlined"}),n.temperature&&n.humidity&&n.catalystQuantity&&!n.blocked&&e.jsx(s,{icon:e.jsx(N,{}),label:"Completed",color:"success",size:"small",variant:"outlined"})]})]}),e.jsxs(i,{variant:"body2",sx:{color:"text.secondary",mt:1},children:["Required:"," ",e.jsxs("strong",{children:[n.quantity," ",n.uom]})]})]}),e.jsxs(u,{sx:{p:3},children:[e.jsxs(R,{container:!0,spacing:3,children:[e.jsx(R,{size:{xs:12,md:3},children:e.jsx(t,{sx:{position:"relative"},children:e.jsx(k,{fullWidth:!0,label:"Temperature",type:"number",value:n.temperature,onChange:e=>S(n.id,"temperature",e.target.value),error:!!p[`${n.id}_temperature`],helperText:p[`${n.id}_temperature`]||"Enter temperature in °C",disabled:y||n.blocked,InputProps:{startAdornment:e.jsx(t,{sx:{display:"flex",alignItems:"center",mr:1},children:e.jsx(D,{sx:{color:"text.secondary",fontSize:20}})}),endAdornment:e.jsx(i,{variant:"body2",sx:{color:"text.secondary"},children:"°C"})}})})}),e.jsx(R,{size:{xs:12,md:3},children:e.jsx(k,{fullWidth:!0,label:"Humidity",type:"number",value:n.humidity,onChange:e=>S(n.id,"humidity",e.target.value),error:!!p[`${n.id}_humidity`],helperText:p[`${n.id}_humidity`]||"Enter humidity in %",disabled:y||n.blocked,InputProps:{startAdornment:e.jsx(t,{sx:{display:"flex",alignItems:"center",mr:1},children:e.jsx(L,{sx:{color:"text.secondary",fontSize:20}})}),endAdornment:e.jsx(i,{variant:"body2",sx:{color:"text.secondary"},children:"%"})}})}),e.jsx(R,{size:{xs:12,md:3},children:e.jsx(k,{fullWidth:!0,label:"Actual Quantity",type:"number",value:n.actualQuantity,onChange:e=>S(n.id,"actualQuantity",e.target.value),error:!!p[`${n.id}_actualQuantity`],helperText:p[`${n.id}_actualQuantity`]||"Enter actual quantity",disabled:y||n.blocked,InputProps:{startAdornment:e.jsx(t,{sx:{display:"flex",alignItems:"center",mr:1},children:e.jsx(G,{sx:{color:"text.secondary",fontSize:20}})})}})}),e.jsx(R,{size:{xs:12,md:3},children:e.jsx(k,{fullWidth:!0,label:"Catalyst Quantity",type:"number",value:n.catalystQuantity,onChange:e=>S(n.id,"catalystQuantity",e.target.value),error:!!p[`${n.id}_catalyst`],helperText:p[`${n.id}_catalyst`]||"Enter catalyst quantity",disabled:y||n.blocked,InputProps:{startAdornment:e.jsx(t,{sx:{display:"flex",alignItems:"center",mr:1},children:e.jsx(G,{sx:{color:"text.secondary",fontSize:20}})})}})})]}),n.calculatedMin>0&&n.calculatedMax>0&&e.jsx(v,{elevation:0,sx:{mt:3,p:2,backgroundColor:j(n.validationStatus),border:`1px solid ${q(n.validationStatus)}`,borderRadius:2},children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:2},children:[_(n.validationStatus),e.jsxs(t,{children:[e.jsx(i,{variant:"body2",color:"text.secondary",children:"Recommended Range"}),e.jsxs(i,{variant:"h6",sx:{fontWeight:600},children:[n.calculatedMin.toFixed(2)," - ",n.calculatedMax.toFixed(2)," ",n.uom]})]})]}),C(n)]})}),("Lesser"===n.validationStatus||"Greater"===n.validationStatus)&&!n.blocked&&e.jsxs(t,{sx:{mt:2},children:[e.jsx(O,{control:e.jsx(F,{checked:m[n.id]||!1,onChange:e=>{return t=n.id,r=e.target.checked,void x(e=>({...e,[t]:r}));var t,r},disabled:y}),label:e.jsx(i,{variant:"body2",color:"text.secondary",children:"I acknowledge that the catalyst quantity is outside the recommended range"})}),p[`${n.id}_acknowledge`]&&e.jsx(i,{variant:"caption",color:"error",sx:{display:"block",mt:.5},children:p[`${n.id}_acknowledge`]})]}),n.blocked&&e.jsx(A,{severity:"error",sx:{mt:2},icon:e.jsx(E,{}),children:"Catalyst mixing is blocked for this temperature and humidity configuration."})]})]},n.id))})})]},n)),Object.keys(p).length>0&&e.jsx(A,{severity:"error",sx:{mb:3,borderRadius:2},icon:e.jsx(W,{}),children:"Please fill in all required fields with valid values and acknowledge any out-of-range values."}),!y&&e.jsx(t,{sx:{display:"flex",justifyContent:"flex-end",pt:2},children:e.jsx(n,{variant:"contained",onClick:()=>{if((()=>{const e={};return l.entries.forEach(t=>{if(t.temperature&&""!==t.temperature.trim()){const n=parseFloat(t.temperature);isNaN(n)&&(e[`${t.id}_temperature`]="Please enter a valid temperature")}else e[`${t.id}_temperature`]="Temperature is required";if(t.humidity&&""!==t.humidity.trim()){const n=parseFloat(t.humidity);isNaN(n)&&(e[`${t.id}_humidity`]="Please enter a valid humidity")}else e[`${t.id}_humidity`]="Humidity is required";if(t.catalystQuantity&&""!==t.catalystQuantity.trim()){const n=parseFloat(t.catalystQuantity);(isNaN(n)||n<0)&&(e[`${t.id}_catalyst`]="Please enter a valid catalyst quantity")}else e[`${t.id}_catalyst`]="Catalyst quantity is required";t.blocked&&(e[`${t.id}_blocked`]="Catalyst mixing is blocked for this configuration"),"Lesser"!==t.validationStatus&&"Greater"!==t.validationStatus||m[t.id]||(e[`${t.id}_acknowledge`]="Please acknowledge the out-of-range value")}),g(e),0===Object.keys(e).length})()){const e={...l,acknowledgments:m};o(e)}},startIcon:e.jsx(N,{}),sx:{borderRadius:2,fontWeight:600,textTransform:"none"},children:"Complete Catalyst Mixing"})})]})},rt=(e,t,n)=>e<t?"Lesser":e>n?"Greater":"Accepted",it=({step:r,executionData:a,onStepComplete:o})=>{const[l,c]=je.useState({}),[u,d]=je.useState({}),p=je.useMemo(()=>{const e=r.stepData,t=[{id:"1",role:"l1",employeeName:"",employeeCode:""}];if(!e)return{formData:{},measurements:[{id:"1",value:""}],responsiblePersonData:t};if(a.prcAggregatedSteps){const n=e.stepGroupId&&e.stepId?a.prcAggregatedSteps[e.prcTemplateStepId]?.[e.stepGroupId?.toString()??""]?.[e.stepId?.toString()??""]:void 0;if(n){let r=n;"object"==typeof n&&null!==n&&"data"in n&&(r=n.data);let i=t;if("object"==typeof n&&null!==n)if("employeeName"in n&&"employeeCode"in n&&"role"in n){const e=n.role;i=[{id:"1",role:["l1","l2","l3","l4"].includes(e)?e:"l1",employeeName:n.employeeName||"",employeeCode:n.employeeCode||""}]}else"responsiblePersons"in n&&Array.isArray(n.responsiblePersons)&&(i=n.responsiblePersons.map((e,t)=>({id:e.id||(t+1).toString(),role:["l1","l2","l3","l4"].includes(e.role)?e.role:"l1",employeeName:e.employeeName||"",employeeCode:e.employeeCode||""})));if(e.multipleMeasurements&&Array.isArray(r)){return{formData:{},measurements:r.map((e,t)=>({id:(t+1).toString(),value:e.toString()})),responsiblePersonData:i}}if("string"==typeof r||"number"==typeof r)return{formData:{value:r.toString()},measurements:[{id:"1",value:""}],responsiblePersonData:i};if("object"==typeof r&&null!==r&&"value"in r)return{formData:{value:r.value.toString()},measurements:[{id:"1",value:""}],responsiblePersonData:i}}}return{formData:{},measurements:[{id:"1",value:""}],responsiblePersonData:t}},[a.prcAggregatedSteps,r]),[g,m]=je.useState(p.formData),[x,y]=je.useState(p.measurements),[b,S]=je.useState(p.responsiblePersonData);je.useEffect(()=>{m(p.formData),y(p.measurements),S(p.responsiblePersonData)},[p]);const _=r.stepData;if(!_)return e.jsx("div",{children:"Invalid step data"});const C=p&&(p.formData&&Object.keys(p.formData).length>0||p.measurements&&p.measurements.some(e=>e.value&&""!==e.value.trim())),w="completed"===r.status||C,j=e=>{m(t=>({...t,value:e})),l.value&&c(e=>({...e,value:""})),u.value&&d(e=>{const t={...e};return delete t.value,t})},P=()=>{const e=(x.length+1).toString();y(t=>[...t,{id:e,value:""}])},T=(e,t,n)=>{S(r=>r.map(r=>r.id===e?{...r,[t]:n}:r)),l[`responsiblePerson_${e}_${t}`]&&c(n=>({...n,[`responsiblePerson_${e}_${t}`]:""}))},z=(e,t)=>{d(n=>({...n,[e]:t}))},I=e=>{if(!_.stepType||"Measurement"!==_.stepType)return null;if("range"!==_.targetValueType)return null;if(!_.minimumAcceptanceValue||!_.maximumAcceptanceValue)return null;const t="string"==typeof e?parseFloat(e):"number"==typeof e?e:void 0;if(void 0===t||isNaN(t))return null;const n=parseFloat(_.minimumAcceptanceValue),r=parseFloat(_.maximumAcceptanceValue);return isNaN(n)||isNaN(r)?null:rt(t,n,r)},E=t=>{switch(t){case"Accepted":return e.jsx(f,{sx:{color:"success.main",fontSize:20}});case"Lesser":return e.jsx(M,{sx:{color:"warning.main",fontSize:20}});case"Greater":return e.jsx(W,{sx:{color:"error.main",fontSize:20}})}},N=t=>{const n="Accepted"===t?"success":"Lesser"===t?"warning":"error",r=`Range: ${t}`;return e.jsx(s,{icon:E(t),label:r,color:n,size:"small",variant:"outlined"})},D=e=>{switch(e){case"Accepted":return"#e8f5e8";case"Lesser":return"#fff3e0";case"Greater":return"#ffebee";default:return"#f5f5f5"}},L=e=>{switch(e){case"Accepted":return"#4caf50";case"Lesser":return"#ff9800";case"Greater":return"#f44336";default:return"#e0e0e0"}};return e.jsxs(t,{sx:{p:2,backgroundColor:"white"},children:[e.jsxs(t,{sx:{mb:2},children:[e.jsx(i,{variant:"h6",sx:{fontWeight:600,color:"#333",mb:.5,lineHeight:1.3},children:r.title}),r.description&&r.description!==r.title&&e.jsx(i,{variant:"body2",sx:{color:"#666",mb:1.5,fontSize:"0.875rem"},children:r.description})]}),e.jsxs(t,{sx:{mb:2,p:1.5,backgroundColor:"#f8f9fa",borderRadius:1,border:"1px solid #e9ecef"},children:[e.jsxs(R,{container:!0,spacing:1.5,children:[e.jsxs(R,{size:{xs:6,sm:3},children:[e.jsx(i,{variant:"caption",sx:{fontWeight:500,color:"#666",fontSize:"0.75rem"},children:"Step Type"}),e.jsx(i,{variant:"body2",sx:{fontSize:"0.875rem",fontWeight:500},children:_.stepType})]}),e.jsxs(R,{size:{xs:6,sm:3},children:[e.jsx(i,{variant:"caption",sx:{fontWeight:500,color:"#666",fontSize:"0.75rem"},children:"Evaluation Method"}),e.jsx(i,{variant:"body2",sx:{fontSize:"0.875rem",fontWeight:500},children:_.evaluationMethod})]}),e.jsxs(R,{size:{xs:6,sm:3},children:[e.jsx(i,{variant:"caption",sx:{fontWeight:500,color:"#666",fontSize:"0.75rem"},children:"UOM"}),e.jsx(i,{variant:"body2",sx:{fontSize:"0.875rem",fontWeight:500},children:_.uom||"N/A"})]}),e.jsxs(R,{size:{xs:6,sm:3},children:[e.jsx(i,{variant:"caption",sx:{fontWeight:500,color:"#666",fontSize:"0.75rem"},children:"Target Type"}),e.jsx(i,{variant:"body2",sx:{fontSize:"0.875rem",fontWeight:500},children:_.targetValueType})]})]}),"range"===_.targetValueType&&_.minValue&&_.maxValue&&e.jsx(t,{sx:{mt:1.5,p:1,backgroundColor:"#fff3cd",borderRadius:.5,border:"1px solid #ffeaa7"},children:e.jsxs(R,{container:!0,spacing:1.5,children:[e.jsxs(R,{size:{xs:6,sm:3},children:[e.jsx(i,{variant:"caption",sx:{fontWeight:600,color:"#856404",fontSize:"0.75rem"},children:"Min Acceptable Value"}),e.jsxs(i,{variant:"body2",sx:{fontSize:"0.875rem",fontWeight:600,color:"#856404"},children:[_.minValue," ",_.uom]})]}),e.jsxs(R,{size:{xs:6,sm:3},children:[e.jsx(i,{variant:"caption",sx:{fontWeight:600,color:"#856404",fontSize:"0.75rem"},children:"Max Acceptable Value"}),e.jsxs(i,{variant:"body2",sx:{fontSize:"0.875rem",fontWeight:600,color:"#856404"},children:[_.maxValue," ",_.uom]})]}),"Measurement"===_.stepType&&_.minimumAcceptanceValue&&_.maximumAcceptanceValue&&e.jsxs(e.Fragment,{children:[e.jsxs(R,{size:{xs:6,sm:3},children:[e.jsx(i,{variant:"caption",sx:{fontWeight:600,color:"#d32f2f",fontSize:"0.75rem"},children:"Acceptance Range Min"}),e.jsxs(i,{variant:"body2",sx:{fontSize:"0.875rem",fontWeight:600,color:"#d32f2f"},children:[_.minimumAcceptanceValue," ",_.uom]})]}),e.jsxs(R,{size:{xs:6,sm:3},children:[e.jsx(i,{variant:"caption",sx:{fontWeight:600,color:"#d32f2f",fontSize:"0.75rem"},children:"Acceptance Range Max"}),e.jsxs(i,{variant:"body2",sx:{fontSize:"0.875rem",fontWeight:600,color:"#d32f2f"},children:[_.maximumAcceptanceValue," ",_.uom]})]})]}),_.multipleMeasurements&&_.multipleMeasurementMaxCount&&e.jsxs(R,{size:{xs:12,sm:6},children:[e.jsx(i,{variant:"caption",sx:{fontWeight:600,color:"#856404",fontSize:"0.75rem"},children:"Multiple Measurements"}),e.jsxs(i,{variant:"body2",sx:{fontSize:"0.875rem",fontWeight:600,color:"#856404"},children:["Max ",_.multipleMeasurementMaxCount," measurements allowed"]})]})]})}),_.notes&&_.notes.trim()&&e.jsxs(t,{sx:{mt:1.5,p:1,backgroundColor:"#e3f2fd",borderRadius:.5,border:"1px solid #bbdefb"},children:[e.jsx(i,{variant:"caption",sx:{fontWeight:600,color:"#1565c0",fontSize:"0.75rem"},children:"Important Notes"}),e.jsx(i,{variant:"body2",sx:{fontSize:"0.875rem",color:"#1565c0",mt:.5},children:_.notes})]})]}),e.jsxs(t,{sx:{mb:2},children:[e.jsx(i,{variant:"subtitle1",sx:{fontWeight:600,color:"#333",mb:1.5,fontSize:"1rem"},children:_.parameterDescription}),(()=>{if("ok/not ok"===_.targetValueType)return e.jsxs($,{component:"fieldset",disabled:w,children:[e.jsx(Q,{component:"legend",sx:{fontSize:"0.875rem",color:"#666",mb:1},children:"Select Result"}),e.jsxs(Y,{row:!0,value:g.value||"",onChange:e=>j(e.target.value),sx:{gap:2},children:[e.jsx(O,{value:"ok",control:e.jsx(X,{size:"small",color:"success"}),label:"OK",sx:{"& .MuiFormControlLabel-label":{fontSize:"0.875rem",color:"ok"===g.value?"#2e7d32":"#666"}}}),e.jsx(O,{value:"not ok",control:e.jsx(X,{size:"small",color:"error"}),label:"Not OK",sx:{"& .MuiFormControlLabel-label":{fontSize:"0.875rem",color:"not ok"===g.value?"#d32f2f":"#666"}}})]})]});if(_.multipleMeasurements){const r=_.multipleMeasurementMaxCount||10,a="Measurement"===_.stepType&&"range"===_.targetValueType&&_.minimumAcceptanceValue&&_.maximumAcceptanceValue;return e.jsxs(t,{children:[e.jsxs(i,{variant:"body2",sx:{mb:1,fontWeight:500,color:"#666"},children:["Multiple Measurements (Max ",r," allowed):"]}),x.map((n,r)=>{const s=a&&n.value?I(n.value):null,o=s&&"Accepted"!==s;return e.jsxs(t,{sx:{mb:2},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[e.jsxs(i,{variant:"body2",sx:{minWidth:"60px"},children:[r+1,":"]}),e.jsx(k,{size:"small",type:"number",value:n.value,onChange:e=>((e,t)=>{y(n=>n.map(n=>n.id===e?{...n,value:t}:n));const n=`measurement_${e}`;u[n]&&d(e=>{const t={...e};return delete t[n],t}),l[`measurement_${e}`]&&c(t=>({...t,[`measurement_${e}`]:""}))})(n.id,e.target.value),error:!!l[`measurement_${n.id}`],helperText:l[`measurement_${n.id}`],sx:{flex:1},inputProps:{min:_.minValue?parseFloat(_.minValue):0,max:_.maxValue?parseFloat(_.maxValue):void 0,step:.01},disabled:w}),_.uom&&"None"!==_.uom&&e.jsx(i,{variant:"body2",sx:{color:"#666",minWidth:"40px"},children:_.uom}),x.length>1&&!w&&e.jsx(h,{onClick:()=>{return e=n.id,void(x.length>1&&y(t=>t.filter(t=>t.id!==e)));var e},color:"error",size:"small",children:e.jsx(B,{})})]}),a&&n.value&&s&&null!==s&&e.jsx(v,{elevation:0,sx:{mt:2,ml:8,p:2,backgroundColor:D(s),border:`1px solid ${L(s)}`,borderRadius:2},children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:2},children:[E(s),e.jsxs(t,{children:[e.jsx(i,{variant:"body2",color:"text.secondary",children:"Acceptance Range"}),e.jsxs(i,{variant:"h6",sx:{fontWeight:600},children:[_.minimumAcceptanceValue," - ",_.maximumAcceptanceValue," ",_.uom||""]})]})]}),N(s)]})}),o&&!w&&e.jsxs(t,{sx:{mt:2,ml:8},children:[e.jsx(O,{control:e.jsx(F,{checked:u[`measurement_${n.id}`]||!1,onChange:e=>z(`measurement_${n.id}`,e.target.checked),disabled:w}),label:e.jsx(i,{variant:"body2",color:"text.secondary",children:"I acknowledge that the measurement value is outside the acceptable range"})}),l[`measurement_${n.id}_acknowledge`]&&e.jsx(i,{variant:"caption",color:"error",sx:{display:"block",mt:.5},children:l[`measurement_${n.id}_acknowledge`]})]})]},n.id)}),x.length<r&&!w&&e.jsxs(n,{startIcon:e.jsx(q,{}),onClick:P,variant:"outlined",size:"small",children:["Add Measurement (",x.length,"/",r,")"]})]})}const r="Measurement"===_.stepType&&"range"===_.targetValueType&&_.minimumAcceptanceValue&&_.maximumAcceptanceValue,a=r&&g.value&&("string"==typeof g.value||"number"==typeof g.value)?I(g.value):null,s=a&&"Accepted"!==a;return e.jsxs(t,{children:[e.jsx(k,{label:"Value",type:"number",value:g.value||"",onChange:e=>j(e.target.value),error:!!l.value,helperText:l.value,fullWidth:!0,inputProps:{min:_.minValue?parseFloat(_.minValue):0,max:_.maxValue?parseFloat(_.maxValue):void 0,step:.01},disabled:w}),_.uom&&"None"!==_.uom&&e.jsxs(i,{variant:"caption",sx:{color:"#666",mt:.5,display:"block"},children:["Unit: ",_.uom]}),r&&g.value&&null!==a?e.jsx(v,{elevation:0,sx:{mt:2,p:2,backgroundColor:D(a),border:`1px solid ${L(a)}`,borderRadius:2},children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:2},children:[E(a),e.jsxs(t,{children:[e.jsx(i,{variant:"body2",color:"text.secondary",children:"Acceptance Range"}),e.jsxs(i,{variant:"h6",sx:{fontWeight:600},children:[String(_.minimumAcceptanceValue||"")," - ",String(_.maximumAcceptanceValue||"")," ",_.uom||""]})]})]}),N(a)]})}):null,s&&!w&&e.jsxs(t,{sx:{mt:2},children:[e.jsx(O,{control:e.jsx(F,{checked:u.value||!1,onChange:e=>z("value",e.target.checked),disabled:w}),label:e.jsx(i,{variant:"body2",color:"text.secondary",children:"I acknowledge that the measurement value is outside the acceptable range"})}),l.value_acknowledge&&e.jsx(i,{variant:"caption",color:"error",sx:{display:"block",mt:.5},children:l.value_acknowledge})]})]})})()]}),_.responsiblePerson&&e.jsxs(t,{sx:{mb:2,p:2,backgroundColor:"#f8f9fa",borderRadius:1,border:"1px solid #e9ecef"},children:[e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1.5},children:[e.jsx(i,{variant:"subtitle1",sx:{fontWeight:600,color:"#333",fontSize:"1rem"},children:"Responsible Person Details"}),!w&&e.jsx(n,{variant:"outlined",size:"small",startIcon:e.jsx(q,{}),onClick:()=>{const e=(b.length+1).toString();S(t=>[...t,{id:e,role:"l1",employeeName:"",employeeCode:""}])},sx:{borderColor:"#1976d2",color:"#1976d2","&:hover":{borderColor:"#1565c0",backgroundColor:"#e3f2fd"}},children:"Add Person"})]}),b.map((n,r)=>e.jsxs(t,{sx:{mb:2,p:2,backgroundColor:"#fff",borderRadius:1,border:"1px solid #dee2e6"},children:[e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1.5},children:[e.jsxs(i,{variant:"body2",sx:{fontWeight:600,color:"#666"},children:["Person ",r+1]}),!w&&b.length>1&&e.jsx(h,{size:"small",onClick:()=>{return e=n.id,void(b.length>1&&S(t=>t.filter(t=>t.id!==e)));var e},sx:{color:"#dc3545"},children:e.jsx(B,{fontSize:"small"})})]}),e.jsxs(R,{container:!0,spacing:2,children:[e.jsx(R,{size:{xs:12,sm:4},children:e.jsxs($,{fullWidth:!0,error:!!l[`responsiblePerson_${n.id}_role`],children:[e.jsx(H,{children:"Role"}),e.jsxs(V,{value:n.role,onChange:e=>T(n.id,"role",e.target.value),label:"Role",disabled:w,children:[e.jsx(U,{value:"l1",children:"L1"}),e.jsx(U,{value:"l2",children:"L2"}),e.jsx(U,{value:"l3",children:"L3"}),e.jsx(U,{value:"l4",children:"L4"})]}),l[`responsiblePerson_${n.id}_role`]&&e.jsx(i,{variant:"caption",color:"error",sx:{mt:.5},children:l[`responsiblePerson_${n.id}_role`]})]})}),e.jsx(R,{size:{xs:12,sm:4},children:e.jsx(k,{fullWidth:!0,label:"Employee Name",value:n.employeeName,onChange:e=>T(n.id,"employeeName",e.target.value),error:!!l[`responsiblePerson_${n.id}_employeeName`],helperText:l[`responsiblePerson_${n.id}_employeeName`],disabled:w})}),e.jsx(R,{size:{xs:12,sm:4},children:e.jsx(k,{fullWidth:!0,label:"Employee Code",value:n.employeeCode,onChange:e=>T(n.id,"employeeCode",e.target.value),error:!!l[`responsiblePerson_${n.id}_employeeCode`],helperText:l[`responsiblePerson_${n.id}_employeeCode`],disabled:w})})]})]},n.id))]}),r.ctq&&_.minValue&&_.maxValue&&e.jsx(A,{severity:"warning",sx:{mb:2,py:1},children:"This is a Critical to Quality (CTQ) parameter. Values outside the acceptable range may require supervisor approval."}),Object.keys(l).length>0&&e.jsx(A,{severity:"error",sx:{mb:3,borderRadius:2},icon:e.jsx(W,{}),children:"Please fill in all required fields with valid values and acknowledge any out-of-range values."}),!w&&e.jsx(t,{sx:{display:"flex",justifyContent:"flex-end",pt:1},children:e.jsx(n,{variant:"contained",onClick:()=>{if((()=>{const e={},t="Measurement"===_.stepType&&"range"===_.targetValueType&&_.minimumAcceptanceValue&&_.maximumAcceptanceValue;if(_.multipleMeasurements)x.forEach((n,r)=>{if(n.value&&""!==n.value.trim()){const i=parseFloat(n.value);if(isNaN(i))e[`measurement_${n.id}`]=`Measurement ${r+1} must be a valid number`;else{if("range"===_.targetValueType&&_.minValue&&_.maxValue){const t=parseFloat(_.minValue),a=parseFloat(_.maxValue);(i<t||i>a)&&(e[`measurement_${n.id}`]=`Measurement ${r+1} must be between ${t} and ${a} ${_.uom||""}`)}if(t){const t=parseFloat(_.minimumAcceptanceValue),r=parseFloat(_.maximumAcceptanceValue);isNaN(t)||isNaN(r)||"Accepted"===rt(i,t,r)||u[`measurement_${n.id}`]||(e[`measurement_${n.id}_acknowledge`]="Please acknowledge the out-of-range value")}}}else e[`measurement_${n.id}`]=`Measurement ${r+1} is required`});else if("ok/not ok"===_.targetValueType)g.value||(e.value="Please select an option");else if(!g.value||"string"==typeof g.value&&""===g.value.trim())e.value="Value is required";else{const n=parseFloat(String(g.value));if(isNaN(n))e.value="Please enter a valid number";else{if("range"===_.targetValueType&&_.minValue&&_.maxValue){const t=parseFloat(_.minValue),r=parseFloat(_.maxValue);(n<t||n>r)&&(e.value=`Value must be between ${t} and ${r} ${_.uom||""}`)}if(t){const t=parseFloat(_.minimumAcceptanceValue),r=parseFloat(_.maximumAcceptanceValue);isNaN(t)||isNaN(r)||"Accepted"===rt(n,t,r)||u.value||(e.value_acknowledge="Please acknowledge the out-of-range value")}}}return _.responsiblePerson&&b.forEach((t,n)=>{t.role||(e[`responsiblePerson_${t.id}_role`]=`Role is required for person ${n+1}`),t.employeeName&&""!==t.employeeName.trim()||(e[`responsiblePerson_${t.id}_employeeName`]=`Employee name is required for person ${n+1}`),t.employeeCode&&""!==t.employeeCode.trim()||(e[`responsiblePerson_${t.id}_employeeCode`]=`Employee code is required for person ${n+1}`)}),c(e),0===Object.keys(e).length})()){let e;e=_.multipleMeasurements?x.map(e=>e.value):String(g.value);const t={data:e,stepId:_.stepId,stepGroupId:_.stepGroupId,prcTemplateStepId:_.prcTemplateStepId};_.responsiblePerson&&(t.responsiblePersons=b.map(e=>({id:e.id,role:e.role,employeeName:e.employeeName,employeeCode:e.employeeCode})));if("Measurement"===_.stepType&&"range"===_.targetValueType&&_.minimumAcceptanceValue&&_.maximumAcceptanceValue)if(_.multipleMeasurements){const e=x.map(e=>{const t=parseFloat(e.value);if(!isNaN(t)){const n=parseFloat(_.minimumAcceptanceValue),r=parseFloat(_.maximumAcceptanceValue);if(!isNaN(n)&&!isNaN(r)){const i=rt(t,n,r);return{value:e.value,minimumAcceptanceValue:_.minimumAcceptanceValue,maximumAcceptanceValue:_.maximumAcceptanceValue,validationStatus:i}}}return{value:e.value,minimumAcceptanceValue:_.minimumAcceptanceValue,maximumAcceptanceValue:_.maximumAcceptanceValue}});t.data=e}else{const e=parseFloat(String(g.value));if(!isNaN(e)){const n=parseFloat(_.minimumAcceptanceValue),r=parseFloat(_.maximumAcceptanceValue);if(!isNaN(n)&&!isNaN(r)){const i=rt(e,n,r);t.minimumAcceptanceValue=_.minimumAcceptanceValue,t.maximumAcceptanceValue=_.maximumAcceptanceValue,t.validationStatus=i}}}o(t)}},sx:{backgroundColor:"#1976d2","&:hover":{backgroundColor:"#1565c0"}},children:"Complete step"})})]})},at=Math.PI/180;const st="undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof WorkerGlobalScope?self:{},ot={_global:st,version:"10.0.8",isBrowser:"undefined"!=typeof window&&("[object Window]"==={}.toString.call(window)||"[object global]"==={}.toString.call(window)),isUnminified:/param/.test(function(e){}.toString()),dblClickWindow:400,getAngle:e=>ot.angleDeg?e*at:e,enableTrace:!1,pointerEventsEnabled:!0,autoDrawEnabled:!0,hitOnDragEnabled:!1,capturePointerEventsEnabled:!1,_mouseListenClick:!1,_touchListenClick:!1,_pointerListenClick:!1,_mouseInDblClickWindow:!1,_touchInDblClickWindow:!1,_pointerInDblClickWindow:!1,_mouseDblClickPointerId:null,_touchDblClickPointerId:null,_pointerDblClickPointerId:null,_renderBackend:"web",legacyTextRendering:!1,pixelRatio:"undefined"!=typeof window&&window.devicePixelRatio||1,dragDistance:3,angleDeg:!0,showWarnings:!0,dragButtons:[0,1],isDragging:()=>ot.DD.isDragging,isTransforming(){var e,t;return null!==(t=null===(e=ot.Transformer)||void 0===e?void 0:e.isTransforming())&&void 0!==t&&t},isDragReady:()=>!!ot.DD.node,releaseCanvasOnDestroy:!0,document:st.document,_injectGlobal(e){st.Konva,st.Konva=e}},lt=e=>{ot[e.prototype.getClassName()]=e};ot._injectGlobal(ot);const ct=()=>{if("undefined"==typeof document)throw new Error('Konva.js unsupported environment.\n\nLooks like you are trying to use Konva.js in Node.js environment. because "document" object is undefined.\n\nTo use Konva.js in Node.js environment, you need to use the "canvas-backend" or "skia-backend" module.\n\nbash: npm install canvas\njs: import "konva/canvas-backend";\n\nor\n\nbash: npm install skia-canvas\njs: import "konva/skia-backend";\n')};class ut{constructor(e=[1,0,0,1,0,0]){this.dirty=!1,this.m=e&&e.slice()||[1,0,0,1,0,0]}reset(){this.m[0]=1,this.m[1]=0,this.m[2]=0,this.m[3]=1,this.m[4]=0,this.m[5]=0}copy(){return new ut(this.m)}copyInto(e){e.m[0]=this.m[0],e.m[1]=this.m[1],e.m[2]=this.m[2],e.m[3]=this.m[3],e.m[4]=this.m[4],e.m[5]=this.m[5]}point(e){const t=this.m;return{x:t[0]*e.x+t[2]*e.y+t[4],y:t[1]*e.x+t[3]*e.y+t[5]}}translate(e,t){return this.m[4]+=this.m[0]*e+this.m[2]*t,this.m[5]+=this.m[1]*e+this.m[3]*t,this}scale(e,t){return this.m[0]*=e,this.m[1]*=e,this.m[2]*=t,this.m[3]*=t,this}rotate(e){const t=Math.cos(e),n=Math.sin(e),r=this.m[0]*t+this.m[2]*n,i=this.m[1]*t+this.m[3]*n,a=this.m[0]*-n+this.m[2]*t,s=this.m[1]*-n+this.m[3]*t;return this.m[0]=r,this.m[1]=i,this.m[2]=a,this.m[3]=s,this}getTranslation(){return{x:this.m[4],y:this.m[5]}}skew(e,t){const n=this.m[0]+this.m[2]*t,r=this.m[1]+this.m[3]*t,i=this.m[2]+this.m[0]*e,a=this.m[3]+this.m[1]*e;return this.m[0]=n,this.m[1]=r,this.m[2]=i,this.m[3]=a,this}multiply(e){const t=this.m[0]*e.m[0]+this.m[2]*e.m[1],n=this.m[1]*e.m[0]+this.m[3]*e.m[1],r=this.m[0]*e.m[2]+this.m[2]*e.m[3],i=this.m[1]*e.m[2]+this.m[3]*e.m[3],a=this.m[0]*e.m[4]+this.m[2]*e.m[5]+this.m[4],s=this.m[1]*e.m[4]+this.m[3]*e.m[5]+this.m[5];return this.m[0]=t,this.m[1]=n,this.m[2]=r,this.m[3]=i,this.m[4]=a,this.m[5]=s,this}invert(){const e=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),t=this.m[3]*e,n=-this.m[1]*e,r=-this.m[2]*e,i=this.m[0]*e,a=e*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),s=e*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=t,this.m[1]=n,this.m[2]=r,this.m[3]=i,this.m[4]=a,this.m[5]=s,this}getMatrix(){return this.m}decompose(){const e=this.m[0],t=this.m[1],n=this.m[2],r=this.m[3],i=e*r-t*n,a={x:this.m[4],y:this.m[5],rotation:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(0!=e||0!=t){const s=Math.sqrt(e*e+t*t);a.rotation=t>0?Math.acos(e/s):-Math.acos(e/s),a.scaleX=s,a.scaleY=i/s,a.skewX=(e*n+t*r)/i,a.skewY=0}else if(0!=n||0!=r){const s=Math.sqrt(n*n+r*r);a.rotation=Math.PI/2-(r>0?Math.acos(-n/s):-Math.acos(n/s)),a.scaleX=i/s,a.scaleY=s,a.skewX=0,a.skewY=(e*n+t*r)/i}return a.rotation=xt._getRotation(a.rotation),a}}const dt=Math.PI/180,ht=180/Math.PI,pt={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],transparent:[255,255,255,0],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]},ft=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/;let gt=[];const mt="undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||function(e){setTimeout(e,60)},xt={_isElement:e=>!(!e||1!=e.nodeType),_isFunction:e=>!!(e&&e.constructor&&e.call&&e.apply),_isPlainObject:e=>!!e&&e.constructor===Object,_isArray:e=>"[object Array]"===Object.prototype.toString.call(e),_isNumber:e=>"[object Number]"===Object.prototype.toString.call(e)&&!isNaN(e)&&isFinite(e),_isString:e=>"[object String]"===Object.prototype.toString.call(e),_isBoolean:e=>"[object Boolean]"===Object.prototype.toString.call(e),isObject:e=>e instanceof Object,isValidSelector(e){if("string"!=typeof e)return!1;const t=e[0];return"#"===t||"."===t||t===t.toUpperCase()},_sign:e=>0===e||e>0?1:-1,requestAnimFrame(e){gt.push(e),1===gt.length&&mt(function(){const e=gt;gt=[],e.forEach(function(e){e()})})},createCanvasElement(){ct();const e=document.createElement("canvas");try{e.style=e.style||{}}catch(t){}return e},createImageElement:()=>(ct(),document.createElement("img")),_isInDocument(e){for(;e=e.parentNode;)if(e==document)return!0;return!1},_urlToImage(e,t){const n=xt.createImageElement();n.onload=function(){t(n)},n.src=e},_rgbToHex:(e,t,n)=>((1<<24)+(e<<16)+(t<<8)+n).toString(16).slice(1),_hexToRgb(e){e=e.replace("#","");const t=parseInt(e,16);return{r:t>>16&255,g:t>>8&255,b:255&t}},getRandomColor(){let e=(16777215*Math.random()|0).toString(16);for(;e.length<6;)e="0"+e;return"#"+e},getRGB(e){let t;return e in pt?(t=pt[e],{r:t[0],g:t[1],b:t[2]}):"#"===e[0]?this._hexToRgb(e.substring(1)):"rgb("===e.substr(0,4)?(t=ft.exec(e.replace(/ /g,"")),{r:parseInt(t[1],10),g:parseInt(t[2],10),b:parseInt(t[3],10)}):{r:0,g:0,b:0}},colorToRGBA:e=>(e=e||"black",xt._namedColorToRBA(e)||xt._hex3ColorToRGBA(e)||xt._hex4ColorToRGBA(e)||xt._hex6ColorToRGBA(e)||xt._hex8ColorToRGBA(e)||xt._rgbColorToRGBA(e)||xt._rgbaColorToRGBA(e)||xt._hslColorToRGBA(e)),_namedColorToRBA(e){const t=pt[e.toLowerCase()];return t?{r:t[0],g:t[1],b:t[2],a:1}:null},_rgbColorToRGBA(e){if(0===e.indexOf("rgb(")){const t=(e=e.match(/rgb\(([^)]+)\)/)[1]).split(/ *, */).map(Number);return{r:t[0],g:t[1],b:t[2],a:1}}},_rgbaColorToRGBA(e){if(0===e.indexOf("rgba(")){const t=(e=e.match(/rgba\(([^)]+)\)/)[1]).split(/ *, */).map((e,t)=>"%"===e.slice(-1)?3===t?parseInt(e)/100:parseInt(e)/100*255:Number(e));return{r:t[0],g:t[1],b:t[2],a:t[3]}}},_hex8ColorToRGBA(e){if("#"===e[0]&&9===e.length)return{r:parseInt(e.slice(1,3),16),g:parseInt(e.slice(3,5),16),b:parseInt(e.slice(5,7),16),a:parseInt(e.slice(7,9),16)/255}},_hex6ColorToRGBA(e){if("#"===e[0]&&7===e.length)return{r:parseInt(e.slice(1,3),16),g:parseInt(e.slice(3,5),16),b:parseInt(e.slice(5,7),16),a:1}},_hex4ColorToRGBA(e){if("#"===e[0]&&5===e.length)return{r:parseInt(e[1]+e[1],16),g:parseInt(e[2]+e[2],16),b:parseInt(e[3]+e[3],16),a:parseInt(e[4]+e[4],16)/255}},_hex3ColorToRGBA(e){if("#"===e[0]&&4===e.length)return{r:parseInt(e[1]+e[1],16),g:parseInt(e[2]+e[2],16),b:parseInt(e[3]+e[3],16),a:1}},_hslColorToRGBA(e){if(/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.test(e)){const[t,...n]=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(e),r=Number(n[0])/360,i=Number(n[1])/100,a=Number(n[2])/100;let s,o,l;if(0===i)return l=255*a,{r:Math.round(l),g:Math.round(l),b:Math.round(l),a:1};s=a<.5?a*(1+i):a+i-a*i;const c=2*a-s,u=[0,0,0];for(let e=0;e<3;e++)o=r+1/3*-(e-1),o<0&&o++,o>1&&o--,l=6*o<1?c+6*(s-c)*o:2*o<1?s:3*o<2?c+(s-c)*(2/3-o)*6:c,u[e]=255*l;return{r:Math.round(u[0]),g:Math.round(u[1]),b:Math.round(u[2]),a:1}}},haveIntersection:(e,t)=>!(t.x>e.x+e.width||t.x+t.width<e.x||t.y>e.y+e.height||t.y+t.height<e.y),cloneObject(e){const t={};for(const n in e)this._isPlainObject(e[n])?t[n]=this.cloneObject(e[n]):this._isArray(e[n])?t[n]=this.cloneArray(e[n]):t[n]=e[n];return t},cloneArray:e=>e.slice(0),degToRad:e=>e*dt,radToDeg:e=>e*ht,_degToRad:e=>(xt.warn("Util._degToRad is removed. Please use public Util.degToRad instead."),xt.degToRad(e)),_radToDeg:e=>(xt.warn("Util._radToDeg is removed. Please use public Util.radToDeg instead."),xt.radToDeg(e)),_getRotation:e=>ot.angleDeg?xt.radToDeg(e):e,_capitalize:e=>e.charAt(0).toUpperCase()+e.slice(1),throw(e){throw new Error("Konva error: "+e)},error(e){},warn(e){ot.showWarnings},each(e,t){for(const n in e)t(n,e[n])},_inRange:(e,t,n)=>t<=e&&e<n,_getProjectionToSegment(e,t,n,r,i,a){let s,o,l;const c=(e-n)*(e-n)+(t-r)*(t-r);if(0==c)s=e,o=t,l=(i-n)*(i-n)+(a-r)*(a-r);else{const u=((i-e)*(n-e)+(a-t)*(r-t))/c;u<0?(s=e,o=t,l=(e-i)*(e-i)+(t-a)*(t-a)):u>1?(s=n,o=r,l=(n-i)*(n-i)+(r-a)*(r-a)):(s=e+u*(n-e),o=t+u*(r-t),l=(s-i)*(s-i)+(o-a)*(o-a))}return[s,o,l]},_getProjectionToLine(e,t,n){const r=xt.cloneObject(e);let i=Number.MAX_VALUE;return t.forEach(function(a,s){if(!n&&s===t.length-1)return;const o=t[(s+1)%t.length],l=xt._getProjectionToSegment(a.x,a.y,o.x,o.y,e.x,e.y),c=l[0],u=l[1],d=l[2];d<i&&(r.x=c,r.y=u,i=d)}),r},_prepareArrayForTween(e,t,n){const r=[],i=[];if(e.length>t.length){const n=t;t=e,e=n}for(let s=0;s<e.length;s+=2)r.push({x:e[s],y:e[s+1]});for(let s=0;s<t.length;s+=2)i.push({x:t[s],y:t[s+1]});const a=[];return i.forEach(function(e){const t=xt._getProjectionToLine(e,r,n);a.push(t.x),a.push(t.y)}),a},_prepareToStringify(e){let t;e.visitedByCircularReferenceRemoval=!0;for(const n in e)if(e.hasOwnProperty(n)&&e[n]&&"object"==typeof e[n])if(t=Object.getOwnPropertyDescriptor(e,n),e[n].visitedByCircularReferenceRemoval||xt._isElement(e[n])){if(!t.configurable)return null;delete e[n]}else if(null===xt._prepareToStringify(e[n])){if(!t.configurable)return null;delete e[n]}return delete e.visitedByCircularReferenceRemoval,e},_assign(e,t){for(const n in t)e[n]=t[n];return e},_getFirstPointerId:e=>e.touches?e.changedTouches[0].identifier:e.pointerId||999,releaseCanvas(...e){ot.releaseCanvasOnDestroy&&e.forEach(e=>{e.width=0,e.height=0})},drawRoundedRectPath(e,t,n,r){let i=t<0?t:0,a=n<0?n:0;t=Math.abs(t),n=Math.abs(n);let s=0,o=0,l=0,c=0;"number"==typeof r?s=o=l=c=Math.min(r,t/2,n/2):(s=Math.min(r[0]||0,t/2,n/2),o=Math.min(r[1]||0,t/2,n/2),c=Math.min(r[2]||0,t/2,n/2),l=Math.min(r[3]||0,t/2,n/2)),e.moveTo(i+s,a),e.lineTo(i+t-o,a),e.arc(i+t-o,a+o,o,3*Math.PI/2,0,!1),e.lineTo(i+t,a+n-c),e.arc(i+t-c,a+n-c,c,0,Math.PI/2,!1),e.lineTo(i+l,a+n),e.arc(i+l,a+n-l,l,Math.PI/2,Math.PI,!1),e.lineTo(i,a+s),e.arc(i+s,a+s,s,Math.PI,3*Math.PI/2,!1)},drawRoundedPolygonPath(e,t,n,r,i){r=Math.abs(r);for(let a=0;a<n;a++){const s=t[(a-1+n)%n],o=t[a],l=t[(a+1)%n],c={x:o.x-s.x,y:o.y-s.y},u={x:l.x-o.x,y:l.y-o.y},d=Math.hypot(c.x,c.y),h=Math.hypot(u.x,u.y);let p;p="number"==typeof i?i:a<i.length?i[a]:0;p=r*Math.cos(Math.PI/n)*Math.min(1,p/r*2);const f={x:c.x/d,y:c.y/d},g={x:u.x/h,y:u.y/h},m={x:o.x-f.x*p,y:o.y-f.y*p},x={x:o.x+g.x*p,y:o.y+g.y*p};0===a?e.moveTo(m.x,m.y):e.lineTo(m.x,m.y),e.arcTo(o.x,o.y,x.x,x.y,p)}}};const yt=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","ellipse","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","roundRect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"];let vt,bt=null;function St(){if(null!==bt)return bt;try{const e=xt.createCanvasElement().getContext("2d");return e?!!e&&"filter"in e:(bt=!1,!1)}catch(e){return bt=!1,!1}}class _t{constructor(e){this.canvas=e,ot.enableTrace&&(this.traceArr=[],this._enableTrace())}fillShape(e){e.fillEnabled()&&this._fill(e)}_fill(e){}strokeShape(e){e.hasStroke()&&this._stroke(e)}_stroke(e){}fillStrokeShape(e){e.attrs.fillAfterStrokeEnabled?(this.strokeShape(e),this.fillShape(e)):(this.fillShape(e),this.strokeShape(e))}getTrace(e,t){let n,r,i,a,s=this.traceArr,o=s.length,l="";for(n=0;n<o;n++)r=s[n],i=r.method,i?(a=r.args,l+=i,e?l+="()":xt._isArray(a[0])?l+="(["+a.join(",")+"])":(t&&(a=a.map(e=>"number"==typeof e?Math.floor(e):e)),l+="("+a.join(",")+")")):(l+=r.property,e||(l+="="+r.val)),l+=";";return l}clearTrace(){this.traceArr=[]}_trace(e){let t,n=this.traceArr;n.push(e),t=n.length,t>=100&&n.shift()}reset(){const e=this.getCanvas().getPixelRatio();this.setTransform(1*e,0,0,1*e,0,0)}getCanvas(){return this.canvas}clear(e){const t=this.getCanvas();e?this.clearRect(e.x||0,e.y||0,e.width||0,e.height||0):this.clearRect(0,0,t.getWidth()/t.pixelRatio,t.getHeight()/t.pixelRatio)}_applyLineCap(e){const t=e.attrs.lineCap;t&&this.setAttr("lineCap",t)}_applyOpacity(e){const t=e.getAbsoluteOpacity();1!==t&&this.setAttr("globalAlpha",t)}_applyLineJoin(e){const t=e.attrs.lineJoin;t&&this.setAttr("lineJoin",t)}_applyMiterLimit(e){const t=e.attrs.miterLimit;null!=t&&this.setAttr("miterLimit",t)}setAttr(e,t){this._context[e]=t}arc(e,t,n,r,i,a){this._context.arc(e,t,n,r,i,a)}arcTo(e,t,n,r,i){this._context.arcTo(e,t,n,r,i)}beginPath(){this._context.beginPath()}bezierCurveTo(e,t,n,r,i,a){this._context.bezierCurveTo(e,t,n,r,i,a)}clearRect(e,t,n,r){this._context.clearRect(e,t,n,r)}clip(...e){this._context.clip.apply(this._context,e)}closePath(){this._context.closePath()}createImageData(e,t){const n=arguments;return 2===n.length?this._context.createImageData(e,t):1===n.length?this._context.createImageData(e):void 0}createLinearGradient(e,t,n,r){return this._context.createLinearGradient(e,t,n,r)}createPattern(e,t){return this._context.createPattern(e,t)}createRadialGradient(e,t,n,r,i,a){return this._context.createRadialGradient(e,t,n,r,i,a)}drawImage(e,t,n,r,i,a,s,o,l){const c=arguments,u=this._context;3===c.length?u.drawImage(e,t,n):5===c.length?u.drawImage(e,t,n,r,i):9===c.length&&u.drawImage(e,t,n,r,i,a,s,o,l)}ellipse(e,t,n,r,i,a,s,o){this._context.ellipse(e,t,n,r,i,a,s,o)}isPointInPath(e,t,n,r){return n?this._context.isPointInPath(n,e,t,r):this._context.isPointInPath(e,t,r)}fill(...e){this._context.fill.apply(this._context,e)}fillRect(e,t,n,r){this._context.fillRect(e,t,n,r)}strokeRect(e,t,n,r){this._context.strokeRect(e,t,n,r)}fillText(e,t,n,r){r?this._context.fillText(e,t,n,r):this._context.fillText(e,t,n)}measureText(e){return this._context.measureText(e)}getImageData(e,t,n,r){return this._context.getImageData(e,t,n,r)}lineTo(e,t){this._context.lineTo(e,t)}moveTo(e,t){this._context.moveTo(e,t)}rect(e,t,n,r){this._context.rect(e,t,n,r)}roundRect(e,t,n,r,i){this._context.roundRect(e,t,n,r,i)}putImageData(e,t,n){this._context.putImageData(e,t,n)}quadraticCurveTo(e,t,n,r){this._context.quadraticCurveTo(e,t,n,r)}restore(){this._context.restore()}rotate(e){this._context.rotate(e)}save(){this._context.save()}scale(e,t){this._context.scale(e,t)}setLineDash(e){this._context.setLineDash?this._context.setLineDash(e):"mozDash"in this._context?this._context.mozDash=e:"webkitLineDash"in this._context&&(this._context.webkitLineDash=e)}getLineDash(){return this._context.getLineDash()}setTransform(e,t,n,r,i,a){this._context.setTransform(e,t,n,r,i,a)}stroke(e){e?this._context.stroke(e):this._context.stroke()}strokeText(e,t,n,r){this._context.strokeText(e,t,n,r)}transform(e,t,n,r,i,a){this._context.transform(e,t,n,r,i,a)}translate(e,t){this._context.translate(e,t)}_enableTrace(){let e,t,n=this,r=yt.length,i=this.setAttr;const a=function(e){let r,i=n[e];n[e]=function(){return t=function(e){const t=[],n=e.length,r=xt;for(let i=0;i<n;i++){let n=e[i];r._isNumber(n)?n=Math.round(1e3*n)/1e3:r._isString(n)||(n+=""),t.push(n)}return t}(Array.prototype.slice.call(arguments,0)),r=i.apply(n,arguments),n._trace({method:e,args:t}),r}};for(e=0;e<r;e++)a(yt[e]);n.setAttr=function(){i.apply(n,arguments);const e=arguments[0];let t=arguments[1];"shadowOffsetX"!==e&&"shadowOffsetY"!==e&&"shadowBlur"!==e||(t/=this.canvas.getPixelRatio()),n._trace({property:e,val:t})}}_applyGlobalCompositeOperation(e){const t=e.attrs.globalCompositeOperation;!t||"source-over"===t||this.setAttr("globalCompositeOperation",t)}}["fillStyle","strokeStyle","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","letterSpacing","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","direction","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation","imageSmoothingEnabled","filter"].forEach(function(e){Object.defineProperty(_t.prototype,e,{get(){return this._context[e]},set(t){this._context[e]=t}})});class Ct extends _t{constructor(e,{willReadFrequently:t=!1}={}){super(e),this._context=e._canvas.getContext("2d",{willReadFrequently:t})}_fillColor(e){const t=e.fill();this.setAttr("fillStyle",t),e._fillFunc(this)}_fillPattern(e){this.setAttr("fillStyle",e._getFillPattern()),e._fillFunc(this)}_fillLinearGradient(e){const t=e._getLinearGradient();t&&(this.setAttr("fillStyle",t),e._fillFunc(this))}_fillRadialGradient(e){const t=e._getRadialGradient();t&&(this.setAttr("fillStyle",t),e._fillFunc(this))}_fill(e){const t=e.fill(),n=e.getFillPriority();if(t&&"color"===n)return void this._fillColor(e);const r=e.getFillPatternImage();if(r&&"pattern"===n)return void this._fillPattern(e);const i=e.getFillLinearGradientColorStops();if(i&&"linear-gradient"===n)return void this._fillLinearGradient(e);const a=e.getFillRadialGradientColorStops();a&&"radial-gradient"===n?this._fillRadialGradient(e):t?this._fillColor(e):r?this._fillPattern(e):i?this._fillLinearGradient(e):a&&this._fillRadialGradient(e)}_strokeLinearGradient(e){const t=e.getStrokeLinearGradientStartPoint(),n=e.getStrokeLinearGradientEndPoint(),r=e.getStrokeLinearGradientColorStops(),i=this.createLinearGradient(t.x,t.y,n.x,n.y);if(r){for(let e=0;e<r.length;e+=2)i.addColorStop(r[e],r[e+1]);this.setAttr("strokeStyle",i)}}_stroke(e){const t=e.dash(),n=e.getStrokeScaleEnabled();if(e.hasStroke()){if(!n){this.save();const e=this.getCanvas().getPixelRatio();this.setTransform(e,0,0,e,0,0)}this._applyLineCap(e),t&&e.dashEnabled()&&(this.setLineDash(t),this.setAttr("lineDashOffset",e.dashOffset())),this.setAttr("lineWidth",e.strokeWidth()),e.getShadowForStrokeEnabled()||this.setAttr("shadowColor","rgba(0,0,0,0)");e.getStrokeLinearGradientColorStops()?this._strokeLinearGradient(e):this.setAttr("strokeStyle",e.stroke()),e._strokeFunc(this),n||this.restore()}}_applyShadow(e){var t,n,r;const i=null!==(t=e.getShadowRGBA())&&void 0!==t?t:"black",a=null!==(n=e.getShadowBlur())&&void 0!==n?n:5,s=null!==(r=e.getShadowOffset())&&void 0!==r?r:{x:0,y:0},o=e.getAbsoluteScale(),l=this.canvas.getPixelRatio(),c=o.x*l,u=o.y*l;this.setAttr("shadowColor",i),this.setAttr("shadowBlur",a*Math.min(Math.abs(c),Math.abs(u))),this.setAttr("shadowOffsetX",s.x*c),this.setAttr("shadowOffsetY",s.y*u)}}class wt extends _t{constructor(e){super(e),this._context=e._canvas.getContext("2d",{willReadFrequently:!0})}_fill(e){this.save(),this.setAttr("fillStyle",e.colorKey),e._fillFuncHit(this),this.restore()}strokeShape(e){e.hasHitStroke()&&this._stroke(e)}_stroke(e){if(e.hasHitStroke()){const t=e.getStrokeScaleEnabled();if(!t){this.save();const e=this.getCanvas().getPixelRatio();this.setTransform(e,0,0,e,0,0)}this._applyLineCap(e);const n=e.hitStrokeWidth(),r="auto"===n?e.strokeWidth():n;this.setAttr("lineWidth",r),this.setAttr("strokeStyle",e.colorKey),e._strokeFuncHit(this),t||this.restore()}}}class kt{constructor(e){this.pixelRatio=1,this.width=0,this.height=0,this.isCache=!1;const t=(e||{}).pixelRatio||ot.pixelRatio||function(){if(vt)return vt;const e=xt.createCanvasElement(),t=e.getContext("2d");return vt=(ot._global.devicePixelRatio||1)/(t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1),xt.releaseCanvas(e),vt}();this.pixelRatio=t,this._canvas=xt.createCanvasElement(),this._canvas.style.padding="0",this._canvas.style.margin="0",this._canvas.style.border="0",this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0"}getContext(){return this.context}getPixelRatio(){return this.pixelRatio}setPixelRatio(e){const t=this.pixelRatio;this.pixelRatio=e,this.setSize(this.getWidth()/t,this.getHeight()/t)}setWidth(e){this.width=this._canvas.width=e*this.pixelRatio,this._canvas.style.width=e+"px";const t=this.pixelRatio;this.getContext()._context.scale(t,t)}setHeight(e){this.height=this._canvas.height=e*this.pixelRatio,this._canvas.style.height=e+"px";const t=this.pixelRatio;this.getContext()._context.scale(t,t)}getWidth(){return this.width}getHeight(){return this.height}setSize(e,t){this.setWidth(e||0),this.setHeight(t||0)}toDataURL(e,t){try{return this._canvas.toDataURL(e,t)}catch(n){try{return this._canvas.toDataURL()}catch(r){return xt.error("Unable to get data URL. "+r.message+" For more info read https://konvajs.org/docs/posts/Tainted_Canvas.html."),""}}}}class jt extends kt{constructor(e={width:0,height:0,willReadFrequently:!1}){super(e),this.context=new Ct(this,{willReadFrequently:e.willReadFrequently}),this.setSize(e.width,e.height)}}function At(){const e=xt.createCanvasElement();e.width=1,e.height=1;const t=e.getContext("2d",{willReadFrequently:!0});t.clearRect(0,0,1,1),t.fillStyle="rgba(255,0,255,1)",t.fillRect(0,0,1,1);const n=t.getImageData(0,0,1,1).data;return!(255===n[0]&&0===n[1]&&255===n[2]&&255===n[3])}function Pt(){var e,t;return"undefined"!=typeof navigator&&(null!==(t=null===(e=navigator.brave)||void 0===e?void 0:e.isBrave())&&void 0!==t&&t)}let Tt=!1;class zt extends kt{constructor(e={width:0,height:0}){super(e),this.hitCanvas=!0,this.context=new wt(this),this.setSize(e.width,e.height),Pt()&&At()&&!Tt&&(Tt=!0,xt.error('Looks like you have "Brave shield" enabled in your browser. It breaks KonvaJS internals. Please disable it. You may need to ask your users to do the same.')),Pt()&&At()}}const It={get isDragging(){let e=!1;return It._dragElements.forEach(t=>{"dragging"===t.dragStatus&&(e=!0)}),e},justDragged:!1,get node(){let e;return It._dragElements.forEach(t=>{e=t.node}),e},_dragElements:new Map,_drag(e){const t=[];It._dragElements.forEach((n,r)=>{const{node:i}=n,a=i.getStage();a.setPointersPositions(e),void 0===n.pointerId&&(n.pointerId=xt._getFirstPointerId(e));const s=a._changedPointerPositions.find(e=>e.id===n.pointerId);if(s){if("dragging"!==n.dragStatus){const t=i.dragDistance();if(Math.max(Math.abs(s.x-n.startPointerPos.x),Math.abs(s.y-n.startPointerPos.y))<t)return;if(i.startDrag({evt:e}),!i.isDragging())return}i._setDragPosition(e,n),t.push(i)}}),t.forEach(t=>{t.fire("dragmove",{type:"dragmove",target:t,evt:e},!0)})},_endDragBefore(e){const t=[];It._dragElements.forEach(n=>{const{node:r}=n,i=r.getStage();e&&i.setPointersPositions(e);if(!i._changedPointerPositions.find(e=>e.id===n.pointerId))return;"dragging"!==n.dragStatus&&"stopped"!==n.dragStatus||(It.justDragged=!0,ot._mouseListenClick=!1,ot._touchListenClick=!1,ot._pointerListenClick=!1,n.dragStatus="stopped");const a=n.node.getLayer()||n.node instanceof ot.Stage&&n.node;a&&-1===t.indexOf(a)&&t.push(a)}),t.forEach(e=>{e.draw()})},_endDragAfter(e){It._dragElements.forEach((t,n)=>{"stopped"===t.dragStatus&&t.node.fire("dragend",{type:"dragend",target:t.node,evt:e},!0),"dragging"!==t.dragStatus&&It._dragElements.delete(n)})}};function Et(e){return xt._isString(e)?'"'+e+'"':"[object Number]"===Object.prototype.toString.call(e)||xt._isBoolean(e)?e:Object.prototype.toString.call(e)}function Mt(e){return e>255?255:e<0?0:Math.round(e)}function Nt(){if(ot.isUnminified)return function(e,t){return xt._isNumber(e)||xt.warn(Et(e)+' is a not valid value for "'+t+'" attribute. The value should be a number.'),e}}function Rt(e){if(ot.isUnminified)return function(t,n){let r=xt._isNumber(t),i=xt._isArray(t)&&t.length==e;return r||i||xt.warn(Et(t)+' is a not valid value for "'+n+'" attribute. The value should be a number or Array<number>('+e+")"),t}}function Dt(){if(ot.isUnminified)return function(e,t){return xt._isNumber(e)||"auto"===e||xt.warn(Et(e)+' is a not valid value for "'+t+'" attribute. The value should be a number or "auto".'),e}}function Lt(){if(ot.isUnminified)return function(e,t){return xt._isString(e)||xt.warn(Et(e)+' is a not valid value for "'+t+'" attribute. The value should be a string.'),e}}function Gt(){if(ot.isUnminified)return function(e,t){const n=xt._isString(e),r="[object CanvasGradient]"===Object.prototype.toString.call(e)||e&&e.addColorStop;return n||r||xt.warn(Et(e)+' is a not valid value for "'+t+'" attribute. The value should be a string or a native gradient.'),e}}function Ot(){if(ot.isUnminified)return function(e,t){return!0===e||!1===e||xt.warn(Et(e)+' is a not valid value for "'+t+'" attribute. The value should be a boolean.'),e}}ot.isBrowser&&(window.addEventListener("mouseup",It._endDragBefore,!0),window.addEventListener("touchend",It._endDragBefore,!0),window.addEventListener("touchcancel",It._endDragBefore,!0),window.addEventListener("mousemove",It._drag),window.addEventListener("touchmove",It._drag),window.addEventListener("mouseup",It._endDragAfter,!1),window.addEventListener("touchend",It._endDragAfter,!1),window.addEventListener("touchcancel",It._endDragAfter,!1));const Ft="get",Wt="set",qt={addGetterSetter(e,t,n,r,i){qt.addGetter(e,t,n),qt.addSetter(e,t,r,i),qt.addOverloadedGetterSetter(e,t)},addGetter(e,t,n){const r=Ft+xt._capitalize(t);e.prototype[r]=e.prototype[r]||function(){const e=this.attrs[t];return void 0===e?n:e}},addSetter(e,t,n,r){const i=Wt+xt._capitalize(t);e.prototype[i]||qt.overWriteSetter(e,t,n,r)},overWriteSetter(e,t,n,r){const i=Wt+xt._capitalize(t);e.prototype[i]=function(e){return n&&null!=e&&(e=n.call(this,e,t)),this._setAttr(t,e),r&&r.call(this),this}},addComponentsGetterSetter(e,t,n,r,i){const a=n.length,s=xt._capitalize,o=Ft+s(t),l=Wt+s(t);e.prototype[o]=function(){const e={};for(let r=0;r<a;r++){const i=n[r];e[i]=this.getAttr(t+s(i))}return e};const c=function(e){if(ot.isUnminified)return function(t,n){return null==t||xt.isObject(t)||xt.warn(Et(t)+' is a not valid value for "'+n+'" attribute. The value should be an object with properties '+e),t}}(n);e.prototype[l]=function(e){const a=this.attrs[t];r&&(e=r.call(this,e,t)),c&&c.call(this,e,t);for(const n in e)e.hasOwnProperty(n)&&this._setAttr(t+s(n),e[n]);return e||n.forEach(e=>{this._setAttr(t+s(e),void 0)}),this._fireChangeEvent(t,a,e),i&&i.call(this),this},qt.addOverloadedGetterSetter(e,t)},addOverloadedGetterSetter(e,t){const n=xt._capitalize(t),r=Wt+n,i=Ft+n;e.prototype[t]=function(){return arguments.length?(this[r](arguments[0]),this):this[i]()}},addDeprecatedGetterSetter(e,t,n,r){xt.error("Adding deprecated "+t);const i=Ft+xt._capitalize(t),a=t+" property is deprecated and will be removed soon. Look at Konva change log for more information.";e.prototype[i]=function(){xt.error(a);const e=this.attrs[t];return void 0===e?n:e},qt.addSetter(e,t,r,function(){xt.error(a)}),qt.addOverloadedGetterSetter(e,t)},backCompat(e,t){xt.each(t,function(t,n){const r=e.prototype[n],i=Ft+xt._capitalize(t),a=Wt+xt._capitalize(t);function s(){r.apply(this,arguments),xt.error('"'+t+'" method is deprecated and will be removed soon. Use ""'+n+'" instead.')}e.prototype[t]=s,e.prototype[i]=s,e.prototype[a]=s})},afterSetFilter(){this._filterUpToDate=!1}};function Bt(e){const t=/(\w+)\(([^)]+)\)/g;let n;for(;null!==(n=t.exec(e));){const[,e,t]=n;switch(e){case"blur":{const e=parseFloat(t.replace("px",""));return function(t){this.blurRadius(.5*e);const n=ot.Filters;n&&n.Blur&&n.Blur.call(this,t)}}case"brightness":{const e=t.includes("%")?parseFloat(t)/100:parseFloat(t);return function(t){this.brightness(e);const n=ot.Filters;n&&n.Brightness&&n.Brightness.call(this,t)}}case"contrast":{const e=parseFloat(t);return function(t){const n=100*(Math.sqrt(e)-1);this.contrast(n);const r=ot.Filters;r&&r.Contrast&&r.Contrast.call(this,t)}}case"grayscale":return function(e){const t=ot.Filters;t&&t.Grayscale&&t.Grayscale.call(this,e)};case"sepia":return function(e){const t=ot.Filters;t&&t.Sepia&&t.Sepia.call(this,e)};case"invert":return function(e){const t=ot.Filters;t&&t.Invert&&t.Invert.call(this,e)};default:xt.warn(`CSS filter "${e}" is not supported in fallback mode. Consider using function filters for better compatibility.`)}}return()=>{}}const $t="absoluteOpacity",Ht="allEventListeners",Vt="absoluteTransform",Ut="absoluteScale",Qt="canvas",Yt="listening",Xt="Shape",Kt=" ",Jt="stage",Zt="transform",en="visible",tn=["xChange.konva","yChange.konva","scaleXChange.konva","scaleYChange.konva","skewXChange.konva","skewYChange.konva","rotationChange.konva","offsetXChange.konva","offsetYChange.konva","transformsEnabledChange.konva"].join(Kt);let nn=1;class rn{constructor(e){this._id=nn++,this.eventListeners={},this.attrs={},this.index=0,this._allEventListeners=null,this.parent=null,this._cache=new Map,this._attachedDepsListeners=new Map,this._lastPos=null,this._batchingTransformChange=!1,this._needClearTransformCache=!1,this._filterUpToDate=!1,this._isUnderCache=!1,this._dragEventId=null,this._shouldFireChangeEvents=!1,this.setAttrs(e),this._shouldFireChangeEvents=!0}hasChildren(){return!1}_clearCache(e){e!==Zt&&e!==Vt||!this._cache.get(e)?e?this._cache.delete(e):this._cache.clear():this._cache.get(e).dirty=!0}_getCache(e,t){let n=this._cache.get(e);return(void 0===n||(e===Zt||e===Vt)&&!0===n.dirty)&&(n=t.call(this),this._cache.set(e,n)),n}_calculate(e,t,n){if(!this._attachedDepsListeners.get(e)){const n=t.map(e=>e+"Change.konva").join(Kt);this.on(n,()=>{this._clearCache(e)}),this._attachedDepsListeners.set(e,!0)}return this._getCache(e,n)}_getCanvasCache(){return this._cache.get(Qt)}_clearSelfAndDescendantCache(e){this._clearCache(e),e===Vt&&this.fire("absoluteTransformChange")}clearCache(){if(this._cache.has(Qt)){const{scene:e,filter:t,hit:n,buffer:r}=this._cache.get(Qt);xt.releaseCanvas(e,t,n,r),this._cache.delete(Qt)}return this._clearSelfAndDescendantCache(),this._requestDraw(),this}cache(e){const t=e||{};let n={};void 0!==t.x&&void 0!==t.y&&void 0!==t.width&&void 0!==t.height||(n=this.getClientRect({skipTransform:!0,relativeTo:this.getParent()||void 0}));let r=Math.ceil(t.width||n.width),i=Math.ceil(t.height||n.height),a=t.pixelRatio,s=void 0===t.x?Math.floor(n.x):t.x,o=void 0===t.y?Math.floor(n.y):t.y,l=t.offset||0,c=t.drawBorder||!1,u=t.hitCanvasPixelRatio||1;if(!r||!i)return void xt.error("Can not cache the node. Width or height of the node equals 0. Caching is skipped.");r+=2*l+(Math.abs(Math.round(n.x)-s)>.5?1:0),i+=2*l+(Math.abs(Math.round(n.y)-o)>.5?1:0),s-=l,o-=l;const d=new jt({pixelRatio:a,width:r,height:i}),h=new jt({pixelRatio:a,width:0,height:0,willReadFrequently:!0}),p=new zt({pixelRatio:u,width:r,height:i}),f=d.getContext(),g=p.getContext(),m=new jt({width:d.width/d.pixelRatio+Math.abs(s),height:d.height/d.pixelRatio+Math.abs(o),pixelRatio:d.pixelRatio}),x=m.getContext();return p.isCache=!0,d.isCache=!0,this._cache.delete(Qt),this._filterUpToDate=!1,!1===t.imageSmoothingEnabled&&(d.getContext()._context.imageSmoothingEnabled=!1,h.getContext()._context.imageSmoothingEnabled=!1),f.save(),g.save(),x.save(),f.translate(-s,-o),g.translate(-s,-o),x.translate(-s,-o),m.x=s,m.y=o,this._isUnderCache=!0,this._clearSelfAndDescendantCache($t),this._clearSelfAndDescendantCache(Ut),this.drawScene(d,this,m),this.drawHit(p,this),this._isUnderCache=!1,f.restore(),g.restore(),c&&(f.save(),f.beginPath(),f.rect(0,0,r,i),f.closePath(),f.setAttr("strokeStyle","red"),f.setAttr("lineWidth",5),f.stroke(),f.restore()),this._cache.set(Qt,{scene:d,filter:h,hit:p,buffer:m,x:s,y:o}),this._requestDraw(),this}isCached(){return this._cache.has(Qt)}getClientRect(e){throw new Error('abstract "getClientRect" method call')}_transformedRect(e,t){const n=[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},{x:e.x,y:e.y+e.height}];let r=1/0,i=1/0,a=-1/0,s=-1/0;const o=this.getAbsoluteTransform(t);return n.forEach(function(e){const t=o.point(e);void 0===r&&(r=a=t.x,i=s=t.y),r=Math.min(r,t.x),i=Math.min(i,t.y),a=Math.max(a,t.x),s=Math.max(s,t.y)}),{x:r,y:i,width:a-r,height:s-i}}_drawCachedSceneCanvas(e){e.save(),e._applyOpacity(this),e._applyGlobalCompositeOperation(this);const t=this._getCanvasCache();e.translate(t.x,t.y);const n=this._getCachedSceneCanvas(),r=n.pixelRatio;e.drawImage(n._canvas,0,0,n.width/r,n.height/r),e.restore()}_drawCachedHitCanvas(e){const t=this._getCanvasCache(),n=t.hit;e.save(),e.translate(t.x,t.y),e.drawImage(n._canvas,0,0,n.width/n.pixelRatio,n.height/n.pixelRatio),e.restore()}_getCachedSceneCanvas(){let e,t,n,r,i=this.filters(),a=this._getCanvasCache(),s=a.scene,o=a.filter,l=o.getContext();if(!i||0===i.length)return s;if(this._filterUpToDate)return o;let c=!0;for(let h=0;h<i.length;h++)if("string"==typeof i[h]&&St(),"string"!=typeof i[h]||!St()){c=!1;break}const u=s.pixelRatio;if(o.setSize(s.width/s.pixelRatio,s.height/s.pixelRatio),c){const e=i.join(" ");return l.save(),l.setAttr("filter",e),l.drawImage(s._canvas,0,0,s.getWidth()/u,s.getHeight()/u),l.restore(),this._filterUpToDate=!0,o}try{for(e=i.length,l.clear(),l.drawImage(s._canvas,0,0,s.getWidth()/u,s.getHeight()/u),t=l.getImageData(0,0,o.getWidth(),o.getHeight()),n=0;n<e;n++)r=i[n],"string"==typeof r&&(r=Bt(r)),r.call(this,t),l.putImageData(t,0,0)}catch(d){xt.error("Unable to apply filter. "+d.message+" This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.")}return this._filterUpToDate=!0,o}on(e,t){if(this._cache&&this._cache.delete(Ht),3===arguments.length)return this._delegate.apply(this,arguments);const n=e.split(Kt);for(let r=0;r<n.length;r++){const e=n[r].split("."),i=e[0],a=e[1]||"";this.eventListeners[i]||(this.eventListeners[i]=[]),this.eventListeners[i].push({name:a,handler:t})}return this}off(e,t){let n,r,i,a,s,o,l=(e||"").split(Kt),c=l.length;if(this._cache&&this._cache.delete(Ht),!e)for(r in this.eventListeners)this._off(r);for(n=0;n<c;n++)if(i=l[n],a=i.split("."),s=a[0],o=a[1],s)this.eventListeners[s]&&this._off(s,o,t);else for(r in this.eventListeners)this._off(r,o,t);return this}dispatchEvent(e){const t={target:this,type:e.type,evt:e};return this.fire(e.type,t),this}addEventListener(e,t){return this.on(e,function(e){t.call(this,e.evt)}),this}removeEventListener(e){return this.off(e),this}_delegate(e,t,n){const r=this;this.on(e,function(e){const i=e.target.findAncestors(t,!0,r);for(let t=0;t<i.length;t++)(e=xt.cloneObject(e)).currentTarget=i[t],n.call(i[t],e)})}remove(){return this.isDragging()&&this.stopDrag(),It._dragElements.delete(this._id),this._remove(),this}_clearCaches(){this._clearSelfAndDescendantCache(Vt),this._clearSelfAndDescendantCache($t),this._clearSelfAndDescendantCache(Ut),this._clearSelfAndDescendantCache(Jt),this._clearSelfAndDescendantCache(en),this._clearSelfAndDescendantCache(Yt)}_remove(){this._clearCaches();const e=this.getParent();e&&e.children&&(e.children.splice(this.index,1),e._setChildrenIndices(),this.parent=null)}destroy(){return this.remove(),this.clearCache(),this}getAttr(e){const t="get"+xt._capitalize(e);return xt._isFunction(this[t])?this[t]():this.attrs[e]}getAncestors(){let e=this.getParent(),t=[];for(;e;)t.push(e),e=e.getParent();return t}getAttrs(){return this.attrs||{}}setAttrs(e){return this._batchTransformChanges(()=>{let t,n;if(!e)return this;for(t in e)"children"!==t&&(n="set"+xt._capitalize(t),xt._isFunction(this[n])?this[n](e[t]):this._setAttr(t,e[t]))}),this}isListening(){return this._getCache(Yt,this._isListening)}_isListening(e){if(!this.listening())return!1;const t=this.getParent();return!t||t===e||this===e||t._isListening(e)}isVisible(){return this._getCache(en,this._isVisible)}_isVisible(e){if(!this.visible())return!1;const t=this.getParent();return!t||t===e||this===e||t._isVisible(e)}shouldDrawHit(e,t=!1){if(e)return this._isVisible(e)&&this._isListening(e);const n=this.getLayer();let r=!1;It._dragElements.forEach(e=>{"dragging"===e.dragStatus&&("Stage"===e.node.nodeType||e.node.getLayer()===n)&&(r=!0)});const i=!t&&!ot.hitOnDragEnabled&&(r||ot.isTransforming());return this.isListening()&&this.isVisible()&&!i}show(){return this.visible(!0),this}hide(){return this.visible(!1),this}getZIndex(){return this.index||0}getAbsoluteZIndex(){let e,t,n,r,i=this.getDepth(),a=this,s=0;const o=this.getStage();return"Stage"!==a.nodeType&&o&&function o(l){for(e=[],t=l.length,n=0;n<t;n++)r=l[n],s++,r.nodeType!==Xt&&(e=e.concat(r.getChildren().slice())),r._id===a._id&&(n=t);e.length>0&&e[0].getDepth()<=i&&o(e)}(o.getChildren()),s}getDepth(){let e=0,t=this.parent;for(;t;)e++,t=t.parent;return e}_batchTransformChanges(e){this._batchingTransformChange=!0,e(),this._batchingTransformChange=!1,this._needClearTransformCache&&(this._clearCache(Zt),this._clearSelfAndDescendantCache(Vt)),this._needClearTransformCache=!1}setPosition(e){return this._batchTransformChanges(()=>{this.x(e.x),this.y(e.y)}),this}getPosition(){return{x:this.x(),y:this.y()}}getRelativePointerPosition(){const e=this.getStage();if(!e)return null;const t=e.getPointerPosition();if(!t)return null;const n=this.getAbsoluteTransform().copy();return n.invert(),n.point(t)}getAbsolutePosition(e){let t=!1,n=this.parent;for(;n;){if(n.isCached()){t=!0;break}n=n.parent}t&&!e&&(e=!0);const r=this.getAbsoluteTransform(e).getMatrix(),i=new ut,a=this.offset();return i.m=r.slice(),i.translate(a.x,a.y),i.getTranslation()}setAbsolutePosition(e){const{x:t,y:n,...r}=this._clearTransform();this.attrs.x=t,this.attrs.y=n,this._clearCache(Zt);const i=this._getAbsoluteTransform().copy();return i.invert(),i.translate(e.x,e.y),e={x:this.attrs.x+i.getTranslation().x,y:this.attrs.y+i.getTranslation().y},this._setTransform(r),this.setPosition({x:e.x,y:e.y}),this._clearCache(Zt),this._clearSelfAndDescendantCache(Vt),this}_setTransform(e){let t;for(t in e)this.attrs[t]=e[t]}_clearTransform(){const e={x:this.x(),y:this.y(),rotation:this.rotation(),scaleX:this.scaleX(),scaleY:this.scaleY(),offsetX:this.offsetX(),offsetY:this.offsetY(),skewX:this.skewX(),skewY:this.skewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,e}move(e){let t=e.x,n=e.y,r=this.x(),i=this.y();return void 0!==t&&(r+=t),void 0!==n&&(i+=n),this.setPosition({x:r,y:i}),this}_eachAncestorReverse(e,t){let n,r,i=[],a=this.getParent();if(!t||t._id!==this._id){for(i.unshift(this);a&&(!t||a._id!==t._id);)i.unshift(a),a=a.parent;for(n=i.length,r=0;r<n;r++)e(i[r])}}rotate(e){return this.rotation(this.rotation()+e),this}moveToTop(){if(!this.parent)return xt.warn("Node has no parent. moveToTop function is ignored."),!1;const e=this.index;return e<this.parent.getChildren().length-1&&(this.parent.children.splice(e,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0)}moveUp(){if(!this.parent)return xt.warn("Node has no parent. moveUp function is ignored."),!1;const e=this.index;return e<this.parent.getChildren().length-1&&(this.parent.children.splice(e,1),this.parent.children.splice(e+1,0,this),this.parent._setChildrenIndices(),!0)}moveDown(){if(!this.parent)return xt.warn("Node has no parent. moveDown function is ignored."),!1;const e=this.index;return e>0&&(this.parent.children.splice(e,1),this.parent.children.splice(e-1,0,this),this.parent._setChildrenIndices(),!0)}moveToBottom(){if(!this.parent)return xt.warn("Node has no parent. moveToBottom function is ignored."),!1;const e=this.index;return e>0&&(this.parent.children.splice(e,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0)}setZIndex(e){if(!this.parent)return xt.warn("Node has no parent. zIndex parameter is ignored."),this;(e<0||e>=this.parent.children.length)&&xt.warn("Unexpected value "+e+" for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to "+(this.parent.children.length-1)+".");const t=this.index;return this.parent.children.splice(t,1),this.parent.children.splice(e,0,this),this.parent._setChildrenIndices(),this}getAbsoluteOpacity(){return this._getCache($t,this._getAbsoluteOpacity)}_getAbsoluteOpacity(){let e=this.opacity();const t=this.getParent();return t&&!t._isUnderCache&&(e*=t.getAbsoluteOpacity()),e}moveTo(e){return this.getParent()!==e&&(this._remove(),e.add(this)),this}toObject(){let e,t,n,r,i,a=this.getAttrs();const s={attrs:{},className:this.getClassName()};for(e in a)t=a[e],i=xt.isObject(t)&&!xt._isPlainObject(t)&&!xt._isArray(t),i||(n="function"==typeof this[e]&&this[e],delete a[e],r=n?n.call(this):null,a[e]=t,r!==t&&(s.attrs[e]=t));return xt._prepareToStringify(s)}toJSON(){return JSON.stringify(this.toObject())}getParent(){return this.parent}findAncestors(e,t,n){const r=[];t&&this._isMatch(e)&&r.push(this);let i=this.parent;for(;i;){if(i===n)return r;i._isMatch(e)&&r.push(i),i=i.parent}return r}isAncestorOf(e){return!1}findAncestor(e,t,n){return this.findAncestors(e,t,n)[0]}_isMatch(e){if(!e)return!1;if("function"==typeof e)return e(this);let t,n,r=e.replace(/ /g,"").split(","),i=r.length;for(t=0;t<i;t++)if(n=r[t],xt.isValidSelector(n)||(xt.warn('Selector "'+n+'" is invalid. Allowed selectors examples are "#foo", ".bar" or "Group".'),xt.warn('If you have a custom shape with such className, please change it to start with upper letter like "Triangle".'),xt.warn("Konva is awesome, right?")),"#"===n.charAt(0)){if(this.id()===n.slice(1))return!0}else if("."===n.charAt(0)){if(this.hasName(n.slice(1)))return!0}else if(this.className===n||this.nodeType===n)return!0;return!1}getLayer(){const e=this.getParent();return e?e.getLayer():null}getStage(){return this._getCache(Jt,this._getStage)}_getStage(){const e=this.getParent();return e?e.getStage():null}fire(e,t={},n){return t.target=t.target||this,n?this._fireAndBubble(e,t):this._fire(e,t),this}getAbsoluteTransform(e){return e?this._getAbsoluteTransform(e):this._getCache(Vt,this._getAbsoluteTransform)}_getAbsoluteTransform(e){let t;if(e)return t=new ut,this._eachAncestorReverse(function(e){const n=e.transformsEnabled();"all"===n?t.multiply(e.getTransform()):"position"===n&&t.translate(e.x()-e.offsetX(),e.y()-e.offsetY())},e),t;{t=this._cache.get(Vt)||new ut,this.parent?this.parent.getAbsoluteTransform().copyInto(t):t.reset();const e=this.transformsEnabled();if("all"===e)t.multiply(this.getTransform());else if("position"===e){const e=this.attrs.x||0,n=this.attrs.y||0,r=this.attrs.offsetX||0,i=this.attrs.offsetY||0;t.translate(e-r,n-i)}return t.dirty=!1,t}}getAbsoluteScale(e){let t=this;for(;t;)t._isUnderCache&&(e=t),t=t.getParent();const n=this.getAbsoluteTransform(e).decompose();return{x:n.scaleX,y:n.scaleY}}getAbsoluteRotation(){return this.getAbsoluteTransform().decompose().rotation}getTransform(){return this._getCache(Zt,this._getTransform)}_getTransform(){var e,t;const n=this._cache.get(Zt)||new ut;n.reset();const r=this.x(),i=this.y(),a=ot.getAngle(this.rotation()),s=null!==(e=this.attrs.scaleX)&&void 0!==e?e:1,o=null!==(t=this.attrs.scaleY)&&void 0!==t?t:1,l=this.attrs.skewX||0,c=this.attrs.skewY||0,u=this.attrs.offsetX||0,d=this.attrs.offsetY||0;return 0===r&&0===i||n.translate(r,i),0!==a&&n.rotate(a),0===l&&0===c||n.skew(l,c),1===s&&1===o||n.scale(s,o),0===u&&0===d||n.translate(-1*u,-1*d),n.dirty=!1,n}clone(e){let t,n,r,i,a,s=xt.cloneObject(this.attrs);for(t in e)s[t]=e[t];const o=new this.constructor(s);for(t in this.eventListeners)for(n=this.eventListeners[t],r=n.length,i=0;i<r;i++)a=n[i],a.name.indexOf("konva")<0&&(o.eventListeners[t]||(o.eventListeners[t]=[]),o.eventListeners[t].push(a));return o}_toKonvaCanvas(e){e=e||{};const t=this.getClientRect(),n=this.getStage(),r=void 0!==e.x?e.x:Math.floor(t.x),i=void 0!==e.y?e.y:Math.floor(t.y),a=e.pixelRatio||1,s=new jt({width:e.width||Math.ceil(t.width)||(n?n.width():0),height:e.height||Math.ceil(t.height)||(n?n.height():0),pixelRatio:a}),o=s.getContext(),l=new jt({width:s.width/s.pixelRatio+Math.abs(r),height:s.height/s.pixelRatio+Math.abs(i),pixelRatio:s.pixelRatio});return!1===e.imageSmoothingEnabled&&(o._context.imageSmoothingEnabled=!1),o.save(),(r||i)&&o.translate(-1*r,-1*i),this.drawScene(s,void 0,l),o.restore(),s}toCanvas(e){return this._toKonvaCanvas(e)._canvas}toDataURL(e){const t=(e=e||{}).mimeType||null,n=e.quality||null,r=this._toKonvaCanvas(e).toDataURL(t,n);return e.callback&&e.callback(r),r}toImage(e){return new Promise((t,n)=>{try{const n=null==e?void 0:e.callback;n&&delete e.callback,xt._urlToImage(this.toDataURL(e),function(e){t(e),null==n||n(e)})}catch(r){n(r)}})}toBlob(e){return new Promise((t,n)=>{try{const n=null==e?void 0:e.callback;n&&delete e.callback,this.toCanvas(e).toBlob(e=>{t(e),null==n||n(e)},null==e?void 0:e.mimeType,null==e?void 0:e.quality)}catch(r){n(r)}})}setSize(e){return this.width(e.width),this.height(e.height),this}getSize(){return{width:this.width(),height:this.height()}}getClassName(){return this.className||this.nodeType}getType(){return this.nodeType}getDragDistance(){return void 0!==this.attrs.dragDistance?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():ot.dragDistance}_off(e,t,n){let r,i,a,s=this.eventListeners[e];for(r=0;r<s.length;r++)if(i=s[r].name,a=s[r].handler,!("konva"===i&&"konva"!==t||t&&i!==t||n&&n!==a)){if(s.splice(r,1),0===s.length){delete this.eventListeners[e];break}r--}}_fireChangeEvent(e,t,n){this._fire(e+"Change",{oldVal:t,newVal:n})}addName(e){if(!this.hasName(e)){const t=this.name(),n=t?t+" "+e:e;this.name(n)}return this}hasName(e){if(!e)return!1;const t=this.name();if(!t)return!1;return-1!==(t||"").split(/\s/g).indexOf(e)}removeName(e){const t=(this.name()||"").split(/\s/g),n=t.indexOf(e);return-1!==n&&(t.splice(n,1),this.name(t.join(" "))),this}setAttr(e,t){const n=this["set"+xt._capitalize(e)];return xt._isFunction(n)?n.call(this,t):this._setAttr(e,t),this}_requestDraw(){if(ot.autoDrawEnabled){const e=this.getLayer()||this.getStage();null==e||e.batchDraw()}}_setAttr(e,t){const n=this.attrs[e];(n!==t||xt.isObject(t))&&(null==t?delete this.attrs[e]:this.attrs[e]=t,this._shouldFireChangeEvents&&this._fireChangeEvent(e,n,t),this._requestDraw())}_setComponentAttr(e,t,n){let r;void 0!==n&&(r=this.attrs[e],r||(this.attrs[e]=this.getAttr(e)),this.attrs[e][t]=n,this._fireChangeEvent(e,r,n))}_fireAndBubble(e,t,n){t&&this.nodeType===Xt&&(t.target=this);const r=["mouseenter","mouseleave","pointerenter","pointerleave","touchenter","touchleave"];if(!(-1!==r.indexOf(e)&&(n&&(this===n||this.isAncestorOf&&this.isAncestorOf(n))||"Stage"===this.nodeType&&!n))){this._fire(e,t);const i=-1!==r.indexOf(e)&&n&&n.isAncestorOf&&n.isAncestorOf(this)&&!n.isAncestorOf(this.parent);(t&&!t.cancelBubble||!t)&&this.parent&&this.parent.isListening()&&!i&&(n&&n.parent?this._fireAndBubble.call(this.parent,e,t,n):this._fireAndBubble.call(this.parent,e,t))}}_getProtoListeners(e){var t,n,r;const i=null!==(t=this._cache.get(Ht))&&void 0!==t?t:{};let a=null==i?void 0:i[e];if(void 0===a){a=[];let t=Object.getPrototypeOf(this);for(;t;){const i=null!==(r=null===(n=t.eventListeners)||void 0===n?void 0:n[e])&&void 0!==r?r:[];a.push(...i),t=Object.getPrototypeOf(t)}i[e]=a,this._cache.set(Ht,i)}return a}_fire(e,t){(t=t||{}).currentTarget=this,t.type=e;const n=this._getProtoListeners(e);if(n)for(let i=0;i<n.length;i++)n[i].handler.call(this,t);const r=this.eventListeners[e];if(r)for(let i=0;i<r.length;i++)r[i].handler.call(this,t)}draw(){return this.drawScene(),this.drawHit(),this}_createDragElement(e){const t=e?e.pointerId:void 0,n=this.getStage(),r=this.getAbsolutePosition();if(!n)return;const i=n._getPointerById(t)||n._changedPointerPositions[0]||r;It._dragElements.set(this._id,{node:this,startPointerPos:i,offset:{x:i.x-r.x,y:i.y-r.y},dragStatus:"ready",pointerId:t})}startDrag(e,t=!0){It._dragElements.has(this._id)||this._createDragElement(e);It._dragElements.get(this._id).dragStatus="dragging",this.fire("dragstart",{type:"dragstart",target:this,evt:e&&e.evt},t)}_setDragPosition(e,t){const n=this.getStage()._getPointerById(t.pointerId);if(!n)return;let r={x:n.x-t.offset.x,y:n.y-t.offset.y};const i=this.dragBoundFunc();if(void 0!==i){const t=i.call(this,r,e);t?r=t:xt.warn("dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.")}this._lastPos&&this._lastPos.x===r.x&&this._lastPos.y===r.y||(this.setAbsolutePosition(r),this._requestDraw()),this._lastPos=r}stopDrag(e){const t=It._dragElements.get(this._id);t&&(t.dragStatus="stopped"),It._endDragBefore(e),It._endDragAfter(e)}setDraggable(e){this._setAttr("draggable",e),this._dragChange()}isDragging(){const e=It._dragElements.get(this._id);return!!e&&"dragging"===e.dragStatus}_listenDrag(){this._dragCleanup(),this.on("mousedown.konva touchstart.konva",function(e){if(!(!(void 0!==e.evt.button)||ot.dragButtons.indexOf(e.evt.button)>=0))return;if(this.isDragging())return;let t=!1;It._dragElements.forEach(e=>{this.isAncestorOf(e.node)&&(t=!0)}),t||this._createDragElement(e)})}_dragChange(){if(this.attrs.draggable)this._listenDrag();else{this._dragCleanup();if(!this.getStage())return;const e=It._dragElements.get(this._id),t=e&&"dragging"===e.dragStatus,n=e&&"ready"===e.dragStatus;t?this.stopDrag():n&&It._dragElements.delete(this._id)}}_dragCleanup(){this.off("mousedown.konva"),this.off("touchstart.konva")}isClientRectOnScreen(e={x:0,y:0}){const t=this.getStage();if(!t)return!1;const n={x:-e.x,y:-e.y,width:t.width()+2*e.x,height:t.height()+2*e.y};return xt.haveIntersection(n,this.getClientRect())}static create(e,t){return xt._isString(e)&&(e=JSON.parse(e)),this._createNode(e,t)}static _createNode(e,t){let n,r,i,a=rn.prototype.getClassName.call(e),s=e.children;t&&(e.attrs.container=t),ot[a]||(xt.warn('Can not find a node with class name "'+a+'". Fallback to "Shape".'),a="Shape");if(n=new(0,ot[a])(e.attrs),s)for(r=s.length,i=0;i<r;i++)n.add(rn._createNode(s[i]));return n}}rn.prototype.nodeType="Node",rn.prototype._attrsAffectingSize=[],rn.prototype.eventListeners={},rn.prototype.on.call(rn.prototype,tn,function(){this._batchingTransformChange?this._needClearTransformCache=!0:(this._clearCache(Zt),this._clearSelfAndDescendantCache(Vt))}),rn.prototype.on.call(rn.prototype,"visibleChange.konva",function(){this._clearSelfAndDescendantCache(en)}),rn.prototype.on.call(rn.prototype,"listeningChange.konva",function(){this._clearSelfAndDescendantCache(Yt)}),rn.prototype.on.call(rn.prototype,"opacityChange.konva",function(){this._clearSelfAndDescendantCache($t)});const an=qt.addGetterSetter;an(rn,"zIndex"),an(rn,"absolutePosition"),an(rn,"position"),an(rn,"x",0,Nt()),an(rn,"y",0,Nt()),an(rn,"globalCompositeOperation","source-over",Lt()),an(rn,"opacity",1,Nt()),an(rn,"name","",Lt()),an(rn,"id","",Lt()),an(rn,"rotation",0,Nt()),qt.addComponentsGetterSetter(rn,"scale",["x","y"]),an(rn,"scaleX",1,Nt()),an(rn,"scaleY",1,Nt()),qt.addComponentsGetterSetter(rn,"skew",["x","y"]),an(rn,"skewX",0,Nt()),an(rn,"skewY",0,Nt()),qt.addComponentsGetterSetter(rn,"offset",["x","y"]),an(rn,"offsetX",0,Nt()),an(rn,"offsetY",0,Nt()),an(rn,"dragDistance",void 0,Nt()),an(rn,"width",0,Nt()),an(rn,"height",0,Nt()),an(rn,"listening",!0,Ot()),an(rn,"preventDefault",!0,Ot()),an(rn,"filters",void 0,function(e){return this._filterUpToDate=!1,e}),an(rn,"visible",!0,Ot()),an(rn,"transformsEnabled","all",Lt()),an(rn,"size"),an(rn,"dragBoundFunc"),an(rn,"draggable",!1,Ot()),qt.backCompat(rn,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"});class sn extends rn{constructor(){super(...arguments),this.children=[]}getChildren(e){const t=this.children||[];return e?t.filter(e):t}hasChildren(){return this.getChildren().length>0}removeChildren(){return this.getChildren().forEach(e=>{e.parent=null,e.index=0,e.remove()}),this.children=[],this._requestDraw(),this}destroyChildren(){return this.getChildren().forEach(e=>{e.parent=null,e.index=0,e.destroy()}),this.children=[],this._requestDraw(),this}add(...e){if(0===e.length)return this;if(e.length>1){for(let t=0;t<e.length;t++)this.add(e[t]);return this}const t=e[0];return t.getParent()?(t.moveTo(this),this):(this._validateAdd(t),t.index=this.getChildren().length,t.parent=this,t._clearCaches(),this.getChildren().push(t),this._fire("add",{child:t}),this._requestDraw(),this)}destroy(){return this.hasChildren()&&this.destroyChildren(),super.destroy(),this}find(e){return this._generalFind(e,!1)}findOne(e){const t=this._generalFind(e,!0);return t.length>0?t[0]:void 0}_generalFind(e,t){const n=[];return this._descendants(r=>{const i=r._isMatch(e);return i&&n.push(r),!(!i||!t)}),n}_descendants(e){let t=!1;const n=this.getChildren();for(const r of n){if(t=e(r),t)return!0;if(r.hasChildren()&&(t=r._descendants(e),t))return!0}return!1}toObject(){const e=rn.prototype.toObject.call(this);return e.children=[],this.getChildren().forEach(t=>{e.children.push(t.toObject())}),e}isAncestorOf(e){let t=e.getParent();for(;t;){if(t._id===this._id)return!0;t=t.getParent()}return!1}clone(e){const t=rn.prototype.clone.call(this,e);return this.getChildren().forEach(function(e){t.add(e.clone())}),t}getAllIntersections(e){const t=[];return this.find("Shape").forEach(n=>{n.isVisible()&&n.intersects(e)&&t.push(n)}),t}_clearSelfAndDescendantCache(e){var t;super._clearSelfAndDescendantCache(e),this.isCached()||null===(t=this.children)||void 0===t||t.forEach(function(t){t._clearSelfAndDescendantCache(e)})}_setChildrenIndices(){var e;null===(e=this.children)||void 0===e||e.forEach(function(e,t){e.index=t}),this._requestDraw()}drawScene(e,t,n){const r=this.getLayer(),i=e||r&&r.getCanvas(),a=i&&i.getContext(),s=this._getCanvasCache(),o=s&&s.scene,l=i&&i.isCache;if(!this.isVisible()&&!l)return this;if(o){a.save();const e=this.getAbsoluteTransform(t).getMatrix();a.transform(e[0],e[1],e[2],e[3],e[4],e[5]),this._drawCachedSceneCanvas(a),a.restore()}else this._drawChildren("drawScene",i,t,n);return this}drawHit(e,t){if(!this.shouldDrawHit(t))return this;const n=this.getLayer(),r=e||n&&n.hitCanvas,i=r&&r.getContext(),a=this._getCanvasCache();if(a&&a.hit){i.save();const e=this.getAbsoluteTransform(t).getMatrix();i.transform(e[0],e[1],e[2],e[3],e[4],e[5]),this._drawCachedHitCanvas(i),i.restore()}else this._drawChildren("drawHit",r,t);return this}_drawChildren(e,t,n,r){var i;const a=t&&t.getContext(),s=this.clipWidth(),o=this.clipHeight(),l=this.clipFunc(),c="number"==typeof s&&"number"==typeof o||l,u=n===this;if(c){a.save();const e=this.getAbsoluteTransform(n);let t,r=e.getMatrix();if(a.transform(r[0],r[1],r[2],r[3],r[4],r[5]),a.beginPath(),l)t=l.call(this,a,this);else{const e=this.clipX(),t=this.clipY();a.rect(e||0,t||0,s,o)}a.clip.apply(a,t),r=e.copy().invert().getMatrix(),a.transform(r[0],r[1],r[2],r[3],r[4],r[5])}const d=!u&&"source-over"!==this.globalCompositeOperation()&&"drawScene"===e;d&&(a.save(),a._applyGlobalCompositeOperation(this)),null===(i=this.children)||void 0===i||i.forEach(function(i){i[e](t,n,r)}),d&&a.restore(),c&&a.restore()}getClientRect(e={}){var t;const n=e.skipTransform,r=e.relativeTo;let i,a,s,o,l={x:1/0,y:1/0,width:0,height:0};const c=this;null===(t=this.children)||void 0===t||t.forEach(function(t){if(!t.visible())return;const n=t.getClientRect({relativeTo:c,skipShadow:e.skipShadow,skipStroke:e.skipStroke});0===n.width&&0===n.height||(void 0===i?(i=n.x,a=n.y,s=n.x+n.width,o=n.y+n.height):(i=Math.min(i,n.x),a=Math.min(a,n.y),s=Math.max(s,n.x+n.width),o=Math.max(o,n.y+n.height)))});const u=this.find("Shape");let d=!1;for(let h=0;h<u.length;h++){if(u[h]._isVisible(this)){d=!0;break}}return l=d&&void 0!==i?{x:i,y:a,width:s-i,height:o-a}:{x:0,y:0,width:0,height:0},n?l:this._transformedRect(l,r)}}qt.addComponentsGetterSetter(sn,"clip",["x","y","width","height"]),qt.addGetterSetter(sn,"clipX",void 0,Nt()),qt.addGetterSetter(sn,"clipY",void 0,Nt()),qt.addGetterSetter(sn,"clipWidth",void 0,Nt()),qt.addGetterSetter(sn,"clipHeight",void 0,Nt()),qt.addGetterSetter(sn,"clipFunc");const on=new Map,ln=void 0!==ot._global.PointerEvent;function cn(e){return on.get(e)}function un(e){return{evt:e,pointerId:e.pointerId}}function dn(e,t){return on.get(e)===t}function hn(e,t){pn(e);t.getStage()&&(on.set(e,t),ln&&t._fire("gotpointercapture",un(new PointerEvent("gotpointercapture"))))}function pn(e,t){const n=on.get(e);if(!n)return;const r=n.getStage();r&&r.content,on.delete(e),ln&&n._fire("lostpointercapture",un(new PointerEvent("lostpointercapture")))}const fn="mouseleave",gn="mouseover",mn="mouseenter",xn="mousemove",yn="mousedown",vn="mouseup",bn="pointermove",Sn="pointerdown",_n="pointerup",Cn="pointercancel",wn="pointerout",kn="pointerleave",jn="pointerover",An="pointerenter",Pn="contextmenu",Tn="touchstart",zn="touchend",In="touchmove",En="touchcancel",Mn="wheel",Nn=[[mn,"_pointerenter"],[yn,"_pointerdown"],[xn,"_pointermove"],[vn,"_pointerup"],[fn,"_pointerleave"],[Tn,"_pointerdown"],[In,"_pointermove"],[zn,"_pointerup"],[En,"_pointercancel"],[gn,"_pointerover"],[Mn,"_wheel"],[Pn,"_contextmenu"],[Sn,"_pointerdown"],[bn,"_pointermove"],[_n,"_pointerup"],[Cn,"_pointercancel"],[kn,"_pointerleave"],["lostpointercapture","_lostpointercapture"]],Rn={mouse:{[wn]:"mouseout",[kn]:fn,[jn]:gn,[An]:mn,[bn]:xn,[Sn]:yn,[_n]:vn,[Cn]:"mousecancel",pointerclick:"click",pointerdblclick:"dblclick"},touch:{[wn]:"touchout",[kn]:"touchleave",[jn]:"touchover",[An]:"touchenter",[bn]:In,[Sn]:Tn,[_n]:zn,[Cn]:En,pointerclick:"tap",pointerdblclick:"dbltap"},pointer:{[wn]:wn,[kn]:kn,[jn]:jn,[An]:An,[bn]:bn,[Sn]:Sn,[_n]:_n,[Cn]:Cn,pointerclick:"pointerclick",pointerdblclick:"pointerdblclick"}},Dn=e=>e.indexOf("pointer")>=0?"pointer":e.indexOf("touch")>=0?"touch":"mouse",Ln=e=>{const t=Dn(e);return"pointer"===t?ot.pointerEventsEnabled&&Rn.pointer:"touch"===t?Rn.touch:"mouse"===t?Rn.mouse:void 0};function Gn(e={}){return(e.clipFunc||e.clipWidth||e.clipHeight)&&xt.warn("Stage does not support clipping. Please use clip for Layers or Groups."),e}const On=[];let Fn=class extends sn{constructor(e){super(Gn(e)),this._pointerPositions=[],this._changedPointerPositions=[],this._buildDOM(),this._bindContentEvents(),On.push(this),this.on("widthChange.konva heightChange.konva",this._resizeDOM),this.on("visibleChange.konva",this._checkVisibility),this.on("clipWidthChange.konva clipHeightChange.konva clipFuncChange.konva",()=>{Gn(this.attrs)}),this._checkVisibility()}_validateAdd(e){const t="Layer"===e.getType(),n="FastLayer"===e.getType();t||n||xt.throw("You may only add layers to the stage.")}_checkVisibility(){if(!this.content)return;const e=this.visible()?"":"none";this.content.style.display=e}setContainer(e){if("string"==typeof e){let t;if("."===e.charAt(0)){const t=e.slice(1);e=document.getElementsByClassName(t)[0]}else t="#"!==e.charAt(0)?e:e.slice(1),e=document.getElementById(t);if(!e)throw"Can not find container in document with id "+t}return this._setAttr("container",e),this.content&&(this.content.parentElement&&this.content.parentElement.removeChild(this.content),e.appendChild(this.content)),this}shouldDrawHit(){return!0}clear(){const e=this.children,t=e.length;for(let n=0;n<t;n++)e[n].clear();return this}clone(e){return e||(e={}),e.container="undefined"!=typeof document&&document.createElement("div"),sn.prototype.clone.call(this,e)}destroy(){super.destroy();const e=this.content;e&&xt._isInDocument(e)&&this.container().removeChild(e);const t=On.indexOf(this);return t>-1&&On.splice(t,1),xt.releaseCanvas(this.bufferCanvas._canvas,this.bufferHitCanvas._canvas),this}getPointerPosition(){const e=this._pointerPositions[0]||this._changedPointerPositions[0];return e?{x:e.x,y:e.y}:(xt.warn("Pointer position is missing and not registered by the stage. Looks like it is outside of the stage container. You can set it manually from event: stage.setPointersPositions(event);"),null)}_getPointerById(e){return this._pointerPositions.find(t=>t.id===e)}getPointersPositions(){return this._pointerPositions}getStage(){return this}getContent(){return this.content}_toKonvaCanvas(e){(e={...e}).x=e.x||0,e.y=e.y||0,e.width=e.width||this.width(),e.height=e.height||this.height();const t=new jt({width:e.width,height:e.height,pixelRatio:e.pixelRatio||1}),n=t.getContext()._context,r=this.children;return(e.x||e.y)&&n.translate(-1*e.x,-1*e.y),r.forEach(function(t){if(!t.isVisible())return;const r=t._toKonvaCanvas(e);n.drawImage(r._canvas,e.x,e.y,r.getWidth()/r.getPixelRatio(),r.getHeight()/r.getPixelRatio())}),t}getIntersection(e){if(!e)return null;const t=this.children;for(let n=t.length-1;n>=0;n--){const r=t[n].getIntersection(e);if(r)return r}return null}_resizeDOM(){const e=this.width(),t=this.height();this.content&&(this.content.style.width=e+"px",this.content.style.height=t+"px"),this.bufferCanvas.setSize(e,t),this.bufferHitCanvas.setSize(e,t),this.children.forEach(n=>{n.setSize({width:e,height:t}),n.draw()})}add(e,...t){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}super.add(e);const n=this.children.length;return n>5&&xt.warn("The stage has "+n+" layers. Recommended maximum number of layers is 3-5. Adding more layers into the stage may drop the performance. Rethink your tree structure, you can use Konva.Group."),e.setSize({width:this.width(),height:this.height()}),e.draw(),ot.isBrowser&&this.content.appendChild(e.canvas._canvas),this}getParent(){return null}getLayer(){return null}hasPointerCapture(e){return dn(e,this)}setPointerCapture(e){hn(e,this)}releaseCapture(e){pn(e)}getLayers(){return this.children}_bindContentEvents(){ot.isBrowser&&Nn.forEach(([e,t])=>{this.content.addEventListener(e,e=>{this[t](e)},{passive:!1})})}_pointerenter(e){this.setPointersPositions(e);const t=Ln(e.type);t&&this._fire(t.pointerenter,{evt:e,target:this,currentTarget:this})}_pointerover(e){this.setPointersPositions(e);const t=Ln(e.type);t&&this._fire(t.pointerover,{evt:e,target:this,currentTarget:this})}_getTargetShape(e){let t=this[e+"targetShape"];return t&&!t.getStage()&&(t=null),t}_pointerleave(e){const t=Ln(e.type),n=Dn(e.type);if(!t)return;this.setPointersPositions(e);const r=this._getTargetShape(n),i=!(ot.isDragging()||ot.isTransforming())||ot.hitOnDragEnabled;r&&i?(r._fireAndBubble(t.pointerout,{evt:e}),r._fireAndBubble(t.pointerleave,{evt:e}),this._fire(t.pointerleave,{evt:e,target:this,currentTarget:this}),this[n+"targetShape"]=null):i&&(this._fire(t.pointerleave,{evt:e,target:this,currentTarget:this}),this._fire(t.pointerout,{evt:e,target:this,currentTarget:this})),this.pointerPos=null,this._pointerPositions=[]}_pointerdown(e){const t=Ln(e.type),n=Dn(e.type);if(!t)return;this.setPointersPositions(e);let r=!1;this._changedPointerPositions.forEach(i=>{const a=this.getIntersection(i);if(It.justDragged=!1,ot["_"+n+"ListenClick"]=!0,!a||!a.isListening())return void(this[n+"ClickStartShape"]=void 0);ot.capturePointerEventsEnabled&&a.setPointerCapture(i.id),this[n+"ClickStartShape"]=a,a._fireAndBubble(t.pointerdown,{evt:e,pointerId:i.id}),r=!0;const s=e.type.indexOf("touch")>=0;a.preventDefault()&&e.cancelable&&s&&e.preventDefault()}),r||this._fire(t.pointerdown,{evt:e,target:this,currentTarget:this,pointerId:this._pointerPositions[0].id})}_pointermove(e){const t=Ln(e.type),n=Dn(e.type);if(!t)return;const r=e.type.indexOf("touch")>=0||"touch"===e.pointerType;ot.isDragging()&&It.node.preventDefault()&&e.cancelable&&r&&e.preventDefault(),this.setPointersPositions(e);if(!(!(ot.isDragging()||ot.isTransforming())||ot.hitOnDragEnabled))return;const i={};let a=!1;const s=this._getTargetShape(n);this._changedPointerPositions.forEach(r=>{const o=cn(r.id)||this.getIntersection(r),l=r.id,c={evt:e,pointerId:l},u=s!==o;if(u&&s&&(s._fireAndBubble(t.pointerout,{...c},o),s._fireAndBubble(t.pointerleave,{...c},o)),o){if(i[o._id])return;i[o._id]=!0}o&&o.isListening()?(a=!0,u&&(o._fireAndBubble(t.pointerover,{...c},s),o._fireAndBubble(t.pointerenter,{...c},s),this[n+"targetShape"]=o),o._fireAndBubble(t.pointermove,{...c})):s&&(this._fire(t.pointerover,{evt:e,target:this,currentTarget:this,pointerId:l}),this[n+"targetShape"]=null)}),a||this._fire(t.pointermove,{evt:e,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id})}_pointerup(e){const t=Ln(e.type),n=Dn(e.type);if(!t)return;this.setPointersPositions(e);const r=this[n+"ClickStartShape"],i=this[n+"ClickEndShape"],a={};let s=!1;this._changedPointerPositions.forEach(o=>{const l=cn(o.id)||this.getIntersection(o);if(l){if(l.releaseCapture(o.id),a[l._id])return;a[l._id]=!0}const c=o.id,u={evt:e,pointerId:c};let d=!1;ot["_"+n+"InDblClickWindow"]?(d=!0,clearTimeout(this[n+"DblTimeout"])):It.justDragged||(ot["_"+n+"InDblClickWindow"]=!0,clearTimeout(this[n+"DblTimeout"])),this[n+"DblTimeout"]=setTimeout(function(){ot["_"+n+"InDblClickWindow"]=!1},ot.dblClickWindow),l&&l.isListening()?(s=!0,this[n+"ClickEndShape"]=l,l._fireAndBubble(t.pointerup,{...u}),ot["_"+n+"ListenClick"]&&r&&r===l&&(l._fireAndBubble(t.pointerclick,{...u}),d&&i&&i===l&&l._fireAndBubble(t.pointerdblclick,{...u}))):(this[n+"ClickEndShape"]=null,s||(this._fire(t.pointerup,{evt:e,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),s=!0),ot["_"+n+"ListenClick"]&&this._fire(t.pointerclick,{evt:e,target:this,currentTarget:this,pointerId:c}),d&&this._fire(t.pointerdblclick,{evt:e,target:this,currentTarget:this,pointerId:c}))}),s||this._fire(t.pointerup,{evt:e,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),ot["_"+n+"ListenClick"]=!1,e.cancelable&&"touch"!==n&&"pointer"!==n&&e.preventDefault()}_contextmenu(e){this.setPointersPositions(e);const t=this.getIntersection(this.getPointerPosition());t&&t.isListening()?t._fireAndBubble(Pn,{evt:e}):this._fire(Pn,{evt:e,target:this,currentTarget:this})}_wheel(e){this.setPointersPositions(e);const t=this.getIntersection(this.getPointerPosition());t&&t.isListening()?t._fireAndBubble(Mn,{evt:e}):this._fire(Mn,{evt:e,target:this,currentTarget:this})}_pointercancel(e){this.setPointersPositions(e);const t=cn(e.pointerId)||this.getIntersection(this.getPointerPosition());t&&t._fireAndBubble(_n,un(e)),pn(e.pointerId)}_lostpointercapture(e){pn(e.pointerId)}setPointersPositions(e){const t=this._getContentPosition();let n=null,r=null;void 0!==(e=e||window.event).touches?(this._pointerPositions=[],this._changedPointerPositions=[],Array.prototype.forEach.call(e.touches,e=>{this._pointerPositions.push({id:e.identifier,x:(e.clientX-t.left)/t.scaleX,y:(e.clientY-t.top)/t.scaleY})}),Array.prototype.forEach.call(e.changedTouches||e.touches,e=>{this._changedPointerPositions.push({id:e.identifier,x:(e.clientX-t.left)/t.scaleX,y:(e.clientY-t.top)/t.scaleY})})):(n=(e.clientX-t.left)/t.scaleX,r=(e.clientY-t.top)/t.scaleY,this.pointerPos={x:n,y:r},this._pointerPositions=[{x:n,y:r,id:xt._getFirstPointerId(e)}],this._changedPointerPositions=[{x:n,y:r,id:xt._getFirstPointerId(e)}])}_setPointerPosition(e){xt.warn('Method _setPointerPosition is deprecated. Use "stage.setPointersPositions(event)" instead.'),this.setPointersPositions(e)}_getContentPosition(){if(!this.content||!this.content.getBoundingClientRect)return{top:0,left:0,scaleX:1,scaleY:1};const e=this.content.getBoundingClientRect();return{top:e.top,left:e.left,scaleX:e.width/this.content.clientWidth||1,scaleY:e.height/this.content.clientHeight||1}}_buildDOM(){if(this.bufferCanvas=new jt({width:this.width(),height:this.height()}),this.bufferHitCanvas=new zt({pixelRatio:1,width:this.width(),height:this.height()}),!ot.isBrowser)return;const e=this.container();if(!e)throw"Stage has no container. A container is required.";e.innerHTML="",this.content=document.createElement("div"),this.content.style.position="relative",this.content.style.userSelect="none",this.content.className="konvajs-content",this.content.setAttribute("role","presentation"),e.appendChild(this.content),this._resizeDOM()}cache(){return xt.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes."),this}clearCache(){return this}batchDraw(){return this.getChildren().forEach(function(e){e.batchDraw()}),this}};Fn.prototype.nodeType="Stage",lt(Fn),qt.addGetterSetter(Fn,"container"),ot.isBrowser&&document.addEventListener("visibilitychange",()=>{On.forEach(e=>{e.batchDraw()})});const Wn="hasShadow",qn="shadowRGBA",Bn="patternImage",$n="linearGradient",Hn="radialGradient";let Vn;function Un(){return Vn||(Vn=xt.createCanvasElement().getContext("2d"),Vn)}const Qn={};class Yn extends rn{constructor(e){let t;for(super(e);t=xt.getRandomColor(),!t||t in Qn;);this.colorKey=t,Qn[t]=this}getContext(){return xt.warn("shape.getContext() method is deprecated. Please do not use it."),this.getLayer().getContext()}getCanvas(){return xt.warn("shape.getCanvas() method is deprecated. Please do not use it."),this.getLayer().getCanvas()}getSceneFunc(){return this.attrs.sceneFunc||this._sceneFunc}getHitFunc(){return this.attrs.hitFunc||this._hitFunc}hasShadow(){return this._getCache(Wn,this._hasShadow)}_hasShadow(){return this.shadowEnabled()&&0!==this.shadowOpacity()&&!!(this.shadowColor()||this.shadowBlur()||this.shadowOffsetX()||this.shadowOffsetY())}_getFillPattern(){return this._getCache(Bn,this.__getFillPattern)}__getFillPattern(){if(this.fillPatternImage()){const e=Un().createPattern(this.fillPatternImage(),this.fillPatternRepeat()||"repeat");if(e&&e.setTransform){const t=new ut;t.translate(this.fillPatternX(),this.fillPatternY()),t.rotate(ot.getAngle(this.fillPatternRotation())),t.scale(this.fillPatternScaleX(),this.fillPatternScaleY()),t.translate(-1*this.fillPatternOffsetX(),-1*this.fillPatternOffsetY());const n=t.getMatrix(),r="undefined"==typeof DOMMatrix?{a:n[0],b:n[1],c:n[2],d:n[3],e:n[4],f:n[5]}:new DOMMatrix(n);e.setTransform(r)}return e}}_getLinearGradient(){return this._getCache($n,this.__getLinearGradient)}__getLinearGradient(){const e=this.fillLinearGradientColorStops();if(e){const t=Un(),n=this.fillLinearGradientStartPoint(),r=this.fillLinearGradientEndPoint(),i=t.createLinearGradient(n.x,n.y,r.x,r.y);for(let a=0;a<e.length;a+=2)i.addColorStop(e[a],e[a+1]);return i}}_getRadialGradient(){return this._getCache(Hn,this.__getRadialGradient)}__getRadialGradient(){const e=this.fillRadialGradientColorStops();if(e){const t=Un(),n=this.fillRadialGradientStartPoint(),r=this.fillRadialGradientEndPoint(),i=t.createRadialGradient(n.x,n.y,this.fillRadialGradientStartRadius(),r.x,r.y,this.fillRadialGradientEndRadius());for(let a=0;a<e.length;a+=2)i.addColorStop(e[a],e[a+1]);return i}}getShadowRGBA(){return this._getCache(qn,this._getShadowRGBA)}_getShadowRGBA(){if(!this.hasShadow())return;const e=xt.colorToRGBA(this.shadowColor());return e?"rgba("+e.r+","+e.g+","+e.b+","+e.a*(this.shadowOpacity()||1)+")":void 0}hasFill(){return this._calculate("hasFill",["fillEnabled","fill","fillPatternImage","fillLinearGradientColorStops","fillRadialGradientColorStops"],()=>this.fillEnabled()&&!!(this.fill()||this.fillPatternImage()||this.fillLinearGradientColorStops()||this.fillRadialGradientColorStops()))}hasStroke(){return this._calculate("hasStroke",["strokeEnabled","strokeWidth","stroke","strokeLinearGradientColorStops"],()=>this.strokeEnabled()&&this.strokeWidth()&&!(!this.stroke()&&!this.strokeLinearGradientColorStops()))}hasHitStroke(){const e=this.hitStrokeWidth();return"auto"===e?this.hasStroke():this.strokeEnabled()&&!!e}intersects(e){const t=this.getStage();if(!t)return!1;const n=t.bufferHitCanvas;n.getContext().clear(),this.drawHit(n,void 0,!0);return n.context.getImageData(Math.round(e.x),Math.round(e.y),1,1).data[3]>0}destroy(){return rn.prototype.destroy.call(this),delete Qn[this.colorKey],delete this.colorKey,this}_useBufferCanvas(e){var t;if(!(null===(t=this.attrs.perfectDrawEnabled)||void 0===t||t))return!1;const n=e||this.hasFill(),r=this.hasStroke(),i=1!==this.getAbsoluteOpacity();if(n&&r&&i)return!0;const a=this.hasShadow(),s=this.shadowForStrokeEnabled();return!!(n&&r&&a&&s)}setStrokeHitEnabled(e){xt.warn("strokeHitEnabled property is deprecated. Please use hitStrokeWidth instead."),e?this.hitStrokeWidth("auto"):this.hitStrokeWidth(0)}getStrokeHitEnabled(){return 0!==this.hitStrokeWidth()}getSelfRect(){const e=this.size();return{x:this._centroid?-e.width/2:0,y:this._centroid?-e.height/2:0,width:e.width,height:e.height}}getClientRect(e={}){let t=!1,n=this.getParent();for(;n;){if(n.isCached()){t=!0;break}n=n.getParent()}const r=e.skipTransform,i=e.relativeTo||t&&this.getStage()||void 0,a=this.getSelfRect(),s=!e.skipStroke&&this.hasStroke()&&this.strokeWidth()||0,o=a.width+s,l=a.height+s,c=!e.skipShadow&&this.hasShadow(),u=c?this.shadowOffsetX():0,d=c?this.shadowOffsetY():0,h=o+Math.abs(u),p=l+Math.abs(d),f=c&&this.shadowBlur()||0,g={width:h+2*f,height:p+2*f,x:-(s/2+f)+Math.min(u,0)+a.x,y:-(s/2+f)+Math.min(d,0)+a.y};return r?g:this._transformedRect(g,i)}drawScene(e,t,n){const r=this.getLayer(),i=(e||r.getCanvas()).getContext(),a=this._getCanvasCache(),s=this.getSceneFunc(),o=this.hasShadow();let l;const c=t===this;if(!this.isVisible()&&!c)return this;if(a){i.save();const e=this.getAbsoluteTransform(t).getMatrix();return i.transform(e[0],e[1],e[2],e[3],e[4],e[5]),this._drawCachedSceneCanvas(i),i.restore(),this}if(!s)return this;if(i.save(),this._useBufferCanvas()){l=this.getStage();const e=n||l.bufferCanvas,r=e.getContext();r.clear(),r.save(),r._applyLineJoin(this),r._applyMiterLimit(this);const a=this.getAbsoluteTransform(t).getMatrix();r.transform(a[0],a[1],a[2],a[3],a[4],a[5]),s.call(this,r,this),r.restore();const u=e.pixelRatio;o&&i._applyShadow(this),c||(i._applyOpacity(this),i._applyGlobalCompositeOperation(this)),i.drawImage(e._canvas,e.x||0,e.y||0,e.width/u,e.height/u)}else{if(i._applyLineJoin(this),i._applyMiterLimit(this),!c){const e=this.getAbsoluteTransform(t).getMatrix();i.transform(e[0],e[1],e[2],e[3],e[4],e[5]),i._applyOpacity(this),i._applyGlobalCompositeOperation(this)}o&&i._applyShadow(this),s.call(this,i,this)}return i.restore(),this}drawHit(e,t,n=!1){if(!this.shouldDrawHit(t,n))return this;const r=this.getLayer(),i=e||r.hitCanvas,a=i&&i.getContext(),s=this.hitFunc()||this.sceneFunc(),o=this._getCanvasCache(),l=o&&o.hit;if(this.colorKey||xt.warn("Looks like your canvas has a destroyed shape in it. Do not reuse shape after you destroyed it. If you want to reuse shape you should call remove() instead of destroy()"),l){a.save();const e=this.getAbsoluteTransform(t).getMatrix();return a.transform(e[0],e[1],e[2],e[3],e[4],e[5]),this._drawCachedHitCanvas(a),a.restore(),this}if(!s)return this;a.save(),a._applyLineJoin(this),a._applyMiterLimit(this);if(!(this===t)){const e=this.getAbsoluteTransform(t).getMatrix();a.transform(e[0],e[1],e[2],e[3],e[4],e[5])}return s.call(this,a,this),a.restore(),this}drawHitFromCache(e=0){const t=this._getCanvasCache(),n=this._getCachedSceneCanvas(),r=t.hit,i=r.getContext(),a=r.getWidth(),s=r.getHeight();i.clear(),i.drawImage(n._canvas,0,0,a,s);try{const t=i.getImageData(0,0,a,s),n=t.data,r=n.length,o=xt._hexToRgb(this.colorKey);for(let i=0;i<r;i+=4){n[i+3]>e?(n[i]=o.r,n[i+1]=o.g,n[i+2]=o.b,n[i+3]=255):n[i+3]=0}i.putImageData(t,0,0)}catch(o){xt.error("Unable to draw hit graph from cached scene canvas. "+o.message)}return this}hasPointerCapture(e){return dn(e,this)}setPointerCapture(e){hn(e,this)}releaseCapture(e){pn(e)}}Yn.prototype._fillFunc=function(e){const t=this.attrs.fillRule;t?e.fill(t):e.fill()},Yn.prototype._strokeFunc=function(e){e.stroke()},Yn.prototype._fillFuncHit=function(e){const t=this.attrs.fillRule;t?e.fill(t):e.fill()},Yn.prototype._strokeFuncHit=function(e){e.stroke()},Yn.prototype._centroid=!1,Yn.prototype.nodeType="Shape",lt(Yn),Yn.prototype.eventListeners={},Yn.prototype.on.call(Yn.prototype,"shadowColorChange.konva shadowBlurChange.konva shadowOffsetChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",function(){this._clearCache(Wn)}),Yn.prototype.on.call(Yn.prototype,"shadowColorChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",function(){this._clearCache(qn)}),Yn.prototype.on.call(Yn.prototype,"fillPriorityChange.konva fillPatternImageChange.konva fillPatternRepeatChange.konva fillPatternScaleXChange.konva fillPatternScaleYChange.konva fillPatternOffsetXChange.konva fillPatternOffsetYChange.konva fillPatternXChange.konva fillPatternYChange.konva fillPatternRotationChange.konva",function(){this._clearCache(Bn)}),Yn.prototype.on.call(Yn.prototype,"fillPriorityChange.konva fillLinearGradientColorStopsChange.konva fillLinearGradientStartPointXChange.konva fillLinearGradientStartPointYChange.konva fillLinearGradientEndPointXChange.konva fillLinearGradientEndPointYChange.konva",function(){this._clearCache($n)}),Yn.prototype.on.call(Yn.prototype,"fillPriorityChange.konva fillRadialGradientColorStopsChange.konva fillRadialGradientStartPointXChange.konva fillRadialGradientStartPointYChange.konva fillRadialGradientEndPointXChange.konva fillRadialGradientEndPointYChange.konva fillRadialGradientStartRadiusChange.konva fillRadialGradientEndRadiusChange.konva",function(){this._clearCache(Hn)}),qt.addGetterSetter(Yn,"stroke",void 0,Gt()),qt.addGetterSetter(Yn,"strokeWidth",2,Nt()),qt.addGetterSetter(Yn,"fillAfterStrokeEnabled",!1),qt.addGetterSetter(Yn,"hitStrokeWidth","auto",Dt()),qt.addGetterSetter(Yn,"strokeHitEnabled",!0,Ot()),qt.addGetterSetter(Yn,"perfectDrawEnabled",!0,Ot()),qt.addGetterSetter(Yn,"shadowForStrokeEnabled",!0,Ot()),qt.addGetterSetter(Yn,"lineJoin"),qt.addGetterSetter(Yn,"lineCap"),qt.addGetterSetter(Yn,"miterLimit"),qt.addGetterSetter(Yn,"sceneFunc"),qt.addGetterSetter(Yn,"hitFunc"),qt.addGetterSetter(Yn,"dash"),qt.addGetterSetter(Yn,"dashOffset",0,Nt()),qt.addGetterSetter(Yn,"shadowColor",void 0,Lt()),qt.addGetterSetter(Yn,"shadowBlur",0,Nt()),qt.addGetterSetter(Yn,"shadowOpacity",1,Nt()),qt.addComponentsGetterSetter(Yn,"shadowOffset",["x","y"]),qt.addGetterSetter(Yn,"shadowOffsetX",0,Nt()),qt.addGetterSetter(Yn,"shadowOffsetY",0,Nt()),qt.addGetterSetter(Yn,"fillPatternImage"),qt.addGetterSetter(Yn,"fill",void 0,Gt()),qt.addGetterSetter(Yn,"fillPatternX",0,Nt()),qt.addGetterSetter(Yn,"fillPatternY",0,Nt()),qt.addGetterSetter(Yn,"fillLinearGradientColorStops"),qt.addGetterSetter(Yn,"strokeLinearGradientColorStops"),qt.addGetterSetter(Yn,"fillRadialGradientStartRadius",0),qt.addGetterSetter(Yn,"fillRadialGradientEndRadius",0),qt.addGetterSetter(Yn,"fillRadialGradientColorStops"),qt.addGetterSetter(Yn,"fillPatternRepeat","repeat"),qt.addGetterSetter(Yn,"fillEnabled",!0),qt.addGetterSetter(Yn,"strokeEnabled",!0),qt.addGetterSetter(Yn,"shadowEnabled",!0),qt.addGetterSetter(Yn,"dashEnabled",!0),qt.addGetterSetter(Yn,"strokeScaleEnabled",!0),qt.addGetterSetter(Yn,"fillPriority","color"),qt.addComponentsGetterSetter(Yn,"fillPatternOffset",["x","y"]),qt.addGetterSetter(Yn,"fillPatternOffsetX",0,Nt()),qt.addGetterSetter(Yn,"fillPatternOffsetY",0,Nt()),qt.addComponentsGetterSetter(Yn,"fillPatternScale",["x","y"]),qt.addGetterSetter(Yn,"fillPatternScaleX",1,Nt()),qt.addGetterSetter(Yn,"fillPatternScaleY",1,Nt()),qt.addComponentsGetterSetter(Yn,"fillLinearGradientStartPoint",["x","y"]),qt.addComponentsGetterSetter(Yn,"strokeLinearGradientStartPoint",["x","y"]),qt.addGetterSetter(Yn,"fillLinearGradientStartPointX",0),qt.addGetterSetter(Yn,"strokeLinearGradientStartPointX",0),qt.addGetterSetter(Yn,"fillLinearGradientStartPointY",0),qt.addGetterSetter(Yn,"strokeLinearGradientStartPointY",0),qt.addComponentsGetterSetter(Yn,"fillLinearGradientEndPoint",["x","y"]),qt.addComponentsGetterSetter(Yn,"strokeLinearGradientEndPoint",["x","y"]),qt.addGetterSetter(Yn,"fillLinearGradientEndPointX",0),qt.addGetterSetter(Yn,"strokeLinearGradientEndPointX",0),qt.addGetterSetter(Yn,"fillLinearGradientEndPointY",0),qt.addGetterSetter(Yn,"strokeLinearGradientEndPointY",0),qt.addComponentsGetterSetter(Yn,"fillRadialGradientStartPoint",["x","y"]),qt.addGetterSetter(Yn,"fillRadialGradientStartPointX",0),qt.addGetterSetter(Yn,"fillRadialGradientStartPointY",0),qt.addComponentsGetterSetter(Yn,"fillRadialGradientEndPoint",["x","y"]),qt.addGetterSetter(Yn,"fillRadialGradientEndPointX",0),qt.addGetterSetter(Yn,"fillRadialGradientEndPointY",0),qt.addGetterSetter(Yn,"fillPatternRotation",0),qt.addGetterSetter(Yn,"fillRule",void 0,Lt()),qt.backCompat(Yn,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"});const Xn=[{x:0,y:0},{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],Kn=Xn.length;let Jn=class extends sn{constructor(e){super(e),this.canvas=new jt,this.hitCanvas=new zt({pixelRatio:1}),this._waitingForDraw=!1,this.on("visibleChange.konva",this._checkVisibility),this._checkVisibility(),this.on("imageSmoothingEnabledChange.konva",this._setSmoothEnabled),this._setSmoothEnabled()}createPNGStream(){return this.canvas._canvas.createPNGStream()}getCanvas(){return this.canvas}getNativeCanvasElement(){return this.canvas._canvas}getHitCanvas(){return this.hitCanvas}getContext(){return this.getCanvas().getContext()}clear(e){return this.getContext().clear(e),this.getHitCanvas().getContext().clear(e),this}setZIndex(e){super.setZIndex(e);const t=this.getStage();return t&&t.content&&(t.content.removeChild(this.getNativeCanvasElement()),e<t.children.length-1?t.content.insertBefore(this.getNativeCanvasElement(),t.children[e+1].getCanvas()._canvas):t.content.appendChild(this.getNativeCanvasElement())),this}moveToTop(){rn.prototype.moveToTop.call(this);const e=this.getStage();return e&&e.content&&(e.content.removeChild(this.getNativeCanvasElement()),e.content.appendChild(this.getNativeCanvasElement())),!0}moveUp(){if(!rn.prototype.moveUp.call(this))return!1;const e=this.getStage();return!(!e||!e.content)&&(e.content.removeChild(this.getNativeCanvasElement()),this.index<e.children.length-1?e.content.insertBefore(this.getNativeCanvasElement(),e.children[this.index+1].getCanvas()._canvas):e.content.appendChild(this.getNativeCanvasElement()),!0)}moveDown(){if(rn.prototype.moveDown.call(this)){const e=this.getStage();if(e){const t=e.children;e.content&&(e.content.removeChild(this.getNativeCanvasElement()),e.content.insertBefore(this.getNativeCanvasElement(),t[this.index+1].getCanvas()._canvas))}return!0}return!1}moveToBottom(){if(rn.prototype.moveToBottom.call(this)){const e=this.getStage();if(e){const t=e.children;e.content&&(e.content.removeChild(this.getNativeCanvasElement()),e.content.insertBefore(this.getNativeCanvasElement(),t[1].getCanvas()._canvas))}return!0}return!1}getLayer(){return this}remove(){const e=this.getNativeCanvasElement();return rn.prototype.remove.call(this),e&&e.parentNode&&xt._isInDocument(e)&&e.parentNode.removeChild(e),this}getStage(){return this.parent}setSize({width:e,height:t}){return this.canvas.setSize(e,t),this.hitCanvas.setSize(e,t),this._setSmoothEnabled(),this}_validateAdd(e){const t=e.getType();"Group"!==t&&"Shape"!==t&&xt.throw("You may only add groups and shapes to a layer.")}_toKonvaCanvas(e){return(e={...e}).width=e.width||this.getWidth(),e.height=e.height||this.getHeight(),e.x=void 0!==e.x?e.x:this.x(),e.y=void 0!==e.y?e.y:this.y(),rn.prototype._toKonvaCanvas.call(this,e)}_checkVisibility(){const e=this.visible();this.canvas._canvas.style.display=e?"block":"none"}_setSmoothEnabled(){this.getContext()._context.imageSmoothingEnabled=this.imageSmoothingEnabled()}getWidth(){if(this.parent)return this.parent.width()}setWidth(){xt.warn('Can not change width of layer. Use "stage.width(value)" function instead.')}getHeight(){if(this.parent)return this.parent.height()}setHeight(){xt.warn('Can not change height of layer. Use "stage.height(value)" function instead.')}batchDraw(){return this._waitingForDraw||(this._waitingForDraw=!0,xt.requestAnimFrame(()=>{this.draw(),this._waitingForDraw=!1})),this}getIntersection(e){if(!this.isListening()||!this.isVisible())return null;let t=1,n=!1;for(;;){for(let r=0;r<Kn;r++){const i=Xn[r],a=this._getIntersection({x:e.x+i.x*t,y:e.y+i.y*t}),s=a.shape;if(s)return s;if(n=!!a.antialiased,!a.antialiased)break}if(!n)return null;t+=1}}_getIntersection(e){const t=this.hitCanvas.pixelRatio,n=this.hitCanvas.context.getImageData(Math.round(e.x*t),Math.round(e.y*t),1,1).data,r=n[3];if(255===r){const e=xt._rgbToHex(n[0],n[1],n[2]),t=Qn["#"+e];return t?{shape:t}:{antialiased:!0}}return r>0?{antialiased:!0}:{}}drawScene(e,t,n){const r=this.getLayer(),i=e||r&&r.getCanvas();return this._fire("beforeDraw",{node:this}),this.clearBeforeDraw()&&i.getContext().clear(),sn.prototype.drawScene.call(this,i,t,n),this._fire("draw",{node:this}),this}drawHit(e,t){const n=this.getLayer(),r=e||n&&n.hitCanvas;return n&&n.clearBeforeDraw()&&n.getHitCanvas().getContext().clear(),sn.prototype.drawHit.call(this,r,t),this}enableHitGraph(){return this.hitGraphEnabled(!0),this}disableHitGraph(){return this.hitGraphEnabled(!1),this}setHitGraphEnabled(e){xt.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening(e)}getHitGraphEnabled(e){return xt.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening()}toggleHitCanvas(){if(!this.parent||!this.parent.content)return;const e=this.parent;!!this.hitCanvas._canvas.parentNode?e.content.removeChild(this.hitCanvas._canvas):e.content.appendChild(this.hitCanvas._canvas)}destroy(){return xt.releaseCanvas(this.getNativeCanvasElement(),this.getHitCanvas()._canvas),super.destroy()}};Jn.prototype.nodeType="Layer",lt(Jn),qt.addGetterSetter(Jn,"imageSmoothingEnabled",!0),qt.addGetterSetter(Jn,"clearBeforeDraw",!0),qt.addGetterSetter(Jn,"hitGraphEnabled",!0,Ot());class Zn extends Jn{constructor(e){super(e),this.listening(!1),xt.warn('Konva.Fast layer is deprecated. Please use "new Konva.Layer({ listening: false })" instead.')}}Zn.prototype.nodeType="FastLayer",lt(Zn);let er=class extends sn{_validateAdd(e){const t=e.getType();"Group"!==t&&"Shape"!==t&&xt.throw("You may only add groups and shapes to groups.")}};er.prototype.nodeType="Group",lt(er);const tr=st.performance&&st.performance.now?function(){return st.performance.now()}:function(){return(new Date).getTime()};class nr{constructor(e,t){this.id=nr.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:tr(),frameRate:0},this.func=e,this.setLayers(t)}setLayers(e){let t=[];return e&&(t=Array.isArray(e)?e:[e]),this.layers=t,this}getLayers(){return this.layers}addLayer(e){const t=this.layers,n=t.length;for(let r=0;r<n;r++)if(t[r]._id===e._id)return!1;return this.layers.push(e),!0}isRunning(){const e=nr.animations,t=e.length;for(let n=0;n<t;n++)if(e[n].id===this.id)return!0;return!1}start(){return this.stop(),this.frame.timeDiff=0,this.frame.lastTime=tr(),nr._addAnimation(this),this}stop(){return nr._removeAnimation(this),this}_updateFrameObject(e){this.frame.timeDiff=e-this.frame.lastTime,this.frame.lastTime=e,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}static _addAnimation(e){this.animations.push(e),this._handleAnimation()}static _removeAnimation(e){const t=e.id,n=this.animations,r=n.length;for(let i=0;i<r;i++)if(n[i].id===t){this.animations.splice(i,1);break}}static _runFrames(){const e={},t=this.animations;for(let n=0;n<t.length;n++){const r=t[n],i=r.layers,a=r.func;r._updateFrameObject(tr());const s=i.length;let o;if(o=!a||!1!==a.call(r,r.frame),o)for(let t=0;t<s;t++){const n=i[t];void 0!==n._id&&(e[n._id]=n)}}for(const n in e)e.hasOwnProperty(n)&&e[n].batchDraw()}static _animationLoop(){const e=nr;e.animations.length?(e._runFrames(),xt.requestAnimFrame(e._animationLoop)):e.animRunning=!1}static _handleAnimation(){this.animRunning||(this.animRunning=!0,xt.requestAnimFrame(this._animationLoop))}}nr.animations=[],nr.animIdCounter=0,nr.animRunning=!1;const rr={node:1,duration:1,easing:1,onFinish:1,yoyo:1},ir=["fill","stroke","shadowColor"];let ar=0;class sr{constructor(e,t,n,r,i,a,s){this.prop=e,this.propFunc=t,this.begin=r,this._pos=r,this.duration=a,this._change=0,this.prevPos=0,this.yoyo=s,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=n,this._change=i-this.begin,this.pause()}fire(e){const t=this[e];t&&t()}setTime(e){e>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():e<0?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=e,this.update())}getTime(){return this._time}setPosition(e){this.prevPos=this._pos,this.propFunc(e),this._pos=e}getPosition(e){return void 0===e&&(e=this._time),this.func(e,this.begin,this._change,this.duration)}play(){this.state=2,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")}reverse(){this.state=3,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")}seek(e){this.pause(),this._time=e,this.update(),this.fire("onSeek")}reset(){this.pause(),this._time=0,this.update(),this.fire("onReset")}finish(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")}update(){this.setPosition(this.getPosition(this._time)),this.fire("onUpdate")}onEnterFrame(){const e=this.getTimer()-this._startTime;2===this.state?this.setTime(e):3===this.state&&this.setTime(this.duration-e)}pause(){this.state=1,this.fire("onPause")}getTimer(){return(new Date).getTime()}}class or{constructor(e){const t=this,n=e.node,r=n._id,i=e.easing||lr.Linear,a=!!e.yoyo;let s,o;s=void 0===e.duration?.3:0===e.duration?.001:e.duration,this.node=n,this._id=ar++;const l=n.getLayer()||(n instanceof ot.Stage?n.getLayers():null);for(o in l||xt.error("Tween constructor have `node` that is not in a layer. Please add node into layer first."),this.anim=new nr(function(){t.tween.onEnterFrame()},l),this.tween=new sr(o,function(e){t._tweenFunc(e)},i,0,1,1e3*s,a),this._addListeners(),or.attrs[r]||(or.attrs[r]={}),or.attrs[r][this._id]||(or.attrs[r][this._id]={}),or.tweens[r]||(or.tweens[r]={}),e)void 0===rr[o]&&this._addAttr(o,e[o]);this.reset(),this.onFinish=e.onFinish,this.onReset=e.onReset,this.onUpdate=e.onUpdate}_addAttr(e,t){const n=this.node,r=n._id;let i,a,s,o,l;const c=or.tweens[r][e];c&&delete or.attrs[r][c][e];let u=n.getAttr(e);if(xt._isArray(t))if(i=[],a=Math.max(t.length,u.length),"points"===e&&t.length!==u.length&&(t.length>u.length?(o=u,u=xt._prepareArrayForTween(u,t,n.closed())):(s=t,t=xt._prepareArrayForTween(t,u,n.closed()))),0===e.indexOf("fill"))for(let d=0;d<a;d++)if(d%2==0)i.push(t[d]-u[d]);else{const e=xt.colorToRGBA(u[d]);l=xt.colorToRGBA(t[d]),u[d]=e,i.push({r:l.r-e.r,g:l.g-e.g,b:l.b-e.b,a:l.a-e.a})}else for(let d=0;d<a;d++)i.push(t[d]-u[d]);else-1!==ir.indexOf(e)?(u=xt.colorToRGBA(u),l=xt.colorToRGBA(t),i={r:l.r-u.r,g:l.g-u.g,b:l.b-u.b,a:l.a-u.a}):i=t-u;or.attrs[r][this._id][e]={start:u,diff:i,end:t,trueEnd:s,trueStart:o},or.tweens[r][e]=this._id}_tweenFunc(e){const t=this.node,n=or.attrs[t._id][this._id];let r,i,a,s,o,l,c,u;for(r in n){if(i=n[r],a=i.start,s=i.diff,u=i.end,xt._isArray(a))if(o=[],c=Math.max(a.length,u.length),0===r.indexOf("fill"))for(l=0;l<c;l++)l%2==0?o.push((a[l]||0)+s[l]*e):o.push("rgba("+Math.round(a[l].r+s[l].r*e)+","+Math.round(a[l].g+s[l].g*e)+","+Math.round(a[l].b+s[l].b*e)+","+(a[l].a+s[l].a*e)+")");else for(l=0;l<c;l++)o.push((a[l]||0)+s[l]*e);else o=-1!==ir.indexOf(r)?"rgba("+Math.round(a.r+s.r*e)+","+Math.round(a.g+s.g*e)+","+Math.round(a.b+s.b*e)+","+(a.a+s.a*e)+")":a+s*e;t.setAttr(r,o)}}_addListeners(){this.tween.onPlay=()=>{this.anim.start()},this.tween.onReverse=()=>{this.anim.start()},this.tween.onPause=()=>{this.anim.stop()},this.tween.onFinish=()=>{const e=this.node,t=or.attrs[e._id][this._id];t.points&&t.points.trueEnd&&e.setAttr("points",t.points.trueEnd),this.onFinish&&this.onFinish.call(this)},this.tween.onReset=()=>{const e=this.node,t=or.attrs[e._id][this._id];t.points&&t.points.trueStart&&e.points(t.points.trueStart),this.onReset&&this.onReset()},this.tween.onUpdate=()=>{this.onUpdate&&this.onUpdate.call(this)}}play(){return this.tween.play(),this}reverse(){return this.tween.reverse(),this}reset(){return this.tween.reset(),this}seek(e){return this.tween.seek(1e3*e),this}pause(){return this.tween.pause(),this}finish(){return this.tween.finish(),this}destroy(){const e=this.node._id,t=this._id,n=or.tweens[e];this.pause(),this.anim&&this.anim.stop();for(const r in n)delete or.tweens[e][r];delete or.attrs[e][t],or.tweens[e]&&(0===Object.keys(or.tweens[e]).length&&delete or.tweens[e],0===Object.keys(or.attrs[e]).length&&delete or.attrs[e])}}or.attrs={},or.tweens={},rn.prototype.to=function(e){const t=e.onFinish;e.node=this,e.onFinish=function(){this.destroy(),t&&t()};new or(e).play()};const lr={BackEaseIn(e,t,n,r){const i=1.70158;return n*(e/=r)*e*((i+1)*e-i)+t},BackEaseOut(e,t,n,r){const i=1.70158;return n*((e=e/r-1)*e*((i+1)*e+i)+1)+t},BackEaseInOut(e,t,n,r){let i=1.70158;return(e/=r/2)<1?n/2*(e*e*((1+(i*=1.525))*e-i))+t:n/2*((e-=2)*e*((1+(i*=1.525))*e+i)+2)+t},ElasticEaseIn(e,t,n,r,i,a){let s=0;return 0===e?t:1===(e/=r)?t+n:(a||(a=.3*r),!i||i<Math.abs(n)?(i=n,s=a/4):s=a/(2*Math.PI)*Math.asin(n/i),-i*Math.pow(2,10*(e-=1))*Math.sin((e*r-s)*(2*Math.PI)/a)+t)},ElasticEaseOut(e,t,n,r,i,a){let s=0;return 0===e?t:1===(e/=r)?t+n:(a||(a=.3*r),!i||i<Math.abs(n)?(i=n,s=a/4):s=a/(2*Math.PI)*Math.asin(n/i),i*Math.pow(2,-10*e)*Math.sin((e*r-s)*(2*Math.PI)/a)+n+t)},ElasticEaseInOut(e,t,n,r,i,a){let s=0;return 0===e?t:2==(e/=r/2)?t+n:(a||(a=r*(.3*1.5)),!i||i<Math.abs(n)?(i=n,s=a/4):s=a/(2*Math.PI)*Math.asin(n/i),e<1?i*Math.pow(2,10*(e-=1))*Math.sin((e*r-s)*(2*Math.PI)/a)*-.5+t:i*Math.pow(2,-10*(e-=1))*Math.sin((e*r-s)*(2*Math.PI)/a)*.5+n+t)},BounceEaseOut:(e,t,n,r)=>(e/=r)<1/2.75?n*(7.5625*e*e)+t:e<2/2.75?n*(7.5625*(e-=1.5/2.75)*e+.75)+t:e<2.5/2.75?n*(7.5625*(e-=2.25/2.75)*e+.9375)+t:n*(7.5625*(e-=2.625/2.75)*e+.984375)+t,BounceEaseIn:(e,t,n,r)=>n-lr.BounceEaseOut(r-e,0,n,r)+t,BounceEaseInOut:(e,t,n,r)=>e<r/2?.5*lr.BounceEaseIn(2*e,0,n,r)+t:.5*lr.BounceEaseOut(2*e-r,0,n,r)+.5*n+t,EaseIn:(e,t,n,r)=>n*(e/=r)*e+t,EaseOut:(e,t,n,r)=>-n*(e/=r)*(e-2)+t,EaseInOut:(e,t,n,r)=>(e/=r/2)<1?n/2*e*e+t:-n/2*(--e*(e-2)-1)+t,StrongEaseIn:(e,t,n,r)=>n*(e/=r)*e*e*e*e+t,StrongEaseOut:(e,t,n,r)=>n*((e=e/r-1)*e*e*e*e+1)+t,StrongEaseInOut:(e,t,n,r)=>(e/=r/2)<1?n/2*e*e*e*e*e+t:n/2*((e-=2)*e*e*e*e+2)+t,Linear:(e,t,n,r)=>n*e/r+t},cr=xt._assign(ot,{Util:xt,Transform:ut,Node:rn,Container:sn,Stage:Fn,stages:On,Layer:Jn,FastLayer:Zn,Group:er,DD:It,Shape:Yn,shapes:Qn,Animation:nr,Tween:or,Easings:lr,Context:_t,Canvas:kt});class ur extends Yn{_sceneFunc(e){const t=ot.getAngle(this.angle()),n=this.clockwise();e.beginPath(),e.arc(0,0,this.outerRadius(),0,t,n),e.arc(0,0,this.innerRadius(),t,0,!n),e.closePath(),e.fillStrokeShape(this)}getWidth(){return 2*this.outerRadius()}getHeight(){return 2*this.outerRadius()}setWidth(e){this.outerRadius(e/2)}setHeight(e){this.outerRadius(e/2)}getSelfRect(){const e=this.innerRadius(),t=this.outerRadius(),n=this.clockwise(),r=ot.getAngle(n?360-this.angle():this.angle()),i=Math.cos(Math.min(r,Math.PI)),a=Math.sin(Math.min(Math.max(Math.PI,r),3*Math.PI/2)),s=Math.sin(Math.min(r,Math.PI/2)),o=i*(i>0?e:t),l=a*(a>0?e:t),c=s*(s>0?t:e);return{x:o,y:n?-1*c:l,width:1*t-o,height:c-l}}}function dr(e,t,n,r,i,a,s){const o=Math.sqrt(Math.pow(n-e,2)+Math.pow(r-t,2)),l=Math.sqrt(Math.pow(i-n,2)+Math.pow(a-r,2)),c=s*o/(o+l),u=s*l/(o+l);return[n-c*(i-e),r-c*(a-t),n+u*(i-e),r+u*(a-t)]}function hr(e,t){const n=e.length,r=[];for(let i=2;i<n-2;i+=2){const n=dr(e[i-2],e[i-1],e[i],e[i+1],e[i+2],e[i+3],t);isNaN(n[0])||(r.push(n[0]),r.push(n[1]),r.push(e[i]),r.push(e[i+1]),r.push(n[2]),r.push(n[3]))}return r}ur.prototype._centroid=!0,ur.prototype.className="Arc",ur.prototype._attrsAffectingSize=["innerRadius","outerRadius","angle","clockwise"],lt(ur),qt.addGetterSetter(ur,"innerRadius",0,Nt()),qt.addGetterSetter(ur,"outerRadius",0,Nt()),qt.addGetterSetter(ur,"angle",0,Nt()),qt.addGetterSetter(ur,"clockwise",!1,Ot());let pr=class extends Yn{constructor(e){super(e),this.on("pointsChange.konva tensionChange.konva closedChange.konva bezierChange.konva",function(){this._clearCache("tensionPoints")})}_sceneFunc(e){const t=this.points(),n=t.length,r=this.tension(),i=this.closed(),a=this.bezier();if(!n)return;let s=0;if(e.beginPath(),e.moveTo(t[0],t[1]),0!==r&&n>4){const r=this.getTensionPoints(),a=r.length;for(s=i?0:4,i||e.quadraticCurveTo(r[0],r[1],r[2],r[3]);s<a-2;)e.bezierCurveTo(r[s++],r[s++],r[s++],r[s++],r[s++],r[s++]);i||e.quadraticCurveTo(r[a-2],r[a-1],t[n-2],t[n-1])}else if(a)for(s=2;s<n;)e.bezierCurveTo(t[s++],t[s++],t[s++],t[s++],t[s++],t[s++]);else for(s=2;s<n;s+=2)e.lineTo(t[s],t[s+1]);i?(e.closePath(),e.fillStrokeShape(this)):e.strokeShape(this)}getTensionPoints(){return this._getCache("tensionPoints",this._getTensionPoints)}_getTensionPoints(){return this.closed()?this._getTensionPointsClosed():hr(this.points(),this.tension())}_getTensionPointsClosed(){const e=this.points(),t=e.length,n=this.tension(),r=dr(e[t-2],e[t-1],e[0],e[1],e[2],e[3],n),i=dr(e[t-4],e[t-3],e[t-2],e[t-1],e[0],e[1],n),a=hr(e,n);return[r[2],r[3]].concat(a).concat([i[0],i[1],e[t-2],e[t-1],i[2],i[3],r[0],r[1],e[0],e[1]])}getWidth(){return this.getSelfRect().width}getHeight(){return this.getSelfRect().height}getSelfRect(){let e=this.points();if(e.length<4)return{x:e[0]||0,y:e[1]||0,width:0,height:0};e=0!==this.tension()?[e[0],e[1],...this._getTensionPoints(),e[e.length-2],e[e.length-1]]:this.points();let t,n,r=e[0],i=e[0],a=e[1],s=e[1];for(let o=0;o<e.length/2;o++)t=e[2*o],n=e[2*o+1],r=Math.min(r,t),i=Math.max(i,t),a=Math.min(a,n),s=Math.max(s,n);return{x:r,y:a,width:i-r,height:s-a}}};pr.prototype.className="Line",pr.prototype._attrsAffectingSize=["points","bezier","tension"],lt(pr),qt.addGetterSetter(pr,"closed",!1),qt.addGetterSetter(pr,"bezier",!1),qt.addGetterSetter(pr,"tension",0,Nt()),qt.addGetterSetter(pr,"points",[],function(){if(ot.isUnminified)return function(e,t){const n=Int8Array?Object.getPrototypeOf(Int8Array):null;return n&&e instanceof n||(xt._isArray(e)?e.forEach(function(e){xt._isNumber(e)||xt.warn('"'+t+'" attribute has non numeric element '+e+". Make sure that all elements are numbers.")}):xt.warn(Et(e)+' is a not valid value for "'+t+'" attribute. The value should be a array of numbers.')),e}}());const fr=[[],[],[-.5773502691896257,.5773502691896257],[0,-.7745966692414834,.7745966692414834],[-.33998104358485626,.33998104358485626,-.8611363115940526,.8611363115940526],[0,-.5384693101056831,.5384693101056831,-.906179845938664,.906179845938664],[.6612093864662645,-.6612093864662645,-.2386191860831969,.2386191860831969,-.932469514203152,.932469514203152],[0,.4058451513773972,-.4058451513773972,-.7415311855993945,.7415311855993945,-.9491079123427585,.9491079123427585],[-.1834346424956498,.1834346424956498,-.525532409916329,.525532409916329,-.7966664774136267,.7966664774136267,-.9602898564975363,.9602898564975363],[0,-.8360311073266358,.8360311073266358,-.9681602395076261,.9681602395076261,-.3242534234038089,.3242534234038089,-.6133714327005904,.6133714327005904],[-.14887433898163122,.14887433898163122,-.4333953941292472,.4333953941292472,-.6794095682990244,.6794095682990244,-.8650633666889845,.8650633666889845,-.9739065285171717,.9739065285171717],[0,-.26954315595234496,.26954315595234496,-.5190961292068118,.5190961292068118,-.7301520055740494,.7301520055740494,-.8870625997680953,.8870625997680953,-.978228658146057,.978228658146057],[-.1252334085114689,.1252334085114689,-.3678314989981802,.3678314989981802,-.5873179542866175,.5873179542866175,-.7699026741943047,.7699026741943047,-.9041172563704749,.9041172563704749,-.9815606342467192,.9815606342467192],[0,-.2304583159551348,.2304583159551348,-.44849275103644687,.44849275103644687,-.6423493394403402,.6423493394403402,-.8015780907333099,.8015780907333099,-.9175983992229779,.9175983992229779,-.9841830547185881,.9841830547185881],[-.10805494870734367,.10805494870734367,-.31911236892788974,.31911236892788974,-.5152486363581541,.5152486363581541,-.6872929048116855,.6872929048116855,-.827201315069765,.827201315069765,-.9284348836635735,.9284348836635735,-.9862838086968123,.9862838086968123],[0,-.20119409399743451,.20119409399743451,-.3941513470775634,.3941513470775634,-.5709721726085388,.5709721726085388,-.7244177313601701,.7244177313601701,-.8482065834104272,.8482065834104272,-.937273392400706,.937273392400706,-.9879925180204854,.9879925180204854],[-.09501250983763744,.09501250983763744,-.2816035507792589,.2816035507792589,-.45801677765722737,.45801677765722737,-.6178762444026438,.6178762444026438,-.755404408355003,.755404408355003,-.8656312023878318,.8656312023878318,-.9445750230732326,.9445750230732326,-.9894009349916499,.9894009349916499],[0,-.17848418149584785,.17848418149584785,-.3512317634538763,.3512317634538763,-.5126905370864769,.5126905370864769,-.6576711592166907,.6576711592166907,-.7815140038968014,.7815140038968014,-.8802391537269859,.8802391537269859,-.9506755217687678,.9506755217687678,-.9905754753144174,.9905754753144174],[-.0847750130417353,.0847750130417353,-.2518862256915055,.2518862256915055,-.41175116146284263,.41175116146284263,-.5597708310739475,.5597708310739475,-.6916870430603532,.6916870430603532,-.8037049589725231,.8037049589725231,-.8926024664975557,.8926024664975557,-.9558239495713977,.9558239495713977,-.9915651684209309,.9915651684209309],[0,-.16035864564022537,.16035864564022537,-.31656409996362983,.31656409996362983,-.46457074137596094,.46457074137596094,-.600545304661681,.600545304661681,-.7209661773352294,.7209661773352294,-.8227146565371428,.8227146565371428,-.9031559036148179,.9031559036148179,-.96020815213483,.96020815213483,-.9924068438435844,.9924068438435844],[-.07652652113349734,.07652652113349734,-.22778585114164507,.22778585114164507,-.37370608871541955,.37370608871541955,-.5108670019508271,.5108670019508271,-.636053680726515,.636053680726515,-.7463319064601508,.7463319064601508,-.8391169718222188,.8391169718222188,-.912234428251326,.912234428251326,-.9639719272779138,.9639719272779138,-.9931285991850949,.9931285991850949],[0,-.1455618541608951,.1455618541608951,-.2880213168024011,.2880213168024011,-.4243421202074388,.4243421202074388,-.5516188358872198,.5516188358872198,-.6671388041974123,.6671388041974123,-.7684399634756779,.7684399634756779,-.8533633645833173,.8533633645833173,-.9200993341504008,.9200993341504008,-.9672268385663063,.9672268385663063,-.9937521706203895,.9937521706203895],[-.06973927331972223,.06973927331972223,-.20786042668822127,.20786042668822127,-.34193582089208424,.34193582089208424,-.469355837986757,.469355837986757,-.5876404035069116,.5876404035069116,-.6944872631866827,.6944872631866827,-.7878168059792081,.7878168059792081,-.8658125777203002,.8658125777203002,-.926956772187174,.926956772187174,-.9700604978354287,.9700604978354287,-.9942945854823992,.9942945854823992],[0,-.1332568242984661,.1332568242984661,-.26413568097034495,.26413568097034495,-.3903010380302908,.3903010380302908,-.5095014778460075,.5095014778460075,-.6196098757636461,.6196098757636461,-.7186613631319502,.7186613631319502,-.8048884016188399,.8048884016188399,-.8767523582704416,.8767523582704416,-.9329710868260161,.9329710868260161,-.9725424712181152,.9725424712181152,-.9947693349975522,.9947693349975522],[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213]],gr=[[],[],[1,1],[.8888888888888888,.5555555555555556,.5555555555555556],[.6521451548625461,.6521451548625461,.34785484513745385,.34785484513745385],[.5688888888888889,.47862867049936647,.47862867049936647,.23692688505618908,.23692688505618908],[.3607615730481386,.3607615730481386,.46791393457269104,.46791393457269104,.17132449237917036,.17132449237917036],[.4179591836734694,.3818300505051189,.3818300505051189,.27970539148927664,.27970539148927664,.1294849661688697,.1294849661688697],[.362683783378362,.362683783378362,.31370664587788727,.31370664587788727,.22238103445337448,.22238103445337448,.10122853629037626,.10122853629037626],[.3302393550012598,.1806481606948574,.1806481606948574,.08127438836157441,.08127438836157441,.31234707704000286,.31234707704000286,.26061069640293544,.26061069640293544],[.29552422471475287,.29552422471475287,.26926671930999635,.26926671930999635,.21908636251598204,.21908636251598204,.1494513491505806,.1494513491505806,.06667134430868814,.06667134430868814],[.2729250867779006,.26280454451024665,.26280454451024665,.23319376459199048,.23319376459199048,.18629021092773426,.18629021092773426,.1255803694649046,.1255803694649046,.05566856711617366,.05566856711617366],[.24914704581340277,.24914704581340277,.2334925365383548,.2334925365383548,.20316742672306592,.20316742672306592,.16007832854334622,.16007832854334622,.10693932599531843,.10693932599531843,.04717533638651183,.04717533638651183],[.2325515532308739,.22628318026289723,.22628318026289723,.2078160475368885,.2078160475368885,.17814598076194574,.17814598076194574,.13887351021978725,.13887351021978725,.09212149983772845,.09212149983772845,.04048400476531588,.04048400476531588],[.2152638534631578,.2152638534631578,.2051984637212956,.2051984637212956,.18553839747793782,.18553839747793782,.15720316715819355,.15720316715819355,.12151857068790319,.12151857068790319,.08015808715976021,.08015808715976021,.03511946033175186,.03511946033175186],[.2025782419255613,.19843148532711158,.19843148532711158,.1861610000155622,.1861610000155622,.16626920581699392,.16626920581699392,.13957067792615432,.13957067792615432,.10715922046717194,.10715922046717194,.07036604748810812,.07036604748810812,.03075324199611727,.03075324199611727],[.1894506104550685,.1894506104550685,.18260341504492358,.18260341504492358,.16915651939500254,.16915651939500254,.14959598881657674,.14959598881657674,.12462897125553388,.12462897125553388,.09515851168249279,.09515851168249279,.062253523938647894,.062253523938647894,.027152459411754096,.027152459411754096],[.17944647035620653,.17656270536699264,.17656270536699264,.16800410215645004,.16800410215645004,.15404576107681028,.15404576107681028,.13513636846852548,.13513636846852548,.11188384719340397,.11188384719340397,.08503614831717918,.08503614831717918,.0554595293739872,.0554595293739872,.02414830286854793,.02414830286854793],[.1691423829631436,.1691423829631436,.16427648374583273,.16427648374583273,.15468467512626524,.15468467512626524,.14064291467065065,.14064291467065065,.12255520671147846,.12255520671147846,.10094204410628717,.10094204410628717,.07642573025488905,.07642573025488905,.0497145488949698,.0497145488949698,.02161601352648331,.02161601352648331],[.1610544498487837,.15896884339395434,.15896884339395434,.15276604206585967,.15276604206585967,.1426067021736066,.1426067021736066,.12875396253933621,.12875396253933621,.11156664554733399,.11156664554733399,.09149002162245,.09149002162245,.06904454273764123,.06904454273764123,.0448142267656996,.0448142267656996,.019461788229726478,.019461788229726478],[.15275338713072584,.15275338713072584,.14917298647260374,.14917298647260374,.14209610931838204,.14209610931838204,.13168863844917664,.13168863844917664,.11819453196151841,.11819453196151841,.10193011981724044,.10193011981724044,.08327674157670475,.08327674157670475,.06267204833410907,.06267204833410907,.04060142980038694,.04060142980038694,.017614007139152118,.017614007139152118],[.14608113364969041,.14452440398997005,.14452440398997005,.13988739479107315,.13988739479107315,.13226893863333747,.13226893863333747,.12183141605372853,.12183141605372853,.10879729916714838,.10879729916714838,.09344442345603386,.09344442345603386,.0761001136283793,.0761001136283793,.057134425426857205,.057134425426857205,.036953789770852494,.036953789770852494,.016017228257774335,.016017228257774335],[.13925187285563198,.13925187285563198,.13654149834601517,.13654149834601517,.13117350478706238,.13117350478706238,.12325237681051242,.12325237681051242,.11293229608053922,.11293229608053922,.10041414444288096,.10041414444288096,.08594160621706773,.08594160621706773,.06979646842452049,.06979646842452049,.052293335152683286,.052293335152683286,.03377490158481415,.03377490158481415,.0146279952982722,.0146279952982722],[.13365457218610619,.1324620394046966,.1324620394046966,.12890572218808216,.12890572218808216,.12304908430672953,.12304908430672953,.11499664022241136,.11499664022241136,.10489209146454141,.10489209146454141,.09291576606003515,.09291576606003515,.07928141177671895,.07928141177671895,.06423242140852585,.06423242140852585,.04803767173108467,.04803767173108467,.030988005856979445,.030988005856979445,.013411859487141771,.013411859487141771],[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872]],mr=[[1],[1,1],[1,2,1],[1,3,3,1]],xr=(e,t,n)=>{let r,i;const a=n/2;r=0;for(let s=0;s<20;s++)i=a*fr[20][s]+a,r+=gr[20][s]*vr(e,t,i);return a*r},yr=(e,t,n)=>{void 0===n&&(n=1);const r=e[0]-2*e[1]+e[2],i=t[0]-2*t[1]+t[2],a=2*e[1]-2*e[0],s=2*t[1]-2*t[0],o=4*(r*r+i*i),l=4*(r*a+i*s),c=a*a+s*s;if(0===o)return n*Math.sqrt(Math.pow(e[2]-e[0],2)+Math.pow(t[2]-t[0],2));const u=l/(2*o),d=n+u,h=c/o-u*u,p=d*d+h>0?Math.sqrt(d*d+h):0,f=u*u+h>0?Math.sqrt(u*u+h):0,g=u+Math.sqrt(u*u+h)!==0?h*Math.log(Math.abs((d+p)/(u+f))):0;return Math.sqrt(o)/2*(d*p-u*f+g)};function vr(e,t,n){const r=br(1,n,e),i=br(1,n,t),a=r*r+i*i;return Math.sqrt(a)}const br=(e,t,n)=>{const r=n.length-1;let i,a;if(0===r)return 0;if(0===e){a=0;for(let e=0;e<=r;e++)a+=mr[r][e]*Math.pow(1-t,r-e)*Math.pow(t,e)*n[e];return a}i=new Array(r);for(let s=0;s<r;s++)i[s]=r*(n[s+1]-n[s]);return br(e-1,t,i)},Sr=(e,t,n)=>{let r=1,i=e/t,a=(e-n(i))/t,s=0;for(;r>.001;){const o=n(i+a),l=Math.abs(e-o)/t;if(l<r)r=l,i+=a;else{const s=n(i-a),o=Math.abs(e-s)/t;o<r?(r=o,i-=a):a/=2}if(s++,s>500)break}return i};class _r extends Yn{constructor(e){super(e),this.dataArray=[],this.pathLength=0,this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute()})}_readDataAttribute(){this.dataArray=_r.parsePathData(this.data()),this.pathLength=_r.getPathLength(this.dataArray)}_sceneFunc(e){const t=this.dataArray;e.beginPath();let n=!1;for(let r=0;r<t.length;r++){const i=t[r].command,a=t[r].points;switch(i){case"L":e.lineTo(a[0],a[1]);break;case"M":e.moveTo(a[0],a[1]);break;case"C":e.bezierCurveTo(a[0],a[1],a[2],a[3],a[4],a[5]);break;case"Q":e.quadraticCurveTo(a[0],a[1],a[2],a[3]);break;case"A":const t=a[0],r=a[1],i=a[2],s=a[3],o=a[4],l=a[5],c=a[6],u=a[7],d=i>s?i:s,h=i>s?1:i/s,p=i>s?s/i:1;e.translate(t,r),e.rotate(c),e.scale(h,p),e.arc(0,0,d,o,o+l,1-u),e.scale(1/h,1/p),e.rotate(-c),e.translate(-t,-r);break;case"z":n=!0,e.closePath()}}n||this.hasFill()?e.fillStrokeShape(this):e.strokeShape(this)}getSelfRect(){let e=[];this.dataArray.forEach(function(t){if("A"===t.command){const n=t.points[4],r=t.points[5],i=t.points[4]+r;let a=Math.PI/180;if(Math.abs(n-i)<a&&(a=Math.abs(n-i)),r<0)for(let s=n-a;s>i;s-=a){const n=_r.getPointOnEllipticalArc(t.points[0],t.points[1],t.points[2],t.points[3],s,0);e.push(n.x,n.y)}else for(let s=n+a;s<i;s+=a){const n=_r.getPointOnEllipticalArc(t.points[0],t.points[1],t.points[2],t.points[3],s,0);e.push(n.x,n.y)}}else if("C"===t.command)for(let n=0;n<=1;n+=.01){const r=_r.getPointOnCubicBezier(n,t.start.x,t.start.y,t.points[0],t.points[1],t.points[2],t.points[3],t.points[4],t.points[5]);e.push(r.x,r.y)}else e=e.concat(t.points)});let t,n,r=e[0],i=e[0],a=e[1],s=e[1];for(let o=0;o<e.length/2;o++)t=e[2*o],n=e[2*o+1],isNaN(t)||(r=Math.min(r,t),i=Math.max(i,t)),isNaN(n)||(a=Math.min(a,n),s=Math.max(s,n));return{x:r,y:a,width:i-r,height:s-a}}getLength(){return this.pathLength}getPointAtLength(e){return _r.getPointAtLengthOfDataArray(e,this.dataArray)}static getLineLength(e,t,n,r){return Math.sqrt((n-e)*(n-e)+(r-t)*(r-t))}static getPathLength(e){let t=0;for(let n=0;n<e.length;++n)t+=e[n].pathLength;return t}static getPointAtLengthOfDataArray(e,t){let n,r=0,i=t.length;if(!i)return null;for(;r<i&&e>t[r].pathLength;)e-=t[r].pathLength,++r;if(r===i)return n=t[r-1].points.slice(-2),{x:n[0],y:n[1]};if(e<.01){return"M"===t[r].command?(n=t[r].points.slice(0,2),{x:n[0],y:n[1]}):{x:t[r].start.x,y:t[r].start.y}}const a=t[r],s=a.points;switch(a.command){case"L":return _r.getPointOnLine(e,a.start.x,a.start.y,s[0],s[1]);case"C":return _r.getPointOnCubicBezier(Sr(e,_r.getPathLength(t),e=>xr([a.start.x,s[0],s[2],s[4]],[a.start.y,s[1],s[3],s[5]],e)),a.start.x,a.start.y,s[0],s[1],s[2],s[3],s[4],s[5]);case"Q":return _r.getPointOnQuadraticBezier(Sr(e,_r.getPathLength(t),e=>yr([a.start.x,s[0],s[2]],[a.start.y,s[1],s[3]],e)),a.start.x,a.start.y,s[0],s[1],s[2],s[3]);case"A":const n=s[0],r=s[1],i=s[2],o=s[3],l=s[5],c=s[6];let u=s[4];return u+=l*e/a.pathLength,_r.getPointOnEllipticalArc(n,r,i,o,u,c)}return null}static getPointOnLine(e,t,n,r,i,a,s){a=null!=a?a:t,s=null!=s?s:n;const o=this.getLineLength(t,n,r,i);if(o<1e-10)return{x:t,y:n};if(r===t)return{x:a,y:s+(i>n?e:-e)};const l=(i-n)/(r-t),c=Math.sqrt(e*e/(1+l*l))*(r<t?-1:1),u=l*c;if(Math.abs(s-n-l*(a-t))<1e-10)return{x:a+c,y:s+u};const d=((a-t)*(r-t)+(s-n)*(i-n))/(o*o),h=t+d*(r-t),p=n+d*(i-n),f=this.getLineLength(a,s,h,p),g=Math.sqrt(e*e-f*f),m=Math.sqrt(g*g/(1+l*l))*(r<t?-1:1);return{x:h+m,y:p+l*m}}static getPointOnCubicBezier(e,t,n,r,i,a,s,o,l){function c(e){return e*e*e}function u(e){return 3*e*e*(1-e)}function d(e){return 3*e*(1-e)*(1-e)}function h(e){return(1-e)*(1-e)*(1-e)}return{x:o*c(e)+a*u(e)+r*d(e)+t*h(e),y:l*c(e)+s*u(e)+i*d(e)+n*h(e)}}static getPointOnQuadraticBezier(e,t,n,r,i,a,s){function o(e){return e*e}function l(e){return 2*e*(1-e)}function c(e){return(1-e)*(1-e)}return{x:a*o(e)+r*l(e)+t*c(e),y:s*o(e)+i*l(e)+n*c(e)}}static getPointOnEllipticalArc(e,t,n,r,i,a){const s=Math.cos(a),o=Math.sin(a),l=n*Math.cos(i),c=r*Math.sin(i);return{x:e+(l*s-c*o),y:t+(l*o+c*s)}}static parsePathData(e){if(!e)return[];let t=e;const n=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];t=t.replace(new RegExp(" ","g"),",");for(let u=0;u<n.length;u++)t=t.replace(new RegExp(n[u],"g"),"|"+n[u]);const r=t.split("|"),i=[],a=[];let s=0,o=0;const l=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi;let c;for(let u=1;u<r.length;u++){let e=r[u],t=e.charAt(0);for(e=e.slice(1),a.length=0;c=l.exec(e);)a.push(c[0]);let n=[],d="A"===t||"a"===t?0:-1;for(let r=0,i=a.length;r<i;r++){const e=a[r];if("00"!==e)if(d>=0){if(3===d){if(/^[01]{2}\d+(?:\.\d+)?$/.test(e)){n.push(parseInt(e[0],10)),n.push(parseInt(e[1],10)),n.push(parseFloat(e.slice(2))),d+=3,d>=7&&(d-=7);continue}if("11"===e||"10"===e||"01"===e){n.push(parseInt(e[0],10)),n.push(parseInt(e[1],10)),d+=2,d>=7&&(d-=7);continue}if("0"===e||"1"===e){n.push(parseInt(e,10)),d+=1,d>=7&&(d-=7);continue}}else if(4===d){if(/^[01]\d+(?:\.\d+)?$/.test(e)){n.push(parseInt(e[0],10)),n.push(parseFloat(e.slice(1))),d+=2,d>=7&&(d-=7);continue}if("0"===e||"1"===e){n.push(parseInt(e,10)),d+=1,d>=7&&(d-=7);continue}}const t=parseFloat(e);isNaN(t)?n.push(0):n.push(t),d+=1,d>=7&&(d-=7)}else{const t=parseFloat(e);isNaN(t)?n.push(0):n.push(t)}else n.push(0,0),d>=0&&(d+=2,d>=7&&(d-=7))}for(;n.length>0&&!isNaN(n[0]);){let e="",r=[];const a=s,l=o;let c,u,d,h,p,f,g,m,x,y;switch(t){case"l":s+=n.shift(),o+=n.shift(),e="L",r.push(s,o);break;case"L":s=n.shift(),o=n.shift(),r.push(s,o);break;case"m":const a=n.shift(),l=n.shift();if(s+=a,o+=l,e="M",i.length>2&&"z"===i[i.length-1].command)for(let e=i.length-2;e>=0;e--)if("M"===i[e].command){s=i[e].points[0]+a,o=i[e].points[1]+l;break}r.push(s,o),t="l";break;case"M":s=n.shift(),o=n.shift(),e="M",r.push(s,o),t="L";break;case"h":s+=n.shift(),e="L",r.push(s,o);break;case"H":s=n.shift(),e="L",r.push(s,o);break;case"v":o+=n.shift(),e="L",r.push(s,o);break;case"V":o=n.shift(),e="L",r.push(s,o);break;case"C":r.push(n.shift(),n.shift(),n.shift(),n.shift()),s=n.shift(),o=n.shift(),r.push(s,o);break;case"c":r.push(s+n.shift(),o+n.shift(),s+n.shift(),o+n.shift()),s+=n.shift(),o+=n.shift(),e="C",r.push(s,o);break;case"S":u=s,d=o,c=i[i.length-1],"C"===c.command&&(u=s+(s-c.points[2]),d=o+(o-c.points[3])),r.push(u,d,n.shift(),n.shift()),s=n.shift(),o=n.shift(),e="C",r.push(s,o);break;case"s":u=s,d=o,c=i[i.length-1],"C"===c.command&&(u=s+(s-c.points[2]),d=o+(o-c.points[3])),r.push(u,d,s+n.shift(),o+n.shift()),s+=n.shift(),o+=n.shift(),e="C",r.push(s,o);break;case"Q":r.push(n.shift(),n.shift()),s=n.shift(),o=n.shift(),r.push(s,o);break;case"q":r.push(s+n.shift(),o+n.shift()),s+=n.shift(),o+=n.shift(),e="Q",r.push(s,o);break;case"T":u=s,d=o,c=i[i.length-1],"Q"===c.command&&(u=s+(s-c.points[0]),d=o+(o-c.points[1])),s=n.shift(),o=n.shift(),e="Q",r.push(u,d,s,o);break;case"t":u=s,d=o,c=i[i.length-1],"Q"===c.command&&(u=s+(s-c.points[0]),d=o+(o-c.points[1])),s+=n.shift(),o+=n.shift(),e="Q",r.push(u,d,s,o);break;case"A":h=n.shift(),p=n.shift(),f=n.shift(),g=n.shift(),m=n.shift(),x=s,y=o,s=n.shift(),o=n.shift(),e="A",r=this.convertEndpointToCenterParameterization(x,y,s,o,g,m,h,p,f);break;case"a":h=n.shift(),p=n.shift(),f=n.shift(),g=n.shift(),m=n.shift(),x=s,y=o,s+=n.shift(),o+=n.shift(),e="A",r=this.convertEndpointToCenterParameterization(x,y,s,o,g,m,h,p,f)}i.push({command:e||t,points:r,start:{x:a,y:l},pathLength:this.calcLength(a,l,e||t,r)})}"z"!==t&&"Z"!==t||i.push({command:"z",points:[],start:void 0,pathLength:0})}return i}static calcLength(e,t,n,r){let i,a,s,o;const l=_r;switch(n){case"L":return l.getLineLength(e,t,r[0],r[1]);case"C":return xr([e,r[0],r[2],r[4]],[t,r[1],r[3],r[5]],1);case"Q":return yr([e,r[0],r[2]],[t,r[1],r[3]],1);case"A":i=0;const n=r[4],c=r[5],u=r[4]+c;let d=Math.PI/180;if(Math.abs(n-u)<d&&(d=Math.abs(n-u)),a=l.getPointOnEllipticalArc(r[0],r[1],r[2],r[3],n,0),c<0)for(o=n-d;o>u;o-=d)s=l.getPointOnEllipticalArc(r[0],r[1],r[2],r[3],o,0),i+=l.getLineLength(a.x,a.y,s.x,s.y),a=s;else for(o=n+d;o<u;o+=d)s=l.getPointOnEllipticalArc(r[0],r[1],r[2],r[3],o,0),i+=l.getLineLength(a.x,a.y,s.x,s.y),a=s;return s=l.getPointOnEllipticalArc(r[0],r[1],r[2],r[3],u,0),i+=l.getLineLength(a.x,a.y,s.x,s.y),i}return 0}static convertEndpointToCenterParameterization(e,t,n,r,i,a,s,o,l){const c=l*(Math.PI/180),u=Math.cos(c)*(e-n)/2+Math.sin(c)*(t-r)/2,d=-1*Math.sin(c)*(e-n)/2+Math.cos(c)*(t-r)/2,h=u*u/(s*s)+d*d/(o*o);h>1&&(s*=Math.sqrt(h),o*=Math.sqrt(h));let p=Math.sqrt((s*s*(o*o)-s*s*(d*d)-o*o*(u*u))/(s*s*(d*d)+o*o*(u*u)));i===a&&(p*=-1),isNaN(p)&&(p=0);const f=p*s*d/o,g=p*-o*u/s,m=(e+n)/2+Math.cos(c)*f-Math.sin(c)*g,x=(t+r)/2+Math.sin(c)*f+Math.cos(c)*g,y=function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])},v=function(e,t){return(e[0]*t[0]+e[1]*t[1])/(y(e)*y(t))},b=function(e,t){return(e[0]*t[1]<e[1]*t[0]?-1:1)*Math.acos(v(e,t))},S=b([1,0],[(u-f)/s,(d-g)/o]),_=[(u-f)/s,(d-g)/o],C=[(-1*u-f)/s,(-1*d-g)/o];let w=b(_,C);return v(_,C)<=-1&&(w=Math.PI),v(_,C)>=1&&(w=0),0===a&&w>0&&(w-=2*Math.PI),1===a&&w<0&&(w+=2*Math.PI),[m,x,s,o,S,w,c,a]}}_r.prototype.className="Path",_r.prototype._attrsAffectingSize=["data"],lt(_r),qt.addGetterSetter(_r,"data");class Cr extends pr{_sceneFunc(e){super._sceneFunc(e);const t=2*Math.PI,n=this.points();let r=n;const i=0!==this.tension()&&n.length>4;i&&(r=this.getTensionPoints());const a=this.pointerLength(),s=n.length;let o,l;if(i){const e=[r[r.length-4],r[r.length-3],r[r.length-2],r[r.length-1],n[s-2],n[s-1]],t=_r.calcLength(r[r.length-4],r[r.length-3],"C",e),i=_r.getPointOnQuadraticBezier(Math.min(1,1-a/t),e[0],e[1],e[2],e[3],e[4],e[5]);o=n[s-2]-i.x,l=n[s-1]-i.y}else o=n[s-2]-n[s-4],l=n[s-1]-n[s-3];const c=(Math.atan2(l,o)+t)%t,u=this.pointerWidth();this.pointerAtEnding()&&(e.save(),e.beginPath(),e.translate(n[s-2],n[s-1]),e.rotate(c),e.moveTo(0,0),e.lineTo(-a,u/2),e.lineTo(-a,-u/2),e.closePath(),e.restore(),this.__fillStroke(e)),this.pointerAtBeginning()&&(e.save(),e.beginPath(),e.translate(n[0],n[1]),i?(o=(r[0]+r[2])/2-n[0],l=(r[1]+r[3])/2-n[1]):(o=n[2]-n[0],l=n[3]-n[1]),e.rotate((Math.atan2(-l,-o)+t)%t),e.moveTo(0,0),e.lineTo(-a,u/2),e.lineTo(-a,-u/2),e.closePath(),e.restore(),this.__fillStroke(e))}__fillStroke(e){const t=this.dashEnabled();t&&(this.attrs.dashEnabled=!1,e.setLineDash([])),e.fillStrokeShape(this),t&&(this.attrs.dashEnabled=!0)}getSelfRect(){const e=super.getSelfRect(),t=this.pointerWidth()/2;return{x:e.x,y:e.y-t,width:e.width,height:e.height+2*t}}}Cr.prototype.className="Arrow",lt(Cr),qt.addGetterSetter(Cr,"pointerLength",10,Nt()),qt.addGetterSetter(Cr,"pointerWidth",10,Nt()),qt.addGetterSetter(Cr,"pointerAtBeginning",!1),qt.addGetterSetter(Cr,"pointerAtEnding",!0);let wr=class extends Yn{_sceneFunc(e){e.beginPath(),e.arc(0,0,this.attrs.radius||0,0,2*Math.PI,!1),e.closePath(),e.fillStrokeShape(this)}getWidth(){return 2*this.radius()}getHeight(){return 2*this.radius()}setWidth(e){this.radius()!==e/2&&this.radius(e/2)}setHeight(e){this.radius()!==e/2&&this.radius(e/2)}};wr.prototype._centroid=!0,wr.prototype.className="Circle",wr.prototype._attrsAffectingSize=["radius"],lt(wr),qt.addGetterSetter(wr,"radius",0,Nt());class kr extends Yn{_sceneFunc(e){const t=this.radiusX(),n=this.radiusY();e.beginPath(),e.save(),t!==n&&e.scale(1,n/t),e.arc(0,0,t,0,2*Math.PI,!1),e.restore(),e.closePath(),e.fillStrokeShape(this)}getWidth(){return 2*this.radiusX()}getHeight(){return 2*this.radiusY()}setWidth(e){this.radiusX(e/2)}setHeight(e){this.radiusY(e/2)}}kr.prototype.className="Ellipse",kr.prototype._centroid=!0,kr.prototype._attrsAffectingSize=["radiusX","radiusY"],lt(kr),qt.addComponentsGetterSetter(kr,"radius",["x","y"]),qt.addGetterSetter(kr,"radiusX",0,Nt()),qt.addGetterSetter(kr,"radiusY",0,Nt());let jr=class e extends Yn{constructor(e){super(e),this._loadListener=()=>{this._requestDraw()},this.on("imageChange.konva",e=>{this._removeImageLoad(e.oldVal),this._setImageLoad()}),this._setImageLoad()}_setImageLoad(){const e=this.image();e&&e.complete||e&&4===e.readyState||e&&e.addEventListener&&e.addEventListener("load",this._loadListener)}_removeImageLoad(e){e&&e.removeEventListener&&e.removeEventListener("load",this._loadListener)}destroy(){return this._removeImageLoad(this.image()),super.destroy(),this}_useBufferCanvas(){const e=!!this.cornerRadius(),t=this.hasShadow();return!(!e||!t)||super._useBufferCanvas(!0)}_sceneFunc(e){const t=this.getWidth(),n=this.getHeight(),r=this.cornerRadius(),i=this.attrs.image;let a;if(i){const e=this.attrs.cropWidth,r=this.attrs.cropHeight;a=e&&r?[i,this.cropX(),this.cropY(),e,r,0,0,t,n]:[i,0,0,t,n]}(this.hasFill()||this.hasStroke()||r)&&(e.beginPath(),r?xt.drawRoundedRectPath(e,t,n,r):e.rect(0,0,t,n),e.closePath(),e.fillStrokeShape(this)),i&&(r&&e.clip(),e.drawImage.apply(e,a))}_hitFunc(e){const t=this.width(),n=this.height(),r=this.cornerRadius();e.beginPath(),r?xt.drawRoundedRectPath(e,t,n,r):e.rect(0,0,t,n),e.closePath(),e.fillStrokeShape(this)}getWidth(){var e,t,n;return null!==(n=null!==(e=this.attrs.width)&&void 0!==e?e:null===(t=this.image())||void 0===t?void 0:t.width)&&void 0!==n?n:0}getHeight(){var e,t,n;return null!==(n=null!==(e=this.attrs.height)&&void 0!==e?e:null===(t=this.image())||void 0===t?void 0:t.height)&&void 0!==n?n:0}static fromURL(t,n,r=null){const i=xt.createImageElement();i.onload=function(){const t=new e({image:i});n(t)},i.onerror=r,i.crossOrigin="Anonymous",i.src=t}};jr.prototype.className="Image",jr.prototype._attrsAffectingSize=["image"],lt(jr),qt.addGetterSetter(jr,"cornerRadius",0,Rt(4)),qt.addGetterSetter(jr,"image"),qt.addComponentsGetterSetter(jr,"crop",["x","y","width","height"]),qt.addGetterSetter(jr,"cropX",0,Nt()),qt.addGetterSetter(jr,"cropY",0,Nt()),qt.addGetterSetter(jr,"cropWidth",0,Nt()),qt.addGetterSetter(jr,"cropHeight",0,Nt());const Ar=["fontFamily","fontSize","fontStyle","padding","lineHeight","text","width","height","pointerDirection","pointerWidth","pointerHeight"],Pr="up",Tr="right",zr="down",Ir="left",Er=Ar.length;class Mr extends er{constructor(e){super(e),this.on("add.konva",function(e){this._addListeners(e.child),this._sync()})}getText(){return this.find("Text")[0]}getTag(){return this.find("Tag")[0]}_addListeners(e){let t,n=this;const r=function(){n._sync()};for(t=0;t<Er;t++)e.on(Ar[t]+"Change.konva",r)}getWidth(){return this.getText().width()}getHeight(){return this.getText().height()}_sync(){let e,t,n,r,i,a,s,o=this.getText(),l=this.getTag();if(o&&l){switch(e=o.width(),t=o.height(),n=l.pointerDirection(),r=l.pointerWidth(),s=l.pointerHeight(),i=0,a=0,n){case Pr:i=e/2,a=-1*s;break;case Tr:i=e+r,a=t/2;break;case zr:i=e/2,a=t+s;break;case Ir:i=-1*r,a=t/2}l.setAttrs({x:-1*i,y:-1*a,width:e,height:t}),o.setAttrs({x:-1*i,y:-1*a})}}}Mr.prototype.className="Label",lt(Mr);class Nr extends Yn{_sceneFunc(e){const t=this.width(),n=this.height(),r=this.pointerDirection(),i=this.pointerWidth(),a=this.pointerHeight(),s=this.cornerRadius();let o=0,l=0,c=0,u=0;"number"==typeof s?o=l=c=u=Math.min(s,t/2,n/2):(o=Math.min(s[0]||0,t/2,n/2),l=Math.min(s[1]||0,t/2,n/2),u=Math.min(s[2]||0,t/2,n/2),c=Math.min(s[3]||0,t/2,n/2)),e.beginPath(),e.moveTo(o,0),r===Pr&&(e.lineTo((t-i)/2,0),e.lineTo(t/2,-1*a),e.lineTo((t+i)/2,0)),e.lineTo(t-l,0),e.arc(t-l,l,l,3*Math.PI/2,0,!1),r===Tr&&(e.lineTo(t,(n-a)/2),e.lineTo(t+i,n/2),e.lineTo(t,(n+a)/2)),e.lineTo(t,n-u),e.arc(t-u,n-u,u,0,Math.PI/2,!1),r===zr&&(e.lineTo((t+i)/2,n),e.lineTo(t/2,n+a),e.lineTo((t-i)/2,n)),e.lineTo(c,n),e.arc(c,n-c,c,Math.PI/2,Math.PI,!1),r===Ir&&(e.lineTo(0,(n+a)/2),e.lineTo(-1*i,n/2),e.lineTo(0,(n-a)/2)),e.lineTo(0,o),e.arc(o,o,o,Math.PI,3*Math.PI/2,!1),e.closePath(),e.fillStrokeShape(this)}getSelfRect(){let e=0,t=0,n=this.pointerWidth(),r=this.pointerHeight(),i=this.pointerDirection(),a=this.width(),s=this.height();return i===Pr?(t-=r,s+=r):i===zr?s+=r:i===Ir?(e-=1.5*n,a+=n):i===Tr&&(a+=1.5*n),{x:e,y:t,width:a,height:s}}}Nr.prototype.className="Tag",lt(Nr),qt.addGetterSetter(Nr,"pointerDirection","none"),qt.addGetterSetter(Nr,"pointerWidth",0,Nt()),qt.addGetterSetter(Nr,"pointerHeight",0,Nt()),qt.addGetterSetter(Nr,"cornerRadius",0,Rt(4));class Rr extends Yn{_sceneFunc(e){const t=this.cornerRadius(),n=this.width(),r=this.height();e.beginPath(),t?xt.drawRoundedRectPath(e,n,r,t):e.rect(0,0,n,r),e.closePath(),e.fillStrokeShape(this)}}Rr.prototype.className="Rect",lt(Rr),qt.addGetterSetter(Rr,"cornerRadius",0,Rt(4));class Dr extends Yn{_sceneFunc(e){const t=this._getPoints(),n=this.radius(),r=this.sides(),i=this.cornerRadius();if(e.beginPath(),i)xt.drawRoundedPolygonPath(e,t,r,n,i);else{e.moveTo(t[0].x,t[0].y);for(let n=1;n<t.length;n++)e.lineTo(t[n].x,t[n].y)}e.closePath(),e.fillStrokeShape(this)}_getPoints(){const e=this.attrs.sides,t=this.attrs.radius||0,n=[];for(let r=0;r<e;r++)n.push({x:t*Math.sin(2*r*Math.PI/e),y:-1*t*Math.cos(2*r*Math.PI/e)});return n}getSelfRect(){const e=this._getPoints();let t=e[0].x,n=e[0].y,r=e[0].x,i=e[0].y;return e.forEach(e=>{t=Math.min(t,e.x),n=Math.max(n,e.x),r=Math.min(r,e.y),i=Math.max(i,e.y)}),{x:t,y:r,width:n-t,height:i-r}}getWidth(){return 2*this.radius()}getHeight(){return 2*this.radius()}setWidth(e){this.radius(e/2)}setHeight(e){this.radius(e/2)}}Dr.prototype.className="RegularPolygon",Dr.prototype._centroid=!0,Dr.prototype._attrsAffectingSize=["radius"],lt(Dr),qt.addGetterSetter(Dr,"radius",0,Nt()),qt.addGetterSetter(Dr,"sides",0,Nt()),qt.addGetterSetter(Dr,"cornerRadius",0,Rt(4));const Lr=2*Math.PI;class Gr extends Yn{_sceneFunc(e){e.beginPath(),e.arc(0,0,this.innerRadius(),0,Lr,!1),e.moveTo(this.outerRadius(),0),e.arc(0,0,this.outerRadius(),Lr,0,!0),e.closePath(),e.fillStrokeShape(this)}getWidth(){return 2*this.outerRadius()}getHeight(){return 2*this.outerRadius()}setWidth(e){this.outerRadius(e/2)}setHeight(e){this.outerRadius(e/2)}}Gr.prototype.className="Ring",Gr.prototype._centroid=!0,Gr.prototype._attrsAffectingSize=["innerRadius","outerRadius"],lt(Gr),qt.addGetterSetter(Gr,"innerRadius",0,Nt()),qt.addGetterSetter(Gr,"outerRadius",0,Nt());class Or extends Yn{constructor(e){super(e),this._updated=!0,this.anim=new nr(()=>{const e=this._updated;return this._updated=!1,e}),this.on("animationChange.konva",function(){this.frameIndex(0)}),this.on("frameIndexChange.konva",function(){this._updated=!0}),this.on("frameRateChange.konva",function(){this.anim.isRunning()&&(clearInterval(this.interval),this._setInterval())})}_sceneFunc(e){const t=this.animation(),n=this.frameIndex(),r=4*n,i=this.animations()[t],a=this.frameOffsets(),s=i[r+0],o=i[r+1],l=i[r+2],c=i[r+3],u=this.image();if((this.hasFill()||this.hasStroke())&&(e.beginPath(),e.rect(0,0,l,c),e.closePath(),e.fillStrokeShape(this)),u)if(a){const r=a[t],i=2*n;e.drawImage(u,s,o,l,c,r[i+0],r[i+1],l,c)}else e.drawImage(u,s,o,l,c,0,0,l,c)}_hitFunc(e){const t=this.animation(),n=this.frameIndex(),r=4*n,i=this.animations()[t],a=this.frameOffsets(),s=i[r+2],o=i[r+3];if(e.beginPath(),a){const r=a[t],i=2*n;e.rect(r[i+0],r[i+1],s,o)}else e.rect(0,0,s,o);e.closePath(),e.fillShape(this)}_useBufferCanvas(){return super._useBufferCanvas(!0)}_setInterval(){const e=this;this.interval=setInterval(function(){e._updateIndex()},1e3/this.frameRate())}start(){if(this.isRunning())return;const e=this.getLayer();this.anim.setLayers(e),this._setInterval(),this.anim.start()}stop(){this.anim.stop(),clearInterval(this.interval)}isRunning(){return this.anim.isRunning()}_updateIndex(){const e=this.frameIndex(),t=this.animation();e<this.animations()[t].length/4-1?this.frameIndex(e+1):this.frameIndex(0)}}Or.prototype.className="Sprite",lt(Or),qt.addGetterSetter(Or,"animation"),qt.addGetterSetter(Or,"animations"),qt.addGetterSetter(Or,"frameOffsets"),qt.addGetterSetter(Or,"image"),qt.addGetterSetter(Or,"frameIndex",0,Nt()),qt.addGetterSetter(Or,"frameRate",17,Nt()),qt.backCompat(Or,{index:"frameIndex",getIndex:"getFrameIndex",setIndex:"setFrameIndex"});class Fr extends Yn{_sceneFunc(e){const t=this.innerRadius(),n=this.outerRadius(),r=this.numPoints();e.beginPath(),e.moveTo(0,0-n);for(let i=1;i<2*r;i++){const a=i%2==0?n:t,s=a*Math.sin(i*Math.PI/r),o=-1*a*Math.cos(i*Math.PI/r);e.lineTo(s,o)}e.closePath(),e.fillStrokeShape(this)}getWidth(){return 2*this.outerRadius()}getHeight(){return 2*this.outerRadius()}setWidth(e){this.outerRadius(e/2)}setHeight(e){this.outerRadius(e/2)}}function Wr(e){return[...e].reduce((e,t,n,r)=>{if(/\p{Emoji}/u.test(t)){const i=r[n+1];i&&/\p{Emoji_Modifier}|\u200D/u.test(i)?(e.push(t+i),r[n+1]=""):e.push(t)}else/\p{Regional_Indicator}{2}/u.test(t+(r[n+1]||""))?e.push(t+r[n+1]):n>0&&/\p{Mn}|\p{Me}|\p{Mc}/u.test(t)?e[e.length-1]+=t:t&&e.push(t);return e},[])}Fr.prototype.className="Star",Fr.prototype._centroid=!0,Fr.prototype._attrsAffectingSize=["innerRadius","outerRadius"],lt(Fr),qt.addGetterSetter(Fr,"numPoints",5,Nt()),qt.addGetterSetter(Fr,"innerRadius",0,Nt()),qt.addGetterSetter(Fr,"outerRadius",0,Nt());const qr="auto",Br="inherit",$r="justify",Hr="left",Vr="middle",Ur="normal",Qr=" ",Yr="none",Xr=["direction","fontFamily","fontSize","fontStyle","fontVariant","padding","align","verticalAlign","lineHeight","text","width","height","wrap","ellipsis","letterSpacing"],Kr=Xr.length;let Jr;function Zr(){return Jr||(Jr=xt.createCanvasElement().getContext("2d"),Jr)}let ei=class extends Yn{constructor(e){super(function(e){return(e=e||{}).fillLinearGradientColorStops||e.fillRadialGradientColorStops||e.fillPatternImage||(e.fill=e.fill||"black"),e}(e)),this._partialTextX=0,this._partialTextY=0;for(let t=0;t<Kr;t++)this.on(Xr[t]+"Change.konva",this._setTextData);this._setTextData()}_sceneFunc(e){var t,n;const r=this.textArr,i=r.length;if(!this.text())return;let a,s=this.padding(),o=this.fontSize(),l=this.lineHeight()*o,c=this.verticalAlign(),u=this.direction(),d=0,h=this.align(),p=this.getWidth(),f=this.letterSpacing(),g=this.charRenderFunc(),m=this.fill(),x=this.textDecoration(),y=-1!==x.indexOf("underline"),v=-1!==x.indexOf("line-through");u=u===Br?e.direction:u;let b=l/2,S=Vr;if(!ot.legacyTextRendering){const e=this.measureSize("M");S="alphabetic";b=((null!==(t=e.fontBoundingBoxAscent)&&void 0!==t?t:e.actualBoundingBoxAscent)-(null!==(n=e.fontBoundingBoxDescent)&&void 0!==n?n:e.actualBoundingBoxDescent))/2+l/2}for("rtl"===u&&e.setAttr("direction",u),e.setAttr("font",this._getContextFont()),e.setAttr("textBaseline",S),e.setAttr("textAlign",Hr),c===Vr?d=(this.getHeight()-i*l-2*s)/2:"bottom"===c&&(d=this.getHeight()-i*l-2*s),e.translate(s,d+s),a=0;a<i;a++){let t=0,n=0;const c=r[a],d=c.text,x=c.width,S=c.lastInParagraph;if(e.save(),"right"===h?t+=p-x-2*s:"center"===h&&(t+=(p-x-2*s)/2),y){e.save(),e.beginPath();const r=t,i=b+n+(ot.legacyTextRendering?Math.round(o/2):Math.round(o/4));e.moveTo(r,i);const a=h!==$r||S?x:p-2*s;e.lineTo(r+Math.round(a),i),e.lineWidth=o/15;const l=this._getLinearGradient();e.strokeStyle=l||m,e.stroke(),e.restore()}if("rtl"===u||0===f&&h!==$r&&!g)0!==f&&e.setAttr("letterSpacing",`${f}px`),this._partialTextX=t,this._partialTextY=b+n,this._partialText=d,e.fillStrokeShape(this);else{const i=d.split(" ").length-1,o=Wr(d);for(let l=0;l<o.length;l++){const c=o[l];if(" "!==c||S||h!==$r||(t+=(p-2*s-x)/i),this._partialTextX=t,this._partialTextY=b+n,this._partialText=c,g){e.save();g({char:c,index:l+r.slice(0,a).reduce((e,t)=>e+Wr(t.text).length,0),x:t,y:b+n,lineIndex:a,column:l,isLastInLine:S,width:this.measureSize(c).width,context:e})}e.fillStrokeShape(this),g&&e.restore(),t+=this.measureSize(c).width+f}}if(v){e.save(),e.beginPath();const r=ot.legacyTextRendering?0:-Math.round(o/4),i=h===$r?0:t;e.moveTo(i,b+n+r);const a=h!==$r||S?x:p-2*s;e.lineTo(i+Math.round(a),b+n+r),e.lineWidth=o/15;const l=this._getLinearGradient();e.strokeStyle=l||m,e.stroke(),e.restore()}e.restore(),i>1&&(b+=l)}}_hitFunc(e){const t=this.getWidth(),n=this.getHeight();e.beginPath(),e.rect(0,0,t,n),e.closePath(),e.fillStrokeShape(this)}setText(e){const t=xt._isString(e)?e:null==e?"":e+"";return this._setAttr("text",t),this}getWidth(){return this.attrs.width===qr||void 0===this.attrs.width?this.getTextWidth()+2*this.padding():this.attrs.width}getHeight(){return this.attrs.height===qr||void 0===this.attrs.height?this.fontSize()*this.textArr.length*this.lineHeight()+2*this.padding():this.attrs.height}getTextWidth(){return this.textWidth}getTextHeight(){return xt.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}measureSize(e){var t,n,r,i,a,s,o,l,c,u,d;let h,p=Zr(),f=this.fontSize();p.save(),p.font=this._getContextFont(),h=p.measureText(e),p.restore();const g=f/100;return{actualBoundingBoxAscent:null!==(t=h.actualBoundingBoxAscent)&&void 0!==t?t:71.58203125*g,actualBoundingBoxDescent:null!==(n=h.actualBoundingBoxDescent)&&void 0!==n?n:0,actualBoundingBoxLeft:null!==(r=h.actualBoundingBoxLeft)&&void 0!==r?r:-7.421875*g,actualBoundingBoxRight:null!==(i=h.actualBoundingBoxRight)&&void 0!==i?i:75.732421875*g,alphabeticBaseline:null!==(a=h.alphabeticBaseline)&&void 0!==a?a:0,emHeightAscent:null!==(s=h.emHeightAscent)&&void 0!==s?s:100*g,emHeightDescent:null!==(o=h.emHeightDescent)&&void 0!==o?o:-20*g,fontBoundingBoxAscent:null!==(l=h.fontBoundingBoxAscent)&&void 0!==l?l:91*g,fontBoundingBoxDescent:null!==(c=h.fontBoundingBoxDescent)&&void 0!==c?c:21*g,hangingBaseline:null!==(u=h.hangingBaseline)&&void 0!==u?u:72.80000305175781*g,ideographicBaseline:null!==(d=h.ideographicBaseline)&&void 0!==d?d:-21*g,width:h.width,height:f}}_getContextFont(){return this.fontStyle()+Qr+this.fontVariant()+Qr+(this.fontSize()+"px ")+this.fontFamily().split(",").map(e=>{const t=(e=e.trim()).indexOf(" ")>=0,n=e.indexOf('"')>=0||e.indexOf("'")>=0;return t&&!n&&(e=`"${e}"`),e}).join(", ")}_addTextLine(e){this.align()===$r&&(e=e.trim());const t=this._getTextWidth(e);return this.textArr.push({text:e,width:t,lastInParagraph:!1})}_getTextWidth(e){const t=this.letterSpacing(),n=e.length;return Zr().measureText(e).width+t*n}_setTextData(){let e=this.text().split("\n"),t=+this.fontSize(),n=0,r=this.lineHeight()*t,i=this.attrs.width,a=this.attrs.height,s=i!==qr&&void 0!==i,o=a!==qr&&void 0!==a,l=this.padding(),c=i-2*l,u=a-2*l,d=0,h=this.wrap(),p="char"!==h&&h!==Yr,f=this.ellipsis();this.textArr=[],Zr().font=this._getContextFont();const g=f?this._getTextWidth("…"):0;for(let m=0,x=e.length;m<x;++m){let t=e[m],i=this._getTextWidth(t);if(s&&i>c)for(;t.length>0;){let e=0,a=Wr(t).length,s="",l=0;for(;e<a;){const n=e+a>>>1,i=Wr(t).slice(0,n+1).join(""),h=this._getTextWidth(i);(f&&o&&d+r>u?h+g:h)<=c?(e=n+1,s=i,l=h):a=n}if(!s)break;if(p){const n=Wr(t),r=Wr(s),i=n[r.length];let a;if((i===Qr||"-"===i)&&l<=c)a=r.length;else{const e=r.lastIndexOf(Qr),t=r.lastIndexOf("-");a=Math.max(e,t)+1}a>0&&(e=a,s=n.slice(0,e).join(""),l=this._getTextWidth(s))}s=s.trimRight(),this._addTextLine(s),n=Math.max(n,l),d+=r;if(this._shouldHandleEllipsis(d)){this._tryToAddEllipsisToLastLine();break}if(t=Wr(t).slice(e).join("").trimLeft(),t.length>0&&(i=this._getTextWidth(t),i<=c)){this._addTextLine(t),d+=r,n=Math.max(n,i);break}}else this._addTextLine(t),d+=r,n=Math.max(n,i),this._shouldHandleEllipsis(d)&&m<x-1&&this._tryToAddEllipsisToLastLine();if(this.textArr[this.textArr.length-1]&&(this.textArr[this.textArr.length-1].lastInParagraph=!0),o&&d+r>u)break}this.textHeight=t,this.textWidth=n}_shouldHandleEllipsis(e){const t=+this.fontSize(),n=this.lineHeight()*t,r=this.attrs.height,i=r!==qr&&void 0!==r,a=r-2*this.padding();return!(this.wrap()!==Yr)||i&&e+n>a}_tryToAddEllipsisToLastLine(){const e=this.attrs.width,t=e!==qr&&void 0!==e,n=e-2*this.padding(),r=this.ellipsis(),i=this.textArr[this.textArr.length-1];if(i&&r){if(t){this._getTextWidth(i.text+"…")<n||(i.text=i.text.slice(0,i.text.length-3))}this.textArr.splice(this.textArr.length-1,1),this._addTextLine(i.text+"…")}}getStrokeScaleEnabled(){return!0}_useBufferCanvas(){const e=-1!==this.textDecoration().indexOf("underline")||-1!==this.textDecoration().indexOf("line-through"),t=this.hasShadow();return!(!e||!t)||super._useBufferCanvas()}};ei.prototype._fillFunc=function(e){e.fillText(this._partialText,this._partialTextX,this._partialTextY)},ei.prototype._strokeFunc=function(e){e.setAttr("miterLimit",2),e.strokeText(this._partialText,this._partialTextX,this._partialTextY)},ei.prototype.className="Text",ei.prototype._attrsAffectingSize=["text","fontSize","padding","wrap","lineHeight","letterSpacing"],lt(ei),qt.overWriteSetter(ei,"width",Dt()),qt.overWriteSetter(ei,"height",Dt()),qt.addGetterSetter(ei,"direction",Br),qt.addGetterSetter(ei,"fontFamily","Arial"),qt.addGetterSetter(ei,"fontSize",12,Nt()),qt.addGetterSetter(ei,"fontStyle",Ur),qt.addGetterSetter(ei,"fontVariant",Ur),qt.addGetterSetter(ei,"padding",0,Nt()),qt.addGetterSetter(ei,"align",Hr),qt.addGetterSetter(ei,"verticalAlign","top"),qt.addGetterSetter(ei,"lineHeight",1,Nt()),qt.addGetterSetter(ei,"wrap","word"),qt.addGetterSetter(ei,"ellipsis",!1,Ot()),qt.addGetterSetter(ei,"letterSpacing",0,Nt()),qt.addGetterSetter(ei,"text","",Lt()),qt.addGetterSetter(ei,"textDecoration",""),qt.addGetterSetter(ei,"charRenderFunc",void 0);const ti="normal";function ni(e){e.fillText(this.partialText,0,0)}function ri(e){e.strokeText(this.partialText,0,0)}class ii extends Yn{constructor(e){super(e),this.dummyCanvas=xt.createCanvasElement(),this.dataArray=[],this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute(),this._setTextData()}),this.on("textChange.konva alignChange.konva letterSpacingChange.konva kerningFuncChange.konva fontSizeChange.konva fontFamilyChange.konva",this._setTextData),this._setTextData()}_getTextPathLength(){return _r.getPathLength(this.dataArray)}_getPointAtLength(e){if(!this.attrs.data)return null;return e>this.pathLength?null:_r.getPointAtLengthOfDataArray(e,this.dataArray)}_readDataAttribute(){this.dataArray=_r.parsePathData(this.attrs.data),this.pathLength=this._getTextPathLength()}_sceneFunc(e){e.setAttr("font",this._getContextFont()),e.setAttr("textBaseline",this.textBaseline()),e.setAttr("textAlign","left"),e.save();const t=this.textDecoration(),n=this.fill(),r=this.fontSize(),i=this.glyphInfo,a=-1!==t.indexOf("underline"),s=-1!==t.indexOf("line-through");a&&e.beginPath();for(let o=0;o<i.length;o++){e.save();const t=i[o].p0;e.translate(t.x,t.y),e.rotate(i[o].rotation),this.partialText=i[o].text,e.fillStrokeShape(this),a&&(0===o&&e.moveTo(0,r/2+1),e.lineTo(i[o].width,r/2+1)),e.restore()}if(a&&(e.strokeStyle=n,e.lineWidth=r/20,e.stroke()),s){e.beginPath();for(let t=0;t<i.length;t++){e.save();const n=i[t].p0;e.translate(n.x,n.y),e.rotate(i[t].rotation),0===t&&e.moveTo(0,0),e.lineTo(i[t].width,0),e.restore()}e.strokeStyle=n,e.lineWidth=r/20,e.stroke()}e.restore()}_hitFunc(e){e.beginPath();const t=this.glyphInfo;if(t.length>=1){const n=t[0].p0;e.moveTo(n.x,n.y)}for(let n=0;n<t.length;n++){const r=t[n].p1;e.lineTo(r.x,r.y)}e.setAttr("lineWidth",this.fontSize()),e.setAttr("strokeStyle",this.colorKey),e.stroke()}getTextWidth(){return this.textWidth}getTextHeight(){return xt.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}setText(e){return ei.prototype.setText.call(this,e)}_getContextFont(){return ei.prototype._getContextFont.call(this)}_getTextSize(e){const t=this.dummyCanvas.getContext("2d");t.save(),t.font=this._getContextFont();const n=t.measureText(e);return t.restore(),{width:n.width,height:parseInt(`${this.fontSize()}`,10)}}_setTextData(){const e=Wr(this.text()),t=[];let n=0;for(let d=0;d<e.length;d++)t.push({char:e[d],width:this._getTextSize(e[d]).width}),n+=t[d].width;const{height:r}=this._getTextSize(this.attrs.text);if(this.textWidth=n,this.textHeight=r,this.glyphInfo=[],!this.attrs.data)return null;const i=this.letterSpacing(),a=this.align(),s=this.kerningFunc(),o=Math.max(this.textWidth+((this.attrs.text||"").length-1)*i,0);let l=0;"center"===a&&(l=Math.max(0,this.pathLength/2-o/2)),"right"===a&&(l=Math.max(0,this.pathLength-o));let c=l;for(let d=0;d<t.length;d++){const n=this._getPointAtLength(c);if(!n)return;const r=t[d].char;let l=t[d].width+i;if(" "===r&&"justify"===a){const e=this.text().split(" ").length-1;l+=(this.pathLength-o)/e}const h=this._getPointAtLength(c+l);if(!h)return;const p=_r.getLineLength(n.x,n.y,h.x,h.y);let f=0;if(s)try{f=s(t[d-1].char,r)*this.fontSize()}catch(u){f=0}n.x+=f,h.x+=f,this.textWidth+=f;const g=_r.getPointOnLine(f+p/2,n.x,n.y,h.x,h.y),m=Math.atan2(h.y-n.y,h.x-n.x);this.glyphInfo.push({transposeX:g.x,transposeY:g.y,text:e[d],rotation:m,p0:n,p1:h,width:p}),c+=l}}getSelfRect(){if(!this.glyphInfo.length)return{x:0,y:0,width:0,height:0};const e=[];this.glyphInfo.forEach(function(t){e.push(t.p0.x),e.push(t.p0.y),e.push(t.p1.x),e.push(t.p1.y)});let t,n,r=e[0]||0,i=e[0]||0,a=e[1]||0,s=e[1]||0;for(let l=0;l<e.length/2;l++)t=e[2*l],n=e[2*l+1],r=Math.min(r,t),i=Math.max(i,t),a=Math.min(a,n),s=Math.max(s,n);const o=this.fontSize();return{x:r-o/2,y:a-o/2,width:i-r+o,height:s-a+o}}destroy(){return xt.releaseCanvas(this.dummyCanvas),super.destroy()}}ii.prototype._fillFunc=ni,ii.prototype._strokeFunc=ri,ii.prototype._fillFuncHit=ni,ii.prototype._strokeFuncHit=ri,ii.prototype.className="TextPath",ii.prototype._attrsAffectingSize=["text","fontSize","data"],lt(ii),qt.addGetterSetter(ii,"data"),qt.addGetterSetter(ii,"fontFamily","Arial"),qt.addGetterSetter(ii,"fontSize",12,Nt()),qt.addGetterSetter(ii,"fontStyle",ti),qt.addGetterSetter(ii,"align","left"),qt.addGetterSetter(ii,"letterSpacing",0,Nt()),qt.addGetterSetter(ii,"textBaseline","middle"),qt.addGetterSetter(ii,"fontVariant",ti),qt.addGetterSetter(ii,"text",""),qt.addGetterSetter(ii,"textDecoration",""),qt.addGetterSetter(ii,"kerningFunc",void 0);const ai="tr-konva",si=["resizeEnabledChange","rotateAnchorOffsetChange","rotateEnabledChange","enabledAnchorsChange","anchorSizeChange","borderEnabledChange","borderStrokeChange","borderStrokeWidthChange","borderDashChange","anchorStrokeChange","anchorStrokeWidthChange","anchorFillChange","anchorCornerRadiusChange","ignoreStrokeChange","anchorStyleFuncChange"].map(e=>e+`.${ai}`).join(" "),oi="nodesRect",li=["widthChange","heightChange","scaleXChange","scaleYChange","skewXChange","skewYChange","rotationChange","offsetXChange","offsetYChange","transformsEnabledChange","strokeWidthChange","draggableChange"],ci={"top-left":-45,"top-center":0,"top-right":45,"middle-right":-90,"middle-left":90,"bottom-left":-135,"bottom-center":180,"bottom-right":135},ui="ontouchstart"in ot._global;const di=["top-left","top-center","top-right","middle-right","middle-left","bottom-left","bottom-center","bottom-right"];function hi(e,t,n){const r=n.x+(e.x-n.x)*Math.cos(t)-(e.y-n.y)*Math.sin(t),i=n.y+(e.x-n.x)*Math.sin(t)+(e.y-n.y)*Math.cos(t);return{...e,rotation:e.rotation+t,x:r,y:i}}function pi(e,t){const n=function(e){return{x:e.x+e.width/2*Math.cos(e.rotation)+e.height/2*Math.sin(-e.rotation),y:e.y+e.height/2*Math.cos(e.rotation)+e.width/2*Math.sin(e.rotation)}}(e);return hi(e,t,n)}let fi=0;class gi extends er{constructor(e){super(e),this._movingAnchorName=null,this._transforming=!1,this._createElements(),this._handleMouseMove=this._handleMouseMove.bind(this),this._handleMouseUp=this._handleMouseUp.bind(this),this.update=this.update.bind(this),this.on(si,this.update),this.getNode()&&this.update()}attachTo(e){return this.setNode(e),this}setNode(e){return xt.warn("tr.setNode(shape), tr.node(shape) and tr.attachTo(shape) methods are deprecated. Please use tr.nodes(nodesArray) instead."),this.setNodes([e])}getNode(){return this._nodes&&this._nodes[0]}_getEventNamespace(){return ai+this._id}setNodes(e=[]){this._nodes&&this._nodes.length&&this.detach();const t=e.filter(e=>!e.isAncestorOf(this)||(xt.error("Konva.Transformer cannot be an a child of the node you are trying to attach"),!1));this._nodes=e=t,1===e.length&&this.useSingleNodeRotation()?this.rotation(e[0].getAbsoluteRotation()):this.rotation(0),this._nodes.forEach(e=>{const t=()=>{1===this.nodes().length&&this.useSingleNodeRotation()&&this.rotation(this.nodes()[0].getAbsoluteRotation()),this._resetTransformCache(),this._transforming||this.isDragging()||this.update()};if(e._attrsAffectingSize.length){const n=e._attrsAffectingSize.map(e=>e+"Change."+this._getEventNamespace()).join(" ");e.on(n,t)}e.on(li.map(e=>e+`.${this._getEventNamespace()}`).join(" "),t),e.on(`absoluteTransformChange.${this._getEventNamespace()}`,t),this._proxyDrag(e)}),this._resetTransformCache();return!!this.findOne(".top-left")&&this.update(),this}_proxyDrag(e){let t;e.on(`dragstart.${this._getEventNamespace()}`,n=>{t=e.getAbsolutePosition(),this.isDragging()||e===this.findOne(".back")||this.startDrag(n,!1)}),e.on(`dragmove.${this._getEventNamespace()}`,n=>{if(!t)return;const r=e.getAbsolutePosition(),i=r.x-t.x,a=r.y-t.y;this.nodes().forEach(t=>{if(t===e)return;if(t.isDragging())return;const r=t.getAbsolutePosition();t.setAbsolutePosition({x:r.x+i,y:r.y+a}),t.startDrag(n)}),t=null})}getNodes(){return this._nodes||[]}getActiveAnchor(){return this._movingAnchorName}detach(){this._nodes&&this._nodes.forEach(e=>{e.off("."+this._getEventNamespace())}),this._nodes=[],this._resetTransformCache()}_resetTransformCache(){this._clearCache(oi),this._clearCache("transform"),this._clearSelfAndDescendantCache("absoluteTransform")}_getNodeRect(){return this._getCache(oi,this.__getNodeRect)}__getNodeShape(e,t=this.rotation(),n){const r=e.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),i=e.getAbsoluteScale(n),a=e.getAbsolutePosition(n),s=r.x*i.x-e.offsetX()*i.x,o=r.y*i.y-e.offsetY()*i.y,l=(ot.getAngle(e.getAbsoluteRotation())+2*Math.PI)%(2*Math.PI);return hi({x:a.x+s*Math.cos(l)+o*Math.sin(-l),y:a.y+o*Math.cos(l)+s*Math.sin(l),width:r.width*i.x,height:r.height*i.y,rotation:l},-ot.getAngle(t),{x:0,y:0})}__getNodeRect(){if(!this.getNode())return{x:-1e8,y:-1e8,width:0,height:0,rotation:0};const e=[];this.nodes().map(t=>{const n=t.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),r=[{x:n.x,y:n.y},{x:n.x+n.width,y:n.y},{x:n.x+n.width,y:n.y+n.height},{x:n.x,y:n.y+n.height}],i=t.getAbsoluteTransform();r.forEach(function(t){const n=i.point(t);e.push(n)})});const t=new ut;t.rotate(-ot.getAngle(this.rotation()));let n=1/0,r=1/0,i=-1/0,a=-1/0;e.forEach(function(e){const s=t.point(e);void 0===n&&(n=i=s.x,r=a=s.y),n=Math.min(n,s.x),r=Math.min(r,s.y),i=Math.max(i,s.x),a=Math.max(a,s.y)}),t.invert();const s=t.point({x:n,y:r});return{x:s.x,y:s.y,width:i-n,height:a-r,rotation:ot.getAngle(this.rotation())}}getX(){return this._getNodeRect().x}getY(){return this._getNodeRect().y}getWidth(){return this._getNodeRect().width}getHeight(){return this._getNodeRect().height}_createElements(){this._createBack(),di.forEach(e=>{this._createAnchor(e)}),this._createAnchor("rotater")}_createAnchor(e){const t=new Rr({stroke:"rgb(0, 161, 255)",fill:"white",strokeWidth:1,name:e+" _anchor",dragDistance:0,draggable:!0,hitStrokeWidth:ui?10:"auto"}),n=this;t.on("mousedown touchstart",function(e){n._handleMouseDown(e)}),t.on("dragstart",e=>{t.stopDrag(),e.cancelBubble=!0}),t.on("dragend",e=>{e.cancelBubble=!0}),t.on("mouseenter",()=>{const n=ot.getAngle(this.rotation()),r=this.rotateAnchorCursor(),i=function(e,t,n){if("rotater"===e)return n;t+=xt.degToRad(ci[e]||0);const r=(xt.radToDeg(t)%360+360)%360;return xt._inRange(r,337.5,360)||xt._inRange(r,0,22.5)?"ns-resize":xt._inRange(r,22.5,67.5)?"nesw-resize":xt._inRange(r,67.5,112.5)?"ew-resize":xt._inRange(r,112.5,157.5)?"nwse-resize":xt._inRange(r,157.5,202.5)?"ns-resize":xt._inRange(r,202.5,247.5)?"nesw-resize":xt._inRange(r,247.5,292.5)?"ew-resize":xt._inRange(r,292.5,337.5)?"nwse-resize":(xt.error("Transformer has unknown angle for cursor detection: "+r),"pointer")}(e,n,r);t.getStage().content&&(t.getStage().content.style.cursor=i),this._cursorChange=!0}),t.on("mouseout",()=>{t.getStage().content&&(t.getStage().content.style.cursor=""),this._cursorChange=!1}),this.add(t)}_createBack(){const e=new Yn({name:"back",width:0,height:0,sceneFunc(e,t){const n=t.getParent(),r=n.padding();e.beginPath(),e.rect(-r,-r,t.width()+2*r,t.height()+2*r),e.moveTo(t.width()/2,-r),n.rotateEnabled()&&n.rotateLineVisible()&&e.lineTo(t.width()/2,-n.rotateAnchorOffset()*xt._sign(t.height())-r),e.fillStrokeShape(t)},hitFunc:(e,t)=>{if(!this.shouldOverdrawWholeArea())return;const n=this.padding();e.beginPath(),e.rect(-n,-n,t.width()+2*n,t.height()+2*n),e.fillStrokeShape(t)}});this.add(e),this._proxyDrag(e),e.on("dragstart",e=>{e.cancelBubble=!0}),e.on("dragmove",e=>{e.cancelBubble=!0}),e.on("dragend",e=>{e.cancelBubble=!0}),this.on("dragmove",e=>{this.update()})}_handleMouseDown(e){if(this._transforming)return;this._movingAnchorName=e.target.name().split(" ")[0];const t=this._getNodeRect(),n=t.width,r=t.height,i=Math.sqrt(Math.pow(n,2)+Math.pow(r,2));this.sin=Math.abs(r/i),this.cos=Math.abs(n/i),"undefined"!=typeof window&&(window.addEventListener("mousemove",this._handleMouseMove),window.addEventListener("touchmove",this._handleMouseMove),window.addEventListener("mouseup",this._handleMouseUp,!0),window.addEventListener("touchend",this._handleMouseUp,!0)),this._transforming=!0;const a=e.target.getAbsolutePosition(),s=e.target.getStage().getPointerPosition();this._anchorDragOffset={x:s.x-a.x,y:s.y-a.y},fi++,this._fire("transformstart",{evt:e.evt,target:this.getNode()}),this._nodes.forEach(t=>{t._fire("transformstart",{evt:e.evt,target:t})})}_handleMouseMove(e){let t,n,r;const i=this.findOne("."+this._movingAnchorName),a=i.getStage();a.setPointersPositions(e);const s=a.getPointerPosition();let o={x:s.x-this._anchorDragOffset.x,y:s.y-this._anchorDragOffset.y};const l=i.getAbsolutePosition();this.anchorDragBoundFunc()&&(o=this.anchorDragBoundFunc()(l,o,e)),i.setAbsolutePosition(o);const c=i.getAbsolutePosition();if(l.x===c.x&&l.y===c.y)return;if("rotater"===this._movingAnchorName){const r=this._getNodeRect();t=i.x()-r.width/2,n=-i.y()+r.height/2;let a=Math.atan2(-n,t)+Math.PI/2;r.height<0&&(a-=Math.PI);const s=ot.getAngle(this.rotation())+a,o=ot.getAngle(this.rotationSnapTolerance()),l=function(e,t,n){let r=t;for(let i=0;i<e.length;i++){const a=ot.getAngle(e[i]),s=Math.abs(a-t)%(2*Math.PI);Math.min(s,2*Math.PI-s)<n&&(r=a)}return r}(this.rotationSnaps(),s,o),c=pi(r,l-r.rotation);return void this._fitNodesInto(c,e)}const u=this.shiftBehavior();let d;d="inverted"===u?this.keepRatio()&&!e.shiftKey:"none"===u?this.keepRatio():this.keepRatio()||e.shiftKey;let h=this.centeredScaling()||e.altKey;if("top-left"===this._movingAnchorName){if(d){const e=h?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-right").x(),y:this.findOne(".bottom-right").y()};r=Math.sqrt(Math.pow(e.x-i.x(),2)+Math.pow(e.y-i.y(),2));const a=this.findOne(".top-left").x()>e.x?-1:1,s=this.findOne(".top-left").y()>e.y?-1:1;t=r*this.cos*a,n=r*this.sin*s,this.findOne(".top-left").x(e.x-t),this.findOne(".top-left").y(e.y-n)}}else if("top-center"===this._movingAnchorName)this.findOne(".top-left").y(i.y());else if("top-right"===this._movingAnchorName){if(d){const e=h?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-left").x(),y:this.findOne(".bottom-left").y()};r=Math.sqrt(Math.pow(i.x()-e.x,2)+Math.pow(e.y-i.y(),2));const a=this.findOne(".top-right").x()<e.x?-1:1,s=this.findOne(".top-right").y()>e.y?-1:1;t=r*this.cos*a,n=r*this.sin*s,this.findOne(".top-right").x(e.x+t),this.findOne(".top-right").y(e.y-n)}var p=i.position();this.findOne(".top-left").y(p.y),this.findOne(".bottom-right").x(p.x)}else if("middle-left"===this._movingAnchorName)this.findOne(".top-left").x(i.x());else if("middle-right"===this._movingAnchorName)this.findOne(".bottom-right").x(i.x());else if("bottom-left"===this._movingAnchorName){if(d){const e=h?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-right").x(),y:this.findOne(".top-right").y()};r=Math.sqrt(Math.pow(e.x-i.x(),2)+Math.pow(i.y()-e.y,2));const a=e.x<i.x()?-1:1,s=i.y()<e.y?-1:1;t=r*this.cos*a,n=r*this.sin*s,i.x(e.x-t),i.y(e.y+n)}p=i.position(),this.findOne(".top-left").x(p.x),this.findOne(".bottom-right").y(p.y)}else if("bottom-center"===this._movingAnchorName)this.findOne(".bottom-right").y(i.y());else if("bottom-right"===this._movingAnchorName&&d){const e=h?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-left").x(),y:this.findOne(".top-left").y()};r=Math.sqrt(Math.pow(i.x()-e.x,2)+Math.pow(i.y()-e.y,2));const a=this.findOne(".bottom-right").x()<e.x?-1:1,s=this.findOne(".bottom-right").y()<e.y?-1:1;t=r*this.cos*a,n=r*this.sin*s,this.findOne(".bottom-right").x(e.x+t),this.findOne(".bottom-right").y(e.y+n)}if(h=this.centeredScaling()||e.altKey,h){const e=this.findOne(".top-left"),t=this.findOne(".bottom-right"),n=e.x(),r=e.y(),i=this.getWidth()-t.x(),a=this.getHeight()-t.y();t.move({x:-n,y:-r}),e.move({x:i,y:a})}const f=this.findOne(".top-left").getAbsolutePosition();t=f.x,n=f.y;const g=this.findOne(".bottom-right").x()-this.findOne(".top-left").x(),m=this.findOne(".bottom-right").y()-this.findOne(".top-left").y();this._fitNodesInto({x:t,y:n,width:g,height:m,rotation:ot.getAngle(this.rotation())},e)}_handleMouseUp(e){this._removeEvents(e)}getAbsoluteTransform(){return this.getTransform()}_removeEvents(e){var t;if(this._transforming){this._transforming=!1,"undefined"!=typeof window&&(window.removeEventListener("mousemove",this._handleMouseMove),window.removeEventListener("touchmove",this._handleMouseMove),window.removeEventListener("mouseup",this._handleMouseUp,!0),window.removeEventListener("touchend",this._handleMouseUp,!0));const n=this.getNode();fi--,this._fire("transformend",{evt:e,target:n}),null===(t=this.getLayer())||void 0===t||t.batchDraw(),n&&this._nodes.forEach(t=>{var n;t._fire("transformend",{evt:e,target:t}),null===(n=t.getLayer())||void 0===n||n.batchDraw()}),this._movingAnchorName=null}}_fitNodesInto(e,t){const n=this._getNodeRect();if(xt._inRange(e.width,2*-this.padding()-1,1))return void this.update();if(xt._inRange(e.height,2*-this.padding()-1,1))return void this.update();const r=new ut;if(r.rotate(ot.getAngle(this.rotation())),this._movingAnchorName&&e.width<0&&this._movingAnchorName.indexOf("left")>=0){const t=r.point({x:2*-this.padding(),y:0});e.x+=t.x,e.y+=t.y,e.width+=2*this.padding(),this._movingAnchorName=this._movingAnchorName.replace("left","right"),this._anchorDragOffset.x-=t.x,this._anchorDragOffset.y-=t.y}else if(this._movingAnchorName&&e.width<0&&this._movingAnchorName.indexOf("right")>=0){const t=r.point({x:2*this.padding(),y:0});this._movingAnchorName=this._movingAnchorName.replace("right","left"),this._anchorDragOffset.x-=t.x,this._anchorDragOffset.y-=t.y,e.width+=2*this.padding()}if(this._movingAnchorName&&e.height<0&&this._movingAnchorName.indexOf("top")>=0){const t=r.point({x:0,y:2*-this.padding()});e.x+=t.x,e.y+=t.y,this._movingAnchorName=this._movingAnchorName.replace("top","bottom"),this._anchorDragOffset.x-=t.x,this._anchorDragOffset.y-=t.y,e.height+=2*this.padding()}else if(this._movingAnchorName&&e.height<0&&this._movingAnchorName.indexOf("bottom")>=0){const t=r.point({x:0,y:2*this.padding()});this._movingAnchorName=this._movingAnchorName.replace("bottom","top"),this._anchorDragOffset.x-=t.x,this._anchorDragOffset.y-=t.y,e.height+=2*this.padding()}if(this.boundBoxFunc()){const t=this.boundBoxFunc()(n,e);t?e=t:xt.warn("boundBoxFunc returned falsy. You should return new bound rect from it!")}const i=1e7,a=new ut;a.translate(n.x,n.y),a.rotate(n.rotation),a.scale(n.width/i,n.height/i);const s=new ut,o=e.width/i,l=e.height/i;!1===this.flipEnabled()?(s.translate(e.x,e.y),s.rotate(e.rotation),s.translate(e.width<0?e.width:0,e.height<0?e.height:0),s.scale(Math.abs(o),Math.abs(l))):(s.translate(e.x,e.y),s.rotate(e.rotation),s.scale(o,l));const c=s.multiply(a.invert());this._nodes.forEach(e=>{var t;if(!e.getStage())return;const n=e.getParent().getAbsoluteTransform(),r=e.getTransform().copy();r.translate(e.offsetX(),e.offsetY());const i=new ut;i.multiply(n.copy().invert()).multiply(c).multiply(n).multiply(r);const a=i.decompose();e.setAttrs(a),null===(t=e.getLayer())||void 0===t||t.batchDraw()}),this.rotation(xt._getRotation(e.rotation)),this._nodes.forEach(e=>{this._fire("transform",{evt:t,target:e}),e._fire("transform",{evt:t,target:e})}),this._resetTransformCache(),this.update(),this.getLayer().batchDraw()}forceUpdate(){this._resetTransformCache(),this.update()}_batchChangeChild(e,t){this.findOne(e).setAttrs(t)}update(){var e;const t=this._getNodeRect();this.rotation(xt._getRotation(t.rotation));const n=t.width,r=t.height,i=this.enabledAnchors(),a=this.resizeEnabled(),s=this.padding(),o=this.anchorSize(),l=this.find("._anchor");l.forEach(e=>{e.setAttrs({width:o,height:o,offsetX:o/2,offsetY:o/2,stroke:this.anchorStroke(),strokeWidth:this.anchorStrokeWidth(),fill:this.anchorFill(),cornerRadius:this.anchorCornerRadius()})}),this._batchChangeChild(".top-left",{x:0,y:0,offsetX:o/2+s,offsetY:o/2+s,visible:a&&i.indexOf("top-left")>=0}),this._batchChangeChild(".top-center",{x:n/2,y:0,offsetY:o/2+s,visible:a&&i.indexOf("top-center")>=0}),this._batchChangeChild(".top-right",{x:n,y:0,offsetX:o/2-s,offsetY:o/2+s,visible:a&&i.indexOf("top-right")>=0}),this._batchChangeChild(".middle-left",{x:0,y:r/2,offsetX:o/2+s,visible:a&&i.indexOf("middle-left")>=0}),this._batchChangeChild(".middle-right",{x:n,y:r/2,offsetX:o/2-s,visible:a&&i.indexOf("middle-right")>=0}),this._batchChangeChild(".bottom-left",{x:0,y:r,offsetX:o/2+s,offsetY:o/2-s,visible:a&&i.indexOf("bottom-left")>=0}),this._batchChangeChild(".bottom-center",{x:n/2,y:r,offsetY:o/2-s,visible:a&&i.indexOf("bottom-center")>=0}),this._batchChangeChild(".bottom-right",{x:n,y:r,offsetX:o/2-s,offsetY:o/2-s,visible:a&&i.indexOf("bottom-right")>=0}),this._batchChangeChild(".rotater",{x:n/2,y:-this.rotateAnchorOffset()*xt._sign(r)-s,visible:this.rotateEnabled()}),this._batchChangeChild(".back",{width:n,height:r,visible:this.borderEnabled(),stroke:this.borderStroke(),strokeWidth:this.borderStrokeWidth(),dash:this.borderDash(),draggable:this.nodes().some(e=>e.draggable()),x:0,y:0});const c=this.anchorStyleFunc();c&&l.forEach(e=>{c(e)}),null===(e=this.getLayer())||void 0===e||e.batchDraw()}isTransforming(){return this._transforming}stopTransform(){if(this._transforming){this._removeEvents();const e=this.findOne("."+this._movingAnchorName);e&&e.stopDrag()}}destroy(){return this.getStage()&&this._cursorChange&&this.getStage().content&&(this.getStage().content.style.cursor=""),er.prototype.destroy.call(this),this.detach(),this._removeEvents(),this}toObject(){return rn.prototype.toObject.call(this)}clone(e){return rn.prototype.clone.call(this,e)}getClientRect(){return this.nodes().length>0?super.getClientRect():{x:0,y:0,width:0,height:0}}}gi.isTransforming=()=>fi>0,gi.prototype.className="Transformer",lt(gi),qt.addGetterSetter(gi,"enabledAnchors",di,function(e){return e instanceof Array||xt.warn("enabledAnchors value should be an array"),e instanceof Array&&e.forEach(function(e){-1===di.indexOf(e)&&xt.warn("Unknown anchor name: "+e+". Available names are: "+di.join(", "))}),e||[]}),qt.addGetterSetter(gi,"flipEnabled",!0,Ot()),qt.addGetterSetter(gi,"resizeEnabled",!0),qt.addGetterSetter(gi,"anchorSize",10,Nt()),qt.addGetterSetter(gi,"rotateEnabled",!0),qt.addGetterSetter(gi,"rotateLineVisible",!0),qt.addGetterSetter(gi,"rotationSnaps",[]),qt.addGetterSetter(gi,"rotateAnchorOffset",50,Nt()),qt.addGetterSetter(gi,"rotateAnchorCursor","crosshair"),qt.addGetterSetter(gi,"rotationSnapTolerance",5,Nt()),qt.addGetterSetter(gi,"borderEnabled",!0),qt.addGetterSetter(gi,"anchorStroke","rgb(0, 161, 255)"),qt.addGetterSetter(gi,"anchorStrokeWidth",1,Nt()),qt.addGetterSetter(gi,"anchorFill","white"),qt.addGetterSetter(gi,"anchorCornerRadius",0,Nt()),qt.addGetterSetter(gi,"borderStroke","rgb(0, 161, 255)"),qt.addGetterSetter(gi,"borderStrokeWidth",1,Nt()),qt.addGetterSetter(gi,"borderDash"),qt.addGetterSetter(gi,"keepRatio",!0),qt.addGetterSetter(gi,"shiftBehavior","default"),qt.addGetterSetter(gi,"centeredScaling",!1),qt.addGetterSetter(gi,"ignoreStroke",!1),qt.addGetterSetter(gi,"padding",0,Nt()),qt.addGetterSetter(gi,"nodes"),qt.addGetterSetter(gi,"node"),qt.addGetterSetter(gi,"boundBoxFunc"),qt.addGetterSetter(gi,"anchorDragBoundFunc"),qt.addGetterSetter(gi,"anchorStyleFunc"),qt.addGetterSetter(gi,"shouldOverdrawWholeArea",!1),qt.addGetterSetter(gi,"useSingleNodeRotation",!0),qt.backCompat(gi,{lineEnabled:"borderEnabled",rotateHandlerOffset:"rotateAnchorOffset",enabledHandlers:"enabledAnchors"});class mi extends Yn{_sceneFunc(e){e.beginPath(),e.arc(0,0,this.radius(),0,ot.getAngle(this.angle()),this.clockwise()),e.lineTo(0,0),e.closePath(),e.fillStrokeShape(this)}getWidth(){return 2*this.radius()}getHeight(){return 2*this.radius()}setWidth(e){this.radius(e/2)}setHeight(e){this.radius(e/2)}}function xi(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}mi.prototype.className="Wedge",mi.prototype._centroid=!0,mi.prototype._attrsAffectingSize=["radius"],lt(mi),qt.addGetterSetter(mi,"radius",0,Nt()),qt.addGetterSetter(mi,"angle",0,Nt()),qt.addGetterSetter(mi,"clockwise",!1),qt.backCompat(mi,{angleDeg:"angle",getAngleDeg:"getAngle",setAngleDeg:"setAngle"});const yi=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],vi=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];qt.addGetterSetter(rn,"blurRadius",0,Nt(),qt.afterSetFilter);qt.addGetterSetter(rn,"brightness",0,Nt(),qt.afterSetFilter);qt.addGetterSetter(rn,"contrast",0,Nt(),qt.afterSetFilter);function bi(e,t,n,r,i){const a=n-t,s=i-r;if(0===a)return r+s/2;if(0===s)return r;let o=(e-t)/a;return o=s*o+r,o}qt.addGetterSetter(rn,"embossStrength",.5,Nt(),qt.afterSetFilter),qt.addGetterSetter(rn,"embossWhiteLevel",.5,Nt(),qt.afterSetFilter),qt.addGetterSetter(rn,"embossDirection","top-left",void 0,qt.afterSetFilter),qt.addGetterSetter(rn,"embossBlend",!1,void 0,qt.afterSetFilter);qt.addGetterSetter(rn,"enhance",0,Nt(),qt.afterSetFilter);qt.addGetterSetter(rn,"hue",0,Nt(),qt.afterSetFilter),qt.addGetterSetter(rn,"saturation",0,Nt(),qt.afterSetFilter),qt.addGetterSetter(rn,"luminance",0,Nt(),qt.afterSetFilter);qt.addGetterSetter(rn,"hue",0,Nt(),qt.afterSetFilter),qt.addGetterSetter(rn,"saturation",0,Nt(),qt.afterSetFilter),qt.addGetterSetter(rn,"value",0,Nt(),qt.afterSetFilter);function Si(e,t,n){let r=4*(n*e.width+t);const i=[];return i.push(e.data[r++],e.data[r++],e.data[r++],e.data[r++]),i}function _i(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)+Math.pow(e[2]-t[2],2))}qt.addGetterSetter(rn,"kaleidoscopePower",2,Nt(),qt.afterSetFilter),qt.addGetterSetter(rn,"kaleidoscopeAngle",0,Nt(),qt.afterSetFilter);qt.addGetterSetter(rn,"threshold",0,Nt(),qt.afterSetFilter);qt.addGetterSetter(rn,"noise",.2,Nt(),qt.afterSetFilter);qt.addGetterSetter(rn,"pixelSize",8,Nt(),qt.afterSetFilter);qt.addGetterSetter(rn,"levels",.5,Nt(),qt.afterSetFilter);qt.addGetterSetter(rn,"red",0,function(e){return this._filterUpToDate=!1,e>255?255:e<0?0:Math.round(e)}),qt.addGetterSetter(rn,"green",0,function(e){return this._filterUpToDate=!1,e>255?255:e<0?0:Math.round(e)}),qt.addGetterSetter(rn,"blue",0,Mt,qt.afterSetFilter);qt.addGetterSetter(rn,"red",0,function(e){return this._filterUpToDate=!1,e>255?255:e<0?0:Math.round(e)}),qt.addGetterSetter(rn,"green",0,function(e){return this._filterUpToDate=!1,e>255?255:e<0?0:Math.round(e)}),qt.addGetterSetter(rn,"blue",0,Mt,qt.afterSetFilter),qt.addGetterSetter(rn,"alpha",1,function(e){return this._filterUpToDate=!1,e>1?1:e<0?0:e});qt.addGetterSetter(rn,"threshold",.5,Nt(),qt.afterSetFilter),cr.Util._assign(cr,{Arc:ur,Arrow:Cr,Circle:wr,Ellipse:kr,Image:jr,Label:Mr,Tag:Nr,Line:pr,Path:_r,Rect:Rr,RegularPolygon:Dr,Ring:Gr,Sprite:Or,Star:Fr,Text:ei,TextPath:ii,Transformer:gi,Wedge:mi,Filters:{Blur:function(e){const t=Math.round(this.blurRadius());t>0&&function(e,t){const n=e.data,r=e.width,i=e.height;let a,s,o,l,c,u,d,h,p,f,g,m,x,y,v,b,S,_,C,w;const k=t+t+1,j=r-1,A=i-1,P=t+1,T=P*(P+1)/2,z=new xi,I=yi[t],E=vi[t];let M=null,N=z,R=null,D=null;for(let L=1;L<k;L++)N=N.next=new xi,L===P&&(M=N);N.next=z,o=s=0;for(let L=0;L<i;L++){m=x=y=v=l=c=u=d=0,h=P*(b=n[s]),p=P*(S=n[s+1]),f=P*(_=n[s+2]),g=P*(C=n[s+3]),l+=T*b,c+=T*S,u+=T*_,d+=T*C,N=z;for(let e=0;e<P;e++)N.r=b,N.g=S,N.b=_,N.a=C,N=N.next;for(let e=1;e<P;e++)a=s+((j<e?j:e)<<2),l+=(N.r=b=n[a])*(w=P-e),c+=(N.g=S=n[a+1])*w,u+=(N.b=_=n[a+2])*w,d+=(N.a=C=n[a+3])*w,m+=b,x+=S,y+=_,v+=C,N=N.next;R=z,D=M;for(let e=0;e<r;e++)n[s+3]=C=d*I>>E,0!==C?(C=255/C,n[s]=(l*I>>E)*C,n[s+1]=(c*I>>E)*C,n[s+2]=(u*I>>E)*C):n[s]=n[s+1]=n[s+2]=0,l-=h,c-=p,u-=f,d-=g,h-=R.r,p-=R.g,f-=R.b,g-=R.a,a=o+((a=e+t+1)<j?a:j)<<2,m+=R.r=n[a],x+=R.g=n[a+1],y+=R.b=n[a+2],v+=R.a=n[a+3],l+=m,c+=x,u+=y,d+=v,R=R.next,h+=b=D.r,p+=S=D.g,f+=_=D.b,g+=C=D.a,m-=b,x-=S,y-=_,v-=C,D=D.next,s+=4;o+=r}for(let L=0;L<r;L++){x=y=v=m=c=u=d=l=0,s=L<<2,h=P*(b=n[s]),p=P*(S=n[s+1]),f=P*(_=n[s+2]),g=P*(C=n[s+3]),l+=T*b,c+=T*S,u+=T*_,d+=T*C,N=z;for(let t=0;t<P;t++)N.r=b,N.g=S,N.b=_,N.a=C,N=N.next;let e=r;for(let i=1;i<=t;i++)s=e+L<<2,l+=(N.r=b=n[s])*(w=P-i),c+=(N.g=S=n[s+1])*w,u+=(N.b=_=n[s+2])*w,d+=(N.a=C=n[s+3])*w,m+=b,x+=S,y+=_,v+=C,N=N.next,i<A&&(e+=r);s=L,R=z,D=M;for(let t=0;t<i;t++)a=s<<2,n[a+3]=C=d*I>>E,C>0?(C=255/C,n[a]=(l*I>>E)*C,n[a+1]=(c*I>>E)*C,n[a+2]=(u*I>>E)*C):n[a]=n[a+1]=n[a+2]=0,l-=h,c-=p,u-=f,d-=g,h-=R.r,p-=R.g,f-=R.b,g-=R.a,a=L+((a=t+P)<A?a:A)*r<<2,l+=m+=R.r=n[a],c+=x+=R.g=n[a+1],u+=y+=R.b=n[a+2],d+=v+=R.a=n[a+3],R=R.next,h+=b=D.r,p+=S=D.g,f+=_=D.b,g+=C=D.a,m-=b,x-=S,y-=_,v-=C,D=D.next,s+=r}}(e,t)},Brightness:function(e){const t=this.brightness(),n=e.data,r=n.length;for(let i=0;i<r;i+=4)n[i]=Math.min(255,n[i]*t),n[i+1]=Math.min(255,n[i+1]*t),n[i+2]=Math.min(255,n[i+2]*t)},Brighten:function(e){const t=255*this.brightness(),n=e.data,r=n.length;for(let i=0;i<r;i+=4)n[i]+=t,n[i+1]+=t,n[i+2]+=t},Contrast:function(e){const t=Math.pow((this.contrast()+100)/100,2),n=e.data,r=n.length;let i=150,a=150,s=150;for(let o=0;o<r;o+=4)i=n[o],a=n[o+1],s=n[o+2],i/=255,i-=.5,i*=t,i+=.5,i*=255,a/=255,a-=.5,a*=t,a+=.5,a*=255,s/=255,s-=.5,s*=t,s+=.5,s*=255,i=i<0?0:i>255?255:i,a=a<0?0:a>255?255:a,s=s<0?0:s>255?255:s,n[o]=i,n[o+1]=a,n[o+2]=s},Emboss:function(e){var t,n,r,i,a,s,o,l,c;const u=e.data,d=e.width,h=e.height,p=Math.min(1,Math.max(0,null!==(n=null===(t=this.embossStrength)||void 0===t?void 0:t.call(this))&&void 0!==n?n:.5)),f=Math.min(1,Math.max(0,null!==(i=null===(r=this.embossWhiteLevel)||void 0===r?void 0:r.call(this))&&void 0!==i?i:.5)),g=null!==(o={"top-left":315,top:270,"top-right":225,right:180,"bottom-right":135,bottom:90,"bottom-left":45,left:0}[null!==(s=null===(a=this.embossDirection)||void 0===a?void 0:a.call(this))&&void 0!==s?s:"top-left"])&&void 0!==o?o:315,m=!(null===(c=null===(l=this.embossBlend)||void 0===l?void 0:l.call(this))||void 0===c||!c),x=10*p,y=255*f,v=g*Math.PI/180,b=Math.cos(v),S=Math.sin(v),_=128/1020*x,C=new Uint8ClampedArray(u),w=new Float32Array(d*h);for(let T=0,z=0;z<u.length;z+=4,T++)w[T]=.2126*C[z]+.7152*C[z+1]+.0722*C[z+2];const k=[-1,0,1,-2,0,2,-1,0,1],j=[-1,-2,-1,0,0,0,1,2,1],A=[-d-1,-d,1-d,-1,0,1,d-1,d,d+1],P=e=>e<0?0:e>255?255:e;for(let T=1;T<h-1;T++)for(let e=1;e<d-1;e++){const t=T*d+e;let n=0,r=0;n+=w[t+A[0]]*k[0],r+=w[t+A[0]]*j[0],n+=w[t+A[1]]*k[1],r+=w[t+A[1]]*j[1],n+=w[t+A[2]]*k[2],r+=w[t+A[2]]*j[2],n+=w[t+A[3]]*k[3],r+=w[t+A[3]]*j[3],n+=w[t+A[5]]*k[5],r+=w[t+A[5]]*j[5],n+=w[t+A[6]]*k[6],r+=w[t+A[6]]*j[6],n+=w[t+A[7]]*k[7],r+=w[t+A[7]]*j[7],n+=w[t+A[8]]*k[8],r+=w[t+A[8]]*j[8];const i=P(y+(b*n+S*r)*_),a=4*t;if(m){const e=i-y;u[a]=P(C[a]+e),u[a+1]=P(C[a+1]+e),u[a+2]=P(C[a+2]+e),u[a+3]=C[a+3]}else u[a]=u[a+1]=u[a+2]=i,u[a+3]=C[a+3]}for(let T=0;T<d;T++){let e=4*T,t=4*((h-1)*d+T);u[e]=C[e],u[e+1]=C[e+1],u[e+2]=C[e+2],u[e+3]=C[e+3],u[t]=C[t],u[t+1]=C[t+1],u[t+2]=C[t+2],u[t+3]=C[t+3]}for(let T=1;T<h-1;T++){let e=T*d*4,t=4*(T*d+(d-1));u[e]=C[e],u[e+1]=C[e+1],u[e+2]=C[e+2],u[e+3]=C[e+3],u[t]=C[t],u[t+1]=C[t+1],u[t+2]=C[t+2],u[t+3]=C[t+3]}return e},Enhance:function(e){const t=e.data,n=t.length;let r,i,a,s=t[0],o=s,l=t[1],c=l,u=t[2],d=u;const h=this.enhance();if(0===h)return;for(let v=0;v<n;v+=4)r=t[v+0],r<s?s=r:r>o&&(o=r),i=t[v+1],i<l?l=i:i>c&&(c=i),a=t[v+2],a<u?u=a:a>d&&(d=a);let p,f,g,m,x,y;if(o===s&&(o=255,s=0),c===l&&(c=255,l=0),d===u&&(d=255,u=0),h>0)p=o+h*(255-o),f=s-h*(s-0),g=c+h*(255-c),m=l-h*(l-0),x=d+h*(255-d),y=u-h*(u-0);else{const e=.5*(o+s);p=o+h*(o-e),f=s+h*(s-e);const t=.5*(c+l);g=c+h*(c-t),m=l+h*(l-t);const n=.5*(d+u);x=d+h*(d-n),y=u+h*(u-n)}for(let v=0;v<n;v+=4)t[v+0]=bi(t[v+0],s,o,f,p),t[v+1]=bi(t[v+1],l,c,m,g),t[v+2]=bi(t[v+2],u,d,y,x)},Grayscale:function(e){const t=e.data,n=t.length;for(let r=0;r<n;r+=4){const e=.34*t[r]+.5*t[r+1]+.16*t[r+2];t[r]=e,t[r+1]=e,t[r+2]=e}},HSL:function(e){const t=e.data,n=t.length,r=Math.pow(2,this.saturation()),i=Math.abs(this.hue()+360)%360,a=127*this.luminance(),s=1*r*Math.cos(i*Math.PI/180),o=1*r*Math.sin(i*Math.PI/180),l=.299+.701*s+.167*o,c=.587-.587*s+.33*o,u=.114-.114*s-.497*o,d=.299-.299*s-.328*o,h=.587+.413*s+.035*o,p=.114-.114*s+.293*o,f=.299-.3*s+1.25*o,g=.587-.586*s-1.05*o,m=.114+.886*s-.2*o;let x,y,v,b;for(let S=0;S<n;S+=4)x=t[S+0],y=t[S+1],v=t[S+2],b=t[S+3],t[S+0]=l*x+c*y+u*v+a,t[S+1]=d*x+h*y+p*v+a,t[S+2]=f*x+g*y+m*v+a,t[S+3]=b},HSV:function(e){const t=e.data,n=t.length,r=Math.pow(2,this.value()),i=Math.pow(2,this.saturation()),a=Math.abs(this.hue()+360)%360,s=r*i*Math.cos(a*Math.PI/180),o=r*i*Math.sin(a*Math.PI/180),l=.299*r+.701*s+.167*o,c=.587*r-.587*s+.33*o,u=.114*r-.114*s-.497*o,d=.299*r-.299*s-.328*o,h=.587*r+.413*s+.035*o,p=.114*r-.114*s+.293*o,f=.299*r-.3*s+1.25*o,g=.587*r-.586*s-1.05*o,m=.114*r+.886*s-.2*o;for(let x=0;x<n;x+=4){const e=t[x+0],n=t[x+1],r=t[x+2],i=t[x+3];t[x+0]=l*e+c*n+u*r,t[x+1]=d*e+h*n+p*r,t[x+2]=f*e+g*n+m*r,t[x+3]=i}},Invert:function(e){const t=e.data,n=t.length;for(let r=0;r<n;r+=4)t[r]=255-t[r],t[r+1]=255-t[r+1],t[r+2]=255-t[r+2]},Kaleidoscope:function(e){const t=e.width,n=e.height;let r,i,a,s,o,l,c,u,d,h,p=Math.round(this.kaleidoscopePower());const f=Math.round(this.kaleidoscopeAngle()),g=Math.floor(t*(f%360)/360);if(p<1)return;const m=xt.createCanvasElement();m.width=t,m.height=n;const x=m.getContext("2d").getImageData(0,0,t,n);xt.releaseCanvas(m),function(e,t,n){const r=e.data,i=t.data,a=e.width,s=e.height,o=n.polarCenterX||a/2,l=n.polarCenterY||s/2;let c=Math.sqrt(o*o+l*l),u=a-o,d=s-l;const h=Math.sqrt(u*u+d*d);c=h>c?h:c;const p=s,f=a,g=360/f*Math.PI/180;for(let m=0;m<f;m+=1){const e=Math.sin(m*g),t=Math.cos(m*g);for(let n=0;n<p;n+=1){u=Math.floor(o+c*n/p*t),d=Math.floor(l+c*n/p*e);let s=4*(d*a+u);const h=r[s+0],f=r[s+1],g=r[s+2],x=r[s+3];s=4*(m+n*a),i[s+0]=h,i[s+1]=f,i[s+2]=g,i[s+3]=x}}}(e,x,{polarCenterX:t/2,polarCenterY:n/2});let y=t/Math.pow(2,p);for(;y<=8;)y*=2,p-=1;y=Math.ceil(y);let v=y,b=0,S=v,_=1;for(g+y>t&&(b=v,S=0,_=-1),i=0;i<n;i+=1)for(r=b;r!==S;r+=_)a=Math.round(r+g)%t,d=4*(t*i+a),o=x.data[d+0],l=x.data[d+1],c=x.data[d+2],u=x.data[d+3],h=4*(t*i+r),x.data[h+0]=o,x.data[h+1]=l,x.data[h+2]=c,x.data[h+3]=u;for(i=0;i<n;i+=1)for(v=Math.floor(y),s=0;s<p;s+=1){for(r=0;r<v+1;r+=1)d=4*(t*i+r),o=x.data[d+0],l=x.data[d+1],c=x.data[d+2],u=x.data[d+3],h=4*(t*i+2*v-r-1),x.data[h+0]=o,x.data[h+1]=l,x.data[h+2]=c,x.data[h+3]=u;v*=2}!function(e,t,n){const r=e.data,i=t.data,a=e.width,s=e.height,o=n.polarCenterX||a/2,l=n.polarCenterY||s/2;let c=Math.sqrt(o*o+l*l),u=a-o,d=s-l;const h=Math.sqrt(u*u+d*d);c=h>c?h:c;const p=s,f=a;let g,m;for(u=0;u<a;u+=1)for(d=0;d<s;d+=1){const e=u-o,t=d-l,n=Math.sqrt(e*e+t*t)*p/c;let s=(180*Math.atan2(t,e)/Math.PI+360+0)%360;s=s*f/360,g=Math.floor(s),m=Math.floor(n);let h=4*(m*a+g);const x=r[h+0],y=r[h+1],v=r[h+2],b=r[h+3];h=4*(d*a+u),i[h+0]=x,i[h+1]=y,i[h+2]=v,i[h+3]=b}}(x,e,{})},Mask:function(e){let t=function(e,t){const n=Si(e,0,0),r=Si(e,e.width-1,0),i=Si(e,0,e.height-1),a=Si(e,e.width-1,e.height-1),s=t||10;if(_i(n,r)<s&&_i(r,a)<s&&_i(a,i)<s&&_i(i,n)<s){const t=function(e){const t=[0,0,0];for(let n=0;n<e.length;n++)t[0]+=e[n][0],t[1]+=e[n][1],t[2]+=e[n][2];return t[0]/=e.length,t[1]/=e.length,t[2]/=e.length,t}([r,n,a,i]),o=[];for(let n=0;n<e.width*e.height;n++){const r=_i(t,[e.data[4*n],e.data[4*n+1],e.data[4*n+2]]);o[n]=r<s?0:255}return o}}(e,this.threshold());return t&&(t=function(e,t,n){const r=[1,1,1,1,0,1,1,1,1],i=Math.round(Math.sqrt(r.length)),a=Math.floor(i/2),s=[];for(let o=0;o<n;o++)for(let l=0;l<t;l++){const c=o*t+l;let u=0;for(let s=0;s<i;s++)for(let c=0;c<i;c++){const d=o+s-a,h=l+c-a;if(d>=0&&d<n&&h>=0&&h<t){const n=r[s*i+c];u+=e[d*t+h]*n}}s[c]=2040===u?255:0}return s}(t,e.width,e.height),t=function(e,t,n){const r=[1,1,1,1,1,1,1,1,1],i=Math.round(Math.sqrt(r.length)),a=Math.floor(i/2),s=[];for(let o=0;o<n;o++)for(let l=0;l<t;l++){const c=o*t+l;let u=0;for(let s=0;s<i;s++)for(let c=0;c<i;c++){const d=o+s-a,h=l+c-a;if(d>=0&&d<n&&h>=0&&h<t){const n=r[s*i+c];u+=e[d*t+h]*n}}s[c]=u>=1020?255:0}return s}(t,e.width,e.height),t=function(e,t,n){const r=[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9],i=Math.round(Math.sqrt(r.length)),a=Math.floor(i/2),s=[];for(let o=0;o<n;o++)for(let l=0;l<t;l++){const c=o*t+l;let u=0;for(let s=0;s<i;s++)for(let c=0;c<i;c++){const d=o+s-a,h=l+c-a;if(d>=0&&d<n&&h>=0&&h<t){const n=r[s*i+c];u+=e[d*t+h]*n}}s[c]=u}return s}(t,e.width,e.height),function(e,t){for(let n=0;n<e.width*e.height;n++)e.data[4*n+3]=t[n]}(e,t)),e},Noise:function(e){const t=255*this.noise(),n=e.data,r=n.length,i=t/2;for(let a=0;a<r;a+=4)n[a+0]+=i-2*i*Math.random(),n[a+1]+=i-2*i*Math.random(),n[a+2]+=i-2*i*Math.random()},Pixelate:function(e){let t=Math.ceil(this.pixelSize()),n=e.width,r=e.height,i=Math.ceil(n/t),a=Math.ceil(r/t),s=e.data;if(t<=0)xt.error("pixelSize value can not be <= 0");else for(let o=0;o<i;o+=1)for(let e=0;e<a;e+=1){let i=0,a=0,l=0,c=0;const u=o*t,d=u+t,h=e*t,p=h+t;let f=0;for(let e=u;e<d;e+=1)if(!(e>=n))for(let t=h;t<p;t+=1){if(t>=r)continue;const o=4*(n*t+e);i+=s[o+0],a+=s[o+1],l+=s[o+2],c+=s[o+3],f+=1}i/=f,a/=f,l/=f,c/=f;for(let e=u;e<d;e+=1)if(!(e>=n))for(let t=h;t<p;t+=1){if(t>=r)continue;const o=4*(n*t+e);s[o+0]=i,s[o+1]=a,s[o+2]=l,s[o+3]=c}}},Posterize:function(e){const t=Math.round(254*this.levels())+1,n=e.data,r=n.length,i=255/t;for(let a=0;a<r;a+=1)n[a]=Math.floor(n[a]/i)*i},RGB:function(e){const t=e.data,n=t.length,r=this.red(),i=this.green(),a=this.blue();for(let s=0;s<n;s+=4){const e=(.34*t[s]+.5*t[s+1]+.16*t[s+2])/255;t[s]=e*r,t[s+1]=e*i,t[s+2]=e*a,t[s+3]=t[s+3]}},RGBA:function(e){const t=e.data,n=t.length,r=this.red(),i=this.green(),a=this.blue(),s=this.alpha();for(let o=0;o<n;o+=4){const e=1-s;t[o]=r*s+t[o]*e,t[o+1]=i*s+t[o+1]*e,t[o+2]=a*s+t[o+2]*e}},Sepia:function(e){const t=e.data,n=t.length;for(let r=0;r<n;r+=4){const e=t[r+0],n=t[r+1],i=t[r+2];t[r+0]=Math.min(255,.393*e+.769*n+.189*i),t[r+1]=Math.min(255,.349*e+.686*n+.168*i),t[r+2]=Math.min(255,.272*e+.534*n+.131*i)}},Solarize:function(e){const t=e.data;for(let n=0;n<t.length;n+=4){const e=t[n],r=t[n+1],i=t[n+2];.2126*e+.7152*r+.0722*i>=128&&(t[n]=255-e,t[n+1]=255-r,t[n+2]=255-i)}return e},Threshold:function(e){const t=255*this.threshold(),n=e.data,r=n.length;for(let i=0;i<r;i+=1)n[i]=n[i]<t?0:255}}});var Ci,wi,ki={exports:{}},ji={exports:{}};function Ai(){return Ci||(Ci=1,(e=ji).exports=function(e){function t(e,t,n,r){return new Wi(e,t,n,r)}function n(){}function r(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{!!(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function a(e){if(i(e)!==e)throw Error(r(188))}function s(e){var t=e.alternate;if(!t){if(null===(t=i(e)))throw Error(r(188));return t!==e?null:e}for(var n=e,s=t;;){var o=n.return;if(null===o)break;var l=o.alternate;if(null===l){if(null!==(s=o.return)){n=s;continue}break}if(o.child===l.child){for(l=o.child;l;){if(l===n)return a(o),e;if(l===s)return a(o),t;l=l.sibling}throw Error(r(188))}if(n.return!==s.return)n=o,s=l;else{for(var c=!1,u=o.child;u;){if(u===n){c=!0,n=o,s=l;break}if(u===s){c=!0,s=o,n=l;break}u=u.sibling}if(!c){for(u=l.child;u;){if(u===n){c=!0,n=l,s=o;break}if(u===s){c=!0,s=l,n=o;break}u=u.sibling}if(!c)throw Error(r(189))}}if(n.alternate!==s)throw Error(r(190))}if(3!==n.tag)throw Error(r(188));return n.stateNode.current===n?e:t}function o(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e;for(e=e.child;null!==e;){if(null!==(t=o(e)))return t;e=e.sibling}return null}function l(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e;for(e=e.child;null!==e;){if(4!==e.tag&&null!==(t=l(e)))return t;e=e.sibling}return null}function c(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=_a&&e[_a]||e["@@iterator"])?e:null}function u(e){if(null==e)return null;if("function"==typeof e)return e.$$typeof===Ca?null:e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case ua:return"Fragment";case ha:return"Profiler";case da:return"StrictMode";case ma:return"Suspense";case xa:return"SuspenseList";case ba:return"Activity"}if("object"==typeof e)switch(e.$$typeof){case ca:return"Portal";case fa:return e.displayName||"Context";case pa:return(e._context.displayName||"Context")+".Consumer";case ga:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case ya:return null!==(t=e.displayName||null)?t:u(e.type)||"Memo";case va:t=e._payload,e=e._init;try{return u(e(t))}catch(n){}}return null}function d(e){return{current:e}}function h(e){0>Uo||(e.current=Vo[Uo],Vo[Uo]=null,Uo--)}function p(e,t){Uo++,Vo[Uo]=e.current,e.current=t}function f(e){var t=42&e;if(0!==t)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return 261888&e;case 262144:case 524288:case 1048576:case 2097152:return 3932160&e;case 4194304:case 8388608:case 16777216:case 33554432:return 62914560&e;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function g(e,t,n){var r=e.pendingLanes;if(0===r)return 0;var i=0,a=e.suspendedLanes,s=e.pingedLanes;e=e.warmLanes;var o=134217727&r;return 0!==o?0!==(r=o&~a)?i=f(r):0!==(s&=o)?i=f(s):n||0!==(n=o&~e)&&(i=f(n)):0!==(o=r&~a)?i=f(o):0!==s?i=f(s):n||0!==(n=r&~e)&&(i=f(n)),0===i?0:0!==t&&t!==i&&0===(t&a)&&((a=i&-i)>=(n=t&-t)||32===a&&4194048&n)?t:i}function m(e,t){return 0===(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)}function x(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function y(){var e=el;return!(62914560&(el<<=1))&&(el=4194304),e}function v(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function b(e,t){e.pendingLanes|=t,268435456!==t&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function S(e,t,n){e.pendingLanes|=t,e.suspendedLanes&=~t;var r=31-Yo(t);e.entangledLanes|=t,e.entanglements[r]=1073741824|e.entanglements[r]|261930&n}function _(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-Yo(n),i=1<<r;i&t|e[r]&t&&(e[r]|=t),n&=~i}}function C(e,t){var n=t&-t;return 0!==((n=42&n?1:w(n))&(e.suspendedLanes|t))?0:n}function w(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function k(e){return 2<(e&=-e)?8<e?134217727&e?32:268435456:8:2}function j(e){if("function"==typeof ul&&dl(e),pl&&"function"==typeof pl.setStrictMode)try{pl.setStrictMode(hl,e)}catch(t){}}function A(e){if(void 0===_o)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);_o=t&&t[1]||"",Co=-1<n.stack.indexOf("\n    at")?" (<anonymous>)":-1<n.stack.indexOf("@")?"@unknown:0:0":""}return"\n"+_o+e+Co}function P(e,t){if(!e||xl)return"";xl=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var r={DetermineComponentFrameRoot:function(){try{if(t){var n=function(){throw Error()};if(Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(n,[])}catch(i){var r=i}Reflect.construct(e,[],n)}else{try{n.call()}catch(a){r=a}e.call(n.prototype)}}else{try{throw Error()}catch(s){r=s}(n=e())&&"function"==typeof n.catch&&n.catch(function(){})}}catch(o){if(o&&r&&"string"==typeof o.stack)return[o.stack,r.stack]}return[null,null]}};r.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var i=Object.getOwnPropertyDescriptor(r.DetermineComponentFrameRoot,"name");i&&i.configurable&&Object.defineProperty(r.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var a=r.DetermineComponentFrameRoot(),s=a[0],o=a[1];if(s&&o){var l=s.split("\n"),c=o.split("\n");for(i=r=0;r<l.length&&!l[r].includes("DetermineComponentFrameRoot");)r++;for(;i<c.length&&!c[i].includes("DetermineComponentFrameRoot");)i++;if(r===l.length||i===c.length)for(r=l.length-1,i=c.length-1;1<=r&&0<=i&&l[r]!==c[i];)i--;for(;1<=r&&0<=i;r--,i--)if(l[r]!==c[i]){if(1!==r||1!==i)do{if(r--,0>--i||l[r]!==c[i]){var u="\n"+l[r].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}}while(1<=r&&0<=i);break}}}finally{xl=!1,Error.prepareStackTrace=n}return(n=e?e.displayName||e.name:"")?A(n):""}function T(e,t){switch(e.tag){case 26:case 27:case 5:return A(e.type);case 16:return A("Lazy");case 13:return e.child!==t&&null!==t?A("Suspense Fallback"):A("Suspense");case 19:return A("SuspenseList");case 0:case 15:return P(e.type,!1);case 11:return P(e.type.render,!1);case 1:return P(e.type,!0);case 31:return A("Activity");default:return""}}function z(e){try{var t="",n=null;do{t+=T(e,n),n=e,e=e.return}while(e);return t}catch(r){return"\nError generating stack: "+r.message+"\n"+r.stack}}function I(e,t){if("object"==typeof e&&null!==e){var n=yl.get(e);return void 0!==n?n:(t={value:e,source:t,stack:z(t)},yl.set(e,t),t)}return{value:e,source:t,stack:z(t)}}function E(e,t){vl[bl++]=_l,vl[bl++]=Sl,Sl=e,_l=t}function M(e,t,n){Cl[wl++]=jl,Cl[wl++]=Al,Cl[wl++]=kl,kl=e;var r=jl;e=Al;var i=32-Yo(r)-1;r&=~(1<<i),n+=1;var a=32-Yo(t)+i;if(30<a){var s=i-i%5;a=(r&(1<<s)-1).toString(32),r>>=s,i-=s,jl=1<<32-Yo(t)+i|n<<i|r,Al=a+e}else jl=1<<a|n<<i|r,Al=e}function N(e){null!==e.return&&(E(e,1),M(e,1,0))}function R(e){for(;e===Sl;)Sl=vl[--bl],vl[bl]=null,_l=vl[--bl],vl[bl]=null;for(;e===kl;)kl=Cl[--wl],Cl[wl]=null,Al=Cl[--wl],Cl[wl]=null,jl=Cl[--wl],Cl[wl]=null}function D(e,t){Cl[wl++]=jl,Cl[wl++]=Al,Cl[wl++]=kl,jl=t.id,Al=t.overflow,kl=e}function L(e,t){p(zl,t),p(Tl,e),p(Pl,null),e=za(t),h(Pl),p(Pl,e)}function G(){h(Pl),h(Tl),h(zl)}function O(e){null!==e.memoizedState&&p(Il,e);var t=Pl.current,n=Ia(t,e.type);t!==n&&(p(Tl,e),p(Pl,n))}function F(e){Tl.current===e&&(h(Pl),h(Tl)),Il.current===e&&(h(Il),qa?os._currentValue=ss:os._currentValue2=ss)}function W(e){throw U(I(Error(r(418,1<arguments.length&&void 0!==arguments[1]&&arguments[1]?"text":"HTML","")),e)),Ll}function q(e,t){if(!Ha)throw Error(r(175));io(e.stateNode,e.type,e.memoizedProps,t,e)||W(e,!0)}function B(e){for(El=e.return;El;)switch(El.tag){case 5:case 31:case 13:return void(Dl=!1);case 27:case 3:return void(Dl=!0);default:El=El.return}}function $(e){if(!Ha||e!==El)return!1;if(!Nl)return B(e),Nl=!0,!1;var t=e.tag;if(Fo?3!==t&&27!==t&&(5!==t||So(e.type)&&!La(e.type,e.memoizedProps))&&Ml&&W(e):3!==t&&(5!==t||So(e.type)&&!La(e.type,e.memoizedProps))&&Ml&&W(e),B(e),13===t){if(!Ha)throw Error(r(316));if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(r(317));Ml=co(e)}else if(31===t){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(r(317));Ml=lo(e)}else Ml=Fo&&27===t?Qs(e.type,Ml):El?Us(e.stateNode):null;return!0}function H(){Ha&&(Ml=El=null,Nl=!1)}function V(){var e=Rl;return null!==e&&(null===Su?Su=e:Su.push.apply(Su,e),Rl=null),e}function U(e){null===Rl?Rl=[e]:Rl.push(e)}function Q(e,t,n){qa?(p(Gl,t._currentValue),t._currentValue=n):(p(Gl,t._currentValue2),t._currentValue2=n)}function Y(e){var t=Gl.current;qa?e._currentValue=t:e._currentValue2=t,h(Gl)}function X(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function K(e,t,n,i){var a=e.child;for(null!==a&&(a.return=e);null!==a;){var s=a.dependencies;if(null!==s){var o=a.child;s=s.firstContext;e:for(;null!==s;){var l=s;s=a;for(var c=0;c<t.length;c++)if(l.context===t[c]){s.lanes|=n,null!==(l=s.alternate)&&(l.lanes|=n),X(s.return,n,e),i||(o=null);break e}s=l.next}}else if(18===a.tag){if(null===(o=a.return))throw Error(r(341));o.lanes|=n,null!==(s=o.alternate)&&(s.lanes|=n),X(o,n,e),o=null}else o=a.child;if(null!==o)o.return=a;else for(o=a;null!==o;){if(o===e){o=null;break}if(null!==(a=o.sibling)){a.return=o.return,o=a;break}o=o.return}a=o}}function J(e,t,n,i){e=null;for(var a=t,s=!1;null!==a;){if(!s)if(524288&a.flags)s=!0;else if(262144&a.flags)break;if(10===a.tag){var o=a.alternate;if(null===o)throw Error(r(387));if(null!==(o=o.memoizedProps)){var l=a.type;fl(a.pendingProps.value,o.value)||(null!==e?e.push(l):e=[l])}}else if(a===Il.current){if(null===(o=a.alternate))throw Error(r(387));o.memoizedState.memoizedState!==a.memoizedState.memoizedState&&(null!==e?e.push(os):e=[os])}a=a.return}null!==e&&K(t,e,n,i),t.flags|=262144}function Z(e){for(e=e.firstContext;null!==e;){var t=e.context;if(!fl(qa?t._currentValue:t._currentValue2,e.memoizedValue))return!0;e=e.next}return!1}function ee(e){Ol=e,Fl=null,null!==(e=e.dependencies)&&(e.firstContext=null)}function te(e){return re(Ol,e)}function ne(e,t){return null===Ol&&ee(e),re(e,t)}function re(e,t){var n=qa?t._currentValue:t._currentValue2;if(t={context:t,memoizedValue:n,next:null},null===Fl){if(null===e)throw Error(r(308));Fl=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else Fl=Fl.next=t;return n}function ie(){return{controller:new Wl,data:new Map,refCount:0}}function ae(e){e.refCount--,0===e.refCount&&ql(Bl,function(){e.controller.abort()})}function se(){}function oe(e){e!==Vl&&null===e.next&&(null===Vl?Hl=Vl=e:Vl=Vl.next=e),Ql=!0,Ul||(Ul=!0,cs?us(function(){6&iu?tl(sl,ce):ue()}):tl(sl,ce))}function le(e,t){if(!Yl&&Ql){Yl=!0;do{for(var n=!1,r=Hl;null!==r;){if(0!==e){var i=r.pendingLanes;if(0===i)var a=0;else{var s=r.suspendedLanes,o=r.pingedLanes;a=(1<<31-Yo(42|e)+1)-1,a=201326741&(a&=i&~(s&~o))?201326741&a|1:a?2|a:0}0!==a&&(n=!0,pe(r,a))}else a=ou,!(3&(a=g(r,r===au?a:0,null!==r.cancelPendingCommit||r.timeoutHandle!==Wa)))||m(r,a)||(n=!0,pe(r,a));r=r.next}}while(n);Yl=!1}}function ce(){ue()}function ue(){Ql=Ul=!1;var e=0;0!==Xl&&Ka()&&(e=Xl);for(var t=al(),n=null,r=Hl;null!==r;){var i=r.next,a=de(r,t);0===a?(r.next=null,null===n?Hl=i:n.next=i,null===i&&(Vl=n)):(n=r,(0!==e||3&a)&&(Ql=!0)),r=i}0!==Pu&&5!==Pu||le(e),0!==Xl&&(Xl=0)}function de(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,a=-62914561&e.pendingLanes;0<a;){var s=31-Yo(a),o=1<<s,l=i[s];-1===l?0!==(o&n)&&0===(o&r)||(i[s]=x(o,t)):l<=t&&(e.expiredLanes|=o),a&=~o}if(n=ou,n=g(e,e===(t=au)?n:0,null!==e.cancelPendingCommit||e.timeoutHandle!==Wa),r=e.callbackNode,0===n||e===t&&(2===lu||9===lu)||null!==e.cancelPendingCommit)return null!==r&&null!==r&&nl(r),e.callbackNode=null,e.callbackPriority=0;if(!(3&n)||m(e,n)){if((t=n&-n)===e.callbackPriority)return t;switch(null!==r&&nl(r),k(n)){case 2:case 8:n=ol;break;case 32:default:n=ll;break;case 268435456:n=cl}return r=he.bind(null,e),n=tl(n,r),e.callbackPriority=t,e.callbackNode=n,t}return null!==r&&null!==r&&nl(r),e.callbackPriority=2,e.callbackNode=null,2}function he(e,t){if(0!==Pu&&5!==Pu)return e.callbackNode=null,e.callbackPriority=0,null;var n=e.callbackNode;if(Ei()&&e.callbackNode!==n)return null;var r=ou;return 0===(r=g(e,e===au?r:0,null!==e.cancelPendingCommit||e.timeoutHandle!==Wa))?null:(oi(e,r,t),de(e,al()),null!=e.callbackNode&&e.callbackNode===n?he.bind(null,e):null)}function pe(e,t){if(Ei())return null;oi(e,t,!0)}function fe(){if(0===Xl){var e=Zl;0===e&&(e=Jo,!(261888&(Jo<<=1))&&(Jo=256)),Xl=e}return Xl}function ge(){if(0===--Jl&&null!==Kl){null!==ec&&(ec.status="fulfilled");var e=Kl;Kl=null,Zl=0,ec=null;for(var t=0;t<e.length;t++)(0,e[t])()}}function me(){var e=nc.current;return null!==e?e:au.pooledCache}function xe(e,t){p(nc,null===t?nc.current:t.pool)}function ye(){var e=me();return null===e?null:{parent:qa?$l._currentValue:$l._currentValue2,pool:e}}function ve(e,t){if(fl(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!ml.call(t,i)||!fl(e[i],t[i]))return!1}return!0}function be(e){return"fulfilled"===(e=e.status)||"rejected"===e}function Se(e,t,n){switch(void 0===(n=e[n])?e.push(t):n!==t&&(t.then(se,se),t=n),t.status){case"fulfilled":return t.value;case"rejected":throw we(e=t.reason),e;default:if("string"==typeof t.status)t.then(se,se);else{if(null!==(e=au)&&100<e.shellSuspendCounter)throw Error(r(482));(e=t).status="pending",e.then(function(e){if("pending"===t.status){var n=t;n.status="fulfilled",n.value=e}},function(e){if("pending"===t.status){var n=t;n.status="rejected",n.reason=e}})}switch(t.status){case"fulfilled":return t.value;case"rejected":throw we(e=t.reason),e}throw oc=t,rc}}function _e(e){try{return(0,e._init)(e._payload)}catch(t){if(null!==t&&"object"==typeof t&&"function"==typeof t.then)throw oc=t,rc;throw t}}function Ce(){if(null===oc)throw Error(r(459));var e=oc;return oc=null,e}function we(e){if(e===rc||e===ac)throw Error(r(483))}function ke(e){var t=cc;return cc+=1,null===lc&&(lc=[]),Se(lc,e,t)}function je(e,t){t=t.props.ref,e.ref=void 0!==t?t:null}function Pe(e,t){if(t.$$typeof===oa)throw Error(r(525));throw e=Object.prototype.toString.call(t),Error(r(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Te(e){function n(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function i(t,r){if(!e)return null;for(;null!==r;)n(t,r),r=r.sibling;return null}function a(e){for(var t=new Map;null!==e;)null!==e.key?t.set(e.key,e):t.set(e.index,e),e=e.sibling;return t}function s(e,t){return(e=Bi(e,t)).index=0,e.sibling=null,e}function o(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=67108866,n):r:(t.flags|=67108866,n):(t.flags|=1048576,n)}function l(t){return e&&null===t.alternate&&(t.flags|=67108866),t}function u(e,t,n,r){return null===t||6!==t.tag?((t=Ui(n,e.mode,r)).return=e,t):((t=s(t,n)).return=e,t)}function d(e,t,n,r){var i=n.type;return i===ua?p(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===i||"object"==typeof i&&null!==i&&i.$$typeof===va&&_e(i)===t.type)?(je(t=s(t,n.props),n),t.return=e,t):(je(t=Hi(n.type,n.key,n.props,null,e.mode,r),n),t.return=e,t)}function h(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Yi(n,e.mode,r)).return=e,t):((t=s(t,n.children||[])).return=e,t)}function p(e,t,n,r,i){return null===t||7!==t.tag?((t=Vi(n,e.mode,r,i)).return=e,t):((t=s(t,n)).return=e,t)}function f(e,t,n){if("string"==typeof t&&""!==t||"number"==typeof t||"bigint"==typeof t)return(t=Ui(""+t,e.mode,n)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case la:return je(n=Hi(t.type,t.key,t.props,null,e.mode,n),t),n.return=e,n;case ca:return(t=Yi(t,e.mode,n)).return=e,t;case va:return f(e,t=_e(t),n)}if(wa(t)||c(t))return(t=Vi(t,e.mode,n,null)).return=e,t;if("function"==typeof t.then)return f(e,ke(t),n);if(t.$$typeof===fa)return f(e,ne(e,t),n);Pe(e,t)}return null}function g(e,t,n,r){var i=null!==t?t.key:null;if("string"==typeof n&&""!==n||"number"==typeof n||"bigint"==typeof n)return null!==i?null:u(e,t,""+n,r);if("object"==typeof n&&null!==n){switch(n.$$typeof){case la:return n.key===i?d(e,t,n,r):null;case ca:return n.key===i?h(e,t,n,r):null;case va:return g(e,t,n=_e(n),r)}if(wa(n)||c(n))return null!==i?null:p(e,t,n,r,null);if("function"==typeof n.then)return g(e,t,ke(n),r);if(n.$$typeof===fa)return g(e,t,ne(e,n),r);Pe(e,n)}return null}function m(e,t,n,r,i){if("string"==typeof r&&""!==r||"number"==typeof r||"bigint"==typeof r)return u(t,e=e.get(n)||null,""+r,i);if("object"==typeof r&&null!==r){switch(r.$$typeof){case la:return d(t,e=e.get(null===r.key?n:r.key)||null,r,i);case ca:return h(t,e=e.get(null===r.key?n:r.key)||null,r,i);case va:return m(e,t,n,r=_e(r),i)}if(wa(r)||c(r))return p(t,e=e.get(n)||null,r,i,null);if("function"==typeof r.then)return m(e,t,n,ke(r),i);if(r.$$typeof===fa)return m(e,t,n,ne(t,r),i);Pe(t,r)}return null}function x(t,u,d,h){if("object"==typeof d&&null!==d&&d.type===ua&&null===d.key&&(d=d.props.children),"object"==typeof d&&null!==d){switch(d.$$typeof){case la:e:{for(var p=d.key;null!==u;){if(u.key===p){if((p=d.type)===ua){if(7===u.tag){i(t,u.sibling),(h=s(u,d.props.children)).return=t,t=h;break e}}else if(u.elementType===p||"object"==typeof p&&null!==p&&p.$$typeof===va&&_e(p)===u.type){i(t,u.sibling),je(h=s(u,d.props),d),h.return=t,t=h;break e}i(t,u);break}n(t,u),u=u.sibling}d.type===ua?((h=Vi(d.props.children,t.mode,h,d.key)).return=t,t=h):(je(h=Hi(d.type,d.key,d.props,null,t.mode,h),d),h.return=t,t=h)}return l(t);case ca:e:{for(p=d.key;null!==u;){if(u.key===p){if(4===u.tag&&u.stateNode.containerInfo===d.containerInfo&&u.stateNode.implementation===d.implementation){i(t,u.sibling),(h=s(u,d.children||[])).return=t,t=h;break e}i(t,u);break}n(t,u),u=u.sibling}(h=Yi(d,t.mode,h)).return=t,t=h}return l(t);case va:return x(t,u,d=_e(d),h)}if(wa(d))return function(t,r,s,l){for(var c=null,u=null,d=r,h=r=0,p=null;null!==d&&h<s.length;h++){d.index>h?(p=d,d=null):p=d.sibling;var x=g(t,d,s[h],l);if(null===x){null===d&&(d=p);break}e&&d&&null===x.alternate&&n(t,d),r=o(x,r,h),null===u?c=x:u.sibling=x,u=x,d=p}if(h===s.length)return i(t,d),Nl&&E(t,h),c;if(null===d){for(;h<s.length;h++)null!==(d=f(t,s[h],l))&&(r=o(d,r,h),null===u?c=d:u.sibling=d,u=d);return Nl&&E(t,h),c}for(d=a(d);h<s.length;h++)null!==(p=m(d,t,h,s[h],l))&&(e&&null!==p.alternate&&d.delete(null===p.key?h:p.key),r=o(p,r,h),null===u?c=p:u.sibling=p,u=p);return e&&d.forEach(function(e){return n(t,e)}),Nl&&E(t,h),c}(t,u,d,h);if(c(d)){if("function"!=typeof(p=c(d)))throw Error(r(150));return function(t,s,l,c){if(null==l)throw Error(r(151));for(var u=null,d=null,h=s,p=s=0,x=null,y=l.next();null!==h&&!y.done;p++,y=l.next()){h.index>p?(x=h,h=null):x=h.sibling;var v=g(t,h,y.value,c);if(null===v){null===h&&(h=x);break}e&&h&&null===v.alternate&&n(t,h),s=o(v,s,p),null===d?u=v:d.sibling=v,d=v,h=x}if(y.done)return i(t,h),Nl&&E(t,p),u;if(null===h){for(;!y.done;p++,y=l.next())null!==(y=f(t,y.value,c))&&(s=o(y,s,p),null===d?u=y:d.sibling=y,d=y);return Nl&&E(t,p),u}for(h=a(h);!y.done;p++,y=l.next())null!==(y=m(h,t,p,y.value,c))&&(e&&null!==y.alternate&&h.delete(null===y.key?p:y.key),s=o(y,s,p),null===d?u=y:d.sibling=y,d=y);return e&&h.forEach(function(e){return n(t,e)}),Nl&&E(t,p),u}(t,u,d=p.call(d),h)}if("function"==typeof d.then)return x(t,u,ke(d),h);if(d.$$typeof===fa)return x(t,u,ne(t,d),h);Pe(t,d)}return"string"==typeof d&&""!==d||"number"==typeof d||"bigint"==typeof d?(d=""+d,null!==u&&6===u.tag?(i(t,u.sibling),(h=s(u,d)).return=t,t=h):(i(t,u),(h=Ui(d,t.mode,h)).return=t,t=h),l(t)):i(t,u)}return function(e,n,r,i){try{cc=0;var a=x(e,n,r,i);return lc=null,a}catch(o){if(o===rc||o===ac)throw o;var s=t(29,o,null,e.mode);return s.lanes=i,s.return=e,s}}}function ze(){for(var e=pc,t=fc=pc=0;t<e;){var n=hc[t];hc[t++]=null;var r=hc[t];hc[t++]=null;var i=hc[t];hc[t++]=null;var a=hc[t];if(hc[t++]=null,null!==r&&null!==i){var s=r.pending;null===s?i.next=i:(i.next=s.next,s.next=i),r.pending=i}0!==a&&Re(n,i,a)}}function Ie(e,t,n,r){hc[pc++]=e,hc[pc++]=t,hc[pc++]=n,hc[pc++]=r,fc|=r,e.lanes|=r,null!==(e=e.alternate)&&(e.lanes|=r)}function Ee(e,t,n,r){return Ie(e,t,n,r),De(e)}function Me(e,t){return Ie(e,null,null,t),De(e)}function Re(e,t,n){e.lanes|=n;var r=e.alternate;null!==r&&(r.lanes|=n);for(var i=!1,a=e.return;null!==a;)a.childLanes|=n,null!==(r=a.alternate)&&(r.childLanes|=n),22===a.tag&&(null===(e=a.stateNode)||1&e._visibility||(i=!0)),e=a,a=a.return;return 3===e.tag?(a=e.stateNode,i&&null!==t&&(i=31-Yo(n),null===(r=(e=a.hiddenUpdates)[i])?e[i]=[t]:r.push(t),t.lane=536870912|n),a):null}function De(e){if(50<Ru)throw Ru=0,Du=null,Error(r(185));for(var t=e.return;null!==t;)t=(e=t).return;return 3===e.tag?e.stateNode:null}function Le(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Ge(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function Oe(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function Fe(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,2&iu){var i=r.pending;return null===i?t.next=t:(t.next=i.next,i.next=t),r.pending=t,t=De(e),Re(e,null,n),t}return Ie(e,r,t,n),De(e)}function We(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,4194048&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,_(e,n)}}function qe(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var i=null,a=null;if(null!==(n=n.firstBaseUpdate)){do{var s={lane:n.lane,tag:n.tag,payload:n.payload,callback:null,next:null};null===a?i=a=s:a=a.next=s,n=n.next}while(null!==n);null===a?i=a=t:a=a.next=t}else i=a=t;return n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:a,shared:r.shared,callbacks:r.callbacks},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Be(){if(mc&&null!==ec)throw ec}function $e(e,t,n,r){mc=!1;var i=e.updateQueue;gc=!1;var a=i.firstBaseUpdate,s=i.lastBaseUpdate,o=i.shared.pending;if(null!==o){i.shared.pending=null;var l=o,c=l.next;l.next=null,null===s?a=c:s.next=c,s=l;var u=e.alternate;null!==u&&(o=(u=u.updateQueue).lastBaseUpdate)!==s&&(null===o?u.firstBaseUpdate=c:o.next=c,u.lastBaseUpdate=l)}if(null!==a){var d=i.baseState;for(s=0,u=c=l=null,o=a;;){var h=-536870913&o.lane,p=h!==o.lane;if(p?(ou&h)===h:(r&h)===h){0!==h&&h===Zl&&(mc=!0),null!==u&&(u=u.next={lane:0,tag:o.tag,payload:o.payload,callback:null,next:null});e:{var f=e,g=o;h=t;var m=n;switch(g.tag){case 1:if("function"==typeof(f=g.payload)){d=f.call(m,d,h);break e}d=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null==(h="function"==typeof(f=g.payload)?f.call(m,d,h):f))break e;d=sa({},d,h);break e;case 2:gc=!0}}null!==(h=o.callback)&&(e.flags|=64,p&&(e.flags|=8192),null===(p=i.callbacks)?i.callbacks=[h]:p.push(h))}else p={lane:h,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===u?(c=u=p,l=d):u=u.next=p,s|=h;if(null===(o=o.next)){if(null===(o=i.shared.pending))break;o=(p=o).next,p.next=null,i.lastBaseUpdate=p,i.shared.pending=null}}null===u&&(l=d),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=u,null===a&&(i.shared.lanes=0),gu|=s,e.lanes=s,e.memoizedState=d}}function He(e,t){if("function"!=typeof e)throw Error(r(191,e));e.call(t)}function Ve(e,t){var n=e.callbacks;if(null!==n)for(e.callbacks=null,e=0;e<n.length;e++)He(n[e],t)}function Ue(e,t){p(yc,e=pu),p(xc,t),pu=e|t.baseLanes}function Qe(){p(yc,pu),p(xc,xc.current)}function Ye(){pu=yc.current,h(xc),h(yc)}function Xe(e){var t=e.alternate;p(Sc,1&Sc.current),p(vc,e),null===bc&&(null===t||null!==xc.current||null!==t.memoizedState)&&(bc=e)}function Ke(e){p(Sc,Sc.current),p(vc,e),null===bc&&(bc=e)}function Je(e){22===e.tag?(p(Sc,Sc.current),p(vc,e),null===bc&&(bc=e)):Ze()}function Ze(){p(Sc,Sc.current),p(vc,vc.current)}function et(e){h(vc),bc===e&&(bc=null),h(Sc)}function tt(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||Ws(n)||qs(n)))return t}else if(19!==t.tag||"forwards"!==t.memoizedProps.revealOrder&&"backwards"!==t.memoizedProps.revealOrder&&"unstable_legacy-backwards"!==t.memoizedProps.revealOrder&&"together"!==t.memoizedProps.revealOrder){if(null!==t.child){t.child.return=t,t=t.child;continue}}else if(128&t.flags)return t;if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}function nt(){throw Error(r(321))}function rt(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!fl(e[n],t[n]))return!1;return!0}function it(e,t,n,r,i,a){return _c=a,Cc=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ka.H=null===e||null===e.memoizedState?Nc:Rc,Pc=!1,a=n(r,i),Pc=!1,Ac&&(a=st(t,n,r,i)),at(e),a}function at(e){ka.H=Mc;var t=null!==wc&&null!==wc.next;if(_c=0,kc=wc=Cc=null,jc=!1,zc=0,Ic=null,t)throw Error(r(300));null===e||Oc||null!==(e=e.dependencies)&&Z(e)&&(Oc=!0)}function st(e,t,n,i){Cc=e;var a=0;do{if(Ac&&(Ic=null),zc=0,Ac=!1,25<=a)throw Error(r(301));if(a+=1,kc=wc=null,null!=e.updateQueue){var s=e.updateQueue;s.lastEffect=null,s.events=null,s.stores=null,null!=s.memoCache&&(s.memoCache.index=0)}ka.H=Dc,s=t(n,i)}while(Ac);return s}function ot(){var e=ka.H,t=e.useState()[0];return t="function"==typeof t.then?pt(t):t,e=e.useState()[0],(null!==wc?wc.memoizedState:null)!==e&&(Cc.flags|=1024),t}function lt(){var e=0!==Tc;return Tc=0,e}function ct(e,t,n){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n}function ut(e){if(jc){for(e=e.memoizedState;null!==e;){var t=e.queue;null!==t&&(t.pending=null),e=e.next}jc=!1}_c=0,kc=wc=Cc=null,Ac=!1,zc=Tc=0,Ic=null}function dt(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===kc?Cc.memoizedState=kc=e:kc=kc.next=e,kc}function ht(){if(null===wc){var e=Cc.alternate;e=null!==e?e.memoizedState:null}else e=wc.next;var t=null===kc?Cc.memoizedState:kc.next;if(null!==t)kc=t,wc=e;else{if(null===e){if(null===Cc.alternate)throw Error(r(467));throw Error(r(310))}e={memoizedState:(wc=e).memoizedState,baseState:wc.baseState,baseQueue:wc.baseQueue,queue:wc.queue,next:null},null===kc?Cc.memoizedState=kc=e:kc=kc.next=e}return kc}function pt(e){var t=zc;return zc+=1,null===Ic&&(Ic=[]),e=Se(Ic,e,t),t=Cc,null===(null===kc?t.memoizedState:kc.next)&&(t=t.alternate,ka.H=null===t||null===t.memoizedState?Nc:Rc),e}function ft(e){if(null!==e&&"object"==typeof e){if("function"==typeof e.then)return pt(e);if(e.$$typeof===fa)return te(e)}throw Error(r(438,String(e)))}function gt(e){var t=null,n=Cc.updateQueue;if(null!==n&&(t=n.memoCache),null==t){var r=Cc.alternate;null!==r&&null!==(r=r.updateQueue)&&null!=(r=r.memoCache)&&(t={data:r.data.map(function(e){return e.slice()}),index:0})}if(null==t&&(t={data:[],index:0}),null===n&&(n={lastEffect:null,events:null,stores:null,memoCache:null},Cc.updateQueue=n),n.memoCache=t,void 0===(n=t.data[t.index]))for(n=t.data[t.index]=Array(e),r=0;r<e;r++)n[r]=Sa;return t.index++,n}function mt(e,t){return"function"==typeof t?t(e):t}function xt(e){return yt(ht(),wc,e)}function yt(e,t,n){var i=e.queue;if(null===i)throw Error(r(311));i.lastRenderedReducer=n;var a=e.baseQueue,s=i.pending;if(null!==s){if(null!==a){var o=a.next;a.next=s.next,s.next=o}t.baseQueue=a=s,i.pending=null}if(s=e.baseState,null===a)e.memoizedState=s;else{var l=o=null,c=null,u=t=a.next,d=!1;do{var h=-536870913&u.lane;if(h!==u.lane?(ou&h)===h:(_c&h)===h){var p=u.revertLane;if(0===p)null!==c&&(c=c.next={lane:0,revertLane:0,gesture:null,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),h===Zl&&(d=!0);else{if((_c&p)===p){u=u.next,p===Zl&&(d=!0);continue}h={lane:0,revertLane:u.revertLane,gesture:null,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},null===c?(l=c=h,o=s):c=c.next=h,Cc.lanes|=p,gu|=p}h=u.action,Pc&&n(s,h),s=u.hasEagerState?u.eagerState:n(s,h)}else p={lane:h,revertLane:u.revertLane,gesture:u.gesture,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},null===c?(l=c=p,o=s):c=c.next=p,Cc.lanes|=h,gu|=h;u=u.next}while(null!==u&&u!==t);if(null===c?o=s:c.next=l,!fl(s,e.memoizedState)&&(Oc=!0,d&&null!==(n=ec)))throw n;e.memoizedState=s,e.baseState=o,e.baseQueue=c,i.lastRenderedState=s}return null===a&&(i.lanes=0),[e.memoizedState,i.dispatch]}function vt(e){var t=ht(),n=t.queue;if(null===n)throw Error(r(311));n.lastRenderedReducer=e;var i=n.dispatch,a=n.pending,s=t.memoizedState;if(null!==a){n.pending=null;var o=a=a.next;do{s=e(s,o.action),o=o.next}while(o!==a);fl(s,t.memoizedState)||(Oc=!0),t.memoizedState=s,null===t.baseQueue&&(t.baseState=s),n.lastRenderedState=s}return[s,i]}function bt(e,t,n){var i=Cc,a=ht(),s=Nl;if(s){if(void 0===n)throw Error(r(407));n=n()}else n=t();var o=!fl((wc||a).memoizedState,n);if(o&&(a.memoizedState=n,Oc=!0),a=a.queue,Ht(Ct.bind(null,i,a,e),[e]),a.getSnapshot!==t||o||null!==kc&&1&kc.memoizedState.tag){if(i.flags|=2048,Ft(9,{destroy:void 0},_t.bind(null,i,a,n,t),null),null===au)throw Error(r(349));s||127&_c||St(i,t,n)}return n}function St(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=Cc.updateQueue)?(t={lastEffect:null,events:null,stores:null,memoCache:null},Cc.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function _t(e,t,n,r){t.value=n,t.getSnapshot=r,wt(t)&&kt(e)}function Ct(e,t,n){return n(function(){wt(t)&&kt(e)})}function wt(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!fl(e,n)}catch(r){return!0}}function kt(e){var t=Me(e,2);null!==t&&si(t,0,2)}function jt(e){var t=dt();if("function"==typeof e){var n=e;if(e=n(),Pc){j(!0);try{n()}finally{j(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:mt,lastRenderedState:e},t}function At(e,t,n,r){return e.baseState=n,yt(e,wc,"function"==typeof r?r:mt)}function Pt(e,t,n,i,a){if(pn(e))throw Error(r(485));if(null!==(e=t.action)){var s={payload:a,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(e){s.listeners.push(e)}};null!==ka.T?n(!0):s.isTransition=!1,i(s),null===(n=t.pending)?(s.next=t.pending=s,Tt(t,s)):(s.next=n.next,t.pending=n.next=s)}}function Tt(e,t){var n=t.action,r=t.payload,i=e.state;if(t.isTransition){var a=ka.T,s={};ka.T=s;try{var o=n(i,r),l=ka.S;null!==l&&l(s,o),zt(e,t,o)}catch(c){Et(e,t,c)}finally{null!==a&&null!==s.types&&(a.types=s.types),ka.T=a}}else try{zt(e,t,a=n(i,r))}catch(u){Et(e,t,u)}}function zt(e,t,n){null!==n&&"object"==typeof n&&"function"==typeof n.then?n.then(function(n){It(e,t,n)},function(n){return Et(e,t,n)}):It(e,t,n)}function It(e,t,n){t.status="fulfilled",t.value=n,Mt(t),e.state=n,null!==(t=e.pending)&&((n=t.next)===t?e.pending=null:(n=n.next,t.next=n,Tt(e,n)))}function Et(e,t,n){var r=e.pending;if(e.pending=null,null!==r){r=r.next;do{t.status="rejected",t.reason=n,Mt(t),t=t.next}while(t!==r)}e.action=null}function Mt(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function Nt(e,t){return t}function Rt(e,t){if(Nl){var n=au.formState;if(null!==n){e:{var r=Cc;if(Nl){if(Ml){var i=Hs(Ml,Dl);if(i){Ml=Us(i),r=Vs(i);break e}}W(r)}r=!1}r&&(t=n[0])}}(n=dt()).memoizedState=n.baseState=t,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Nt,lastRenderedState:t},n.queue=r,n=un.bind(null,Cc,r),r.dispatch=n,r=jt(!1);var a=hn.bind(null,Cc,!1,r.queue);return i={state:t,dispatch:null,action:e,pending:null},(r=dt()).queue=i,n=Pt.bind(null,Cc,i,a,n),i.dispatch=n,r.memoizedState=e,[t,n,!1]}function Dt(e){return Lt(ht(),wc,e)}function Lt(e,t,n){if(t=yt(e,t,Nt)[0],e=xt(mt)[0],"object"==typeof t&&null!==t&&"function"==typeof t.then)try{var r=pt(t)}catch(s){if(s===rc)throw ac;throw s}else r=t;var i=(t=ht()).queue,a=i.dispatch;return n!==t.memoizedState&&(Cc.flags|=2048,Ft(9,{destroy:void 0},Gt.bind(null,i,n),null)),[r,a,e]}function Gt(e,t){e.action=t}function Ot(e){var t=ht(),n=wc;if(null!==n)return Lt(t,n,e);ht(),t=t.memoizedState;var r=(n=ht()).queue.dispatch;return n.memoizedState=e,[t,r,!1]}function Ft(e,t,n,r){return e={tag:e,create:n,deps:r,inst:t,next:null},null===(t=Cc.updateQueue)&&(t={lastEffect:null,events:null,stores:null,memoCache:null},Cc.updateQueue=t),null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Wt(){return ht().memoizedState}function qt(e,t,n,r){var i=dt();Cc.flags|=e,i.memoizedState=Ft(1|t,{destroy:void 0},n,void 0===r?null:r)}function Bt(e,t,n,r){var i=ht();r=void 0===r?null:r;var a=i.memoizedState.inst;null!==wc&&null!==r&&rt(r,wc.memoizedState.deps)?i.memoizedState=Ft(t,a,n,r):(Cc.flags|=e,i.memoizedState=Ft(1|t,a,n,r))}function $t(e,t){qt(8390656,8,e,t)}function Ht(e,t){Bt(2048,8,e,t)}function Vt(e){var t=ht().memoizedState;return function(e){Cc.flags|=4;var t=Cc.updateQueue;if(null===t)t={lastEffect:null,events:null,stores:null,memoCache:null},Cc.updateQueue=t,t.events=[e];else{var n=t.events;null===n?t.events=[e]:n.push(e)}}({ref:t,nextImpl:e}),function(){if(2&iu)throw Error(r(440));return t.impl.apply(void 0,arguments)}}function Ut(e,t){return Bt(4,2,e,t)}function Qt(e,t){return Bt(4,4,e,t)}function Yt(e,t){if("function"==typeof t){e=e();var n=t(e);return function(){"function"==typeof n?n():t(null)}}if(null!=t)return e=e(),t.current=e,function(){t.current=null}}function Xt(e,t,n){n=null!=n?n.concat([e]):null,Bt(4,4,Yt.bind(null,t,e),n)}function Kt(){}function Jt(e,t){var n=ht();t=void 0===t?null:t;var r=n.memoizedState;return null!==t&&rt(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Zt(e,t){var n=ht();t=void 0===t?null:t;var r=n.memoizedState;if(null!==t&&rt(t,r[1]))return r[0];if(r=e(),Pc){j(!0);try{e()}finally{j(!1)}}return n.memoizedState=[r,t],r}function en(e,t,n){return void 0===n||1073741824&_c&&!(261930&ou)?e.memoizedState=t:(e.memoizedState=n,e=ai(),Cc.lanes|=e,gu|=e,n)}function tn(e,t,n,r){return fl(n,t)?n:null!==xc.current?(e=en(e,n,r),fl(e,t)||(Oc=!0),e):42&_c&&(!(1073741824&_c)||261930&ou)?(e=ai(),Cc.lanes|=e,gu|=e,t):(Oc=!0,e.memoizedState=n)}function nn(e,t,n,r,i){var a=Ya();Qa(0!==a&&8>a?a:8);var s,o,l,c=ka.T,u={};ka.T=u,hn(e,!1,t,n);try{var d=i(),h=ka.S;null!==h&&h(u,d),null!==d&&"object"==typeof d&&"function"==typeof d.then?dn(e,t,(s=r,o=[],l={status:"pending",value:null,reason:null,then:function(e){o.push(e)}},d.then(function(){l.status="fulfilled",l.value=s;for(var e=0;e<o.length;e++)(0,o[e])(s)},function(e){for(l.status="rejected",l.reason=e,e=0;e<o.length;e++)(0,o[e])(void 0)}),l),ii()):dn(e,t,r,ii())}catch(p){dn(e,t,{then:function(){},status:"rejected",reason:p},ii())}finally{Qa(a),null!==c&&null!==u.types&&(c.types=u.types),ka.T=c}}function rn(e){var t=e.memoizedState;if(null!==t)return t;var n={};return(t={memoizedState:ss,baseState:ss,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:mt,lastRenderedState:ss},next:null}).next={memoizedState:n,baseState:n,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:mt,lastRenderedState:n},next:null},e.memoizedState=t,null!==(e=e.alternate)&&(e.memoizedState=t),t}function an(){return te(os)}function sn(){return ht().memoizedState}function on(){return ht().memoizedState}function ln(e){for(var t=e.return;null!==t;){switch(t.tag){case 24:case 3:var n=ii(),r=Fe(t,e=Oe(n),n);return null!==r&&(si(r,0,n),We(r,t,n)),t={cache:ie()},void(e.payload=t)}t=t.return}}function cn(e,t,n){var r=ii();n={lane:r,revertLane:0,gesture:null,action:n,hasEagerState:!1,eagerState:null,next:null},pn(e)?fn(t,n):null!==(n=Ee(e,t,n,r))&&(si(n,0,r),gn(n,t,r))}function un(e,t,n){dn(e,t,n,ii())}function dn(e,t,n,r){var i={lane:r,revertLane:0,gesture:null,action:n,hasEagerState:!1,eagerState:null,next:null};if(pn(e))fn(t,i);else{var a=e.alternate;if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var s=t.lastRenderedState,o=a(s,n);if(i.hasEagerState=!0,i.eagerState=o,fl(o,s))return Ie(e,t,i,0),null===au&&ze(),!1}catch(l){}if(null!==(n=Ee(e,t,i,r)))return si(n,0,r),gn(n,t,r),!0}return!1}function hn(e,t,n,i){if(i={lane:2,revertLane:fe(),gesture:null,action:i,hasEagerState:!1,eagerState:null,next:null},pn(e)){if(t)throw Error(r(479))}else null!==(t=Ee(e,n,i,2))&&si(t,0,2)}function pn(e){var t=e.alternate;return e===Cc||null!==t&&t===Cc}function fn(e,t){Ac=jc=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function gn(e,t,n){if(4194048&n){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,_(e,n)}}function mn(e,t,n,r){n=null==(n=n(r,t=e.memoizedState))?t:sa({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}function xn(e,t,n,r,i,a,s){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,a,s):!(t.prototype&&t.prototype.isPureReactComponent&&ve(n,r)&&ve(i,a))}function yn(e,t,n,r){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&Lc.enqueueReplaceState(t,t.state,null)}function vn(e,t){var n=t;if("ref"in t)for(var r in n={},t)"ref"!==r&&(n[r]=t[r]);if(e=e.defaultProps)for(var i in n===t&&(n=sa({},n)),e)void 0===n[i]&&(n[i]=e[i]);return n}function bn(e,t){try{(0,e.onUncaughtError)(t.value,{componentStack:t.stack})}catch(n){setTimeout(function(){throw n})}}function Sn(e,t,n){try{(0,e.onCaughtError)(n.value,{componentStack:n.stack,errorBoundary:1===t.tag?t.stateNode:null})}catch(r){setTimeout(function(){throw r})}}function _n(e,t,n){return(n=Oe(n)).tag=3,n.payload={element:null},n.callback=function(){bn(e,t)},n}function Cn(e){return(e=Oe(e)).tag=3,e}function wn(e,t,n,r){var i=n.type.getDerivedStateFromError;if("function"==typeof i){var a=r.value;e.payload=function(){return i(a)},e.callback=function(){Sn(t,n,r)}}var s=n.stateNode;null!==s&&"function"==typeof s.componentDidCatch&&(e.callback=function(){Sn(t,n,r),"function"!=typeof i&&(null===Au?Au=new Set([this]):Au.add(this));var e=r.stack;this.componentDidCatch(r.value,{componentStack:null!==e?e:""})})}function kn(e,t,n,r){t.child=null===e?dc(t,null,n,r):uc(t,e.child,n,r)}function jn(e,t,n,r,i){n=n.render;var a=t.ref;if("ref"in r){var s={};for(var o in r)"ref"!==o&&(s[o]=r[o])}else s=r;return ee(t),r=it(e,t,n,s,a,i),o=lt(),null===e||Oc?(Nl&&o&&N(t),t.flags|=1,kn(e,t,r,i),t.child):(ct(e,t,i),Qn(e,t,i))}function An(e,t,n,r,i){if(null===e){var a=n.type;return"function"!=typeof a||qi(a)||void 0!==a.defaultProps||null!==n.compare?((e=Hi(n.type,null,r,t,t.mode,i)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,Pn(e,t,a,r,i))}if(a=e.child,!Yn(e,i)){var s=a.memoizedProps;if((n=null!==(n=n.compare)?n:ve)(s,r)&&e.ref===t.ref)return Qn(e,t,i)}return t.flags|=1,(e=Bi(a,r)).ref=t.ref,e.return=t,t.child=e}function Pn(e,t,n,r,i){if(null!==e){var a=e.memoizedProps;if(ve(a,r)&&e.ref===t.ref){if(Oc=!1,t.pendingProps=r=a,!Yn(e,i))return t.lanes=e.lanes,Qn(e,t,i);131072&e.flags&&(Oc=!0)}}return Rn(e,t,n,r,i)}function Tn(e,t,n,r){var i=r.children,a=null!==e?e.memoizedState:null;if(null===e&&null===t.stateNode&&(t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),"hidden"===r.mode){if(128&t.flags){if(a=null!==a?a.baseLanes|n:n,null!==e){for(r=t.child=e.child,i=0;null!==r;)i=i|r.lanes|r.childLanes,r=r.sibling;r=i&~a}else r=0,t.child=null;return In(e,t,a,n,r)}if(!(536870912&n))return r=t.lanes=536870912,In(e,t,null!==a?a.baseLanes|n:n,n,r);t.memoizedState={baseLanes:0,cachePool:null},null!==e&&xe(0,null!==a?a.cachePool:null),null!==a?Ue(t,a):Qe(),Je(t)}else null!==a?(xe(0,a.cachePool),Ue(t,a),Ze(),t.memoizedState=null):(null!==e&&xe(0,null),Qe(),Ze());return kn(e,t,i,n),t.child}function zn(e,t){return null!==e&&22===e.tag||null!==t.stateNode||(t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),t.sibling}function In(e,t,n,r,i){var a=me();return a=null===a?null:{parent:qa?$l._currentValue:$l._currentValue2,pool:a},t.memoizedState={baseLanes:n,cachePool:a},null!==e&&xe(0,null),Qe(),Je(t),null!==e&&J(e,t,r,!0),t.childLanes=i,null}function En(e,t){return(t=Bn({mode:t.mode,children:t.children},e.mode)).ref=e.ref,e.child=t,t.return=e,t}function Mn(e,t,n){return uc(t,e.child,null,n),(e=En(t,t.pendingProps)).flags|=2,et(t),t.memoizedState=null,e}function Nn(e,t){var n=t.ref;if(null===n)null!==e&&null!==e.ref&&(t.flags|=4194816);else{if("function"!=typeof n&&"object"!=typeof n)throw Error(r(284));null!==e&&e.ref===n||(t.flags|=4194816)}}function Rn(e,t,n,r,i){return ee(t),n=it(e,t,n,r,void 0,i),r=lt(),null===e||Oc?(Nl&&r&&N(t),t.flags|=1,kn(e,t,n,i),t.child):(ct(e,t,i),Qn(e,t,i))}function Dn(e,t,n,r,i,a){return ee(t),t.updateQueue=null,n=st(t,r,n,i),at(e),r=lt(),null===e||Oc?(Nl&&r&&N(t),t.flags|=1,kn(e,t,n,a),t.child):(ct(e,t,a),Qn(e,t,a))}function Ln(e,t,n,r,i){if(ee(t),null===t.stateNode){var a=Qo,s=n.contextType;"object"==typeof s&&null!==s&&(a=te(s)),a=new n(r,a),t.memoizedState=null!==a.state&&void 0!==a.state?a.state:null,a.updater=Lc,t.stateNode=a,a._reactInternals=t,(a=t.stateNode).props=r,a.state=t.memoizedState,a.refs={},Le(t),s=n.contextType,a.context="object"==typeof s&&null!==s?te(s):Qo,a.state=t.memoizedState,"function"==typeof(s=n.getDerivedStateFromProps)&&(mn(t,n,s,r),a.state=t.memoizedState),"function"==typeof n.getDerivedStateFromProps||"function"==typeof a.getSnapshotBeforeUpdate||"function"!=typeof a.UNSAFE_componentWillMount&&"function"!=typeof a.componentWillMount||(s=a.state,"function"==typeof a.componentWillMount&&a.componentWillMount(),"function"==typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount(),s!==a.state&&Lc.enqueueReplaceState(a,a.state,null),$e(t,r,a,i),Be(),a.state=t.memoizedState),"function"==typeof a.componentDidMount&&(t.flags|=4194308),r=!0}else if(null===e){a=t.stateNode;var o=t.memoizedProps,l=vn(n,o);a.props=l;var c=a.context,u=n.contextType;s=Qo,"object"==typeof u&&null!==u&&(s=te(u));var d=n.getDerivedStateFromProps;u="function"==typeof d||"function"==typeof a.getSnapshotBeforeUpdate,o=t.pendingProps!==o,u||"function"!=typeof a.UNSAFE_componentWillReceiveProps&&"function"!=typeof a.componentWillReceiveProps||(o||c!==s)&&yn(t,a,r,s),gc=!1;var h=t.memoizedState;a.state=h,$e(t,r,a,i),Be(),c=t.memoizedState,o||h!==c||gc?("function"==typeof d&&(mn(t,n,d,r),c=t.memoizedState),(l=gc||xn(t,n,l,r,h,c,s))?(u||"function"!=typeof a.UNSAFE_componentWillMount&&"function"!=typeof a.componentWillMount||("function"==typeof a.componentWillMount&&a.componentWillMount(),"function"==typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"==typeof a.componentDidMount&&(t.flags|=4194308)):("function"==typeof a.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=c),a.props=r,a.state=c,a.context=s,r=l):("function"==typeof a.componentDidMount&&(t.flags|=4194308),r=!1)}else{a=t.stateNode,Ge(e,t),u=vn(n,s=t.memoizedProps),a.props=u,d=t.pendingProps,h=a.context,c=n.contextType,l=Qo,"object"==typeof c&&null!==c&&(l=te(c)),(c="function"==typeof(o=n.getDerivedStateFromProps)||"function"==typeof a.getSnapshotBeforeUpdate)||"function"!=typeof a.UNSAFE_componentWillReceiveProps&&"function"!=typeof a.componentWillReceiveProps||(s!==d||h!==l)&&yn(t,a,r,l),gc=!1,h=t.memoizedState,a.state=h,$e(t,r,a,i),Be();var p=t.memoizedState;s!==d||h!==p||gc||null!==e&&null!==e.dependencies&&Z(e.dependencies)?("function"==typeof o&&(mn(t,n,o,r),p=t.memoizedState),(u=gc||xn(t,n,u,r,h,p,l)||null!==e&&null!==e.dependencies&&Z(e.dependencies))?(c||"function"!=typeof a.UNSAFE_componentWillUpdate&&"function"!=typeof a.componentWillUpdate||("function"==typeof a.componentWillUpdate&&a.componentWillUpdate(r,p,l),"function"==typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(r,p,l)),"function"==typeof a.componentDidUpdate&&(t.flags|=4),"function"==typeof a.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!=typeof a.componentDidUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!=typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=p),a.props=r,a.state=p,a.context=l,r=u):("function"!=typeof a.componentDidUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!=typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),r=!1)}return a=r,Nn(e,t),r=!!(128&t.flags),a||r?(a=t.stateNode,n=r&&"function"!=typeof n.getDerivedStateFromError?null:a.render(),t.flags|=1,null!==e&&r?(t.child=uc(t,e.child,null,i),t.child=uc(t,null,n,i)):kn(e,t,n,i),t.memoizedState=a.state,e=t.child):e=Qn(e,t,i),e}function Gn(e,t,n,r){return H(),t.flags|=256,kn(e,t,n,r),t.child}function On(e){return{baseLanes:e,cachePool:ye()}}function Fn(e,t,n){return e=null!==e?e.childLanes&~n:0,t&&(e|=yu),e}function Wn(e,t,n){var i,a=t.pendingProps,s=!1,o=!!(128&t.flags);if((i=o)||(i=(null===e||null!==e.memoizedState)&&!!(2&Sc.current)),i&&(s=!0,t.flags&=-129),i=!!(32&t.flags),t.flags&=-33,null===e){if(Nl){if(s?Xe(t):Ze(),(e=Ml)?null!==(e=ro(e,Dl))&&(t.memoizedState={dehydrated:e,treeContext:null!==kl?{id:jl,overflow:Al}:null,retryLane:536870912,hydrationErrors:null},(n=Qi(e)).return=t,t.child=n,El=t,Ml=null):e=null,null===e)throw W(t);return qs(e)?t.lanes=32:t.lanes=536870912,null}var l=a.children;return a=a.fallback,s?(Ze(),l=Bn({mode:"hidden",children:l},s=t.mode),a=Vi(a,s,n,null),l.return=t,a.return=t,l.sibling=a,t.child=l,(a=t.child).memoizedState=On(n),a.childLanes=Fn(e,i,n),t.memoizedState=Fc,zn(null,a)):(Xe(t),qn(t,l))}var c=e.memoizedState;if(null!==c&&null!==(l=c.dehydrated)){if(o)256&t.flags?(Xe(t),t.flags&=-257,t=$n(e,t,n)):null!==t.memoizedState?(Ze(),t.child=e.child,t.flags|=128,t=null):(Ze(),l=a.fallback,s=t.mode,a=Bn({mode:"visible",children:a.children},s),(l=Vi(l,s,n,null)).flags|=2,a.return=t,l.return=t,a.sibling=l,t.child=a,uc(t,e.child,null,n),(a=t.child).memoizedState=On(n),a.childLanes=Fn(e,i,n),t.memoizedState=Fc,t=zn(null,a));else if(Xe(t),qs(l))i=Bs(l).digest,(a=Error(r(419))).stack="",a.digest=i,U({value:a,source:null,stack:null}),t=$n(e,t,n);else if(Oc||J(e,t,n,!1),i=0!==(n&e.childLanes),Oc||i){if(null!==(i=au)&&0!==(a=C(i,n))&&a!==c.retryLane)throw c.retryLane=a,Me(e,a),si(i,0,a),Gc;Ws(l)||yi(),t=$n(e,t,n)}else Ws(l)?(t.flags|=192,t.child=e.child,t=null):(e=c.treeContext,Ha&&(Ml=Js(l),El=t,Nl=!0,Rl=null,Dl=!1,null!==e&&D(t,e)),(t=qn(t,a.children)).flags|=4096);return t}return s?(Ze(),l=a.fallback,s=t.mode,o=(c=e.child).sibling,(a=Bi(c,{mode:"hidden",children:a.children})).subtreeFlags=65011712&c.subtreeFlags,null!==o?l=Bi(o,l):(l=Vi(l,s,n,null)).flags|=2,l.return=t,a.return=t,a.sibling=l,t.child=a,zn(null,a),a=t.child,null===(l=e.child.memoizedState)?l=On(n):(null!==(s=l.cachePool)?(c=qa?$l._currentValue:$l._currentValue2,s=s.parent!==c?{parent:c,pool:c}:s):s=ye(),l={baseLanes:l.baseLanes|n,cachePool:s}),a.memoizedState=l,a.childLanes=Fn(e,i,n),t.memoizedState=Fc,zn(e.child,a)):(Xe(t),e=(n=e.child).sibling,(n=Bi(n,{mode:"visible",children:a.children})).return=t,n.sibling=null,null!==e&&(null===(i=t.deletions)?(t.deletions=[e],t.flags|=16):i.push(e)),t.child=n,t.memoizedState=null,n)}function qn(e,t){return(t=Bn({mode:"visible",children:t},e.mode)).return=e,e.child=t}function Bn(e,n){return(e=t(22,e,null,n)).lanes=0,e}function $n(e,t,n){return uc(t,e.child,null,n),(e=qn(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Hn(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),X(e.return,t,n)}function Vn(e,t,n,r,i,a){var s=e.memoizedState;null===s?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i,treeForkCount:a}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=n,s.tailMode=i,s.treeForkCount=a)}function Un(e,t,n){var r=t.pendingProps,i=r.revealOrder,a=r.tail;r=r.children;var s=Sc.current,o=!!(2&s);if(o?(s=1&s|2,t.flags|=128):s&=1,p(Sc,s),kn(e,t,r,n),r=Nl?_l:0,!o&&null!==e&&128&e.flags)e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Hn(e,n,t);else if(19===e.tag)Hn(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}switch(i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===tt(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),Vn(t,!1,i,n,a,r);break;case"backwards":case"unstable_legacy-backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===tt(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}Vn(t,!0,n,null,a,r);break;case"together":Vn(t,!1,null,null,void 0,r);break;default:t.memoizedState=null}return t.child}function Qn(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),gu|=t.lanes,0===(n&t.childLanes)){if(null===e)return null;if(J(e,t,n,!1),0===(n&t.childLanes))return null}if(null!==e&&t.child!==e.child)throw Error(r(153));if(null!==t.child){for(n=Bi(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Bi(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Yn(e,t){return 0!==(e.lanes&t)||!(null===(e=e.dependencies)||!Z(e))}function Xn(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps)Oc=!0;else{if(!(Yn(e,n)||128&t.flags))return Oc=!1,function(e,t,n){switch(t.tag){case 3:L(t,t.stateNode.containerInfo),Q(0,$l,e.memoizedState.cache),H();break;case 27:case 5:O(t);break;case 4:L(t,t.stateNode.containerInfo);break;case 10:Q(0,t.type,t.memoizedProps.value);break;case 31:if(null!==t.memoizedState)return t.flags|=128,Ke(t),null;break;case 13:var r=t.memoizedState;if(null!==r)return null!==r.dehydrated?(Xe(t),t.flags|=128,null):0!==(n&t.child.childLanes)?Wn(e,t,n):(Xe(t),null!==(e=Qn(e,t,n))?e.sibling:null);Xe(t);break;case 19:var i=!!(128&e.flags);if((r=0!==(n&t.childLanes))||(J(e,t,n,!1),r=0!==(n&t.childLanes)),i){if(r)return Un(e,t,n);t.flags|=128}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),p(Sc,Sc.current),r)break;return null;case 22:return t.lanes=0,Tn(e,t,n,t.pendingProps);case 24:Q(0,$l,e.memoizedState.cache)}return Qn(e,t,n)}(e,t,n);Oc=!!(131072&e.flags)}else Oc=!1,Nl&&1048576&t.flags&&M(t,_l,t.index);switch(t.lanes=0,t.tag){case 16:e:{var i=t.pendingProps;if(e=_e(t.elementType),t.type=e,"function"!=typeof e){if(null!=e){var a=e.$$typeof;if(a===ga){t.tag=11,t=jn(null,t,e,i,n);break e}if(a===ya){t.tag=14,t=An(null,t,e,i,n);break e}}throw t=u(e)||e,Error(r(306,t,""))}qi(e)?(i=vn(e,i),t.tag=1,t=Ln(null,t,e,i,n)):(t.tag=0,t=Rn(null,t,e,i,n))}return t;case 0:return Rn(e,t,t.type,t.pendingProps,n);case 1:return Ln(e,t,i=t.type,a=vn(i,t.pendingProps),n);case 3:e:{if(L(t,t.stateNode.containerInfo),null===e)throw Error(r(387));var s=t.pendingProps;i=(a=t.memoizedState).element,Ge(e,t),$e(t,s,null,n);var o=t.memoizedState;if(s=o.cache,Q(0,$l,s),s!==a.cache&&K(t,[$l],n,!0),Be(),s=o.element,Ha&&a.isDehydrated){if(a={element:s,isDehydrated:!1,cache:o.cache},t.updateQueue.baseState=a,t.memoizedState=a,256&t.flags){t=Gn(e,t,s,n);break e}if(s!==i){U(i=I(Error(r(424)),t)),t=Gn(e,t,s,n);break e}for(Ha&&(Ml=Xs(t.stateNode.containerInfo),El=t,Nl=!0,Rl=null,Dl=!0),n=dc(t,null,s,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(H(),s===i){t=Qn(e,t,n);break e}kn(e,t,s,n)}t=t.child}return t;case 26:if(jo)return Nn(e,t),null===e?(n=To(t.type,null,t.pendingProps,null))?t.memoizedState=n:Nl||(t.stateNode=Ro(t.type,t.pendingProps,zl.current,t)):t.memoizedState=To(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:if(Fo)return O(t),null===e&&Fo&&Nl&&(i=t.stateNode=Wo(t.type,t.pendingProps,zl.current,Pl.current,!1),El=t,Dl=!0,Ml=Zs(t.type,i,Ml)),kn(e,t,t.pendingProps.children,n),Nn(e,t),null===e&&(t.flags|=4194304),t.child;case 5:return null===e&&Nl&&(wo(t.type,t.pendingProps,Pl.current),(a=i=Ml)&&(null!==(i=eo(i,t.type,t.pendingProps,Dl))?(t.stateNode=i,El=t,Ml=Ys(i),Dl=!1,a=!0):a=!1),a||W(t)),O(t),a=t.type,s=t.pendingProps,o=null!==e?e.memoizedProps:null,i=s.children,La(a,s)?i=null:null!==o&&La(a,o)&&(t.flags|=32),null!==t.memoizedState&&(a=it(e,t,ot,null,null,n),qa?os._currentValue=a:os._currentValue2=a),Nn(e,t),kn(e,t,i,n),t.child;case 6:return null===e&&Nl&&(ko(t.pendingProps,Pl.current),(e=n=Ml)&&(null!==(n=to(n,t.pendingProps,Dl))?(t.stateNode=n,El=t,Ml=null,e=!0):e=!1),e||W(t)),null;case 13:return Wn(e,t,n);case 4:return L(t,t.stateNode.containerInfo),i=t.pendingProps,null===e?t.child=uc(t,null,i,n):kn(e,t,i,n),t.child;case 11:return jn(e,t,t.type,t.pendingProps,n);case 7:return kn(e,t,t.pendingProps,n),t.child;case 8:case 12:return kn(e,t,t.pendingProps.children,n),t.child;case 10:return i=t.pendingProps,Q(0,t.type,i.value),kn(e,t,i.children,n),t.child;case 9:return a=t.type._context,i=t.pendingProps.children,ee(t),i=i(a=te(a)),t.flags|=1,kn(e,t,i,n),t.child;case 14:return An(e,t,t.type,t.pendingProps,n);case 15:return Pn(e,t,t.type,t.pendingProps,n);case 19:return Un(e,t,n);case 31:return function(e,t,n){var i=t.pendingProps,a=!!(128&t.flags);if(t.flags&=-129,null===e){if(Nl){if("hidden"===i.mode)return e=En(t,i),t.lanes=536870912,zn(null,e);if(Ke(t),(e=Ml)?null!==(e=no(e,Dl))&&(t.memoizedState={dehydrated:e,treeContext:null!==kl?{id:jl,overflow:Al}:null,retryLane:536870912,hydrationErrors:null},(n=Qi(e)).return=t,t.child=n,El=t,Ml=null):e=null,null===e)throw W(t);return t.lanes=536870912,null}return En(t,i)}var s=e.memoizedState;if(null!==s){var o=s.dehydrated;if(Ke(t),a)if(256&t.flags)t.flags&=-257,t=Mn(e,t,n);else{if(null===t.memoizedState)throw Error(r(558));t.child=e.child,t.flags|=128,t=null}else if(Oc||J(e,t,n,!1),a=0!==(n&e.childLanes),Oc||a){if(null!==(i=au)&&0!==(o=C(i,n))&&o!==s.retryLane)throw s.retryLane=o,Me(e,o),si(i,0,o),Gc;yi(),t=Mn(e,t,n)}else e=s.treeContext,Ha&&(Ml=Ks(o),El=t,Nl=!0,Rl=null,Dl=!1,null!==e&&D(t,e)),(t=En(t,i)).flags|=4096;return t}return(e=Bi(e.child,{mode:i.mode,children:i.children})).ref=t.ref,t.child=e,e.return=t,e}(e,t,n);case 22:return Tn(e,t,n,t.pendingProps);case 24:return ee(t),i=te($l),null===e?(null===(a=me())&&(a=au,s=ie(),a.pooledCache=s,s.refCount++,null!==s&&(a.pooledCacheLanes|=n),a=s),t.memoizedState={parent:i,cache:a},Le(t),Q(0,$l,a)):(0!==(e.lanes&n)&&(Ge(e,t),$e(t,null,null,n),Be()),a=e.memoizedState,s=t.memoizedState,a.parent!==i?(a={parent:i,cache:i},t.memoizedState=a,0===t.lanes&&(t.memoizedState=t.updateQueue.baseState=a),Q(0,$l,i)):(i=s.cache,Q(0,$l,i),i!==a.cache&&K(t,[$l],n,!0))),kn(e,t,t.pendingProps.children,n),t.child;case 29:throw t.pendingProps}throw Error(r(156,t.tag))}function Kn(e){e.flags|=4}function Jn(e){$a&&(e.flags|=8)}function Zn(e,t){if(null!==e&&e.child===t.child)return!1;if(16&t.flags)return!0;for(e=t.child;null!==e;){if(8218&e.flags||8218&e.subtreeFlags)return!0;e=e.sibling}return!1}function er(e,t,n,r){if(Ba)for(n=t.child;null!==n;){if(5===n.tag||6===n.tag)Ra(e,n.stateNode);else if(!(4===n.tag||Fo&&27===n.tag)&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}else if($a)for(var i=t.child;null!==i;){if(5===i.tag){var a=i.stateNode;n&&r&&(a=Os(a,i.type,i.memoizedProps)),Ra(e,a)}else if(6===i.tag)a=i.stateNode,n&&r&&(a=Fs(a,i.memoizedProps)),Ra(e,a);else if(4!==i.tag)if(22===i.tag&&null!==i.memoizedState)null!==(a=i.child)&&(a.return=i),er(e,i,!0,!0);else if(null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)break;for(;null===i.sibling;){if(null===i.return||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}}function tr(e,t,n,r){var i=!1;if($a)for(var a=t.child;null!==a;){if(5===a.tag){var s=a.stateNode;n&&r&&(s=Os(s,a.type,a.memoizedProps)),Ds(e,s)}else if(6===a.tag)s=a.stateNode,n&&r&&(s=Fs(s,a.memoizedProps)),Ds(e,s);else if(4!==a.tag)if(22===a.tag&&null!==a.memoizedState)null!==(i=a.child)&&(i.return=a),tr(e,a,!0,!0),i=!0;else if(null!==a.child){a.child.return=a,a=a.child;continue}if(a===t)break;for(;null===a.sibling;){if(null===a.return||a.return===t)return i;a=a.return}a.sibling.return=a.return,a=a.sibling}return i}function nr(e,t){if($a&&Zn(e,t)){var n=(e=t.stateNode).containerInfo,r=Rs();tr(r,t,!1,!1),e.pendingChildren=r,Kn(t),Ls(n,r)}}function rr(e,t,n,r){if(Ba)e.memoizedProps!==r&&Kn(t);else if($a){var i=e.stateNode,a=e.memoizedProps;if((e=Zn(e,t))||a!==r){var s=Pl.current;(a=Ns(i,n,a,r,!e,null))===i?t.stateNode=i:(Jn(t),Da(a,n,r,s)&&Kn(t),t.stateNode=a,e&&er(a,t,!1,!1))}else t.stateNode=i}}function ir(e,t,n,r,i){if(32&e.mode&&(null===n?Za(t,r):es(t,n,r))){if(e.flags|=16777216,(335544128&i)===i||ts(t,r))if(ns(e.stateNode,t,r))e.flags|=8192;else{if(!gi())throw oc=sc,ic;e.flags|=8192}}else e.flags&=-16777217}function ar(e,t){if(Lo(t)){if(e.flags|=16777216,!Go(t)){if(!gi())throw oc=sc,ic;e.flags|=8192}}else e.flags&=-16777217}function sr(e,t){null!==t&&(e.flags|=4),16384&e.flags&&(t=22!==e.tag?y():536870912,e.lanes|=t,vu|=t)}function or(e,t){if(!Nl)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function lr(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=65011712&i.subtreeFlags,r|=65011712&i.flags,i.return=e,i=i.sibling;else for(i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function cr(e,t,n){var i=t.pendingProps;switch(R(t),t.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:case 1:return lr(t),null;case 3:return n=t.stateNode,i=null,null!==e&&(i=e.memoizedState.cache),t.memoizedState.cache!==i&&(t.flags|=2048),Y($l),G(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||($(t)?Kn(t):null===e||e.memoizedState.isDehydrated&&!(256&t.flags)||(t.flags|=1024,V())),nr(e,t),lr(t),null;case 26:if(jo){var a=t.type,s=t.memoizedState;return null===e?(Kn(t),null!==s?(lr(t),ar(t,s)):(lr(t),ir(t,a,null,i,n))):s?s!==e.memoizedState?(Kn(t),lr(t),ar(t,s)):(lr(t),t.flags&=-16777217):(s=e.memoizedProps,Ba?s!==i&&Kn(t):rr(e,t,a,i),lr(t),ir(t,a,s,i,n)),null}case 27:if(Fo){if(F(t),n=zl.current,a=t.type,null!==e&&null!=t.stateNode)Ba?e.memoizedProps!==i&&Kn(t):rr(e,t,a,i);else{if(!i){if(null===t.stateNode)throw Error(r(166));return lr(t),null}e=Pl.current,$(t)?q(t,e):(e=Wo(a,i,n,e,!0),t.stateNode=e,Kn(t))}return lr(t),null}case 5:if(F(t),a=t.type,null!==e&&null!=t.stateNode)rr(e,t,a,i);else{if(!i){if(null===t.stateNode)throw Error(r(166));return lr(t),null}if(s=Pl.current,$(t))q(t,s),go(t.stateNode,a,i,s)&&(t.flags|=64);else{var o=Na(a,i,zl.current,s,t);Jn(t),er(o,t,!1,!1),t.stateNode=o,Da(o,a,i,s)&&Kn(t)}}return lr(t),ir(t,t.type,null===e?null:e.memoizedProps,t.pendingProps,n),null;case 6:if(e&&null!=t.stateNode)n=e.memoizedProps,Ba?n!==i&&Kn(t):$a&&(n!==i?(e=zl.current,n=Pl.current,Jn(t),t.stateNode=Ga(i,e,n,t)):t.stateNode=e.stateNode);else{if("string"!=typeof i&&null===t.stateNode)throw Error(r(166));if(e=zl.current,n=Pl.current,$(t)){if(!Ha)throw Error(r(176));if(e=t.stateNode,n=t.memoizedProps,i=null,null!==(a=El))switch(a.tag){case 27:case 5:i=a.memoizedProps}ao(e,n,t,i)||W(t,!0)}else Jn(t),t.stateNode=Ga(i,e,n,t)}return lr(t),null;case 31:if(n=t.memoizedState,null===e||null!==e.memoizedState){if(i=$(t),null!==n){if(null===e){if(!i)throw Error(r(318));if(!Ha)throw Error(r(556));if(!(e=null!==(e=t.memoizedState)?e.dehydrated:null))throw Error(r(557));so(e,t)}else H(),!(128&t.flags)&&(t.memoizedState=null),t.flags|=4;lr(t),e=!1}else n=V(),null!==e&&null!==e.memoizedState&&(e.memoizedState.hydrationErrors=n),e=!0;if(!e)return 256&t.flags?(et(t),t):(et(t),null);if(128&t.flags)throw Error(r(558))}return lr(t),null;case 13:if(i=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(a=$(t),null!==i&&null!==i.dehydrated){if(null===e){if(!a)throw Error(r(318));if(!Ha)throw Error(r(344));if(!(a=null!==(a=t.memoizedState)?a.dehydrated:null))throw Error(r(317));oo(a,t)}else H(),!(128&t.flags)&&(t.memoizedState=null),t.flags|=4;lr(t),a=!1}else a=V(),null!==e&&null!==e.memoizedState&&(e.memoizedState.hydrationErrors=a),a=!0;if(!a)return 256&t.flags?(et(t),t):(et(t),null)}return et(t),128&t.flags?(t.lanes=n,t):(n=null!==i,e=null!==e&&null!==e.memoizedState,n&&(a=null,null!==(i=t.child).alternate&&null!==i.alternate.memoizedState&&null!==i.alternate.memoizedState.cachePool&&(a=i.alternate.memoizedState.cachePool.pool),s=null,null!==i.memoizedState&&null!==i.memoizedState.cachePool&&(s=i.memoizedState.cachePool.pool),s!==a&&(i.flags|=2048)),n!==e&&n&&(t.child.flags|=8192),sr(t,t.updateQueue),lr(t),null);case 4:return G(),nr(e,t),null===e&&Ua(t.stateNode.containerInfo),lr(t),null;case 10:return Y(t.type),lr(t),null;case 19:if(h(Sc),null===(i=t.memoizedState))return lr(t),null;if(a=!!(128&t.flags),null===(s=i.rendering))if(a)or(i,!1);else{if(0!==fu||null!==e&&128&e.flags)for(e=t.child;null!==e;){if(null!==(s=tt(e))){for(t.flags|=128,or(i,!1),e=s.updateQueue,t.updateQueue=e,sr(t,e),t.subtreeFlags=0,e=n,n=t.child;null!==n;)$i(n,e),n=n.sibling;return p(Sc,1&Sc.current|2),Nl&&E(t,i.treeForkCount),t.child}e=e.sibling}null!==i.tail&&al()>ku&&(t.flags|=128,a=!0,or(i,!1),t.lanes=4194304)}else{if(!a)if(null!==(e=tt(s))){if(t.flags|=128,a=!0,e=e.updateQueue,t.updateQueue=e,sr(t,e),or(i,!0),null===i.tail&&"hidden"===i.tailMode&&!s.alternate&&!Nl)return lr(t),null}else 2*al()-i.renderingStartTime>ku&&536870912!==n&&(t.flags|=128,a=!0,or(i,!1),t.lanes=4194304);i.isBackwards?(s.sibling=t.child,t.child=s):(null!==(e=i.last)?e.sibling=s:t.child=s,i.last=s)}return null!==i.tail?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=al(),e.sibling=null,n=Sc.current,p(Sc,a?1&n|2:1&n),Nl&&E(t,i.treeForkCount),e):(lr(t),null);case 22:case 23:return et(t),Ye(),i=null!==t.memoizedState,null!==e?null!==e.memoizedState!==i&&(t.flags|=8192):i&&(t.flags|=8192),i?!!(536870912&n)&&!(128&t.flags)&&(lr(t),6&t.subtreeFlags&&(t.flags|=8192)):lr(t),null!==(n=t.updateQueue)&&sr(t,n.retryQueue),n=null,null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),i=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(i=t.memoizedState.cachePool.pool),i!==n&&(t.flags|=2048),null!==e&&h(nc),null;case 24:return n=null,null!==e&&(n=e.memoizedState.cache),t.memoizedState.cache!==n&&(t.flags|=2048),Y($l),lr(t),null;case 25:case 30:return null}throw Error(r(156,t.tag))}function ur(e,t){switch(R(t),t.tag){case 1:return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Y($l),G(),65536&(e=t.flags)&&!(128&e)?(t.flags=-65537&e|128,t):null;case 26:case 27:case 5:return F(t),null;case 31:if(null!==t.memoizedState){if(et(t),null===t.alternate)throw Error(r(340));H()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 13:if(et(t),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(r(340));H()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return h(Sc),null;case 4:return G(),null;case 10:return Y(t.type),null;case 22:case 23:return et(t),Ye(),null!==e&&h(nc),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 24:return Y($l),null;default:return null}}function dr(e,t){switch(R(t),t.tag){case 3:Y($l),G();break;case 26:case 27:case 5:F(t);break;case 4:G();break;case 31:null!==t.memoizedState&&et(t);break;case 13:et(t);break;case 19:h(Sc);break;case 10:Y(t.type);break;case 22:case 23:et(t),Ye(),null!==e&&h(nc);break;case 24:Y($l)}}function hr(e,t){try{var n=t.updateQueue,r=null!==n?n.lastEffect:null;if(null!==r){var i=r.next;n=i;do{if((n.tag&e)===e){r=void 0;var a=n.create,s=n.inst;r=a(),s.destroy=r}n=n.next}while(n!==i)}}catch(o){Ri(t,t.return,o)}}function pr(e,t,n){try{var r=t.updateQueue,i=null!==r?r.lastEffect:null;if(null!==i){var a=i.next;r=a;do{if((r.tag&e)===e){var s=r.inst,o=s.destroy;if(void 0!==o){s.destroy=void 0,i=t;var l=n,c=o;try{c()}catch(u){Ri(i,l,u)}}}r=r.next}while(r!==a)}}catch(u){Ri(t,t.return,u)}}function fr(e){var t=e.updateQueue;if(null!==t){var n=e.stateNode;try{Ve(t,n)}catch(r){Ri(e,e.return,r)}}}function gr(e,t,n){n.props=vn(e.type,e.memoizedProps),n.state=e.memoizedState;try{n.componentWillUnmount()}catch(r){Ri(e,t,r)}}function mr(e,t){try{var n=e.ref;if(null!==n){switch(e.tag){case 26:case 27:case 5:var r=Ta(e.stateNode);break;default:r=e.stateNode}"function"==typeof n?e.refCleanup=n(r):n.current=r}}catch(i){Ri(e,t,i)}}function xr(e,t){var n=e.ref,r=e.refCleanup;if(null!==n)if("function"==typeof r)try{r()}catch(i){Ri(e,t,i)}finally{e.refCleanup=null,null!=(e=e.alternate)&&(e.refCleanup=null)}else if("function"==typeof n)try{n(null)}catch(a){Ri(e,t,a)}else n.current=null}function yr(e){var t=e.type,n=e.memoizedProps,r=e.stateNode;try{_s(r,t,n,e)}catch(i){Ri(e,e.return,i)}}function vr(e,t,n){try{Cs(e.stateNode,e.type,n,t,e)}catch(r){Ri(e,e.return,r)}}function br(e){return 5===e.tag||3===e.tag||!!jo&&26===e.tag||!!Fo&&27===e.tag&&Ho(e.type)||4===e.tag}function Sr(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||br(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(Fo&&27===e.tag&&Ho(e.type))continue e;if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function _r(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?ks(n,e,t):bs(n,e);else if(4!==r&&(Fo&&27===r&&Ho(e.type)&&(n=e.stateNode,t=null),null!==(e=e.child)))for(_r(e,t,n),e=e.sibling;null!==e;)_r(e,t,n),e=e.sibling}function Cr(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?ws(n,e,t):vs(n,e);else if(4!==r&&(Fo&&27===r&&Ho(e.type)&&(n=e.stateNode),null!==(e=e.child)))for(Cr(e,t,n),e=e.sibling;null!==e;)Cr(e,t,n),e=e.sibling}function wr(e,t,n){e=e.containerInfo;try{Gs(e,n)}catch(r){Ri(t,t.return,r)}}function kr(e){var t=e.stateNode,n=e.memoizedProps;try{qo(e.type,n,t,e)}catch(r){Ri(e,e.return,r)}}function jr(e,t,n){var r=n.flags;switch(n.tag){case 0:case 11:case 15:Lr(e,n),4&r&&hr(5,n);break;case 1:if(Lr(e,n),4&r)if(e=n.stateNode,null===t)try{e.componentDidMount()}catch(s){Ri(n,n.return,s)}else{var i=vn(n.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(i,t,e.__reactInternalSnapshotBeforeUpdate)}catch(o){Ri(n,n.return,o)}}64&r&&fr(n),512&r&&mr(n,n.return);break;case 3:if(Lr(e,n),64&r&&null!==(r=n.updateQueue)){if(e=null,null!==n.child)switch(n.child.tag){case 27:case 5:e=Ta(n.child.stateNode);break;case 1:e=n.child.stateNode}try{Ve(r,e)}catch(s){Ri(n,n.return,s)}}break;case 27:Fo&&null===t&&4&r&&kr(n);case 26:case 5:if(Lr(e,n),null===t)if(4&r)yr(n);else if(64&r){e=n.type,t=n.memoizedProps,i=n.stateNode;try{uo(i,e,t,n)}catch(s){Ri(n,n.return,s)}}512&r&&mr(n,n.return);break;case 12:Lr(e,n);break;case 31:Lr(e,n),4&r&&zr(e,n);break;case 13:Lr(e,n),4&r&&Ir(e,n),64&r&&null!==(r=n.memoizedState)&&null!==(r=r.dehydrated)&&(n=Oi.bind(null,n),$s(r,n));break;case 22:if(!(r=null!==n.memoizedState||Wc)){t=null!==t&&null!==t.memoizedState||qc,i=Wc;var a=qc;Wc=r,(qc=t)&&!a?Or(e,n,!!(8772&n.subtreeFlags)):Lr(e,n),Wc=i,qc=a}break;case 30:break;default:Lr(e,n)}}function Ar(e){var t=e.alternate;null!==t&&(e.alternate=null,Ar(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&null!==(t=e.stateNode)&&Ja(t),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function Pr(e,t,n){for(n=n.child;null!==n;)Tr(e,t,n),n=n.sibling}function Tr(e,t,n){if(pl&&"function"==typeof pl.onCommitFiberUnmount)try{pl.onCommitFiberUnmount(hl,n)}catch(a){}switch(n.tag){case 26:if(jo){qc||xr(n,t),Pr(e,t,n),n.memoizedState?Io(n.memoizedState):n.stateNode&&No(n.stateNode);break}case 27:if(Fo){qc||xr(n,t);var r=Vc,i=Uc;Ho(n.type)&&(Vc=n.stateNode,Uc=!1),Pr(e,t,n),Bo(n.stateNode),Vc=r,Uc=i;break}case 5:qc||xr(n,t);case 6:if(Ba){if(r=Vc,i=Uc,Vc=null,Pr(e,t,n),Uc=i,null!==(Vc=r))if(Uc)try{As(Vc,n.stateNode)}catch(s){Ri(n,t,s)}else try{js(Vc,n.stateNode)}catch(s){Ri(n,t,s)}}else Pr(e,t,n);break;case 18:Ba&&null!==Vc&&(Uc?yo(Vc,n.stateNode):xo(Vc,n.stateNode));break;case 4:Ba?(r=Vc,i=Uc,Vc=n.stateNode.containerInfo,Uc=!0,Pr(e,t,n),Vc=r,Uc=i):($a&&wr(n.stateNode,n,Rs()),Pr(e,t,n));break;case 0:case 11:case 14:case 15:pr(2,n,t),qc||pr(4,n,t),Pr(e,t,n);break;case 1:qc||(xr(n,t),"function"==typeof(r=n.stateNode).componentWillUnmount&&gr(n,t,r)),Pr(e,t,n);break;case 21:Pr(e,t,n);break;case 22:qc=(r=qc)||null!==n.memoizedState,Pr(e,t,n),qc=r;break;default:Pr(e,t,n)}}function zr(e,t){if(Ha&&null===t.memoizedState&&null!==(e=t.alternate)&&null!==(e=e.memoizedState)){e=e.dehydrated;try{po(e)}catch(n){Ri(t,t.return,n)}}}function Ir(e,t){if(Ha&&null===t.memoizedState&&null!==(e=t.alternate)&&null!==(e=e.memoizedState)&&null!==(e=e.dehydrated))try{fo(e)}catch(n){Ri(t,t.return,n)}}function Er(e,t){var n=function(e){switch(e.tag){case 31:case 13:case 19:var t=e.stateNode;return null===t&&(t=e.stateNode=new $c),t;case 22:return null===(t=(e=e.stateNode)._retryCache)&&(t=e._retryCache=new $c),t;default:throw Error(r(435,e.tag))}}(e);t.forEach(function(t){if(!n.has(t)){n.add(t);var r=Fi.bind(null,e,t);t.then(r,r)}})}function Mr(e,t){var n=t.deletions;if(null!==n)for(var i=0;i<n.length;i++){var a=n[i],s=e,o=t;if(Ba){var l=o;e:for(;null!==l;){switch(l.tag){case 27:if(Fo){if(Ho(l.type)){Vc=l.stateNode,Uc=!1;break e}break}case 5:Vc=l.stateNode,Uc=!1;break e;case 3:case 4:Vc=l.stateNode.containerInfo,Uc=!0;break e}l=l.return}if(null===Vc)throw Error(r(160));Tr(s,o,a),Vc=null,Uc=!1}else Tr(s,o,a);null!==(s=a.alternate)&&(s.return=null),a.return=null}if(13886&t.subtreeFlags)for(t=t.child;null!==t;)Nr(t,e),t=t.sibling}function Nr(e,t){var n=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:Mr(t,e),Rr(e),4&i&&(pr(3,e,e.return),hr(3,e),pr(5,e,e.return));break;case 1:Mr(t,e),Rr(e),512&i&&(qc||null===n||xr(n,n.return)),64&i&&Wc&&null!==(e=e.updateQueue)&&null!==(i=e.callbacks)&&(n=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=null===n?i:n.concat(i));break;case 26:if(jo){var a=Qc;if(Mr(t,e),Rr(e),512&i&&(qc||null===n||xr(n,n.return)),4&i){i=null!==n?n.memoizedState:null;var s=e.memoizedState;null===n?null===s?null===e.stateNode?e.stateNode=Eo(a,e.type,e.memoizedProps,e):Mo(a,e.type,e.stateNode):e.stateNode=zo(a,s,e.memoizedProps):i!==s?(null===i?null!==n.stateNode&&No(n.stateNode):Io(i),null===s?Mo(a,e.type,e.stateNode):zo(a,s,e.memoizedProps)):null===s&&null!==e.stateNode&&vr(e,e.memoizedProps,n.memoizedProps)}break}case 27:if(Fo){Mr(t,e),Rr(e),512&i&&(qc||null===n||xr(n,n.return)),null!==n&&4&i&&vr(e,e.memoizedProps,n.memoizedProps);break}case 5:if(Mr(t,e),Rr(e),512&i&&(qc||null===n||xr(n,n.return)),Ba){if(32&e.flags){a=e.stateNode;try{Ps(a)}catch(h){Ri(e,e.return,h)}}4&i&&null!=e.stateNode&&vr(e,a=e.memoizedProps,null!==n?n.memoizedProps:a),1024&i&&(Bc=!0)}else $a&&null!==e.alternate&&(e.alternate.stateNode=e.stateNode);break;case 6:if(Mr(t,e),Rr(e),4&i&&Ba){if(null===e.stateNode)throw Error(r(162));i=e.memoizedProps,n=null!==n?n.memoizedProps:i,a=e.stateNode;try{Ss(a,n,i)}catch(h){Ri(e,e.return,h)}}break;case 3:if(jo?(Do(),a=Qc,Qc=Po(t.containerInfo),Mr(t,e),Qc=a):Mr(t,e),Rr(e),4&i){if(Ba&&Ha&&null!==n&&n.memoizedState.isDehydrated)try{ho(t.containerInfo)}catch(h){Ri(e,e.return,h)}if($a){i=t.containerInfo,n=t.pendingChildren;try{Gs(i,n)}catch(h){Ri(e,e.return,h)}}}Bc&&(Bc=!1,Dr(e));break;case 4:jo?(n=Qc,Qc=Po(e.stateNode.containerInfo),Mr(t,e),Rr(e),Qc=n):(Mr(t,e),Rr(e)),4&i&&$a&&wr(e.stateNode,e,e.stateNode.pendingChildren);break;case 12:Mr(t,e),Rr(e);break;case 31:Mr(t,e),Rr(e),4&i&&null!==(i=e.updateQueue)&&(e.updateQueue=null,Er(e,i));break;case 13:Mr(t,e),Rr(e),8192&e.child.flags&&null!==e.memoizedState!=(null!==n&&null!==n.memoizedState)&&(Cu=al()),4&i&&null!==(i=e.updateQueue)&&(e.updateQueue=null,Er(e,i));break;case 22:a=null!==e.memoizedState;var o=null!==n&&null!==n.memoizedState,l=Wc,c=qc;if(Wc=l||a,qc=c||o,Mr(t,e),qc=c,Wc=l,Rr(e),8192&i&&((t=e.stateNode)._visibility=a?-2&t._visibility:1|t._visibility,a&&(null===n||o||Wc||qc||Gr(e)),Ba))e:if(n=null,Ba)for(t=e;;){if(5===t.tag||jo&&26===t.tag){if(null===n){o=n=t;try{s=o.stateNode,a?Ts(s):Is(o.stateNode,o.memoizedProps)}catch(h){Ri(o,o.return,h)}}}else if(6===t.tag){if(null===n){o=t;try{var u=o.stateNode;a?zs(u):Es(u,o.memoizedProps)}catch(h){Ri(o,o.return,h)}}}else if(18===t.tag){if(null===n){o=t;try{var d=o.stateNode;a?vo(d):bo(o.stateNode)}catch(h){Ri(o,o.return,h)}}}else if((22!==t.tag&&23!==t.tag||null===t.memoizedState||t===e)&&null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;null===t.sibling;){if(null===t.return||t.return===e)break e;n===t&&(n=null),t=t.return}n===t&&(n=null),t.sibling.return=t.return,t=t.sibling}4&i&&null!==(i=e.updateQueue)&&null!==(n=i.retryQueue)&&(i.retryQueue=null,Er(e,n));break;case 19:Mr(t,e),Rr(e),4&i&&null!==(i=e.updateQueue)&&(e.updateQueue=null,Er(e,i));break;case 30:case 21:break;default:Mr(t,e),Rr(e)}}function Rr(e){var t=e.flags;if(2&t){try{for(var n,i=e.return;null!==i;){if(br(i)){n=i;break}i=i.return}if(Ba){if(null==n)throw Error(r(160));switch(n.tag){case 27:if(Fo){var a=n.stateNode;Cr(e,Sr(e),a);break}case 5:var s=n.stateNode;32&n.flags&&(Ps(s),n.flags&=-33),Cr(e,Sr(e),s);break;case 3:case 4:var o=n.stateNode.containerInfo;_r(e,Sr(e),o);break;default:throw Error(r(161))}}}catch(l){Ri(e,e.return,l)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function Dr(e){if(1024&e.subtreeFlags)for(e=e.child;null!==e;){var t=e;Dr(t),5===t.tag&&1024&t.flags&&ls(t.stateNode),e=e.sibling}}function Lr(e,t){if(8772&t.subtreeFlags)for(t=t.child;null!==t;)jr(e,t.alternate,t),t=t.sibling}function Gr(e){for(e=e.child;null!==e;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:pr(4,t,t.return),Gr(t);break;case 1:xr(t,t.return);var n=t.stateNode;"function"==typeof n.componentWillUnmount&&gr(t,t.return,n),Gr(t);break;case 27:Fo&&Bo(t.stateNode);case 26:case 5:xr(t,t.return),Gr(t);break;case 22:null===t.memoizedState&&Gr(t);break;default:Gr(t)}e=e.sibling}}function Or(e,t,n){for(n=n&&!!(8772&t.subtreeFlags),t=t.child;null!==t;){var r=t.alternate,i=e,a=t,s=a.flags;switch(a.tag){case 0:case 11:case 15:Or(i,a,n),hr(4,a);break;case 1:if(Or(i,a,n),"function"==typeof(i=(r=a).stateNode).componentDidMount)try{i.componentDidMount()}catch(c){Ri(r,r.return,c)}if(null!==(i=(r=a).updateQueue)){var o=r.stateNode;try{var l=i.shared.hiddenCallbacks;if(null!==l)for(i.shared.hiddenCallbacks=null,i=0;i<l.length;i++)He(l[i],o)}catch(c){Ri(r,r.return,c)}}n&&64&s&&fr(a),mr(a,a.return);break;case 27:Fo&&kr(a);case 26:case 5:Or(i,a,n),n&&null===r&&4&s&&yr(a),mr(a,a.return);break;case 12:Or(i,a,n);break;case 31:Or(i,a,n),n&&4&s&&zr(i,a);break;case 13:Or(i,a,n),n&&4&s&&Ir(i,a);break;case 22:null===a.memoizedState&&Or(i,a,n),mr(a,a.return);break;case 30:break;default:Or(i,a,n)}t=t.sibling}}function Fr(e,t){var n=null;null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),e=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(e=t.memoizedState.cachePool.pool),e!==n&&(null!=e&&e.refCount++,null!=n&&ae(n))}function Wr(e,t){e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&ae(e))}function qr(e,t,n,r){if(10256&t.subtreeFlags)for(t=t.child;null!==t;)Br(e,t,n,r),t=t.sibling}function Br(e,t,n,r){var i=t.flags;switch(t.tag){case 0:case 11:case 15:qr(e,t,n,r),2048&i&&hr(9,t);break;case 1:case 31:case 13:default:qr(e,t,n,r);break;case 3:qr(e,t,n,r),2048&i&&(e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&ae(e)));break;case 12:if(2048&i){qr(e,t,n,r),e=t.stateNode;try{var a=t.memoizedProps,s=a.id,o=a.onPostCommit;"function"==typeof o&&o(s,null===t.alternate?"mount":"update",e.passiveEffectDuration,-0)}catch(l){Ri(t,t.return,l)}}else qr(e,t,n,r);break;case 23:break;case 22:a=t.stateNode,s=t.alternate,null!==t.memoizedState?2&a._visibility?qr(e,t,n,r):Hr(e,t):2&a._visibility?qr(e,t,n,r):(a._visibility|=2,$r(e,t,n,r,!!(10256&t.subtreeFlags)||!1)),2048&i&&Fr(s,t);break;case 24:qr(e,t,n,r),2048&i&&Wr(t.alternate,t)}}function $r(e,t,n,r,i){for(i=i&&(!!(10256&t.subtreeFlags)||!1),t=t.child;null!==t;){var a=e,s=t,o=n,l=r,c=s.flags;switch(s.tag){case 0:case 11:case 15:$r(a,s,o,l,i),hr(8,s);break;case 23:break;case 22:var u=s.stateNode;null!==s.memoizedState?2&u._visibility?$r(a,s,o,l,i):Hr(a,s):(u._visibility|=2,$r(a,s,o,l,i)),i&&2048&c&&Fr(s.alternate,s);break;case 24:$r(a,s,o,l,i),i&&2048&c&&Wr(s.alternate,s);break;default:$r(a,s,o,l,i)}t=t.sibling}}function Hr(e,t){if(10256&t.subtreeFlags)for(t=t.child;null!==t;){var n=e,r=t,i=r.flags;switch(r.tag){case 22:Hr(n,r),2048&i&&Fr(r.alternate,r);break;case 24:Hr(n,r),2048&i&&Wr(r.alternate,r);break;default:Hr(n,r)}t=t.sibling}}function Vr(e,t,n){if(e.subtreeFlags&Yc)for(e=e.child;null!==e;)Ur(e,t,n),e=e.sibling}function Ur(e,t,n){switch(e.tag){case 26:if(Vr(e,t,n),e.flags&Yc)if(null!==e.memoizedState)Oo(n,Qc,e.memoizedState,e.memoizedProps);else{var r=e.stateNode,i=e.type;e=e.memoizedProps,((335544128&t)===t||ts(i,e))&&is(n,r,i,e)}break;case 5:Vr(e,t,n),e.flags&Yc&&(r=e.stateNode,i=e.type,e=e.memoizedProps,((335544128&t)===t||ts(i,e))&&is(n,r,i,e));break;case 3:case 4:jo?(r=Qc,Qc=Po(e.stateNode.containerInfo),Vr(e,t,n),Qc=r):Vr(e,t,n);break;case 22:null===e.memoizedState&&(null!==(r=e.alternate)&&null!==r.memoizedState?(r=Yc,Yc=16777216,Vr(e,t,n),Yc=r):Vr(e,t,n));break;default:Vr(e,t,n)}}function Qr(e){var t=e.alternate;if(null!==t&&null!==(e=t.child)){t.child=null;do{t=e.sibling,e.sibling=null,e=t}while(null!==e)}}function Yr(e){var t=e.deletions;if(16&e.flags){if(null!==t)for(var n=0;n<t.length;n++){var r=t[n];Hc=r,Jr(r,e)}Qr(e)}if(10256&e.subtreeFlags)for(e=e.child;null!==e;)Xr(e),e=e.sibling}function Xr(e){switch(e.tag){case 0:case 11:case 15:Yr(e),2048&e.flags&&pr(9,e,e.return);break;case 3:case 12:default:Yr(e);break;case 22:var t=e.stateNode;null!==e.memoizedState&&2&t._visibility&&(null===e.return||13!==e.return.tag)?(t._visibility&=-3,Kr(e)):Yr(e)}}function Kr(e){var t=e.deletions;if(16&e.flags){if(null!==t)for(var n=0;n<t.length;n++){var r=t[n];Hc=r,Jr(r,e)}Qr(e)}for(e=e.child;null!==e;){switch((t=e).tag){case 0:case 11:case 15:pr(8,t,t.return),Kr(t);break;case 22:2&(n=t.stateNode)._visibility&&(n._visibility&=-3,Kr(t));break;default:Kr(t)}e=e.sibling}}function Jr(e,t){for(;null!==Hc;){var n=Hc;switch(n.tag){case 0:case 11:case 15:pr(8,n,t);break;case 23:case 22:if(null!==n.memoizedState&&null!==n.memoizedState.cachePool){var r=n.memoizedState.cachePool.pool;null!=r&&r.refCount++}break;case 24:ae(n.memoizedState.cache)}if(null!==(r=n.child))r.return=n,Hc=r;else e:for(n=e;null!==Hc;){var i=(r=Hc).sibling,a=r.return;if(Ar(r),r===n){Hc=null;break e}if(null!==i){i.return=a,Hc=i;break e}Hc=a}}}function Zr(e){var t=Va(e);if(null!=t){if("string"!=typeof t.memoizedProps["data-testname"])throw Error(r(364));return t}if(null===(e=hs(e)))throw Error(r(362));return e.stateNode.current}function ei(e,t){var n=e.tag;switch(t.$$typeof){case Kc:if(e.type===t.value)return!0;break;case Jc:e:{for(t=t.value,e=[e,0],n=0;n<e.length;){var i=e[n++],a=i.tag,s=e[n++],o=t[s];if(5!==a&&26!==a&&27!==a||!gs(i)){for(;null!=o&&ei(i,o);)o=t[++s];if(s===t.length){t=!0;break e}for(i=i.child;null!==i;)e.push(i,s),i=i.sibling}}t=!1}return t;case Zc:if((5===n||26===n||27===n)&&ms(e.stateNode,t.value))return!0;break;case tu:if((5===n||6===n||26===n||27===n)&&null!==(e=fs(e))&&0<=e.indexOf(t.value))return!0;break;case eu:if((5===n||26===n||27===n)&&"string"==typeof(e=e.memoizedProps["data-testname"])&&e.toLowerCase()===t.value.toLowerCase())return!0;break;default:throw Error(r(365))}return!1}function ti(e){switch(e.$$typeof){case Kc:return"<"+(u(e.value)||"Unknown")+">";case Jc:return":has("+(ti(e)||"")+")";case Zc:return'[role="'+e.value+'"]';case tu:return'"'+e.value+'"';case eu:return'[data-testname="'+e.value+'"]';default:throw Error(r(365))}}function ni(e,t){var n=[];e=[e,0];for(var r=0;r<e.length;){var i=e[r++],a=i.tag,s=e[r++],o=t[s];if(5!==a&&26!==a&&27!==a||!gs(i)){for(;null!=o&&ei(i,o);)o=t[++s];if(s===t.length)n.push(i);else for(i=i.child;null!==i;)e.push(i,s),i=i.sibling}}return n}function ri(e,t){if(!ds)throw Error(r(363));e=ni(e=Zr(e),t),t=[],e=Array.from(e);for(var n=0;n<e.length;){var i=e[n++],a=i.tag;if(5===a||26===a||27===a)gs(i)||t.push(i.stateNode);else for(i=i.child;null!==i;)e.push(i),i=i.sibling}return t}function ii(){return 2&iu&&0!==ou?ou&-ou:null!==ka.T?fe():Xa()}function ai(){if(0===yu)if(536870912&ou&&!Nl)yu=536870912;else{var e=Zo;!(3932160&(Zo<<=1))&&(Zo=262144),yu=e}return null!==(e=vc.current)&&(e.flags|=32),yu}function si(e,t,n){(e!==au||2!==lu&&9!==lu)&&null===e.cancelPendingCommit||(pi(e,0),ui(e,ou,yu,!1)),b(e,n),2&iu&&e===au||(e===au&&(!(2&iu)&&(mu|=n),4===fu&&ui(e,ou,yu,!1)),oe(e))}function oi(e,t,n){if(6&iu)throw Error(r(327));for(var i=!n&&!(127&t)&&0===(t&e.expiredLanes)||m(e,t),a=i?function(e,t){var n=iu;iu|=2;var i=mi(),a=xi();au!==e||ou!==t?(ju=null,ku=al()+500,pi(e,t)):du=m(e,t);e:for(;;)try{if(0!==lu&&null!==su){t=su;var s=cu;t:switch(lu){case 1:lu=0,cu=null,wi(e,t,s,1);break;case 2:case 9:if(be(s)){lu=0,cu=null,Ci(t);break}t=function(){2!==lu&&9!==lu||au!==e||(lu=7),oe(e)},s.then(t,t);break e;case 3:lu=7;break e;case 4:lu=5;break e;case 7:be(s)?(lu=0,cu=null,Ci(t)):(lu=0,cu=null,wi(e,t,s,7));break;case 5:var o=null;switch(su.tag){case 26:o=su.memoizedState;case 5:case 27:var l=su,c=l.type,u=l.pendingProps;if(o?Go(o):ns(l.stateNode,c,u)){lu=0,cu=null;var d=l.sibling;if(null!==d)su=d;else{var h=l.return;null!==h?(su=h,ki(h)):su=null}break t}}lu=0,cu=null,wi(e,t,s,5);break;case 6:lu=0,cu=null,wi(e,t,s,6);break;case 8:hi(),fu=6;break e;default:throw Error(r(462))}}Si();break}catch(p){fi(e,p)}return Fl=Ol=null,ka.H=i,ka.A=a,iu=n,null!==su?0:(au=null,ou=0,ze(),fu)}(e,t):vi(e,t,!0),s=i;;){if(0===a){du&&!i&&ui(e,t,0,!1);break}if(n=e.current.alternate,!s||ci(n)){if(2===a){if(s=t,e.errorRecoveryDisabledLanes&s)var o=0;else o=0!=(o=-536870913&e.pendingLanes)?o:536870912&o?536870912:0;if(0!==o){t=o;e:{var l=e;a=bu;var c=Ha&&l.current.memoizedState.isDehydrated;if(c&&(pi(l,o).flags|=256),2!==(o=vi(l,o,!1))){if(hu&&!c){l.errorRecoveryDisabledLanes|=s,mu|=s,a=4;break e}s=Su,Su=a,null!==s&&(null===Su?Su=s:Su.push.apply(Su,s))}a=o}if(s=!1,2!==a)continue}}if(1===a){pi(e,0),ui(e,t,0,!0);break}e:{switch(i=e,s=a){case 0:case 1:throw Error(r(345));case 4:if((4194048&t)!==t)break;case 6:ui(i,t,yu,!uu);break e;case 2:Su=null;break;case 3:case 5:break;default:throw Error(r(329))}if((62914560&t)===t&&10<(a=Cu+300-al())){if(ui(i,t,yu,!uu),0!==g(i,0,!0))break e;Iu=t,i.timeoutHandle=Oa(li.bind(null,i,n,Su,ju,_u,t,yu,mu,vu,uu,s,"Throttled",-0,0),a)}else li(i,n,Su,ju,_u,t,yu,mu,vu,uu,s,null,-0,0)}break}a=vi(e,t,!1),s=!1}oe(e)}function li(e,t,n,r,i,a,s,o,l,c,u,d,h,p){if(e.timeoutHandle=Wa,8192&(d=t.subtreeFlags)||!(16785408&~d)){Ur(t,a,d=rs());var f=(62914560&a)===a?Cu-al():(4194048&a)===a?wu-al():0;if(null!==(f=as(d,f)))return Iu=a,e.cancelPendingCommit=f(Ai.bind(null,e,t,a,n,r,i,s,o,l,u,d,null,h,p)),void ui(e,a,s,!c)}Ai(e,t,a,n,r,i,s,o,l)}function ci(e){for(var t=e;;){var n=t.tag;if((0===n||11===n||15===n)&&16384&t.flags&&null!==(n=t.updateQueue)&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var i=n[r],a=i.getSnapshot;i=i.value;try{if(!fl(a(),i))return!1}catch(s){return!1}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function ui(e,t,n,r){t&=~xu,t&=~mu,e.suspendedLanes|=t,e.pingedLanes&=~t,r&&(e.warmLanes|=t),r=e.expirationTimes;for(var i=t;0<i;){var a=31-Yo(i),s=1<<a;r[a]=-1,i&=~s}0!==n&&S(e,n,t)}function di(){return!!(6&iu)||(le(0),!1)}function hi(){if(null!==su){if(0===lu)var e=su.return;else Fl=Ol=null,ut(e=su),lc=null,cc=0,e=su;for(;null!==e;)dr(e.alternate,e),e=e.return;su=null}}function pi(e,t){var n=e.timeoutHandle;n!==Wa&&(e.timeoutHandle=Wa,Fa(n)),null!==(n=e.cancelPendingCommit)&&(e.cancelPendingCommit=null,n()),Iu=0,hi(),au=e,su=n=Bi(e.current,null),ou=t,lu=0,cu=null,uu=!1,du=m(e,t),hu=!1,vu=yu=xu=mu=gu=fu=0,Su=bu=null,_u=!1,8&t&&(t|=32&t);var r=e.entangledLanes;if(0!==r)for(e=e.entanglements,r&=t;0<r;){var i=31-Yo(r),a=1<<i;t|=e[i],r&=~a}return pu=t,ze(),n}function fi(e,t){Cc=null,ka.H=Mc,t===rc||t===ac?(t=Ce(),lu=3):t===ic?(t=Ce(),lu=4):lu=t===Gc?8:null!==t&&"object"==typeof t&&"function"==typeof t.then?6:1,cu=t,null===su&&(fu=1,bn(e,I(t,e.current)))}function gi(){var e=vc.current;return null===e||((4194048&ou)===ou?null===bc:!!((62914560&ou)===ou||536870912&ou)&&e===bc)}function mi(){var e=ka.H;return ka.H=Mc,null===e?Mc:e}function xi(){var e=ka.A;return ka.A=Xc,e}function yi(){fu=4,uu||(4194048&ou)!==ou&&null!==vc.current||(du=!0),!(134217727&gu)&&!(134217727&mu)||null===au||ui(au,ou,yu,!1)}function vi(e,t,n){var r=iu;iu|=2;var i=mi(),a=xi();au===e&&ou===t||(ju=null,pi(e,t)),t=!1;var s=fu;e:for(;;)try{if(0!==lu&&null!==su){var o=su,l=cu;switch(lu){case 8:hi(),s=6;break e;case 3:case 2:case 9:case 6:null===vc.current&&(t=!0);var c=lu;if(lu=0,cu=null,wi(e,o,l,c),n&&du){s=0;break e}break;default:c=lu,lu=0,cu=null,wi(e,o,l,c)}}bi(),s=fu;break}catch(u){fi(e,u)}return t&&e.shellSuspendCounter++,Fl=Ol=null,iu=r,ka.H=i,ka.A=a,null===su&&(au=null,ou=0,ze()),s}function bi(){for(;null!==su;)_i(su)}function Si(){for(;null!==su&&!rl();)_i(su)}function _i(e){var t=Xn(e.alternate,e,pu);e.memoizedProps=e.pendingProps,null===t?ki(e):su=t}function Ci(e){var t=e,n=t.alternate;switch(t.tag){case 15:case 0:t=Dn(n,t,t.pendingProps,t.type,void 0,ou);break;case 11:t=Dn(n,t,t.pendingProps,t.type.render,t.ref,ou);break;case 5:ut(t);default:dr(n,t),t=Xn(n,t=su=$i(t,pu),pu)}e.memoizedProps=e.pendingProps,null===t?ki(e):su=t}function wi(e,t,n,i){Fl=Ol=null,ut(t),lc=null,cc=0;var a=t.return;try{if(function(e,t,n,i,a){if(n.flags|=32768,null!==i&&"object"==typeof i&&"function"==typeof i.then){if(null!==(t=n.alternate)&&J(t,n,a,!0),null!==(n=vc.current)){switch(n.tag){case 31:case 13:return null===bc?yi():null===n.alternate&&0===fu&&(fu=3),n.flags&=-257,n.flags|=65536,n.lanes=a,i===sc?n.flags|=16384:(null===(t=n.updateQueue)?n.updateQueue=new Set([i]):t.add(i),Di(e,i,a)),!1;case 22:return n.flags|=65536,i===sc?n.flags|=16384:(null===(t=n.updateQueue)?(t={transitions:null,markerInstances:null,retryQueue:new Set([i])},n.updateQueue=t):null===(n=t.retryQueue)?t.retryQueue=new Set([i]):n.add(i),Di(e,i,a)),!1}throw Error(r(435,n.tag))}return Di(e,i,a),yi(),!1}if(Nl)return null!==(t=vc.current)?(!(65536&t.flags)&&(t.flags|=256),t.flags|=65536,t.lanes=a,i!==Ll&&U(I(e=Error(r(422),{cause:i}),n))):(i!==Ll&&U(I(t=Error(r(423),{cause:i}),n)),(e=e.current.alternate).flags|=65536,a&=-a,e.lanes|=a,i=I(i,n),qe(e,a=_n(e.stateNode,i,a)),4!==fu&&(fu=2)),!1;var s=Error(r(520),{cause:i});if(s=I(s,n),null===bu?bu=[s]:bu.push(s),4!==fu&&(fu=2),null===t)return!0;i=I(i,n),n=t;do{switch(n.tag){case 3:return n.flags|=65536,e=a&-a,n.lanes|=e,qe(n,e=_n(n.stateNode,i,e)),!1;case 1:if(t=n.type,s=n.stateNode,!(128&n.flags||"function"!=typeof t.getDerivedStateFromError&&(null===s||"function"!=typeof s.componentDidCatch||null!==Au&&Au.has(s))))return n.flags|=65536,a&=-a,n.lanes|=a,wn(a=Cn(a),e,n,i),qe(n,a),!1}n=n.return}while(null!==n);return!1}(e,a,t,n,ou))return fu=1,bn(e,I(n,e.current)),void(su=null)}catch(s){if(null!==a)throw su=a,s;return fu=1,bn(e,I(n,e.current)),void(su=null)}32768&t.flags?(Nl||1===i?e=!0:du||536870912&ou?e=!1:(uu=e=!0,(2===i||9===i||3===i||6===i)&&null!==(i=vc.current)&&13===i.tag&&(i.flags|=16384)),ji(t,e)):ki(t)}function ki(e){var t=e;do{if(32768&t.flags)return void ji(t,uu);e=t.return;var n=cr(t.alternate,t,pu);if(null!==n)return void(su=n);if(null!==(t=t.sibling))return void(su=t);su=t=e}while(null!==t);0===fu&&(fu=5)}function ji(e,t){do{var n=ur(e.alternate,e);if(null!==n)return n.flags&=32767,void(su=n);if(null!==(n=e.return)&&(n.flags|=32768,n.subtreeFlags=0,n.deletions=null),!t&&null!==(e=e.sibling))return void(su=e);su=e=n}while(null!==e);fu=6,su=null}function Ai(e,t,n,i,a,s,o,l,c){e.cancelPendingCommit=null;do{Ei()}while(0!==Pu);if(6&iu)throw Error(r(327));if(null!==t){if(t===e.current)throw Error(r(177));if(s=t.lanes|t.childLanes,function(e,t,n,r,i,a){var s=e.pendingLanes;e.pendingLanes=n,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=n,e.entangledLanes&=n,e.errorRecoveryDisabledLanes&=n,e.shellSuspendCounter=0;var o=e.entanglements,l=e.expirationTimes,c=e.hiddenUpdates;for(n=s&~n;0<n;){var u=31-Yo(n),d=1<<u;o[u]=0,l[u]=-1;var h=c[u];if(null!==h)for(c[u]=null,u=0;u<h.length;u++){var p=h[u];null!==p&&(p.lane&=-536870913)}n&=~d}0!==r&&S(e,r,0),0!==a&&0===i&&0!==e.tag&&(e.suspendedLanes|=a&~(s&~t))}(e,n,s|=fc,o,l,c),e===au&&(su=au=null,ou=0),zu=t,Tu=e,Iu=n,Eu=s,Mu=a,Nu=i,10256&t.subtreeFlags||10256&t.flags?(e.callbackNode=null,e.callbackPriority=0,tl(ll,function(){return Mi(),null})):(e.callbackNode=null,e.callbackPriority=0),i=!!(13878&t.flags),13878&t.subtreeFlags||i){i=ka.T,ka.T=null,a=Ya(),Qa(2),o=iu,iu|=4;try{!function(e,t){for(Ea(e.containerInfo),Hc=t;null!==Hc;)if(t=(e=Hc).child,1028&e.subtreeFlags&&null!==t)t.return=e,Hc=t;else for(;null!==Hc;){var n=(e=Hc).alternate;switch(t=e.flags,e.tag){case 0:if(4&t&&null!==(t=null!==(t=e.updateQueue)?t.events:null))for(var i=0;i<t.length;i++){var a=t[i];a.ref.impl=a.nextImpl}break;case 11:case 15:case 5:case 26:case 27:case 6:case 4:case 17:break;case 1:if(1024&t&&null!==n){t=void 0,i=e,a=n.memoizedProps,n=n.memoizedState;var s=i.stateNode;try{var o=vn(i.type,a);t=s.getSnapshotBeforeUpdate(o,n),s.__reactInternalSnapshotBeforeUpdate=t}catch(l){Ri(i,i.return,l)}}break;case 3:1024&t&&Ba&&Ms(e.stateNode.containerInfo);break;default:if(1024&t)throw Error(r(163))}if(null!==(t=e.sibling)){t.return=e.return,Hc=t;break}Hc=e.return}}(e,t)}finally{iu=o,Qa(a),ka.T=i}}Pu=1,Pi(),Ti(),zi()}}function Pi(){if(1===Pu){Pu=0;var e=Tu,t=zu,n=!!(13878&t.flags);if(13878&t.subtreeFlags||n){n=ka.T,ka.T=null;var r=Ya();Qa(2);var i=iu;iu|=4;try{Nr(t,e),Ma(e.containerInfo)}finally{iu=i,Qa(r),ka.T=n}}e.current=t,Pu=2}}function Ti(){if(2===Pu){Pu=0;var e=Tu,t=zu,n=!!(8772&t.flags);if(8772&t.subtreeFlags||n){n=ka.T,ka.T=null;var r=Ya();Qa(2);var i=iu;iu|=4;try{jr(e,t.alternate,t)}finally{iu=i,Qa(r),ka.T=n}}Pu=3}}function zi(){if(4===Pu||3===Pu){Pu=0,il();var e=Tu,t=zu,n=Iu,r=Nu;10256&t.subtreeFlags||10256&t.flags?Pu=5:(Pu=0,zu=Tu=null,Ii(e,e.pendingLanes));var i=e.pendingLanes;if(0===i&&(Au=null),k(n),t=t.stateNode,pl&&"function"==typeof pl.onCommitFiberRoot)try{pl.onCommitFiberRoot(hl,t,void 0,!(128&~t.current.flags))}catch(l){}if(null!==r){t=ka.T,i=Ya(),Qa(2),ka.T=null;try{for(var a=e.onRecoverableError,s=0;s<r.length;s++){var o=r[s];a(o.value,{componentStack:o.stack})}}finally{ka.T=t,Qa(i)}}3&Iu&&Ei(),oe(e),i=e.pendingLanes,261930&n&&42&i?e===Du?Ru++:(Ru=0,Du=e):Ru=0,Ha&&mo(),le(0)}}function Ii(e,t){0===(e.pooledCacheLanes&=t)&&null!=(t=e.pooledCache)&&(e.pooledCache=null,ae(t))}function Ei(){return Pi(),Ti(),zi(),Mi()}function Mi(){if(5!==Pu)return!1;var e=Tu,t=Eu;Eu=0;var n=k(Iu),i=32>n?32:n;n=ka.T;var a=Ya();try{Qa(i),ka.T=null,i=Mu,Mu=null;var s=Tu,o=Iu;if(Pu=0,zu=Tu=null,Iu=0,6&iu)throw Error(r(331));var l=iu;if(iu|=4,Xr(s.current),Br(s,s.current,o,i),iu=l,le(0),pl&&"function"==typeof pl.onPostCommitFiberRoot)try{pl.onPostCommitFiberRoot(hl,s)}catch(c){}return!0}finally{Qa(a),ka.T=n,Ii(e,t)}}function Ni(e,t,n){t=I(n,t),null!==(e=Fe(e,t=_n(e.stateNode,t,2),2))&&(b(e,2),oe(e))}function Ri(e,t,n){if(3===e.tag)Ni(e,e,n);else for(;null!==t;){if(3===t.tag){Ni(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"==typeof t.type.getDerivedStateFromError||"function"==typeof r.componentDidCatch&&(null===Au||!Au.has(r))){e=I(n,e),null!==(r=Fe(t,n=Cn(2),2))&&(wn(n,r,t,e),b(r,2),oe(r));break}}t=t.return}}function Di(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new ru;var i=new Set;r.set(t,i)}else void 0===(i=r.get(t))&&(i=new Set,r.set(t,i));i.has(n)||(hu=!0,i.add(n),e=Li.bind(null,e,t,n),t.then(e,e))}function Li(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),e.pingedLanes|=e.suspendedLanes&n,e.warmLanes&=~n,au===e&&(ou&n)===n&&(4===fu||3===fu&&(62914560&ou)===ou&&300>al()-Cu?!(2&iu)&&pi(e,0):xu|=n,vu===ou&&(vu=0)),oe(e)}function Gi(e,t){0===t&&(t=y()),null!==(e=Me(e,t))&&(b(e,t),oe(e))}function Oi(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Gi(e,n)}function Fi(e,t){var n=0;switch(e.tag){case 31:case 13:var i=e.stateNode,a=e.memoizedState;null!==a&&(n=a.retryLane);break;case 19:i=e.stateNode;break;case 22:i=e.stateNode._retryCache;break;default:throw Error(r(314))}null!==i&&i.delete(t),Gi(e,n)}function Wi(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function qi(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Bi(e,n){var r=e.alternate;return null===r?((r=t(e.tag,n,e.key,e.mode)).elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=n,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=65011712&e.flags,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,n=e.dependencies,r.dependencies=null===n?null:{lanes:n.lanes,firstContext:n.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r.refCleanup=e.refCleanup,r}function $i(e,t){e.flags&=65011714;var n=e.alternate;return null===n?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=n.childLanes,e.lanes=n.lanes,e.child=n.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=n.memoizedProps,e.memoizedState=n.memoizedState,e.updateQueue=n.updateQueue,e.type=n.type,t=n.dependencies,e.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function Hi(e,n,i,a,s,o){var l=0;if(a=e,"function"==typeof e)qi(e)&&(l=1);else if("string"==typeof e)l=jo&&Fo?Ao(e,i,Pl.current)?26:$o(e)?27:5:jo?Ao(e,i,Pl.current)?26:5:Fo&&$o(e)?27:5;else e:switch(e){case ba:return(e=t(31,i,n,s)).elementType=ba,e.lanes=o,e;case ua:return Vi(i.children,s,o,n);case da:l=8,s|=24;break;case ha:return(e=t(12,i,n,2|s)).elementType=ha,e.lanes=o,e;case ma:return(e=t(13,i,n,s)).elementType=ma,e.lanes=o,e;case xa:return(e=t(19,i,n,s)).elementType=xa,e.lanes=o,e;default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case fa:l=10;break e;case pa:l=9;break e;case ga:l=11;break e;case ya:l=14;break e;case va:l=16,a=null;break e}l=29,i=Error(r(130,null===e?"null":typeof e,"")),a=null}return(n=t(l,i,n,s)).elementType=e,n.type=a,n.lanes=o,n}function Vi(e,n,r,i){return(e=t(7,e,i,n)).lanes=r,e}function Ui(e,n,r){return(e=t(6,e,null,n)).lanes=r,e}function Qi(e){var n=t(18,null,null,0);return n.stateNode=e,n}function Yi(e,n,r){return(n=t(4,null!==e.children?e.children:[],e.key,n)).lanes=r,n.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},n}function Xi(e,t,n,r,i,a,s,o,l){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=Wa,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=v(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=v(0),this.hiddenUpdates=v(null),this.identifierPrefix=r,this.onUncaughtError=i,this.onCaughtError=a,this.onRecoverableError=s,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=l,this.incompleteTransitions=new Map}function Ki(e,n,r,i,a,s,o,l,c,u,d,h){return e=new Xi(e,n,r,o,c,u,d,h,l),n=1,!0===s&&(n|=24),s=t(3,null,null,n),e.current=s,s.stateNode=e,(n=ie()).refCount++,e.pooledCache=n,n.refCount++,s.memoizedState={element:i,isDehydrated:r,cache:n},Le(s),e}function Ji(e){return e?e=Qo:Qo}function Zi(e){var t=e._reactInternals;if(void 0===t){if("function"==typeof e.render)throw Error(r(188));throw e=Object.keys(e).join(","),Error(r(268,e))}return null===(e=null!==(e=s(t))?o(e):null)?null:Ta(e.stateNode)}function ea(e,t,n,r,i,a){i=Ji(i),null===r.context?r.context=i:r.pendingContext=i,(r=Oe(t)).payload={element:n},null!==(a=void 0===a?null:a)&&(r.callback=a),null!==(n=Fe(e,r,t))&&(si(n,0,t),We(n,e,t))}function ta(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function na(e,t){ta(e,t),(e=e.alternate)&&ta(e,t)}var ra={},ia=Ae(),aa=Ne(),sa=Object.assign,oa=Symbol.for("react.element"),la=Symbol.for("react.transitional.element"),ca=Symbol.for("react.portal"),ua=Symbol.for("react.fragment"),da=Symbol.for("react.strict_mode"),ha=Symbol.for("react.profiler"),pa=Symbol.for("react.consumer"),fa=Symbol.for("react.context"),ga=Symbol.for("react.forward_ref"),ma=Symbol.for("react.suspense"),xa=Symbol.for("react.suspense_list"),ya=Symbol.for("react.memo"),va=Symbol.for("react.lazy"),ba=Symbol.for("react.activity"),Sa=Symbol.for("react.memo_cache_sentinel"),_a=Symbol.iterator,Ca=Symbol.for("react.client.reference"),wa=Array.isArray,ka=ia.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ja=e.rendererVersion,Aa=e.rendererPackageName,Pa=e.extraDevToolsConfig,Ta=e.getPublicInstance,za=e.getRootHostContext,Ia=e.getChildHostContext,Ea=e.prepareForCommit,Ma=e.resetAfterCommit,Na=e.createInstance;e.cloneMutableInstance;var Ra=e.appendInitialChild,Da=e.finalizeInitialChildren,La=e.shouldSetTextContent,Ga=e.createTextInstance;e.cloneMutableTextInstance;var Oa=e.scheduleTimeout,Fa=e.cancelTimeout,Wa=e.noTimeout,qa=e.isPrimaryRenderer;e.warnsIfNotActing;var Ba=e.supportsMutation,$a=e.supportsPersistence,Ha=e.supportsHydration,Va=e.getInstanceFromNode;e.beforeActiveInstanceBlur;var Ua=e.preparePortalMount;e.prepareScopeUpdate,e.getInstanceFromScope;var Qa=e.setCurrentUpdatePriority,Ya=e.getCurrentUpdatePriority,Xa=e.resolveUpdatePriority;e.trackSchedulerEvent,e.resolveEventType,e.resolveEventTimeStamp;var Ka=e.shouldAttemptEagerTransition,Ja=e.detachDeletedInstance;e.requestPostPaintCallback;var Za=e.maySuspendCommit,es=e.maySuspendCommitOnUpdate,ts=e.maySuspendCommitInSyncRender,ns=e.preloadInstance,rs=e.startSuspendingCommit,is=e.suspendInstance;e.suspendOnActiveViewTransition;var as=e.waitForCommitToBeReady;e.getSuspendedCommitReason;var ss=e.NotPendingTransition,os=e.HostTransitionContext,ls=e.resetFormInstance;e.bindToConsole;var cs=e.supportsMicrotasks,us=e.scheduleMicrotask,ds=e.supportsTestSelectors,hs=e.findFiberRoot,ps=e.getBoundingRect,fs=e.getTextContent,gs=e.isHiddenSubtree,ms=e.matchAccessibilityRole,xs=e.setFocusIfFocusable,ys=e.setupIntersectionObserver,vs=e.appendChild,bs=e.appendChildToContainer,Ss=e.commitTextUpdate,_s=e.commitMount,Cs=e.commitUpdate,ws=e.insertBefore,ks=e.insertInContainerBefore,js=e.removeChild,As=e.removeChildFromContainer,Ps=e.resetTextContent,Ts=e.hideInstance,zs=e.hideTextInstance,Is=e.unhideInstance,Es=e.unhideTextInstance;e.cancelViewTransitionName,e.cancelRootViewTransitionName,e.restoreRootViewTransitionName,e.cloneRootViewTransitionContainer,e.removeRootViewTransitionClone,e.measureClonedInstance,e.hasInstanceChanged,e.hasInstanceAffectedParent,e.startViewTransition,e.startGestureTransition,e.stopViewTransition,e.getCurrentGestureOffset,e.createViewTransitionInstance;var Ms=e.clearContainer;e.createFragmentInstance,e.updateFragmentInstanceFiber,e.commitNewChildToFragmentInstance,e.deleteChildFromFragmentInstance;var Ns=e.cloneInstance,Rs=e.createContainerChildSet,Ds=e.appendChildToContainerChildSet,Ls=e.finalizeContainerChildren,Gs=e.replaceContainerChildren,Os=e.cloneHiddenInstance,Fs=e.cloneHiddenTextInstance,Ws=e.isSuspenseInstancePending,qs=e.isSuspenseInstanceFallback,Bs=e.getSuspenseInstanceFallbackErrorDetails,$s=e.registerSuspenseInstanceRetry,Hs=e.canHydrateFormStateMarker,Vs=e.isFormStateMarkerMatching,Us=e.getNextHydratableSibling,Qs=e.getNextHydratableSiblingAfterSingleton,Ys=e.getFirstHydratableChild,Xs=e.getFirstHydratableChildWithinContainer,Ks=e.getFirstHydratableChildWithinActivityInstance,Js=e.getFirstHydratableChildWithinSuspenseInstance,Zs=e.getFirstHydratableChildWithinSingleton,eo=e.canHydrateInstance,to=e.canHydrateTextInstance,no=e.canHydrateActivityInstance,ro=e.canHydrateSuspenseInstance,io=e.hydrateInstance,ao=e.hydrateTextInstance,so=e.hydrateActivityInstance,oo=e.hydrateSuspenseInstance,lo=e.getNextHydratableInstanceAfterActivityInstance,co=e.getNextHydratableInstanceAfterSuspenseInstance,uo=e.commitHydratedInstance,ho=e.commitHydratedContainer,po=e.commitHydratedActivityInstance,fo=e.commitHydratedSuspenseInstance,go=e.finalizeHydratedChildren,mo=e.flushHydrationEvents;e.clearActivityBoundary;var xo=e.clearSuspenseBoundary;e.clearActivityBoundaryFromContainer;var yo=e.clearSuspenseBoundaryFromContainer,vo=e.hideDehydratedBoundary,bo=e.unhideDehydratedBoundary,So=e.shouldDeleteUnhydratedTailInstances;e.diffHydratedPropsForDevWarnings,e.diffHydratedTextForDevWarnings,e.describeHydratableInstanceForDevWarnings;var _o,Co,wo=e.validateHydratableInstance,ko=e.validateHydratableTextInstance,jo=e.supportsResources,Ao=e.isHostHoistableType,Po=e.getHoistableRoot,To=e.getResource,zo=e.acquireResource,Io=e.releaseResource,Eo=e.hydrateHoistable,Mo=e.mountHoistable,No=e.unmountHoistable,Ro=e.createHoistableInstance,Do=e.prepareToCommitHoistables,Lo=e.mayResourceSuspendCommit,Go=e.preloadResource,Oo=e.suspendResource,Fo=e.supportsSingletons,Wo=e.resolveSingletonInstance,qo=e.acquireSingletonInstance,Bo=e.releaseSingletonInstance,$o=e.isHostSingletonType,Ho=e.isSingletonScope,Vo=[],Uo=-1,Qo={},Yo=Math.clz32?Math.clz32:function(e){return 0==(e>>>=0)?32:31-(Xo(e)/Ko|0)|0},Xo=Math.log,Ko=Math.LN2,Jo=256,Zo=262144,el=4194304,tl=aa.unstable_scheduleCallback,nl=aa.unstable_cancelCallback,rl=aa.unstable_shouldYield,il=aa.unstable_requestPaint,al=aa.unstable_now,sl=aa.unstable_ImmediatePriority,ol=aa.unstable_UserBlockingPriority,ll=aa.unstable_NormalPriority,cl=aa.unstable_IdlePriority,ul=aa.log,dl=aa.unstable_setDisableYieldValue,hl=null,pl=null,fl="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},gl="function"==typeof reportError?reportError:function(e){if("object"==typeof window&&"function"==typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"==typeof e&&null!==e&&"string"==typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"==typeof process&&"function"==typeof process.emit)return void process.emit("uncaughtException",e)},ml=Object.prototype.hasOwnProperty,xl=!1,yl=new WeakMap,vl=[],bl=0,Sl=null,_l=0,Cl=[],wl=0,kl=null,jl=1,Al="",Pl=d(null),Tl=d(null),zl=d(null),Il=d(null),El=null,Ml=null,Nl=!1,Rl=null,Dl=!1,Ll=Error(r(519)),Gl=d(null),Ol=null,Fl=null,Wl="undefined"!=typeof AbortController?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(t,n){e.push(n)}};this.abort=function(){t.aborted=!0,e.forEach(function(e){return e()})}},ql=aa.unstable_scheduleCallback,Bl=aa.unstable_NormalPriority,$l={$$typeof:fa,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0},Hl=null,Vl=null,Ul=!1,Ql=!1,Yl=!1,Xl=0,Kl=null,Jl=0,Zl=0,ec=null,tc=ka.S;ka.S=function(e,t){wu=al(),"object"==typeof t&&null!==t&&"function"==typeof t.then&&function(e,t){if(null===Kl){var n=Kl=[];Jl=0,Zl=fe(),ec={status:"pending",value:void 0,then:function(e){n.push(e)}}}Jl++,t.then(ge,ge)}(0,t),null!==tc&&tc(e,t)};var nc=d(null),rc=Error(r(460)),ic=Error(r(474)),ac=Error(r(542)),sc={then:function(){}},oc=null,lc=null,cc=0,uc=Te(!0),dc=Te(!1),hc=[],pc=0,fc=0,gc=!1,mc=!1,xc=d(null),yc=d(0),vc=d(null),bc=null,Sc=d(0),_c=0,Cc=null,wc=null,kc=null,jc=!1,Ac=!1,Pc=!1,Tc=0,zc=0,Ic=null,Ec=0,Mc={readContext:te,use:ft,useCallback:nt,useContext:nt,useEffect:nt,useImperativeHandle:nt,useLayoutEffect:nt,useInsertionEffect:nt,useMemo:nt,useReducer:nt,useRef:nt,useState:nt,useDebugValue:nt,useDeferredValue:nt,useTransition:nt,useSyncExternalStore:nt,useId:nt,useHostTransitionStatus:nt,useFormState:nt,useActionState:nt,useOptimistic:nt,useMemoCache:nt,useCacheRefresh:nt};Mc.useEffectEvent=nt;var Nc={readContext:te,use:ft,useCallback:function(e,t){return dt().memoizedState=[e,void 0===t?null:t],e},useContext:te,useEffect:$t,useImperativeHandle:function(e,t,n){n=null!=n?n.concat([e]):null,qt(4194308,4,Yt.bind(null,t,e),n)},useLayoutEffect:function(e,t){return qt(4194308,4,e,t)},useInsertionEffect:function(e,t){qt(4,2,e,t)},useMemo:function(e,t){var n=dt();t=void 0===t?null:t;var r=e();if(Pc){j(!0);try{e()}finally{j(!1)}}return n.memoizedState=[r,t],r},useReducer:function(e,t,n){var r=dt();if(void 0!==n){var i=n(t);if(Pc){j(!0);try{n(t)}finally{j(!1)}}}else i=t;return r.memoizedState=r.baseState=i,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:i},r.queue=e,e=e.dispatch=cn.bind(null,Cc,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},dt().memoizedState=e},useState:function(e){var t=(e=jt(e)).queue,n=un.bind(null,Cc,t);return t.dispatch=n,[e.memoizedState,n]},useDebugValue:Kt,useDeferredValue:function(e,t){return en(dt(),e,t)},useTransition:function(){var e=jt(!1);return e=nn.bind(null,Cc,e.queue,!0,!1),dt().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,n){var i=Cc,a=dt();if(Nl){if(void 0===n)throw Error(r(407));n=n()}else{if(n=t(),null===au)throw Error(r(349));127&ou||St(i,t,n)}a.memoizedState=n;var s={value:n,getSnapshot:t};return a.queue=s,$t(Ct.bind(null,i,s,e),[e]),i.flags|=2048,Ft(9,{destroy:void 0},_t.bind(null,i,s,n,t),null),n},useId:function(){var e=dt(),t=au.identifierPrefix;if(Nl){var n=Al;t="_"+t+"R_"+(n=(jl&~(1<<32-Yo(jl)-1)).toString(32)+n),0<(n=Tc++)&&(t+="H"+n.toString(32)),t+="_"}else t="_"+t+"r_"+(n=Ec++).toString(32)+"_";return e.memoizedState=t},useHostTransitionStatus:an,useFormState:Rt,useActionState:Rt,useOptimistic:function(e){var t=dt();t.memoizedState=t.baseState=e;var n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=n,t=hn.bind(null,Cc,!0,n),n.dispatch=t,[e,t]},useMemoCache:gt,useCacheRefresh:function(){return dt().memoizedState=ln.bind(null,Cc)},useEffectEvent:function(e){var t=dt(),n={impl:e};return t.memoizedState=n,function(){if(2&iu)throw Error(r(440));return n.impl.apply(void 0,arguments)}}},Rc={readContext:te,use:ft,useCallback:Jt,useContext:te,useEffect:Ht,useImperativeHandle:Xt,useInsertionEffect:Ut,useLayoutEffect:Qt,useMemo:Zt,useReducer:xt,useRef:Wt,useState:function(){return xt(mt)},useDebugValue:Kt,useDeferredValue:function(e,t){return tn(ht(),wc.memoizedState,e,t)},useTransition:function(){var e=xt(mt)[0],t=ht().memoizedState;return["boolean"==typeof e?e:pt(e),t]},useSyncExternalStore:bt,useId:sn,useHostTransitionStatus:an,useFormState:Dt,useActionState:Dt,useOptimistic:function(e,t){return At(ht(),0,e,t)},useMemoCache:gt,useCacheRefresh:on};Rc.useEffectEvent=Vt;var Dc={readContext:te,use:ft,useCallback:Jt,useContext:te,useEffect:Ht,useImperativeHandle:Xt,useInsertionEffect:Ut,useLayoutEffect:Qt,useMemo:Zt,useReducer:vt,useRef:Wt,useState:function(){return vt(mt)},useDebugValue:Kt,useDeferredValue:function(e,t){var n=ht();return null===wc?en(n,e,t):tn(n,wc.memoizedState,e,t)},useTransition:function(){var e=vt(mt)[0],t=ht().memoizedState;return["boolean"==typeof e?e:pt(e),t]},useSyncExternalStore:bt,useId:sn,useHostTransitionStatus:an,useFormState:Ot,useActionState:Ot,useOptimistic:function(e,t){var n=ht();return null!==wc?At(n,0,e,t):(n.baseState=e,[e,n.queue.dispatch])},useMemoCache:gt,useCacheRefresh:on};Dc.useEffectEvent=Vt;var Lc={enqueueSetState:function(e,t,n){e=e._reactInternals;var r=ii(),i=Oe(r);i.payload=t,null!=n&&(i.callback=n),null!==(t=Fe(e,i,r))&&(si(t,0,r),We(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=ii(),i=Oe(r);i.tag=1,i.payload=t,null!=n&&(i.callback=n),null!==(t=Fe(e,i,r))&&(si(t,0,r),We(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=ii(),r=Oe(n);r.tag=2,null!=t&&(r.callback=t),null!==(t=Fe(e,r,n))&&(si(t,0,n),We(t,e,n))}},Gc=Error(r(461)),Oc=!1,Fc={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null},Wc=!1,qc=!1,Bc=!1,$c="function"==typeof WeakSet?WeakSet:Set,Hc=null,Vc=null,Uc=!1,Qc=null,Yc=8192,Xc={getCacheForType:function(e){var t=te($l),n=t.data.get(e);return void 0===n&&(n=e(),t.data.set(e,n)),n},cacheSignal:function(){return te($l).controller.signal}},Kc=0,Jc=1,Zc=2,eu=3,tu=4;if("function"==typeof Symbol&&Symbol.for){var nu=Symbol.for;Kc=nu("selector.component"),Jc=nu("selector.has_pseudo_class"),Zc=nu("selector.role"),eu=nu("selector.test_id"),tu=nu("selector.text")}var ru="function"==typeof WeakMap?WeakMap:Map,iu=0,au=null,su=null,ou=0,lu=0,cu=null,uu=!1,du=!1,hu=!1,pu=0,fu=0,gu=0,mu=0,xu=0,yu=0,vu=0,bu=null,Su=null,_u=!1,Cu=0,wu=0,ku=1/0,ju=null,Au=null,Pu=0,Tu=null,zu=null,Iu=0,Eu=0,Mu=null,Nu=null,Ru=0,Du=null;return ra.attemptContinuousHydration=function(e){if(13===e.tag||31===e.tag){var t=Me(e,67108864);null!==t&&si(t,0,67108864),na(e,67108864)}},ra.attemptHydrationAtCurrentPriority=function(e){if(13===e.tag||31===e.tag){var t=ii(),n=Me(e,t=w(t));null!==n&&si(n,0,t),na(e,t)}},ra.attemptSynchronousHydration=function(e){switch(e.tag){case 3:if((e=e.stateNode).current.memoizedState.isDehydrated){var t=f(e.pendingLanes);if(0!==t){for(e.pendingLanes|=2,e.entangledLanes|=2;t;){var n=1<<31-Yo(t);e.entanglements[1]|=n,t&=~n}oe(e),!(6&iu)&&(ku=al()+500,le(0))}}break;case 31:case 13:null!==(t=Me(e,2))&&si(t,0,2),di(),na(e,2)}},ra.batchedUpdates=function(e,t){return e(t)},ra.createComponentSelector=function(e){return{$$typeof:Kc,value:e}},ra.createContainer=function(e,t,n,r,i,a,s,o,l,c){return Ki(e,t,!1,null,0,r,a,null,s,o,l,c)},ra.createHasPseudoClassSelector=function(e){return{$$typeof:Jc,value:e}},ra.createHydrationContainer=function(e,t,n,r,i,a,s,o,l,c,u,d,h,p){return(e=Ki(n,r,!0,e,0,a,o,p,l,c,u,d)).context=Ji(null),n=e.current,(i=Oe(r=w(r=ii()))).callback=null!=t?t:null,Fe(n,i,r),t=r,e.current.lanes=t,b(e,t),oe(e),e},ra.createPortal=function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:ca,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}},ra.createRoleSelector=function(e){return{$$typeof:Zc,value:e}},ra.createTestNameSelector=function(e){return{$$typeof:eu,value:e}},ra.createTextSelector=function(e){return{$$typeof:tu,value:e}},ra.defaultOnCaughtError=function(e){},ra.defaultOnRecoverableError=function(e){gl(e)},ra.defaultOnUncaughtError=function(e){gl(e)},ra.deferredUpdates=function(e){var t=ka.T,n=Ya();try{return Qa(32),ka.T=null,e()}finally{Qa(n),ka.T=t}},ra.discreteUpdates=function(e,t,n,r,i){var a=ka.T,s=Ya();try{return Qa(2),ka.T=null,e(t,n,r,i)}finally{Qa(s),ka.T=a,0===iu&&(ku=al()+500)}},ra.findAllNodes=ri,ra.findBoundingRects=function(e,t){if(!ds)throw Error(r(363));t=ri(e,t),e=[];for(var n=0;n<t.length;n++)e.push(ps(t[n]));for(t=e.length-1;0<t;t--)for(var i=(n=e[t]).x,a=i+n.width,s=n.y,o=s+n.height,l=t-1;0<=l;l--)if(t!==l){var c=e[l],u=c.x,d=u+c.width,h=c.y,p=h+c.height;if(i>=u&&s>=h&&a<=d&&o<=p){e.splice(t,1);break}if(!(i!==u||n.width!==c.width||p<s||h>o)){h>s&&(c.height+=h-s,c.y=s),p<o&&(c.height=o-h),e.splice(t,1);break}if(!(s!==h||n.height!==c.height||d<i||u>a)){u>i&&(c.width+=u-i,c.x=i),d<a&&(c.width=a-u),e.splice(t,1);break}}return e},ra.findHostInstance=Zi,ra.findHostInstanceWithNoPortals=function(e){return null===(e=null!==(e=s(e))?l(e):null)?null:Ta(e.stateNode)},ra.findHostInstanceWithWarning=function(e){return Zi(e)},ra.flushPassiveEffects=Ei,ra.flushSyncFromReconciler=function(e){var t=iu;iu|=1;var n=ka.T,r=Ya();try{if(Qa(2),ka.T=null,e)return e()}finally{Qa(r),ka.T=n,!(6&(iu=t))&&le(0)}},ra.flushSyncWork=di,ra.focusWithin=function(e,t){if(!ds)throw Error(r(363));for(t=ni(e=Zr(e),t),t=Array.from(t),e=0;e<t.length;){var n=t[e++],i=n.tag;if(!gs(n)){if((5===i||26===i||27===i)&&xs(n.stateNode))return!0;for(n=n.child;null!==n;)t.push(n),n=n.sibling}}return!1},ra.getFindAllNodesFailureDescription=function(e,t){if(!ds)throw Error(r(363));var n=0,i=[];e=[Zr(e),0];for(var a=0;a<e.length;){var s=e[a++],o=s.tag,l=e[a++],c=t[l];if((5!==o&&26!==o&&27!==o||!gs(s))&&(ei(s,c)&&(i.push(ti(c)),++l>n&&(n=l)),l<t.length))for(s=s.child;null!==s;)e.push(s,l),s=s.sibling}if(n<t.length){for(e=[];n<t.length;n++)e.push(ti(t[n]));return"findAllNodes was able to match part of the selector:\n  "+i.join(" > ")+"\n\nNo matching component was found for:\n  "+e.join(" > ")}return null},ra.getPublicRootInstance=function(e){if(!(e=e.current).child)return null;switch(e.child.tag){case 27:case 5:return Ta(e.child.stateNode);default:return e.child.stateNode}},ra.injectIntoDevTools=function(){var e={bundleType:0,version:ja,rendererPackageName:Aa,currentDispatcherRef:ka,reconcilerVersion:"19.2.0"};if(null!==Pa&&(e.rendererConfig=Pa),"undefined"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)e=!1;else{var t=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(t.isDisabled||!t.supportsFiber)e=!0;else{try{hl=t.inject(e),pl=t}catch(n){}e=!!t.checkDCE}}return e},ra.isAlreadyRendering=function(){return!!(6&iu)},ra.observeVisibleRects=function(e,t,n,i){if(!ds)throw Error(r(363));e=ri(e,t);var a=ys(e,n,i).disconnect;return{disconnect:function(){a()}}},ra.shouldError=function(){return null},ra.shouldSuspend=function(){return!1},ra.startHostTransition=function(e,t,i,a){if(5!==e.tag)throw Error(r(476));var s=rn(e).queue;nn(e,s,t,ss,null===i?n:function(){var t=rn(e);return null===t.next&&(t=e.alternate.memoizedState),dn(e,t.next.queue,{},ii()),i(a)})},ra.updateContainer=function(e,t,n,r){var i=t.current,a=ii();return ea(i,a,e,t,n,r),a},ra.updateContainerSync=function(e,t,n,r){return ea(t.current,2,e,t,n,r),2},ra},e.exports.default=e.exports,Object.defineProperty(e.exports,"__esModule",{value:!0})),ji.exports;var e}const Pi=Pe((wi||(wi=1,ki.exports=Ai()),ki.exports));var Ti,zi,Ii={exports:{}},Ei={};var Mi=(zi||(zi=1,Ii.exports=(Ti||(Ti=1,Ei.ConcurrentRoot=1,Ei.ContinuousEventPriority=8,Ei.DefaultEventPriority=32,Ei.DiscreteEventPriority=2,Ei.IdleEventPriority=268435456,Ei.LegacyRoot=0,Ei.NoEventPriority=0),Ei)),Ii.exports);const Ni={children:!0,ref:!0,key:!0,style:!0,forwardedRef:!0,unstable_applyCache:!0,unstable_applyDrawHitFromCache:!0};let Ri=!1,Di=!1;const Li=".react-konva-event",Gi={};function Oi(e,t,n=Gi){if(!Ri&&"zIndex"in t&&(Ri=!0),!Di&&t.draggable){var r=void 0!==t.x||void 0!==t.y,i=t.onDragEnd||t.onDragMove;r&&!i&&(Di=!0)}for(var a in n)if(!Ni[a]){var s="on"===a.slice(0,2),o=n[a]!==t[a];if(s&&o)"content"===(p=a.substr(2).toLowerCase()).substr(0,7)&&(p="content"+p.substr(7,1).toUpperCase()+p.substr(8)),e.off(p,n[a]);!t.hasOwnProperty(a)&&e.setAttr(a,void 0)}var l=t._useStrictMode,c={},u=!1;const d={};for(var a in t)if(!Ni[a]){s="on"===a.slice(0,2);var h=n[a]!==t[a];if(s&&h)"content"===(p=a.substr(2).toLowerCase()).substr(0,7)&&(p="content"+p.substr(7,1).toUpperCase()+p.substr(8)),t[a]&&(d[p]=t[a]);!s&&(t[a]!==n[a]||l&&t[a]!==e.getAttr(a))&&(u=!0,c[a]=t[a])}for(var p in u&&(e.setAttrs(c),Fi(e)),d)e.off(p+Li),e.on(p+Li,d[p])}function Fi(e){if(!ot.autoDrawEnabled){var t=e.getLayer()||e.getStage();t&&t.batchDraw()}}var Wi=Ne();const qi={},Bi={};cr.Node.prototype._applyProps=Oi;let $i=Mi.DefaultEventPriority;const Hi=setTimeout,Vi=clearTimeout;function Ui(e,t,n){t._remove(),e.add(t),t.setZIndex(n.getZIndex()),Fi(e)}const Qi=Te.createContext(null);const Yi=Object.freeze(Object.defineProperty({__proto__:null,HostTransitionContext:Qi,NotPendingTransition:null,afterActiveInstanceBlur:function(){},appendChild:function(e,t){t.parent===e?t.moveToTop():e.add(t),Fi(e)},appendChildToContainer:function(e,t){t.parent===e?t.moveToTop():e.add(t),Fi(e)},appendInitialChild:function(e,t){"string"!=typeof t&&(e.add(t),Fi(e))},beforeActiveInstanceBlur:function(){},cancelTimeout:Vi,clearContainer:function(e){},commitMount:function(e,t,n){},commitTextUpdate:function(e,t,n){},commitUpdate:function(e,t,n,r){Oi(e,r,n)},createInstance:function(e,t,n){let r=cr[e];r||(r=cr.Group);const i={},a={};for(var s in t){if("ref"!==s)"on"===s.slice(0,2)?a[s]=t[s]:i[s]=t[s]}const o=new r(i);return Oi(o,a),o},createTextInstance:function(e,t,n){},detachDeletedInstance:function(){},finalizeInitialChildren:function(e,t,n){return!1},getChildHostContext:function(){return qi},getCurrentEventPriority:function(){return Mi.DefaultEventPriority},getCurrentUpdatePriority:function(){return $i},getInstanceFromNode:function(){return null},getInstanceFromScope:function(){return null},getPublicInstance:function(e){return e},getRootHostContext:function(){return qi},hideInstance:function(e){e.hide(),Fi(e)},hideTextInstance:function(e){},idlePriority:Wi.unstable_IdlePriority,insertBefore:Ui,insertInContainerBefore:function(e,t,n){Ui(e,t,n)},isPrimaryRenderer:!1,maySuspendCommit:function(){return!1},noTimeout:-1,now:Wi.unstable_now,preloadInstance:function(){return!0},prepareForCommit:function(){return null},preparePortalMount:function(){return null},prepareScopeUpdate:function(){},prepareUpdate:function(e,t,n,r){return Bi},removeChild:function(e,t){t.destroy(),t.off(Li),Fi(e)},removeChildFromContainer:function(e,t){t.destroy(),t.off(Li),Fi(e)},requestPostPaintCallback:function(){},resetAfterCommit:function(){},resetFormInstance:function(){},resetTextContent:function(e){},resolveEventTimeStamp:function(){return-1.1},resolveEventType:function(){return null},resolveUpdatePriority:function(){return Mi.DiscreteEventPriority},run:Wi.unstable_runWithPriority,scheduleMicrotask:e=>{e()},scheduleTimeout:Hi,setCurrentUpdatePriority:function(e){$i=e},shouldAttemptEagerTransition:function(){return!1},shouldDeprioritizeSubtree:function(e,t){return!1},shouldSetTextContent:function(e,t){return!1},startSuspendingCommit:function(){},supportsHydration:!1,supportsMicrotasks:!0,supportsMutation:!0,supportsPersistence:!1,suspendInstance:function(){},trackSchedulerEvent:function(){},unhideInstance:function(e,t){(null==t.visible||t.visible)&&e.show()},unhideTextInstance:function(e,t){},waitForCommitToBeReady:function(){return null},warnsIfNotActing:!1},Symbol.toStringTag,{value:"Module"}));function Xi(e,t,n){if(!e)return;if(!0===n(e))return e;let r=e.child;for(;r;){const e=Xi(r,t,n);if(e)return e;r=r.sibling}}function Ki(e){try{return Object.defineProperties(e,{_currentRenderer:{get:()=>null,set(){}},_currentRenderer2:{get:()=>null,set(){}}})}catch(t){return e}}const Ji=Ki(je.createContext(null));class Zi extends je.Component{render(){return je.createElement(Ji.Provider,{value:this._reactInternals},this.props.children)}}const ea=Symbol.for("react.context"),ta=e=>null!==e&&"object"==typeof e&&"$$typeof"in e&&e.$$typeof===ea;function na(){const e=function(){const e=je.useContext(Ji);if(null===e)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const t=je.useId();return je.useMemo(()=>{for(const n of[e,null==e?void 0:e.alternate]){if(!n)continue;const e=Xi(n,!1,e=>{let n=e.memoizedState;for(;n;){if(n.memoizedState===t)return!0;n=n.next}});if(e)return e}},[e,t])}(),[t]=je.useState(()=>new Map);t.clear();let n=e;for(;n;){const e=n.type;ta(e)&&e!==Ji&&!t.has(e)&&t.set(e,je.use(Ki(e))),n=n.return}return t}if(-1===Te.version.indexOf("19"))throw new Error("react-konva version 19 is only compatible with React 19. Make sure to have the last version of react-konva and react or downgrade react-konva to version 18.");const ra=e=>{const t=Te.useRef(null),n=Te.useRef(null),r=Te.useRef(null),i=function(e){const t=Te.useRef({});return Te.useLayoutEffect(()=>{t.current=e}),Te.useLayoutEffect(()=>()=>{t.current={}},[]),t.current}(e),a=function(){const e=na();return je.useMemo(()=>Array.from(e.keys()).reduce((t,n)=>r=>je.createElement(t,null,je.createElement(n.Provider,{...r,value:e.get(n)})),e=>je.createElement(Zi,{...e})),[e])}(),s=Te.useRef(!1),o=t=>{const{forwardedRef:n}=e;n&&("function"==typeof n?n(t):n.current=t)},l=(()=>{const e=Te.useRef(0);return Te.useMemo(()=>{e.current++},[]),e.current>1})();return Te.useLayoutEffect(()=>s.current&&l?()=>{s.current=!1,o(null),ua.updateContainer(null,r.current,null),n.current.destroy()}:(s.current=!0,n.current=new cr.Stage({width:e.width,height:e.height,container:t.current}),o(n.current),r.current=ua.createContainer(n.current,Mi.ConcurrentRoot,null,!1,null,"",console.error,console.error,console.error,null),ua.updateContainer(Te.createElement(a,{},e.children),r.current,null,()=>{}),()=>{l||(o(null),ua.updateContainer(null,r.current,null),n.current.destroy())}),[]),Te.useLayoutEffect(()=>{o(n.current),Oi(n.current,e,i),ua.updateContainer(Te.createElement(a,{},e.children),r.current,null)}),Te.createElement("div",{ref:t,id:e.id,accessKey:e.accessKey,className:e.className,role:e.role,style:e.style,tabIndex:e.tabIndex,title:e.title})},ia="Layer",aa="Group",sa="Circle",oa="Line",la="Image",ca="Text",ua=Pi(Yi),da=Te.forwardRef((e,t)=>Te.createElement(Zi,{},Te.createElement(ra,{...e,forwardedRef:t}))),ha=["Surface Defect","Dimensional Defect","Material Defect","Assembly Defect","Functional Defect","Cosmetic Defect","Structural Defect","Other"],pa=({images:r,existingAnnotations:a=[],onSave:o,readOnly:l=!1})=>{const[c,u]=je.useState(0),[d,p]=je.useState(a),[g,m]=je.useState("none");je.useEffect(()=>{p(a)},[a]);const[x,y]=je.useState(!1),[b,S]=je.useState([]),[_,C]=je.useState(null),[w,j]=je.useState(!1),[A,P]=je.useState(""),[T,z]=je.useState(""),[I,E]=je.useState(!1),[M,N]=je.useState(!1),[R,D]=je.useState({width:0,height:0}),[L,G]=je.useState(null),[O,F]=je.useState(1),[W,Q]=je.useState({x:0,y:0}),[Y,X]=je.useState(!1),[ae,se]=je.useState({x:0,y:0}),[oe,le]=je.useState({width:600,height:400}),ce=je.useRef(null),ue=je.useRef(null),de=r[c],he=de?.filePath?`https://indocool-prc-backend.onrender.com/${de.filePath}`:"",pe=je.useCallback(()=>d.find(e=>e.imageFileName===de?.fileName)?.regions||[],[d,de]),fe=je.useCallback((e,t)=>{let n=e,r=t;if(e>800||t>600){const i=800/e,a=600/t,s=Math.min(i,a);n=e*s,r=t*s}if(e<400||t<300){const i=400/e,a=300/t,s=Math.min(i,a);n=e*s,r=t*s}return{width:Math.round(n),height:Math.round(r)}},[]);je.useEffect(()=>{if(he){const e=new window.Image;e.crossOrigin="anonymous",e.onload=()=>{D({width:e.width,height:e.height});const t=fe(e.width,e.height);le(t),E(!0),G(e)},e.onerror=e=>{N(!0),E(!1),G(null)},e.src=he}},[he,fe]);const ge=je.useCallback((e,t,n=15)=>t.some(t=>Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))<=n),[]),me=je.useCallback(e=>{if(l||"none"===g)return;const t=ce.current;if(!t)return;const n=t.getPointerPosition();if(!n)return;const r=t.scaleX(),i=(n.x-t.x())/r,a=(n.y-t.y())/r;if("point"===g){const e={type:"point",id:`point-${Date.now()}`,x:i/oe.width,y:a/oe.height,cls:"defect",comment:"",category:""};C(e),j(!0)}else if("polygon"===g)if(x)if(b.length>=3&&ge([i,a],[b[0]])){const e={type:"polygon",id:`polygon-${Date.now()}`,points:b.map(([e,t])=>[e/oe.width,t/oe.height]),cls:"inspection-area",comment:"",category:""};C(e),j(!0),y(!1),S([])}else S(e=>[...e,[i,a]]);else S([[i,a]]),y(!0)},[g,l,oe,x,b,ge]),xe=je.useCallback(e=>{if(l||"polygon"!==g||!x||b.length<3)return;const t={type:"polygon",id:`polygon-${Date.now()}`,points:b.map(([e,t])=>[e/oe.width,t/oe.height]),cls:"inspection-area",comment:"",category:""};C(t),j(!0),y(!1),S([])},[l,g,x,b,oe]),ye=je.useCallback(()=>{if(!_||!de)return;const e={..._,comment:A,category:T},t=[...pe(),e],n=d.filter(e=>e.imageFileName!==de.fileName);n.push({imageFileName:de.fileName,imageUrl:he,regions:t}),p(n),j(!1),P(""),z(""),C(null),o(n)},[_,A,T,de,he,pe,d,o]),ve=je.useCallback(e=>{if(!de)return;const t=pe().filter(t=>t.id!==e),n=d.filter(e=>e.imageFileName!==de.fileName);t.length>0&&n.push({imageFileName:de.fileName,imageUrl:he,regions:t}),p(n),o(n)},[de,pe,d,he,o]),be=je.useCallback(()=>{o(d)},[d,o]);je.useEffect(()=>{y(!1),S([])},[g]);const Se=je.useCallback(()=>{F(e=>Math.min(1.2*e,3))},[]),_e=je.useCallback(()=>{F(e=>Math.max(e/1.2,.5))},[]),Ce=je.useCallback(()=>{F(1),Q({x:0,y:0})},[]),we=je.useCallback(e=>{const t=e;t.target===t.target.getStage()&&(X(!0),se({x:t.evt.clientX-W.x,y:t.evt.clientY-W.y}))},[W]),ke=je.useCallback(e=>{if(Y){const t=e,n={x:t.evt.clientX-ae.x,y:t.evt.clientY-ae.y};Q(n)}},[Y,ae]),Ae=je.useCallback(()=>{X(!1)},[]),Pe=je.useCallback(e=>{const t=e;t.evt.preventDefault();const n=t.target.getStage().scaleX(),r=t.evt.deltaY>0?1.1*n:n/1.1;F(Math.max(.5,Math.min(3,r)))},[]);return de?e.jsxs(t,{sx:{p:2},children:[e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(i,{variant:"h6",children:["Image Annotation (",c+1," of ",r.length,")"]}),e.jsx(t,{sx:{display:"flex",gap:1},children:!l&&e.jsxs(e.Fragment,{children:[e.jsx(n,{variant:"point"===g?"contained":"outlined",size:"small",startIcon:e.jsx(q,{}),onClick:()=>m("point"===g?"none":"point"),children:"Point"}),e.jsx(n,{variant:"polygon"===g?"contained":"outlined",size:"small",startIcon:e.jsx(q,{}),onClick:()=>m("polygon"===g?"none":"polygon"),children:"Polygon"}),e.jsx(n,{variant:"contained",size:"small",startIcon:e.jsx(f,{}),onClick:be,color:"primary",children:"Save Annotations"})]})})]}),r.length>1&&e.jsx(t,{sx:{display:"flex",gap:1,mb:2,flexWrap:"wrap"},children:r.map((t,n)=>e.jsx(s,{label:`Image ${n+1}`,variant:n===c?"filled":"outlined",onClick:()=>u(n),clickable:!0},n))}),e.jsxs(v,{sx:{p:2,mb:2},children:[e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(i,{variant:"subtitle1",children:"Annotation Canvas"}),e.jsxs(t,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e.jsx(h,{size:"small",onClick:_e,disabled:O<=.5,children:e.jsx(K,{})}),e.jsxs(i,{variant:"body2",sx:{minWidth:60,textAlign:"center"},children:[Math.round(100*O),"%"]}),e.jsx(h,{size:"small",onClick:Se,disabled:O>=3,children:e.jsx(J,{})}),e.jsx(h,{size:"small",onClick:Ce,children:e.jsx(Z,{})})]})]}),e.jsxs(t,{sx:{border:"1px solid #e0e0e0",borderRadius:1,overflow:"hidden",position:"relative",background:"#fafafa",display:"flex",justifyContent:"center",alignItems:"center"},children:[!I&&!M&&e.jsx(t,{sx:{width:oe.width,height:oe.height,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"grey.100"},children:e.jsx(i,{children:"Loading image..."})}),M&&e.jsx(t,{sx:{width:oe.width,height:oe.height,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"grey.100"},children:e.jsx(i,{color:"error",children:"Failed to load image"})}),I&&e.jsx(da,{ref:ce,width:oe.width,height:oe.height,scaleX:O,scaleY:O,x:W.x,y:W.y,onClick:me,onDblClick:xe,onMouseDown:we,onMouseMove:ke,onMouseUp:Ae,onWheel:Pe,draggable:!1,children:e.jsxs(ia,{children:[e.jsx(la,{ref:ue,image:L||void 0,width:oe.width,height:oe.height}),pe().map((t,n)=>((t,n)=>{if("point"===t.type){const r=t.x*oe.width,i=t.y*oe.height;return e.jsx(aa,{children:e.jsxs(aa,{children:[e.jsx(sa,{x:r,y:i,radius:10,fill:"rgba(244, 67, 54, 0.15)",stroke:"rgba(244, 67, 54, 0.3)",strokeWidth:1}),e.jsx(sa,{x:r,y:i,radius:9,fill:"white",stroke:"#f44336",strokeWidth:2,shadowColor:"rgba(0,0,0,0.25)",shadowBlur:3,shadowOffset:{x:0,y:1},shadowOpacity:.4}),e.jsx(sa,{x:r,y:i,radius:7,fill:"rgba(255,255,255,0.8)",stroke:"none"}),e.jsx(ca,{x:r+12,y:i-8,text:`${n+1}`,fontSize:12,fontWeight:"bold",fill:"#f44336",align:"center",verticalAlign:"middle",width:18,height:12,onClick:()=>C(t)})]})},t.id)}if("polygon"===t.type){const r=t.points.flatMap(([e,t])=>[e*oe.width,t*oe.height]),i=r.reduce((e,t,n)=>n%2==0?e+t:e,0)/(r.length/2),a=r.reduce((e,t,n)=>n%2==1?e+t:e,0)/(r.length/2);return e.jsxs(aa,{children:[e.jsx(oa,{points:r,closed:!0,stroke:"#1976d2",strokeWidth:2,fill:"rgba(25, 118, 210, 0.1)",onClick:()=>C(t)}),e.jsxs(aa,{children:[e.jsx(sa,{x:i,y:a,radius:10,fill:"rgba(25, 118, 210, 0.15)",stroke:"rgba(25, 118, 210, 0.3)",strokeWidth:1}),e.jsx(sa,{x:i,y:a,radius:9,fill:"white",stroke:"#1976d2",strokeWidth:2,shadowColor:"rgba(0,0,0,0.25)",shadowBlur:3,shadowOffset:{x:0,y:1},shadowOpacity:.4}),e.jsx(sa,{x:i,y:a,radius:7,fill:"rgba(255,255,255,0.8)",stroke:"none"}),e.jsx(ca,{x:i+12,y:a-8,text:`${n+1}`,fontSize:12,fontWeight:"bold",fill:"#1976d2",align:"center",verticalAlign:"middle",width:18,height:12})]})]},t.id)}return null})(t,n)),(()=>{if(!x||0===b.length)return null;const t=b.flat();return e.jsxs(aa,{children:[e.jsx(oa,{points:t,stroke:"#4caf50",strokeWidth:2,dash:[5,5]}),b.map(([t,n],r)=>e.jsx(sa,{x:t,y:n,radius:4,fill:"#4caf50",stroke:"white",strokeWidth:1},r))]})})()]})})]})]}),pe().length>0&&e.jsxs(v,{sx:{p:2},children:[e.jsxs(i,{variant:"subtitle2",sx:{mb:2,fontWeight:600},children:["Annotations (",pe().length,")"]}),e.jsx(t,{sx:{display:"flex",flexDirection:"column",gap:1},children:pe().map((n,r)=>e.jsxs(t,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",p:1.5,border:"1px solid #e0e0e0",borderRadius:1,bgcolor:"white","&:hover":{bgcolor:"#f5f5f5"}},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:2,flex:1},children:[e.jsx(t,{sx:{width:24,height:24,borderRadius:"50%",bgcolor:"point"===n.type?"#f44336":"#1976d2",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"12px",fontWeight:"bold"},children:r+1}),e.jsxs(t,{sx:{flex:1},children:[e.jsxs(i,{variant:"body2",sx:{fontWeight:500},children:["point"===n.type?"Point":"Polygon"," • ",n.cls]}),n.category&&e.jsx(s,{label:n.category,size:"small",sx:{backgroundColor:"#e3f2fd",color:"#1976d2",fontSize:"0.625rem",height:"20px",mt:.5,mr:1}}),n.comment&&e.jsxs(i,{variant:"caption",color:"text.secondary",sx:{fontStyle:"italic",display:"block",mt:.5},children:['"',n.comment,'"']})]})]}),!l&&e.jsx(h,{size:"small",onClick:()=>ve(n.id),sx:{color:"error.main"},children:e.jsx(B,{fontSize:"small"})})]},n.id))})]}),e.jsxs(ee,{open:w,onClose:()=>j(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(te,{children:"Add Details to Annotation"}),e.jsxs(ne,{children:[e.jsxs($,{fullWidth:!0,margin:"dense",required:!0,children:[e.jsx(H,{children:"Defect Category"}),e.jsx(V,{value:T,onChange:e=>z(e.target.value),label:"Defect Category",variant:"outlined",children:ha.map(t=>e.jsx(U,{value:t,children:t},t))})]}),e.jsx(k,{margin:"dense",label:"Description",fullWidth:!0,multiline:!0,rows:3,value:A,onChange:e=>P(e.target.value),placeholder:"Add a description...",variant:"outlined"})]}),e.jsxs(re,{children:[e.jsx(n,{onClick:()=>j(!1),startIcon:e.jsx(ie,{}),children:"Cancel"}),e.jsx(n,{onClick:ye,variant:"contained",startIcon:e.jsx(f,{}),disabled:!T.trim(),children:"Save Annotation"})]})]})]}):e.jsx(t,{sx:{p:2,textAlign:"center"},children:e.jsx(i,{variant:"body1",color:"text.secondary",children:"No images available for annotation"})})};function fa(e){return e&&"object"==typeof e?Object.keys(e).sort((e,t)=>parseInt(e,10)-parseInt(t,10)).map(t=>{const n=e[t];if(!n||"object"!=typeof n)return null;const r={id:n.id,type:n.type,cls:n.cls,comment:n.comment};var i;return"point"===n.type&&void 0!==n.x&&void 0!==n.y?(r.x=n.x,r.y=n.y):"polygon"===n.type&&n.points&&(r.points=(i=n.points)&&"object"==typeof i?Object.keys(i).sort((e,t)=>parseInt(e,10)-parseInt(t,10)).map(e=>{const t=i[e];return t&&"object"==typeof t&&"0"in t&&"1"in t?[t[0],t[1]]:[0,0]}):[]),r}).filter(e=>null!==e):[]}function ga(e){if(!e||"object"!=typeof e)return{};const t={};return Object.entries(e).forEach(([e,n])=>{n&&"object"==typeof n&&Object.entries(n).forEach(([e,n])=>{var r;if(!["stepCompleted","productionApproved","ctqApproved","partialCtqApprove"].includes(e)&&(n&&"object"==typeof n)){const i={};"value"in n&&(i.value=n.value),"annotations"in n&&n.annotations&&(i.annotations=(r=n.annotations)&&"object"==typeof r?Object.keys(r).sort((e,t)=>parseInt(e,10)-parseInt(t,10)).map(e=>{const t=r[e];return t&&"object"==typeof t?{imageFileName:t.imageFileName,imageUrl:t.imageUrl,regions:fa(t.regions||{})}:null}).filter(e=>null!==e):[]),Object.keys(i).length>0&&(t[e]=i)}})}),t}const ma=({step:r,executionData:a,onStepComplete:o})=>{const[l,c]=je.useState({}),[u,d]=je.useState([]),[p,f]=je.useState(new Set),[g,m]=je.useState(new Set),j=je.useMemo(()=>{if(a.prcAggregatedSteps){let e=r.stepData?.prcTemplateStepId?a.prcAggregatedSteps[r.stepData.prcTemplateStepId]:void 0;if(!e)for(const[t,n]of Object.entries(a.prcAggregatedSteps))if("object"==typeof n&&null!==n){if(Object.keys(n).some(e=>r.inspectionParameters?.some(t=>t.id.toString()===e))){e=n;break}}if(e&&"object"==typeof e){const t=ga({temp:e}),n=Object.keys(t).length>0?t:e,i={},a=[];return Object.entries(n).forEach(([e,t])=>{if("object"==typeof t&&null!==t){const n={};let s=!1;Object.entries(t).forEach(([t,o])=>{if("annotations"===t&&Array.isArray(o))n.annotations=o,a.push(...o),s=!0;else if("value"===t&&"object"==typeof o&&null!==o){const t=r.inspectionParameters?.find(t=>t.id.toString()===e);if("table"===t?.type&&t?.columns&&t.columns.length>0&&Array.isArray(o)){o.forEach((n,r)=>{t&&t.columns&&t.columns.forEach(t=>{const a=`${e}_row_${r}_${t.name}`,s=n[t.name];i[a]=null!=s?String(s):""})})}else{const t=o.value;t&&"object"==typeof t&&null!==t&&!Array.isArray(t)?Object.entries(t).forEach(([t,n])=>{i[`${e}_${t}`]=String(n)}):Array.isArray(o)||Object.entries(o).forEach(([t,n])=>{i[`${e}_${t}`]=String(n)})}}else if("value"===t){const e=o.value;n.value=String(void 0!==e?e:o)}else{i[`${e}_${t}`]=String(o)}}),(s||void 0!==n.value)&&(i[e]=n)}else i[e]=String(t)}),a.length>0&&(i.annotations=a),i}}return{}},[a.prcAggregatedSteps,r.stepData,r.inspectionParameters]),[P,T]=je.useState(j);je.useEffect(()=>{const e={...j};if(r.inspectionParameters?.forEach(t=>{if("table"===t.type&&t.columns&&t.columns.length>0&&t.columns){Object.keys(e).some(e=>e.match(new RegExp(`^${t.id}_row_\\d+_`)))||t.columns.forEach(n=>{const r=`${t.id}_row_0_${n.name}`;e[r]=""})}}),T(e),j.annotations&&Array.isArray(j.annotations))d(j.annotations);else{const e=[];Object.entries(j).forEach(([t,n])=>{if("object"==typeof n&&null!==n&&"annotations"in n){const t=n.annotations;Array.isArray(t)&&e.push(...t)}}),d(e)}},[j,r.inspectionParameters]);const I="completed"===r.status,E=(e,t,n)=>{const r="value"===t?e.toString():`${e}_${t}`;T(i=>{const a={...i};if("value"===t){const t=a[e.toString()];a[e.toString()]="object"==typeof t&&null!==t?{...t,value:n}:{value:n}}else a[r]=n;return a}),l[r]&&c(e=>({...e,[r]:""}))},M=e=>{m(t=>{const n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n})},N=e=>{if(!r.inspectionParameters)return 0;const t=r.inspectionParameters.find(t=>t.id===e);if(!t||"table"!==t.type||!t.columns)return 0;let n=-1;return Object.keys(P).forEach(t=>{const r=t.match(new RegExp(`^${e}_row_(\\d+)_`));if(r){const e=parseInt(r[1],10);e>n&&(n=e)}}),n+1},D=(e,t,n,r)=>{const i=`${e}_row_${t}_${n}`;T(e=>{const t={...e};return t[i]=r,t}),l[i]&&c(e=>({...e,[i]:""}))};return e.jsxs(t,{sx:{p:2,backgroundColor:"white"},children:[e.jsxs(t,{sx:{mb:2},children:[e.jsx(i,{variant:"h6",sx:{fontWeight:600,color:"#333",mb:.5,lineHeight:1.3},children:r.title}),r.description&&r.description!==r.title&&e.jsx(i,{variant:"body2",sx:{color:"#666",fontSize:"0.875rem"},children:r.description})]}),r.inspectionMetadata&&e.jsx(t,{sx:{mb:2,p:1.5,backgroundColor:"#f8f9fa",borderRadius:1,border:"1px solid #e9ecef"},children:e.jsxs(R,{container:!0,spacing:1.5,children:[e.jsxs(R,{size:{xs:6,sm:3},children:[e.jsx(i,{variant:"caption",sx:{fontWeight:500,color:"#666",fontSize:"0.75rem"},children:"Inspection ID"}),e.jsx(i,{variant:"body2",sx:{fontSize:"0.875rem",fontWeight:500},children:r.inspectionMetadata.inspectionId})]}),e.jsxs(R,{size:{xs:6,sm:3},children:[e.jsx(i,{variant:"caption",sx:{fontWeight:500,color:"#666",fontSize:"0.75rem"},children:"Inspection Type"}),e.jsx(i,{variant:"body2",sx:{fontSize:"0.875rem",fontWeight:500},children:r.inspectionMetadata.type})]}),e.jsxs(R,{size:{xs:6,sm:3},children:[e.jsx(i,{variant:"caption",sx:{fontWeight:500,color:"#666",fontSize:"0.75rem"},children:"Status"}),e.jsx(i,{variant:"body2",sx:{fontSize:"0.875rem",fontWeight:500},children:r.inspectionMetadata.status})]}),e.jsxs(R,{size:{xs:6,sm:3},children:[e.jsx(i,{variant:"caption",sx:{fontWeight:500,color:"#666",fontSize:"0.75rem"},children:"Version"}),e.jsxs(i,{variant:"body2",sx:{fontSize:"0.875rem",fontWeight:500},children:["v",r.inspectionMetadata.version]})]})]})}),e.jsx(y,{component:v,sx:{mb:2},children:e.jsxs(b,{children:[e.jsx(S,{children:e.jsxs(_,{children:[e.jsx(C,{sx:{fontWeight:600,backgroundColor:"#f5f5f5"},children:"#"}),e.jsx(C,{sx:{fontWeight:600,backgroundColor:"#f5f5f5"},children:"Parameter Name"}),e.jsx(C,{sx:{fontWeight:600,backgroundColor:"#f5f5f5"},children:"CTQ"}),e.jsx(C,{sx:{fontWeight:600,backgroundColor:"#f5f5f5"},children:"Value"}),e.jsx(C,{sx:{fontWeight:600,backgroundColor:"#f5f5f5"},children:"Images"}),e.jsx(C,{sx:{fontWeight:600,backgroundColor:"#f5f5f5"},children:"Specification"}),e.jsx(C,{sx:{fontWeight:600,backgroundColor:"#f5f5f5"},children:"Actions"})]})}),e.jsx(w,{children:r.inspectionParameters?.map((a,o)=>{const m=Array.isArray(a.files)&&a.files.length>0,j="table"===a.type&&a.columns&&a.columns.length>0,A=!j&&a.columns&&a.columns.length>0,L=p.has(a.id),G=g.has(a.id),F=(W=a.id,u.filter(e=>r.inspectionParameters?.find(t=>t.id===W&&Array.isArray(t.files)&&t.files.some(t=>t.fileName===e.imageFileName))).length);var W;const H=j?N(a.id):0;return e.jsxs(e.Fragment,{children:[e.jsxs(_,{sx:{"&:hover":{backgroundColor:"#f8f9fa"},"&:nth-of-type(odd)":{backgroundColor:"#fafafa"}},children:[e.jsx(C,{sx:{fontWeight:500},children:o+1}),e.jsxs(C,{children:[e.jsx(i,{variant:"body2",sx:{fontWeight:500},children:a.parameterName}),e.jsxs(i,{variant:"caption",sx:{color:"#666",display:"block"},children:[a.type," • ",a.role,j&&" • Table",A&&` • ${a.columns?.length} fields`]})]}),e.jsx(C,{children:a.ctq&&e.jsx(s,{label:"CTQ",size:"small",color:"warning",sx:{fontSize:"0.75rem"}})}),e.jsx(C,{children:j?e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsxs(i,{variant:"caption",sx:{color:"#666"},children:[H," row",1!==H?"s":""]}),e.jsx(h,{size:"small",onClick:()=>M(a.id),sx:{color:"primary"},children:G?e.jsx(ae,{}):e.jsx(z,{})})]}):A?e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsxs(i,{variant:"caption",sx:{color:"#666"},children:[a.columns?.length," fields"]}),e.jsx(h,{size:"small",onClick:()=>M(a.id),sx:{color:"primary"},children:G?e.jsx(ae,{}):e.jsx(z,{})})]}):(()=>{const t=P[a.id.toString()],n=String("object"==typeof t&&null!==t&&"value"in t?t.value||"":t||"");return"ok/not ok"===a.type?e.jsxs($,{component:"fieldset",disabled:I,children:[e.jsx(Q,{component:"legend",sx:{fontSize:"0.875rem",color:"#666",mb:1},children:"Select Result"}),e.jsxs(Y,{row:!0,value:n,onChange:e=>E(a.id,"value",e.target.value),sx:{gap:2},children:[e.jsx(O,{value:"ok",control:e.jsx(X,{size:"small",color:"success"}),label:"OK",sx:{"& .MuiFormControlLabel-label":{fontSize:"0.875rem",color:"ok"===n?"#2e7d32":"#666"}}}),e.jsx(O,{value:"not ok",control:e.jsx(X,{size:"small",color:"error"}),label:"Not OK",sx:{"& .MuiFormControlLabel-label":{fontSize:"0.875rem",color:"not ok"===n?"#d32f2f":"#666"}}})]})]}):"datetime"===a.type?e.jsx(x,{dateAdapter:Ee,children:e.jsx(se,{label:"Value",value:n?Me(n):null,onChange:e=>{const t=e?e.format("YYYY-MM-DDTHH:mm"):"";E(a.id,"value",t)},disabled:I,slotProps:{textField:{size:"small",error:!!l[a.id.toString()],helperText:l[a.id.toString()],variant:"outlined",sx:{minWidth:200,"& .MuiOutlinedInput-root":{height:"40px"}}}}})}):e.jsx(k,{label:"Value",type:"number"===a.type?"number":"text",value:n,onChange:e=>E(a.id,"value",e.target.value),error:!!l[a.id.toString()],helperText:l[a.id.toString()],size:"small",disabled:I,variant:"outlined",inputProps:{min:0,step:"number"===a.type?.01:void 0},sx:{minWidth:120,"& .MuiOutlinedInput-root":{height:"40px"}}})})()}),e.jsx(C,{children:m?e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(oe,{color:"primary",fontSize:"small"}),e.jsxs(i,{variant:"caption",sx:{color:"#666"},children:[Array.isArray(a.files)?a.files.length:0," file",Array.isArray(a.files)&&1!==a.files.length?"s":""]}),F>0&&e.jsx(s,{label:F,size:"small",color:"primary",sx:{fontSize:"0.7rem",height:20}})]}):e.jsx(i,{variant:"caption",sx:{color:"#999"},children:"No images"})}),e.jsx(C,{children:e.jsx(le,{title:a.specification,arrow:!0,children:e.jsx(i,{variant:"caption",sx:{color:"#666",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",maxWidth:200},children:a.specification})})}),e.jsx(C,{children:e.jsx(t,{sx:{display:"flex",gap:.5},children:m&&e.jsx(h,{size:"small",onClick:()=>(e=>{f(t=>{const n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n})})(a.id),sx:{color:"primary"},title:"Toggle Image Annotation",children:L?e.jsx(ae,{}):e.jsx(z,{})})})})]},a.id),j&&e.jsx(_,{children:e.jsx(C,{colSpan:7,sx:{p:0,border:0},children:e.jsx(ce,{in:G,timeout:"auto",unmountOnExit:!0,children:e.jsxs(t,{sx:{p:2,backgroundColor:"#f8f9fa"},children:[e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(i,{variant:"subtitle2",sx:{fontWeight:600},children:[a.parameterName," - Table"]}),!I&&e.jsx(n,{variant:"outlined",size:"small",startIcon:e.jsx(q,{}),onClick:()=>(e=>{const t=r.inspectionParameters?.find(t=>t.id===e);if(!t||!t.columns)return;const n=N(e);T(r=>{const i={...r};return t.columns?.forEach(t=>{const r=`${e}_row_${n}_${t.name}`;i[r]=""}),i})})(a.id),sx:{textTransform:"none",borderRadius:"4px"},children:"Add Row"})]}),0!==H||I?e.jsx(y,{component:v,variant:"outlined",children:e.jsxs(b,{size:"small",children:[e.jsx(S,{children:e.jsxs(_,{sx:{backgroundColor:"#f5f5f5"},children:[a.columns?.map(t=>e.jsxs(C,{sx:{fontWeight:600,fontSize:"0.875rem"},children:[t.name,t.defaultValue&&e.jsxs(i,{variant:"caption",sx:{display:"block",color:"#666",fontWeight:400},children:["Default: ",t.defaultValue]})]},t.name)),!I&&e.jsx(C,{sx:{fontWeight:600,fontSize:"0.875rem",width:80},children:"Actions"})]})}),e.jsx(w,{children:Array.from({length:H},(t,n)=>e.jsxs(_,{children:[a.columns?.map(t=>{const r=`${a.id}_row_${n}_${t.name}`,i=String(P[r]||"");return e.jsx(C,{children:"ok/not ok"===t.type?e.jsx($,{component:"fieldset",disabled:I,size:"small",children:e.jsxs(Y,{row:!0,value:i,onChange:e=>D(a.id,n,t.name,e.target.value),sx:{gap:.5,m:0},children:[e.jsx(O,{value:"ok",control:e.jsx(X,{size:"small",color:"success"}),label:"OK",sx:{m:0,"& .MuiFormControlLabel-label":{fontSize:"0.75rem",color:"ok"===i?"#2e7d32":"#666"}}}),e.jsx(O,{value:"not ok",control:e.jsx(X,{size:"small",color:"error"}),label:"Not OK",sx:{m:0,"& .MuiFormControlLabel-label":{fontSize:"0.75rem",color:"not ok"===i?"#d32f2f":"#666"}}})]})}):"datetime"===t.type?e.jsx(x,{dateAdapter:Ee,children:e.jsx(se,{value:i?Me(i):null,onChange:e=>{const r=e?e.format("YYYY-MM-DDTHH:mm"):"";D(a.id,n,t.name,r)},disabled:I,slotProps:{textField:{size:"small",error:!!l[r],helperText:l[r],variant:"outlined",fullWidth:!0}}})}):e.jsx(k,{type:"number"===t.type?"number":"text",value:i,onChange:e=>D(a.id,n,t.name,e.target.value),error:!!l[r],helperText:l[r],size:"small",disabled:I,variant:"outlined",fullWidth:!0,inputProps:{min:0,step:"number"===t.type?.01:void 0}})},t.name)}),!I&&e.jsx(C,{children:e.jsx(h,{size:"small",onClick:()=>((e,t)=>{const n=r.inspectionParameters?.find(t=>t.id===e);n&&n.columns&&(T(r=>{const i={...r};let a=-1;Object.keys(i).forEach(t=>{const n=t.match(new RegExp(`^${e}_row_(\\d+)_`));if(n){const e=parseInt(n[1],10);e>a&&(a=e)}});const s=a+1;n.columns?.forEach(n=>{const r=`${e}_row_${t}_${n.name}`;delete i[r]});for(let o=t+1;o<s;o++)n.columns?.forEach(t=>{const n=`${e}_row_${o}_${t.name}`,r=`${e}_row_${o-1}_${t.name}`;n in i&&(i[r]=i[n],delete i[n])});return i}),c(r=>{const i={...r};let a=-1;Object.keys(i).forEach(t=>{const n=t.match(new RegExp(`^${e}_row_(\\d+)_`));if(n){const e=parseInt(n[1],10);e>a&&(a=e)}});const s=a+1;for(let o=t;o<s;o++)n.columns?.forEach(n=>{const r=`${e}_row_${o}_${n.name}`,a=`${e}_row_${o-1}_${n.name}`;r in i&&(o===t||(i[a]=i[r]),delete i[r])});return i}))})(a.id,n),color:"error",sx:{p:.5},children:e.jsx(B,{fontSize:"small"})})})]},n))})]})}):e.jsx(t,{sx:{textAlign:"center",py:4,color:"#999"},children:e.jsx(i,{variant:"body2",children:'No rows added. Click "Add Row" to start.'})})]})})})},`${a.id}-table`),A&&e.jsx(_,{children:e.jsx(C,{colSpan:7,sx:{p:0,border:0},children:e.jsx(ce,{in:G,timeout:"auto",unmountOnExit:!0,children:e.jsxs(t,{sx:{p:2,backgroundColor:"#f8f9fa"},children:[e.jsxs(i,{variant:"subtitle2",sx:{fontWeight:600,mb:2},children:[a.parameterName," - Multiple Fields"]}),e.jsx(R,{container:!0,spacing:2,children:a.columns?.map(n=>{const r=`${a.id}_${n.name}`,s=String(P[r]||"");return e.jsxs(R,{size:{xs:12,sm:6,md:4},children:["ok/not ok"===n.type?e.jsxs(t,{children:[e.jsx(i,{variant:"body2",sx:{mb:1,fontWeight:500},children:n.name}),e.jsx($,{component:"fieldset",disabled:I,children:e.jsxs(Y,{row:!0,value:s,onChange:e=>E(a.id,n.name,e.target.value),sx:{gap:1},children:[e.jsx(O,{value:"ok",control:e.jsx(X,{size:"small",color:"success"}),label:"OK",sx:{"& .MuiFormControlLabel-label":{fontSize:"0.75rem",color:"ok"===s?"#2e7d32":"#666"}}}),e.jsx(O,{value:"not ok",control:e.jsx(X,{size:"small",color:"error"}),label:"Not OK",sx:{"& .MuiFormControlLabel-label":{fontSize:"0.75rem",color:"not ok"===s?"#d32f2f":"#666"}}})]})}),l[r]&&e.jsx(i,{variant:"caption",color:"error",sx:{mt:.5,display:"block"},children:l[r]})]}):"datetime"===n.type?e.jsx(x,{dateAdapter:Ee,children:e.jsx(se,{label:n.name,value:s?Me(s):null,onChange:e=>{const t=e?e.format("YYYY-MM-DDTHH:mm"):"";E(a.id,n.name,t)},disabled:I,slotProps:{textField:{fullWidth:!0,error:!!l[r],helperText:l[r],variant:"outlined"}}})}):e.jsx(k,{label:n.name,type:"number"===n.type?"number":"text",value:s,onChange:e=>E(a.id,n.name,e.target.value),error:!!l[r],helperText:l[r],fullWidth:!0,disabled:I,variant:"outlined",inputProps:{min:0,step:"number"===n.type?.01:void 0}}),n.defaultValue&&e.jsxs(i,{variant:"caption",sx:{color:"#666",mt:.5,display:"block"},children:["Default: ",n.defaultValue]}),n.tolerance&&e.jsxs(i,{variant:"caption",sx:{color:"#666",mt:.5,display:"block"},children:["Tolerance: ±",n.tolerance]})]},n.name)})})]})})})},`${a.id}-multicolumn`),m&&e.jsx(_,{children:e.jsx(C,{colSpan:7,sx:{p:0,border:0},children:e.jsx(ce,{in:L,timeout:"auto",unmountOnExit:!0,children:e.jsxs(t,{sx:{p:2,backgroundColor:"#f8f9fa"},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e.jsx(ue,{color:"primary"}),e.jsxs(i,{variant:"subtitle2",sx:{fontWeight:600},children:["Image Annotation for ",a.parameterName]})]}),e.jsxs(t,{sx:{mb:2,p:1,backgroundColor:"#e3f2fd",borderRadius:.5,border:"1px solid #bbdefb"},children:[e.jsx(i,{variant:"caption",sx:{fontWeight:600,color:"#1565c0",fontSize:"0.75rem"},children:"Attached Files"}),e.jsx(t,{sx:{mt:.5},children:Array.isArray(a.files)&&a.files.map((n,r)=>e.jsx(t,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:e.jsxs(i,{variant:"body2",sx:{fontSize:"0.875rem",color:"#1565c0"},children:["📎 ",n.originalFileName]})},r))})]}),e.jsx(pa,{images:Array.isArray(a.files)?a.files:[],existingAnnotations:u.filter(e=>Array.isArray(a.files)&&a.files.some(t=>t.fileName===e.imageFileName)),onSave:e=>((e,t)=>{d(n=>[...n.filter(t=>!r.inspectionParameters?.find(n=>n.id===e&&Array.isArray(n.files)&&n.files.some(e=>e.fileName===t.imageFileName))),...t]),T(n=>{const r={...n};return r[e.toString()]||(r[e.toString()]={}),r[e.toString()].annotations=t,r})})(a.id,e),readOnly:I})]})})})},`${a.id}-annotations`)]})})})]})}),Object.keys(l).length>0&&e.jsx(A,{severity:"error",sx:{mb:2,py:1},children:"Please fill in all required fields with valid values."}),!I&&e.jsx(t,{sx:{display:"flex",justifyContent:"flex-end",pt:1},children:e.jsx(n,{variant:"contained",onClick:()=>{if((()=>{const e={};return r.inspectionParameters?.forEach(t=>{if("table"===t.type&&t.columns&&t.columns.length>0&&t.columns){const n=N(t.id);0===n&&(e[`${t.id}_table_rows`]="At least one row is required");for(let r=0;r<n;r++)t.columns.forEach(n=>{const i=`${t.id}_row_${r}_${n.name}`,a=P[i];if(!a||"string"==typeof a&&""===a.trim())e[i]=`Row ${r+1}, ${n.name} is required`;else if("number"===n.type){const t=parseFloat(String(a));isNaN(t)&&(e[i]=`Row ${r+1}, ${n.name} must be a valid number`)}else"ok/not ok"===n.type?"ok"!==a&&"not ok"!==a&&(e[i]=`Row ${r+1}, ${n.name} must be either OK or Not OK`):"datetime"===n.type&&(a&&String(a).trim()||(e[i]=`Row ${r+1}, ${n.name} is required`))})}else if(t.columns&&t.columns.length>0)t.columns.forEach(n=>{const r=`${t.id}_${n.name}`,i=P[r];if(!i||"string"==typeof i&&""===i.trim())e[r]=`${n.name} is required`;else if("number"===n.type){const t=parseFloat(String(i));isNaN(t)&&(e[r]=`${n.name} must be a valid number`)}else"ok/not ok"===n.type?"ok"!==i&&"not ok"!==i&&(e[r]=`${n.name} must be either OK or Not OK`):"datetime"===n.type&&(i&&String(i).trim()||(e[r]=`${n.name} is required`))});else{const n=t.id.toString(),r=P[n];let i;if(i=String("object"==typeof r&&null!==r&&"value"in r?r.value||"":r||""),i&&""!==i.trim())if("number"===t.type){const t=parseFloat(i);isNaN(t)&&(e[n]="Value must be a valid number")}else"ok/not ok"===t.type?"ok"!==i&&"not ok"!==i&&(e[n]="Value must be either OK or Not OK"):"datetime"===t.type&&(i&&i.trim()||(e[n]="Value is required"));else e[n]="Value is required"}}),c(e),0===Object.keys(e).length})()){const e={};r.inspectionParameters?.forEach(t=>{const n={};if("table"===t.type&&t.columns&&t.columns.length>0&&t.columns){const e=N(t.id),r=[];for(let n=0;n<e;n++){const e={};t.columns.forEach(r=>{const i=`${t.id}_row_${n}_${r.name}`,a=P[i];null!=a&&(e[r.name]=a)}),Object.keys(e).length>0&&r.push(e)}r.length>0&&(n.value=r)}else if(t.columns&&t.columns.length>0){const e={};t.columns.forEach(n=>{const r=`${t.id}_${n.name}`,i=P[r];null!=i&&(e[n.name]=i)}),Object.keys(e).length>0&&(n.value=e)}else{const e=t.id.toString(),r=P[e];"object"==typeof r&&null!==r?(n.value=r.value,r.annotations&&(n.annotations=r.annotations)):n.value=r}if(P[t.id.toString()]&&"object"==typeof P[t.id.toString()]){const e=P[t.id.toString()];e.annotations&&Array.isArray(e.annotations)&&(n.annotations=e.annotations)}Object.keys(n).length>0&&(e[t.id.toString()]=n)}),o(e)}},sx:{backgroundColor:"#1976d2","&:hover":{backgroundColor:"#1565c0"}},children:"Complete step"})})]})},xa=({step:a,executionData:o,onBackToList:l,onPreviousStep:c,onNextStep:u,onStepComplete:m,canGoPrevious:x,canGoNext:y})=>{const v="sequence"===a.type&&a.stepGroup,b=v?a.stepGroup.steps:[],[S,_]=je.useState(()=>{if(!(v&&a.stepGroup&&a.prcTemplateStepId&&o.prcAggregatedSteps))return 0;const e=o.prcAggregatedSteps[a.prcTemplateStepId.toString()];if(!e)return 0;const t=e[a.stepGroup.id.toString()];if(!t)return 0;let n=-1;return a.stepGroup.steps.forEach((e,r)=>{void 0!==t[e.id.toString()]&&(n=r)}),n+1<b.length?n+1:0}),C=v?b[S]:null,w=async e=>{v&&C?(await m({...e,stepId:C.id,stepGroupId:a.stepGroup.id,prcTemplateStepId:a.prcTemplateStepId}),S<b.length-1&&_(e=>e+1)):await m(e)},k=()=>{if(!v||!a.stepGroup||!a.prcTemplateStepId)return!1;const e=o.prcAggregatedSteps?.[a.prcTemplateStepId.toString()];if(!e)return!1;const t=e[a.stepGroup.id.toString()];return!!t&&a.stepGroup.steps.every(e=>void 0!==t[e.id.toString()])},j=v?S>0:x,A=v?S<b.length-1||k():y;return e.jsxs(t,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsx(t,{sx:{p:1.5,borderBottom:"1px solid #e0e0e0",backgroundColor:"white"},children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(h,{onClick:l,size:"small",children:e.jsx(r,{})}),e.jsx(d,{sx:{width:32,height:32,backgroundColor:"completed"===a.status?"#4caf50":"#2196f3"},children:"completed"===a.status?e.jsx(f,{sx:{fontSize:18}}):e.jsx(g,{sx:{fontSize:18}})}),e.jsx(t,{sx:{flex:1,minWidth:0},children:e.jsx(i,{variant:"h6",sx:{fontWeight:600,color:"#333",lineHeight:1.2},children:a.title})}),e.jsxs(t,{sx:{display:"flex",gap:.5},children:[a.ctq&&e.jsx(s,{label:"CTQ",size:"small",sx:{backgroundColor:"#fff3e0",color:"#f57c00",height:24,fontSize:"0.75rem"}}),e.jsx(s,{label:a.type,size:"small",sx:{backgroundColor:"#f5f5f5",color:"#666",height:24,fontSize:"0.75rem"}})]}),e.jsxs(t,{sx:{display:"flex",gap:.5},children:[e.jsx(n,{variant:"outlined",size:"small",startIcon:e.jsx(r,{}),onClick:()=>{v&&S>0?_(e=>e-1):c()},disabled:!j,sx:{minWidth:"auto",px:1},children:"Prev"}),e.jsx(n,{variant:"outlined",size:"small",endIcon:e.jsx(p,{}),onClick:async()=>{v?S<b.length-1?_(e=>e+1):k()?await m({}):u():u()},disabled:!A,sx:{minWidth:"auto",px:1},children:"Next"})]})]})}),v&&e.jsx(t,{sx:{p:1,backgroundColor:"#f9f9f9",borderBottom:"1px solid #e0e0e0"},children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsxs(i,{variant:"body2",sx:{color:"#666",fontSize:"0.875rem",minWidth:"fit-content"},children:["Step ",S+1," of ",b.length]}),e.jsx(t,{sx:{flex:1,height:3,backgroundColor:"#e0e0e0",borderRadius:1.5},children:e.jsx(t,{sx:{width:(S+1)/b.length*100+"%",height:"100%",backgroundColor:"#2196f3",borderRadius:1.5,transition:"width 0.3s ease"}})}),e.jsx(i,{variant:"body2",sx:{color:"#666",fontSize:"0.875rem",textAlign:"right",maxWidth:"200px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:C?.parameterDescription})]})}),e.jsx(t,{sx:{flex:1,overflow:"auto"},children:(()=>{if(v&&C){const t={stepNumber:a.stepNumber,type:"sequence",title:C.parameterDescription,description:C.notes||a.description,status:a.status,ctq:C.ctq,stepData:{prcTemplateStepId:a.prcTemplateStepId,stepGroupId:a.stepGroup.id,stepId:C.id,stepType:C.stepType,targetValueType:C.targetValueType,uom:C.uom,minValue:C.minValue,maxValue:C.maxValue,minimumAcceptanceValue:C.minimumAcceptanceValue,maximumAcceptanceValue:C.maximumAcceptanceValue,multipleMeasurements:C.multipleMeasurements,multipleMeasurementMaxCount:C.multipleMeasurementMaxCount,notes:C.notes,parameterDescription:C.parameterDescription,evaluationMethod:C.evaluationMethod,allowAttachments:C.allowAttachments,stepNumber:C.stepNumber,responsiblePerson:C.responsiblePerson}};return e.jsx(it,{step:t,executionData:o,onStepComplete:w})}switch(a.type){case"rawMaterials":return e.jsx(et,{step:a,executionData:o,onStepComplete:w});case"bom":return e.jsx(nt,{step:a,executionData:o,onStepComplete:w});case"inspection":return e.jsx(ma,{step:a,executionData:o,onStepComplete:w});default:return e.jsxs("div",{children:["Unknown step type: ",a.type]})}})()})]})},ya=({imageUrl:r,imageFileName:a,originalFileName:o,annotations:l,readOnly:c=!0,showAnnotations:u=!0})=>{const[d,p]=je.useState(!1),[f,g]=je.useState(!1),[m,x]=je.useState(null),[y,b]=je.useState(1),[S,_]=je.useState({x:0,y:0}),[C,w]=je.useState({width:300,height:200}),[k,j]=je.useState(!1),[A,P]=je.useState({x:0,y:0}),[T,z]=je.useState(!1),I=je.useRef(null),E=je.useRef(null);je.useEffect(()=>{if(!r){const e=setTimeout(()=>{g(!0),p(!1),x(null)},0);return()=>clearTimeout(e)}const e=setTimeout(()=>{p(!1),g(!1),x(null)},0),t=new Image;t.crossOrigin="anonymous";let n=!0;return t.onload=()=>{if(!n)return;x(t),p(!0),g(!1);const e=t.width/t.height;let r=300,i=300/e;i>200&&(i=200,r=200*e),w({width:r,height:i})},t.onerror=()=>{n&&(g(!0),p(!1))},t.src=r,()=>{clearTimeout(e),n=!1}},[r]);const M=e=>{const t="in"===e?1.2*y:y/1.2;b(Math.max(.1,Math.min(5,t)))},N=e=>{c||(j(!0),P({x:e.evt.clientX-S.x,y:e.evt.clientY-S.y}))},R=e=>{if(k&&!c){const t={x:e.evt.clientX-A.x,y:e.evt.clientY-A.y};_(t)}},D=()=>{j(!1)},L=(t,n,r)=>{if(!u)return null;if("point"===t.type){const i=t.x*r.width,a=t.y*r.height;return e.jsx(aa,{children:e.jsxs(aa,{children:[e.jsx(sa,{x:i,y:a,radius:10,fill:"rgba(244, 67, 54, 0.15)",stroke:"rgba(244, 67, 54, 0.3)",strokeWidth:1}),e.jsx(sa,{x:i,y:a,radius:9,fill:"white",stroke:"#f44336",strokeWidth:2,shadowColor:"rgba(0,0,0,0.25)",shadowBlur:3,shadowOffset:{x:0,y:1},shadowOpacity:.4}),e.jsx(sa,{x:i,y:a,radius:7,fill:"rgba(255,255,255,0.8)",stroke:"none"}),e.jsx(ca,{x:i+12,y:a-8,text:`${n+1}`,fontSize:12,fontWeight:"bold",fill:"#f44336",align:"center",verticalAlign:"middle",width:18,height:12})]})},n)}if("polygon"===t.type&&t.points.length>0){const i=t.points.flat().map((e,t)=>t%2==0?e*r.width:e*r.height),a=i.filter((e,t)=>t%2==0).reduce((e,t)=>e+t,0)/(i.length/2),s=i.filter((e,t)=>t%2==1).reduce((e,t)=>e+t,0)/(i.length/2);return e.jsxs(aa,{children:[e.jsx(oa,{points:i,stroke:"#f44336",strokeWidth:2,fill:"rgba(244, 67, 54, 0.2)",closed:!0,opacity:.8,shadowColor:"rgba(0, 0, 0, 0.2)",shadowBlur:2}),t.points.map((t,n)=>{const i=t[0]*r.width,a=t[1]*r.height;return e.jsx(sa,{x:i,y:a,radius:4,fill:"#f44336",stroke:"#ffffff",strokeWidth:1,opacity:.9,shadowColor:"rgba(0, 0, 0, 0.2)",shadowBlur:2},n)}),e.jsx(ca,{x:a+12,y:s-8,text:`${n+1}`,fontSize:12,fontWeight:"bold",fill:"#f44336",align:"center",verticalAlign:"middle",width:18,height:12})]},n)}return null};return e.jsxs(t,{children:[e.jsxs(v,{variant:"outlined",sx:{p:1,display:"flex",flexDirection:"column",alignItems:"center",position:"relative"},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1,mb:1,width:"100%"},children:[e.jsx(ue,{color:"primary",fontSize:"small"}),e.jsx(i,{variant:"body2",sx:{fontWeight:500,color:"#333",flex:1},children:o}),e.jsx(s,{label:`${l.length} annotations`,size:"small",sx:{backgroundColor:"#e3f2fd",color:"#1976d2",fontSize:"0.6rem",height:16,"& .MuiChip-label":{px:.5}}}),e.jsx(h,{size:"small",onClick:()=>z(!0),sx:{ml:.5},children:e.jsx(de,{fontSize:"small"})})]}),e.jsxs(t,{sx:{border:"1px solid #e0e0e0",borderRadius:1,overflow:"hidden",position:"relative",background:"#fafafa",display:"flex",justifyContent:"center",alignItems:"center",width:C.width,height:C.height},children:[!d&&!f&&e.jsx(t,{sx:{width:C.width,height:C.height,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"grey.100"},children:e.jsx(i,{variant:"caption",children:"Loading..."})}),f&&e.jsx(t,{sx:{width:C.width,height:C.height,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"grey.100"},children:e.jsx(i,{variant:"caption",color:"error",children:"Failed to load"})}),d&&e.jsx(da,{ref:I,width:C.width,height:C.height,scaleX:y,scaleY:y,x:S.x,y:S.y,onMouseDown:N,onMouseMove:R,onMouseUp:D,draggable:!c,children:e.jsxs(ia,{children:[e.jsx(la,{ref:E,image:m||void 0,width:C.width,height:C.height}),l.map((e,t)=>((e,t)=>L(e,t,C))(e,t))]})})]}),e.jsxs(t,{sx:{display:"flex",justifyContent:"center",gap:.5,mt:1},children:[e.jsx(h,{onClick:()=>M("out"),size:"small",sx:{p:.5},children:e.jsx(K,{fontSize:"small"})}),e.jsxs(i,{variant:"caption",sx:{alignSelf:"center",mx:.5},children:[Math.round(100*y),"%"]}),e.jsx(h,{onClick:()=>M("in"),size:"small",sx:{p:.5},children:e.jsx(J,{fontSize:"small"})})]})]}),e.jsxs(ee,{open:T,onClose:()=>z(!1),maxWidth:"lg",fullWidth:!0,fullScreen:!0,children:[e.jsx(te,{children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ue,{color:"primary"}),e.jsx(i,{variant:"h6",sx:{fontWeight:600},children:o})]})}),e.jsx(ne,{sx:{p:0},children:e.jsxs(t,{sx:{display:"flex",flexDirection:"column",height:"100%"},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e.jsx(ue,{color:"primary"}),e.jsx(i,{variant:"h6",sx:{fontWeight:600},children:o}),e.jsx(s,{label:`${l.length} annotations`,size:"small",sx:{backgroundColor:"#e3f2fd",color:"#1976d2",fontSize:"0.7rem"}})]}),e.jsx(t,{sx:{flex:1,display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsxs(t,{sx:{border:"1px solid #e0e0e0",borderRadius:1,overflow:"hidden",position:"relative",background:"#fafafa",display:"flex",justifyContent:"center",alignItems:"center",width:"100%",height:"100%",maxWidth:"90vw",maxHeight:"80vh"},children:[!d&&!f&&e.jsx(t,{sx:{width:400,height:300,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"grey.100"},children:e.jsx(i,{children:"Loading image..."})}),f&&e.jsx(t,{sx:{width:400,height:300,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"grey.100"},children:e.jsx(i,{color:"error",children:"Failed to load image"})}),d&&e.jsx(da,{ref:I,width:800,height:600,scaleX:y,scaleY:y,x:S.x,y:S.y,onMouseDown:N,onMouseMove:R,onMouseUp:D,draggable:!c,children:e.jsxs(ia,{children:[e.jsx(la,{ref:E,image:m||void 0,width:800,height:600}),l.map((e,t)=>L(e,t,{width:800,height:600}))]})})]})}),e.jsxs(t,{sx:{display:"flex",justifyContent:"center",gap:1,mt:2},children:[e.jsx(h,{onClick:()=>M("out"),size:"small",children:e.jsx(K,{})}),e.jsxs(i,{variant:"body2",sx:{alignSelf:"center",mx:1},children:[Math.round(100*y),"%"]}),e.jsx(h,{onClick:()=>M("in"),size:"small",children:e.jsx(J,{})})]})]})}),e.jsx(re,{children:e.jsx(n,{onClick:()=>z(!1),children:"Close"})})]})]})},va=({previewData:a,onBackToStep:o,onApproveProduction:l,onApproveCTQ:g,onPartialApproveCTQ:m,onProceedToNext:x,onBackToStepGroup:j})=>{const{currentRole:P}=Le(),T=1===P.id||2===P.id,I=1===P.id||3===P.id,[E,D]=je.useState(a.productionApproved||!1),[L,G]=je.useState(a.ctqApproved||!1),[O,F]=je.useState(new Set),[q,B]=je.useState(a.partialCtqApprove||!1),[$,H]=je.useState(""),[V,Q]=je.useState(null),[Y,X]=je.useState("full"),K=e=>{const t=Math.floor(e/3600),n=Math.floor(e%3600/60),r=Math.round(e%60);return`${t.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`},J=t=>{switch(t){case"Accepted":return e.jsx(f,{sx:{color:"success.main",fontSize:20}});case"Lesser":return e.jsx(M,{sx:{color:"warning.main",fontSize:20}});case"Greater":return e.jsx(W,{sx:{color:"error.main",fontSize:20}})}},Z=t=>{const n="Accepted"===t?"success":"Lesser"===t?"warning":"error",r=`Range: ${t}`;return e.jsx(s,{icon:J(t),label:r,color:n,size:"small",variant:"outlined"})},ee=E&&(!a.ctq||L||q)&&!a.stepCompleted&&(!a.timingExceeded||$.trim().length>0);return e.jsxs(t,{sx:{p:2},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(h,{onClick:o,sx:{mr:1,p:.5},children:e.jsx(r,{})}),e.jsx(d,{sx:{bgcolor:"success.main",mr:1,width:32,height:32},children:e.jsx(he,{sx:{fontSize:18}})}),e.jsxs(t,{children:[e.jsxs(i,{variant:"h6",sx:{fontWeight:600,fontSize:"1.1rem"},children:["Step ",a.stepNumber," -"," ","inspection"===a.type?"Inspection Report":"Measurement Report"]}),e.jsx(i,{variant:"caption",sx:{color:"text.secondary"},children:a.title})]})]}),e.jsxs(t,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e.jsx(n,{variant:E?"outlined":"contained",color:E?"success":"primary",onClick:()=>{D(!0),l()},disabled:E||!T&&!("inspection"===a.type&&I),startIcon:e.jsx(N,{}),size:"small",children:E?"inspection"===a.type?"Inspection Approved":"Production Approved":"inspection"===a.type?"Approve Inspection":"Approve Production"}),a.ctq&&e.jsxs(e.Fragment,{children:[e.jsxs(pe,{variant:L||q?"outlined":"contained",size:"small",children:[e.jsx(n,{color:L||q?"success":"warning",onClick:()=>{"full"===Y?(G(!0),g()):(B(!0),m())},disabled:L||q||!I,startIcon:e.jsx(N,{}),children:L?"CTQ Approved":q?"Partially Approved":"partial"===Y?"Partially CTQ Approve":"CTQ Approve"}),e.jsx(n,{color:L||q?"success":"warning",onClick:e=>{Q(e.currentTarget)},disabled:L||q||!I,sx:{minWidth:"auto",px:1},children:e.jsx(fe,{})})]}),e.jsxs(ge,{anchorEl:V,open:Boolean(V),onClose:()=>{Q(null)},anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},children:[e.jsx(U,{onClick:()=>{X("full"),Q(null)},selected:"full"===Y,children:"CTQ Approve"}),e.jsx(U,{onClick:()=>{X("partial"),Q(null)},selected:"partial"===Y,children:"Partially CTQ Approve"})]})]}),e.jsx(n,{variant:"contained",color:"success",onClick:()=>x($),disabled:!ee,startIcon:a.stepCompleted?e.jsx(f,{}):e.jsx(p,{}),size:"small",children:a.stepCompleted?"Completed":"Complete Step"}),e.jsxs(t,{sx:{display:"flex",gap:1,ml:2},children:[a.ctq&&e.jsx(s,{label:"CTQ",sx:{backgroundColor:"#fff3e0",color:"#f57c00",fontSize:"0.7rem"}}),e.jsx(s,{label:a.type,sx:{backgroundColor:"#f5f5f5",color:"#666",fontSize:"0.7rem"}})]})]})]}),e.jsx(c,{variant:"outlined",sx:{mb:2},children:e.jsx(u,{sx:{p:2},children:(()=>{let{data:n}=a;if("inspection"===a.type&&"object"==typeof n&&null!==n){if(Object.keys(n).some(e=>{const t=n[e];if("object"==typeof t&&null!==t&&"annotations"in t){const e=t.annotations;return"object"==typeof e&&null!==e&&!Array.isArray(e)}return!1})){const e={};Object.entries(n).forEach(([t,n])=>{if(!["stepCompleted","productionApproved","ctqApproved","partialCtqApprove"].includes(t)&&"object"==typeof n&&null!==n){const r={};if("value"in n&&(r.value=n.value),"annotations"in n&&n.annotations){const e=n.annotations;"object"!=typeof e||Array.isArray(e)?r.annotations=e:r.annotations=Object.keys(e).sort((e,t)=>parseInt(e,10)-parseInt(t,10)).map(t=>{const n=e[t];if("object"==typeof n&&null!==n){const e={...n};if("regions"in n&&n.regions){const t=n.regions;"object"!=typeof t||Array.isArray(t)||(e.regions=Object.keys(t).sort((e,t)=>parseInt(e,10)-parseInt(t,10)).map(e=>{const n=t[e];if("object"==typeof n&&null!==n){const e={...n};if("points"in n&&n.points){const t=n.points;"object"!=typeof t||Array.isArray(t)||(e.points=Object.keys(t).sort((e,t)=>parseInt(e,10)-parseInt(t,10)).map(e=>{const n=t[e];return"object"==typeof n&&null!==n&&"0"in n&&"1"in n?[n[0],n[1]]:[0,0]}))}return e}return n}))}return e}return n})}Object.keys(r).length>0&&(e[t]=r)}}),n=e,a.data}}if("sequence"===a.type)return e.jsxs(t,{children:[a.timingExceeded&&e.jsxs(t,{sx:{mb:2},children:[e.jsxs(A,{severity:"warning",sx:{mb:1,border:"1px solid #ff9800",backgroundColor:"#fff8e1","& .MuiAlert-icon":{color:"#f57c00"}},icon:e.jsx(me,{sx:{fontSize:20}}),children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(i,{variant:"subtitle2",sx:{fontWeight:600,color:"#e65100"},children:"Timing Exceeded"}),e.jsx(s,{label:`+${Math.round((a.actualDuration||0)-(a.expectedDuration||0))}s`,size:"small",sx:{backgroundColor:"#ff5722",color:"white",fontSize:"0.7rem",fontWeight:600,height:20}})]}),e.jsxs(i,{variant:"body2",sx:{color:"#bf360c",fontSize:"0.875rem"},children:[e.jsx("strong",{children:K(a.actualDuration||0)})," actual vs"," ",e.jsx("strong",{children:K(a.expectedDuration||0)})," expected"]})]}),e.jsx(k,{fullWidth:!0,multiline:!0,rows:2,label:"Reason for delay",placeholder:"Brief explanation for the timing delay",value:a.stepCompleted?a.timingExceededRemarks||"No reason provided":$,onChange:e=>H(e.target.value),required:!a.stepCompleted,disabled:a.stepCompleted,sx:{mt:2,"& .MuiOutlinedInput-root":{borderColor:a.stepCompleted||$.trim()?"#e0e0e0":"#f44336","&:hover .MuiOutlinedInput-notchedOutline":{borderColor:a.stepCompleted||$.trim()?"#1976d2":"#f44336"},"&.Mui-disabled":{backgroundColor:"#f5f5f5",color:"#666"}}},error:!a.stepCompleted&&!$.trim(),helperText:"Required to proceed"})]}),e.jsxs(i,{variant:"h6",sx:{mb:1.5,fontWeight:600,color:"#333",fontSize:"1.1rem"},children:["Measurement Report (",Array.isArray(n)?n.length:0," measurements)"]}),e.jsx(y,{component:v,variant:"outlined",sx:{maxHeight:400},children:e.jsxs(b,{size:"small",stickyHeader:!0,children:[e.jsx(S,{children:e.jsxs(_,{sx:{backgroundColor:"#f5f5f5"},children:[e.jsx(C,{sx:{fontWeight:600,fontSize:"0.8rem",py:1},children:"Step"}),e.jsx(C,{sx:{fontWeight:600,fontSize:"0.8rem",py:1},children:"Parameter"}),e.jsx(C,{sx:{fontWeight:600,fontSize:"0.8rem",py:1},children:"Value"}),e.jsx(C,{sx:{fontWeight:600,fontSize:"0.8rem",py:1},children:"Type"}),e.jsx(C,{sx:{fontWeight:600,fontSize:"0.8rem",py:1},children:"Method"}),e.jsx(C,{sx:{fontWeight:600,fontSize:"0.8rem",py:1},children:"Range"}),e.jsx(C,{sx:{fontWeight:600,fontSize:"0.8rem",py:1},children:"Status"})]})}),e.jsx(w,{children:Array.isArray(n)&&n.length>0?n.map((n,r)=>e.jsxs(_,{sx:{"&:nth-of-type(odd)":{backgroundColor:"#fafafa"},"&:hover":{backgroundColor:"#f0f0f0"}},children:[e.jsx(C,{sx:{py:1,fontSize:"0.8rem"},children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(i,{variant:"body2",sx:{fontWeight:500},children:n.stepNumber||r+1}),n.ctq&&e.jsx(s,{label:"CTQ",size:"small",sx:{backgroundColor:"#fff3e0",color:"#f57c00",fontSize:"0.6rem",height:16,"& .MuiChip-label":{px:.5}}})]})}),e.jsx(C,{sx:{py:1,fontSize:"0.8rem",maxWidth:200},children:e.jsx(i,{variant:"body2",sx:{fontWeight:500,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:n.parameterDescription,children:n.parameterDescription})}),e.jsx(C,{sx:{py:1,fontSize:"0.8rem"},children:e.jsx(t,{sx:{display:"flex",alignItems:"center",gap:.5},children:"Check"===n.stepType||"Inspection"===n.stepType?e.jsx(s,{label:n.value,size:"small",sx:{backgroundColor:"#e3f2fd",color:"#1976d2",fontSize:"0.7rem",height:20}}):e.jsxs(i,{variant:"body2",sx:{fontWeight:600,color:"#1976d2"},children:[Array.isArray(n.value)?n.value.join(", "):n.value," ",n.uom&&"None"!==n.uom?n.uom:""]})})}),e.jsx(C,{sx:{py:1,fontSize:"0.8rem",color:"#666"},children:n.stepType}),e.jsx(C,{sx:{py:1,fontSize:"0.8rem",color:"#666"},children:n.evaluationMethod}),e.jsx(C,{sx:{py:1,fontSize:"0.8rem"},children:"Measurement"===n.stepType&&n.minimumAcceptanceValue&&n.maximumAcceptanceValue?e.jsxs(i,{variant:"body2",sx:{color:"#666",fontWeight:500},children:[n.minimumAcceptanceValue," - ",n.maximumAcceptanceValue," ",n.uom&&"None"!==n.uom?n.uom:""]}):e.jsx(i,{variant:"body2",sx:{color:"#999",fontStyle:"italic"},children:"N/A"})}),e.jsx(C,{sx:{py:1,fontSize:"0.8rem"},children:n.validationStatus&&n.minimumAcceptanceValue&&n.maximumAcceptanceValue?e.jsx(t,{sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:Z(n.validationStatus)}):e.jsx(t,{sx:{display:"flex",alignItems:"center",justifyContent:"center",width:24,height:24,borderRadius:"50%",backgroundColor:"#e8f5e8"},children:e.jsx(f,{sx:{color:"#4caf50",fontSize:16}})})})]},n.stepId||r)):e.jsx(_,{children:e.jsx(C,{colSpan:7,sx:{textAlign:"center",py:3,color:"#666"},children:"No measurement data available"})})})]})}),Array.isArray(n)&&n.some(e=>e.notes&&e.notes.length>0)&&e.jsxs(t,{sx:{mt:2},children:[e.jsx(i,{variant:"subtitle2",sx:{fontWeight:600,mb:1,color:"#333"},children:"Important Notes:"}),n.filter(e=>e.notes&&e.notes.length>0).map((n,r)=>e.jsxs(t,{sx:{mb:1,p:1,backgroundColor:"#f9f9f9",borderRadius:1},children:[e.jsxs(i,{variant:"caption",sx:{fontWeight:500,color:"#666"},children:["Step ",n.stepNumber,":"]}),e.jsx(i,{variant:"caption",sx:{color:"#333",ml:.5},children:n.notes})]},r))]}),(()=>{let r=[],a=!1;if(Array.isArray(n)){const e={};n.forEach((t,n)=>{const r=t;if(r.responsiblePersons&&Array.isArray(r.responsiblePersons)){const t=r.stepId||`Step ${n+1}`,i=r.parameterDescription||`Parameter ${n+1}`;e[t]||(e[t]={stepId:t,parameterDescription:i,responsiblePersons:[]}),r.responsiblePersons.forEach(n=>{const r=n;e[t].responsiblePersons.push({role:r.role||"",employeeName:r.employeeName||"",employeeCode:r.employeeCode||""})})}}),r=Object.values(e),a=r.filter(e=>e?.responsiblePersons?.length)?.length>0}return a&&e.jsxs(t,{sx:{mt:2},children:[e.jsx(i,{variant:"subtitle2",sx:{fontWeight:600,mb:1.5,color:"#333"},children:"Responsible Person Details:"}),r.map((n,r)=>n.responsiblePersons.length?e.jsxs(t,{sx:{mb:2},children:[e.jsx(t,{sx:{backgroundColor:"#f5f5f5",p:1.5,borderRadius:"4px 4px 0 0",border:"1px solid #e0e0e0",borderBottom:"none"},children:e.jsxs(i,{variant:"subtitle2",sx:{fontWeight:600,color:"#333",fontSize:"0.9rem"},children:["Step ",n.stepId,": ",n.parameterDescription]})}),e.jsx(y,{component:v,variant:"outlined",sx:{borderRadius:"0 0 4px 4px",borderTop:"none"},children:e.jsxs(b,{size:"small",children:[e.jsx(S,{children:e.jsxs(_,{sx:{backgroundColor:"#fafafa"},children:[e.jsx(C,{sx:{fontWeight:600,fontSize:"0.8rem",py:1},children:"Role"}),e.jsx(C,{sx:{fontWeight:600,fontSize:"0.8rem",py:1},children:"Employee Name"}),e.jsx(C,{sx:{fontWeight:600,fontSize:"0.8rem",py:1},children:"Employee Code"})]})}),e.jsx(w,{children:n.responsiblePersons.map((t,n)=>e.jsxs(_,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(C,{sx:{fontSize:"0.875rem",py:1},children:t.role?.toUpperCase()}),e.jsx(C,{sx:{fontSize:"0.875rem",py:1},children:t.employeeName}),e.jsx(C,{sx:{fontSize:"0.875rem",py:1},children:t.employeeCode})]},n))})]})})]},r):e.jsx(e.Fragment,{}))]})})()]});if("inspection"===a.type){const r=a.inspectionParameters||[],o=a.inspectionMetadata;return e.jsxs(t,{children:[o&&e.jsx(t,{sx:{mb:2,p:1.5,backgroundColor:"#e3f2fd",borderRadius:1,border:"1px solid #bbdefb"},children:e.jsxs(R,{container:!0,spacing:1.5,children:[e.jsxs(R,{size:{xs:6,sm:3},children:[e.jsx(i,{variant:"caption",sx:{fontWeight:600,color:"#1565c0",fontSize:"0.75rem"},children:"Inspection ID"}),e.jsx(i,{variant:"body2",sx:{fontSize:"0.875rem",fontWeight:600,color:"#1565c0"},children:o.inspectionId})]}),e.jsxs(R,{size:{xs:6,sm:3},children:[e.jsx(i,{variant:"caption",sx:{fontWeight:600,color:"#1565c0",fontSize:"0.75rem"},children:"Type"}),e.jsx(i,{variant:"body2",sx:{fontSize:"0.875rem",fontWeight:600,color:"#1565c0"},children:o.type})]}),e.jsxs(R,{size:{xs:6,sm:3},children:[e.jsx(i,{variant:"caption",sx:{fontWeight:600,color:"#1565c0",fontSize:"0.75rem"},children:"Status"}),e.jsx(i,{variant:"body2",sx:{fontSize:"0.875rem",fontWeight:600,color:"#1565c0"},children:o.status})]}),e.jsxs(R,{size:{xs:6,sm:3},children:[e.jsx(i,{variant:"caption",sx:{fontWeight:600,color:"#1565c0",fontSize:"0.75rem"},children:"Version"}),e.jsxs(i,{variant:"body2",sx:{fontSize:"0.875rem",fontWeight:600,color:"#1565c0"},children:["v",o.version]})]})]})}),e.jsxs(i,{variant:"h6",sx:{mb:1.5,fontWeight:600,color:"#333",fontSize:"1.1rem"},children:["Inspection Report (",Object.keys(n).filter(e=>"data"!==e&&"startTime"!==e&&"endTime"!==e&&"stepCompleted"!==e&&"productionApproved"!==e&&"ctqApproved"!==e).length," ","parameters)"]}),e.jsx(y,{component:v,variant:"outlined",sx:{maxHeight:400},children:e.jsxs(b,{size:"small",stickyHeader:!0,children:[e.jsx(S,{children:e.jsxs(_,{sx:{backgroundColor:"#f5f5f5"},children:[e.jsx(C,{sx:{fontWeight:600,fontSize:"0.8rem",py:1},children:"#"}),e.jsx(C,{sx:{fontWeight:600,fontSize:"0.8rem",py:1},children:"Parameter"}),e.jsx(C,{sx:{fontWeight:600,fontSize:"0.8rem",py:1},children:"Type"}),e.jsx(C,{sx:{fontWeight:600,fontSize:"0.8rem",py:1},children:"Value"}),e.jsx(C,{sx:{fontWeight:600,fontSize:"0.8rem",py:1},children:"CTQ"}),e.jsx(C,{sx:{fontWeight:600,fontSize:"0.8rem",py:1},children:"Specification"}),e.jsx(C,{sx:{fontWeight:600,fontSize:"0.8rem",py:1},children:"Status"})]})}),e.jsx(w,{children:Object.entries(n).filter(([e])=>"data"!==e&&"startTime"!==e&&"endTime"!==e&&"stepCompleted"!==e&&"productionApproved"!==e&&"ctqApproved"!==e).map(([n,a],o)=>{const l=r.find(e=>e.id.toString()===n);let c="",u=!1,d=!1,p=!1,g=0,m=l?.ctq||!1,x=l?.parameterName||`Parameter ${n}`,k=l?.type||"text",j=l?.specification||"N/A";if("table"===k&&l?.columns&&l.columns.length>0&&(p=!0),"object"==typeof a&&null!==a){const e=a;if(e.annotations&&Array.isArray(e.annotations)&&(u=!0),e.value)if(p&&Array.isArray(e.value))d=!0,g=e.value.length,c=`${g} row${1!==g?"s":""}`;else if("object"!=typeof e.value||null===e.value||Array.isArray(e.value)){const t=String(e.value);c="ok/not ok"===k?"ok"===t?"OK":"not ok"===t?"Not OK":t:t}else{d=!0;const t=e.value;c=Object.entries(t).map(([e,t])=>"ok/not ok"===k?`${e}: ${"ok"===t?"OK":"not ok"===t?"Not OK":t}`:`${e}: ${t}`).join(", ")}}else{const e=String(a);c="ok/not ok"===k?"ok"===e?"OK":"not ok"===e?"Not OK":e:e}return e.jsxs(Te.Fragment,{children:[e.jsxs(_,{sx:{"&:nth-of-type(odd)":{backgroundColor:"#fafafa"},"&:hover":{backgroundColor:"#f0f0f0"},cursor:d||p?"pointer":"default"},onClick:d||p?()=>(e=>{F(t=>{const n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n})})(n):void 0,children:[e.jsx(C,{sx:{py:1,fontSize:"0.8rem"},children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(d||p)&&e.jsx(h,{size:"small",sx:{p:.25},children:O.has(n)?e.jsx(ae,{}):e.jsx(z,{})}),e.jsx(i,{variant:"body2",sx:{fontWeight:500},children:o+1})]})}),e.jsx(C,{sx:{py:1,fontSize:"0.8rem",maxWidth:200},children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(i,{variant:"body2",sx:{fontWeight:500,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:x,children:x}),u&&e.jsx(s,{label:"Images",size:"small",sx:{backgroundColor:"#e3f2fd",color:"#1976d2",fontSize:"0.6rem",height:16,"& .MuiChip-label":{px:.5}}}),p&&e.jsx(s,{label:"Table",size:"small",sx:{backgroundColor:"#e1f5fe",color:"#0277bd",fontSize:"0.6rem",height:16,"& .MuiChip-label":{px:.5}}}),d&&!p&&e.jsx(s,{label:"Multi",size:"small",sx:{backgroundColor:"#f3e5f5",color:"#7b1fa2",fontSize:"0.6rem",height:16,"& .MuiChip-label":{px:.5}}}),l?.files&&l.files.length>0&&e.jsx(s,{label:`${l.files.length} files`,size:"small",sx:{backgroundColor:"#e8f5e8",color:"#4caf50",fontSize:"0.6rem",height:16,"& .MuiChip-label":{px:.5}}})]})}),e.jsx(C,{sx:{py:1,fontSize:"0.8rem",color:"#666"},children:k}),e.jsx(C,{sx:{py:1,fontSize:"0.8rem"},children:p?e.jsxs(i,{variant:"body2",sx:{fontWeight:600,color:"#0277bd"},children:[g," row",1!==g?"s":""]}):d?e.jsxs(i,{variant:"body2",sx:{fontWeight:600,color:"#7b1fa2"},children:[Object.keys(a.value).length," ","fields"]}):e.jsx(i,{variant:"body2",sx:{fontWeight:600,color:"#1976d2"},children:c})}),e.jsx(C,{sx:{py:1,fontSize:"0.8rem"},children:m&&e.jsx(s,{label:"CTQ",size:"small",sx:{backgroundColor:"#fff3e0",color:"#f57c00",fontSize:"0.7rem",height:20}})}),e.jsx(C,{sx:{py:1,fontSize:"0.8rem",color:"#666",maxWidth:150},children:e.jsx(i,{variant:"body2",sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:j,children:j})}),e.jsx(C,{sx:{py:1,fontSize:"0.8rem"},children:e.jsx(t,{sx:{display:"flex",alignItems:"center",justifyContent:"center",width:24,height:24,borderRadius:"50%",backgroundColor:"#e8f5e8"},children:e.jsx(f,{sx:{color:"#4caf50",fontSize:16}})})})]}),d&&e.jsx(_,{children:e.jsx(C,{colSpan:7,sx:{py:0,border:"none"},children:e.jsx(ce,{in:O.has(n),timeout:"auto",unmountOnExit:!0,children:e.jsxs(t,{sx:{p:2,backgroundColor:"#f8f9fa",border:"1px solid #e0e0e0",borderRadius:1,m:1},children:[e.jsxs(i,{variant:"subtitle2",sx:{mb:1.5,fontWeight:600,color:"#333"},children:[x," - ",p?"Table Data":"Detailed Values"]}),e.jsx(y,{component:v,variant:"outlined",children:e.jsxs(b,{size:"small",children:[e.jsx(S,{children:e.jsx(_,{sx:{backgroundColor:"#fafafa"},children:l?.columns?.map(t=>e.jsx(C,{sx:{fontWeight:600,fontSize:"0.75rem",py:.5,px:1,borderRight:"1px solid #e0e0e0"},children:t.name},t.name))})}),e.jsx(w,{children:p&&Array.isArray(a.value)?a.value.map((t,n)=>e.jsx(_,{children:l?.columns?.map(n=>{const r=t[n.name],a="ok/not ok"===n.type?"ok"===r?"OK":"not ok"===r?"Not OK":String(r||""):String(r||"");return e.jsx(C,{sx:{fontSize:"0.75rem",py:.5,px:1,borderRight:"1px solid #e0e0e0",maxWidth:150},children:e.jsx(i,{variant:"body2",sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:a,children:a})},n.name)})},n)):e.jsx(_,{children:l?.columns?.map(t=>{const n=a.value[t.name],r="ok/not ok"===t.type?"ok"===n?"OK":"not ok"===n?"Not OK":String(n):String(n);return e.jsx(C,{sx:{fontSize:"0.75rem",py:.5,px:1,borderRight:"1px solid #e0e0e0",maxWidth:150},children:e.jsx(i,{variant:"body2",sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:r,children:r})},t.name)})})})]})})]})})})})]},n)})})]})}),Object.entries(n).filter(([e])=>"data"!==e&&"startTime"!==e&&"endTime"!==e&&"stepCompleted"!==e&&"productionApproved"!==e&&"ctqApproved"!==e).some(([e,t])=>"object"==typeof t&&null!==t&&"annotations"in t&&Array.isArray(t.annotations)&&t.annotations.length>0)&&e.jsxs(t,{sx:{mt:2},children:[e.jsx(i,{variant:"h6",sx:{mb:1.5,fontWeight:600,color:"#333",fontSize:"1.1rem"},children:"Image Annotations"}),Object.entries(n).filter(([e])=>"data"!==e&&"startTime"!==e&&"endTime"!==e&&"stepCompleted"!==e&&"productionApproved"!==e&&"ctqApproved"!==e).map(([n,a])=>{const o=r.find(e=>e.id.toString()===n);if("object"==typeof a&&null!==a&&"annotations"in a){const r=a.annotations;if(Array.isArray(r)&&r.length>0)return e.jsx(t,{sx:{mb:2},children:e.jsxs(v,{variant:"outlined",sx:{p:2},children:[e.jsx(i,{variant:"subtitle1",sx:{fontWeight:600,mb:1,color:"#1976d2"},children:o?.parameterName||`Parameter ${n}`}),r.map((r,a)=>{const l=o?.files?.find(e=>e.fileName===r.imageFileName)?.originalFileName||r.imageFileName;let c=r.imageUrl||`https://indocool-prc-backend.onrender.com/${o?.files?.find(e=>e.fileName===r.imageFileName)?.filePath||""}`;return c=c.replace(/\\/g,"/"),e.jsxs(t,{sx:{mb:2,p:1.5,backgroundColor:"#f8f9fa",borderRadius:1,border:"1px solid #e9ecef"},children:[e.jsx(t,{sx:{mb:2},children:e.jsx(ya,{imageUrl:c,imageFileName:r.imageFileName,originalFileName:l,annotations:r.regions||[],readOnly:!0,showAnnotations:!0},`${n}-${a}-${r.imageFileName}`)}),r.regions&&r.regions.length>0&&e.jsxs(t,{sx:{mt:1},children:[e.jsx(i,{variant:"caption",sx:{fontWeight:500,color:"#666",fontSize:"0.75rem"},children:"Annotation Details:"}),r.regions.map((n,r)=>e.jsxs(t,{sx:{mt:.5,p:1,backgroundColor:"#fff",borderRadius:.5,border:"1px solid #e0e0e0"},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[e.jsx(s,{label:`${r+1}`,size:"small",sx:{backgroundColor:"#f44336",color:"white",fontSize:"0.6rem",fontWeight:"bold",height:16,minWidth:20,"& .MuiChip-label":{px:.5}}}),e.jsx(s,{label:n.type,size:"small",sx:{backgroundColor:"point"===n.type?"#e8f5e8":"#fff3e0",color:"point"===n.type?"#4caf50":"#f57c00",fontSize:"0.6rem",height:16}}),e.jsxs(i,{variant:"caption",sx:{color:"#666",fontSize:"0.7rem"},children:["ID: ",n.id]})]}),n.comment&&e.jsxs(i,{variant:"body2",sx:{fontSize:"0.8rem",color:"#333",fontStyle:"italic"},children:['"',n.comment,'"']}),n.category&&e.jsx(t,{sx:{mt:.5},children:e.jsx(s,{label:n.category,size:"small",sx:{backgroundColor:"#e3f2fd",color:"#1976d2",fontSize:"0.6rem",height:18}})}),"point"===n.type&&e.jsxs(i,{variant:"caption",sx:{color:"#666",fontSize:"0.7rem",display:"block",mt:.5},children:["Position: (",n.x,", ",n.y,")"]}),"polygon"===n.type&&n.points&&e.jsxs(i,{variant:"caption",sx:{color:"#666",fontSize:"0.7rem",display:"block",mt:.5},children:["Points: ",n.points.length," vertices"]}),n.cls&&e.jsxs(i,{variant:"caption",sx:{color:"#666",fontSize:"0.7rem",display:"block",mt:.5},children:["Class: ",n.cls]})]},r))]})]},a)})]})},n)}return null})]}),e.jsx(t,{sx:{mt:2,p:1.5,backgroundColor:"#f8f9fa",borderRadius:1,border:"1px solid #e9ecef"},children:e.jsxs(R,{container:!0,spacing:1.5,children:[e.jsxs(R,{size:{xs:6,sm:3},children:[e.jsx(i,{variant:"caption",sx:{fontWeight:500,color:"#666",fontSize:"0.75rem"},children:"Total Parameters"}),e.jsx(i,{variant:"body2",sx:{fontSize:"0.875rem",fontWeight:600},children:Object.keys(n).filter(e=>"data"!==e&&"startTime"!==e&&"endTime"!==e&&"stepCompleted"!==e&&"productionApproved"!==e&&"ctqApproved"!==e).length})]}),e.jsxs(R,{size:{xs:6,sm:3},children:[e.jsx(i,{variant:"caption",sx:{fontWeight:500,color:"#666",fontSize:"0.75rem"},children:"CTQ Parameters"}),e.jsx(i,{variant:"body2",sx:{fontSize:"0.875rem",fontWeight:600},children:r.filter(e=>e.ctq).length})]}),e.jsxs(R,{size:{xs:6,sm:3},children:[e.jsx(i,{variant:"caption",sx:{fontWeight:500,color:"#666",fontSize:"0.75rem"},children:"With Images"}),e.jsx(i,{variant:"body2",sx:{fontSize:"0.875rem",fontWeight:600},children:Object.values(n).filter(e=>"object"==typeof e&&e?.annotations&&Array.isArray(e.annotations)).length})]}),e.jsxs(R,{size:{xs:6,sm:3},children:[e.jsx(i,{variant:"caption",sx:{fontWeight:500,color:"#666",fontSize:"0.75rem"},children:"Total Annotations"}),e.jsx(i,{variant:"body2",sx:{fontSize:"0.875rem",fontWeight:600},children:Object.values(n).reduce((e,t)=>"object"==typeof t&&t?.annotations&&Array.isArray(t.annotations)?e+t.annotations.reduce((e,t)=>e+(t.regions?.length||0),0):e,0)})]})]})})]})}return e.jsxs(t,{children:[e.jsx(i,{variant:"h6",sx:{mb:2,fontWeight:600,color:"#333"},children:"Step Completed"}),e.jsx(c,{variant:"outlined",sx:{backgroundColor:"#f8f9fa"},children:e.jsxs(u,{sx:{textAlign:"center",py:3},children:[e.jsx(f,{sx:{fontSize:48,color:"#4caf50",mb:2}}),e.jsx(i,{variant:"body1",sx:{color:"#666"},children:"This step has been completed successfully"})]})})]})})()})}),a.ctq&&!L&&!q&&e.jsx(A,{severity:"warning",sx:{mb:2},children:"This is a Critical to Quality (CTQ) step. Both Production and CTQ approvals are required to proceed."}),e.jsx(t,{sx:{display:"flex",justifyContent:"flex-start"},children:e.jsx(n,{variant:"outlined",onClick:j||o,startIcon:e.jsx(r,{}),size:"small",children:j?"Back to Steps":"Back to Step"})})]})},ba=({executionData:n,currentStep:r})=>{const a=(e,t)=>{const n=e/t*100;return n>=100?"#4caf50":n>=50?"#ff9800":"#2196f3"};return e.jsxs(t,{sx:{p:2,backgroundColor:"white"},children:[e.jsx(i,{variant:"h6",sx:{fontWeight:600,color:"#333",mb:3},children:"Quick Stats"}),e.jsx(c,{sx:{mb:2},children:e.jsxs(u,{sx:{p:2},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(f,{sx:{color:a(n.stepsCompleted,n.totalSteps)}}),e.jsx(i,{variant:"body2",sx:{fontWeight:500},children:"Steps Completed"})]}),e.jsx(i,{variant:"h4",sx:{fontWeight:600,color:a(n.stepsCompleted,n.totalSteps)},children:n.stepsCompleted}),e.jsxs(i,{variant:"caption",sx:{color:"#666"},children:["of ",n.totalSteps," total steps"]})]})}),e.jsx(c,{sx:{mb:2},children:e.jsxs(u,{sx:{p:2},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(xe,{sx:{color:n.completedCtq===n.totalCtq?"#4caf50":"#ff9800"}}),e.jsx(i,{variant:"body2",sx:{fontWeight:500},children:"CTQs Passed"})]}),e.jsx(i,{variant:"h4",sx:{fontWeight:600,color:n.completedCtq===n.totalCtq?"#4caf50":"#ff9800"},children:n.completedCtq}),e.jsxs(i,{variant:"caption",sx:{color:"#666"},children:["of ",n.totalCtq," total CTQs"]})]})}),e.jsx(c,{sx:{mb:2},children:e.jsxs(u,{sx:{p:2},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(ye,{sx:{color:"#2196f3"}}),e.jsx(i,{variant:"body2",sx:{fontWeight:500},children:"Current Step"})]}),e.jsx(i,{variant:"h4",sx:{fontWeight:600,color:"#2196f3"},children:r?r.stepNumber:0}),e.jsx(i,{variant:"caption",sx:{color:"#666"},children:r?r.title:"No active step"})]})}),e.jsx(c,{sx:{mb:2},children:e.jsxs(u,{sx:{p:2},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(ye,{sx:{color:"#666"}}),e.jsx(i,{variant:"body2",sx:{fontWeight:500},children:"Total Duration"})]}),e.jsx(i,{variant:"h4",sx:{fontWeight:600,color:"#666"},children:(o=n.duration,`${Math.floor(o/36e5)}h ${Math.floor(o%36e5/6e4)}m`)})]})}),e.jsx(ve,{sx:{my:2}}),"Recent Activity",e.jsxs(t,{children:[e.jsx(i,{variant:"body2",sx:{fontWeight:600,color:"#333",mb:2},children:"Recent Activity"}),e.jsxs(be,{dense:!0,children:[e.jsx(Se,{sx:{px:0},children:e.jsx(_e,{primary:"PRC Execution Started",secondary:new Date(n.createdAt).toLocaleString(),primaryTypographyProps:{fontSize:"0.875rem"},secondaryTypographyProps:{fontSize:"0.75rem"}})}),n.updatedAt!==n.createdAt&&e.jsx(Se,{sx:{px:0},children:e.jsx(_e,{primary:"Last Updated",secondary:new Date(n.updatedAt).toLocaleString(),primaryTypographyProps:{fontSize:"0.875rem"},secondaryTypographyProps:{fontSize:"0.75rem"}})}),r&&e.jsx(Se,{sx:{px:0},children:e.jsx(_e,{primary:`Step ${r.stepNumber} - ${r.title}`,secondary:"Currently in progress",primaryTypographyProps:{fontSize:"0.875rem"},secondaryTypographyProps:{fontSize:"0.75rem"}})})]})]}),e.jsxs(t,{sx:{mt:3},children:[e.jsx(i,{variant:"body2",sx:{fontWeight:600,color:"#333",mb:2},children:"Status Summary"}),e.jsxs(t,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsx(s,{label:`${n.stepsCompleted}/${n.totalSteps} Steps`,size:"small",sx:{backgroundColor:"#e3f2fd",color:"#1976d2"}}),e.jsx(s,{label:`${n.completedCtq}/${n.totalCtq} CTQs`,size:"small",sx:{backgroundColor:n.completedCtq===n.totalCtq?"#e8f5e8":"#fff3e0",color:n.completedCtq===n.totalCtq?"#2e7d32":"#f57c00"}}),e.jsx(s,{label:n.status,size:"small",sx:{backgroundColor:"#f5f5f5",color:"#666"}})]})]})]});var o},Sa=e=>{const t=["stepCompleted","productionApproved","ctqApproved","partialCtqApprove"];return Object.entries(e).filter(([e])=>!t.includes(e))},_a=()=>{const{id:n}=ze(),r=ke(),i=n?parseInt(n,10):0,{userInfo:a}=Le(),[s,o]=je.useState(0),l=je.useRef(null),[c,u]=je.useState("list"),[d,h]=je.useState(null),[p,f]=je.useState([]),[g,m]=je.useState({}),{data:x,isLoading:y,isFetching:v,error:b}=Re(i),[S,{isLoading:_}]=De();je.useEffect(()=>{if(x&&!_&&!v){const e=x.data,t=Ge(e);setTimeout(()=>{f(t),m(e.prcAggregatedSteps||{})},0)}},[x,_,v]);const C=p[s],w=je.useCallback(()=>{if(Object.keys(g).length>0)return g;const e=x?.data;return e?.prcAggregatedSteps||{}},[g,x]),k=(e,t)=>{if(!x)return!1;const n=x.data.stepStartEndTime;if(!n)return!1;if("rawMaterials"===e.type)return void 0!==n.rawMaterials;if("bom"===e.type)return void 0!==n.bom;if("sequence"===e.type){let r,i,a;if(e.stepData)r=e.stepData.prcTemplateStepId,i=e.stepData.stepGroupId||0,a=e.stepData.stepId||0;else{if(!t)return!1;r=t.prcTemplateStepId||e.prcTemplateStepId||0,i=t.stepGroupId||e.stepGroup?.id||0,a=t.stepId||0}const s=n[r.toString()];if(s){const e=s[i.toString()];if(e)return void 0!==e[a.toString()]}}if("inspection"===e.type&&e.stepData){return void 0!==n[e.stepData.prcTemplateStepId.toString()]}return!1};je.useEffect(()=>{C&&"in-progress"===C.status&&(l.current=(new Date).toISOString())},[C]);je.useEffect(()=>{if(x&&"preview"===c&&d&&"sequence"===d.type&&C?.stepGroup){const e=x.data,t=P(C,e.stepStartEndTime);let n="";if(C.prcTemplateStepId&&C.stepGroup){const e=w()?.[C.prcTemplateStepId.toString()];if(e&&e[C.stepGroup.id.toString()]){const t=e[C.stepGroup.id.toString()];n=t.timingExceededRemarks||""}}d.timingExceeded===t.timingExceeded&&d.actualDuration===t.actualDuration&&d.expectedDuration===t.expectedDuration&&d.timingExceededRemarks===n||h(e=>e?{...e,timingExceeded:t.timingExceeded,actualDuration:t.actualDuration,expectedDuration:t.expectedDuration,timingExceededRemarks:n}:null)}},[x,c,d?.type,C?.stepGroup?.id,C,w,d]);const j=(e,t)=>{if(!e.stepGroup||!e.prcTemplateStepId)return!1;const n=t||w();if(!n)return!1;const r=n[e.prcTemplateStepId.toString()];if(!r)return!1;const i=r[e.stepGroup.id.toString()];if(!i)return!1;return e.stepGroup.steps.every(e=>void 0!==i[e.id.toString()])},P=(e,t)=>{if(!e.stepGroup||!e.prcTemplateStepId||!e.stepGroup.sequenceTiming)return{timingExceeded:!1,actualDuration:0,expectedDuration:0};const n=e.prcTemplateStepId.toString(),r=e.stepGroup.id.toString(),i=t[n];if(!i)return{timingExceeded:!1,actualDuration:0,expectedDuration:e.stepGroup.sequenceTiming};const a=i[r];if(!a)return{timingExceeded:!1,actualDuration:0,expectedDuration:e.stepGroup.sequenceTiming};let s=0,o=0;if(e.stepGroup.steps.forEach(e=>{const t=a[e.id.toString()];if(t){const e=new Date(t.startTime),n=new Date(t.endTime).getTime()-e.getTime(),r=Math.round(n/1e3*10)/10;s+=r,o++}}),0===o)return{timingExceeded:!1,actualDuration:0,expectedDuration:e.stepGroup.sequenceTiming};const l=e.stepGroup.sequenceTiming;return{timingExceeded:s>l,actualDuration:s,expectedDuration:l}},T=e=>{if(!e)return!1;if("sequence"===e.type&&e.stepGroup&&e.prcTemplateStepId){const t=w()?.[e.prcTemplateStepId.toString()];if(!t)return!1;const n=t[e.stepGroup.id.toString()];if(!n)return!1;const r=!0===n.productionApproved,i=!e.ctq||!0===n.ctqApproved||!0===n.partialCtqApprove,a=!0===n.stepCompleted;return r&&a&&i}if("inspection"===e.type&&e.stepData?.prcTemplateStepId){const t=w()?.[e.stepData.prcTemplateStepId.toString()];if(!t||0===Object.keys(t).length)return!1;const n=!0===t.productionApproved,r=!e.ctq||!0===t.ctqApproved||!0===t.partialCtqApprove,i=!0===t.stepCompleted;return n&&i&&r}return"completed"===e.status},z=e=>{if(!e.stepGroup||!e.prcTemplateStepId)return-1;const t=w();if(!t)return-1;const n=t[e.prcTemplateStepId.toString()];if(!n)return-1;const r=n[e.stepGroup.id.toString()];if(!r)return-1;let i=-1;return e.stepGroup.steps.forEach((e,t)=>{void 0!==r[e.id.toString()]&&(i=t)}),i};if(y)return e.jsx(t,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh"},children:e.jsx(Ce,{})});if(b)return e.jsx(t,{sx:{p:3},children:e.jsx(A,{severity:"error",children:"Failed to load PRC execution details. Please try again."})});if(!x)return e.jsx(t,{sx:{p:3},children:e.jsx(A,{severity:"warning",children:"No execution data found for this PRC."})});const I=x.data;return 0===p.length?e.jsx(t,{sx:{p:3},children:e.jsx(A,{severity:"warning",children:"No execution steps found for this PRC."})}):e.jsxs(e.Fragment,{children:[e.jsx(we,{sx:{color:"#fff",zIndex:e=>e.zIndex.drawer+1},open:y||v||_,children:e.jsx(Ce,{color:"inherit"})}),e.jsxs(t,{sx:{height:"calc(100vh - 64px - 38px)",display:"flex",flexDirection:"column",overflow:"hidden",margin:-3,p:3,boxSizing:"border-box"},children:[e.jsx(Je,{executionData:I}),e.jsxs(t,{sx:{flex:1,overflow:"hidden"},children:["list"===c&&e.jsxs(t,{sx:{display:"flex",height:"100%"},children:[e.jsx(t,{sx:{flex:1,borderRight:"1px solid #e0e0e0"},children:e.jsx(Ze,{steps:p,currentStepIndex:s,onStepClick:e=>{const t=p[e];if(t){if(e>s){if(!T(p[s]))return void u("detail")}if("sequence"===t.type&&t.stepGroup){l.current=(new Date).toISOString();if(j(t)){o(e);const n=w()?.[t.prcTemplateStepId?.toString()||""],r=n?.[t.stepGroup?.id.toString()||""],i=[];r&&Sa(r).forEach(([e,n])=>{const r=t.stepGroup?.steps.find(t=>t.id.toString()===e),a={stepId:e,value:n.value||n.data,parameterDescription:r?.parameterDescription||`Step ${e}`,stepType:r?.stepType||"Unknown",evaluationMethod:r?.evaluationMethod||"Unknown",uom:r?.uom||"",notes:r?.notes||"",ctq:r?.ctq||!1,stepNumber:r?.stepNumber||0,responsiblePersons:[]};let s=null;n.responsiblePersons&&Array.isArray(n.responsiblePersons)?s=n.responsiblePersons:n.data&&"object"==typeof n.data&&n.data.responsiblePersons&&(s=n.data.responsiblePersons),s&&Array.isArray(s)&&(a.responsiblePersons=s),i.push(a)});let a=!1,s=!1,l=!1;if(t.prcTemplateStepId&&t.stepGroup){const e=w()?.[t.prcTemplateStepId.toString()];if(e&&e[t.stepGroup.id.toString()]){const n=e[t.stepGroup.id.toString()];a=!0===n.productionApproved,s=!0===n.ctqApproved||!0===n.partialCtqApprove,l=!0===n.stepCompleted}}const c=x.data,d=P(t,c.stepStartEndTime);let p="";if(t.prcTemplateStepId&&t.stepGroup){const e=w()?.[t.prcTemplateStepId.toString()];if(e&&e[t.stepGroup.id.toString()]){p=e[t.stepGroup.id.toString()].timingExceededRemarks||""}}const f={stepNumber:t.stepNumber,title:t.title,type:t.type,ctq:t.ctq,data:i,productionApproved:a,ctqApproved:s,stepCompleted:l,timingExceeded:d.timingExceeded,actualDuration:d.actualDuration,expectedDuration:d.expectedDuration,timingExceededRemarks:p};return h(f),void u("preview")}if(-1!==z(t))return o(e),void u("detail")}if("inspection"===t.type){const n=t.stepData?.prcTemplateStepId;if(n){const r=w()?.[n.toString()];if(r&&Object.keys(r).length>0){o(e);let n=!1,i=!1,a=!1;n=!0===r.productionApproved,i=!t.ctq||!0===r.ctqApproved||!0===r.partialCtqApprove,a=!0===r.stepCompleted;const s={stepNumber:t.stepNumber,title:t.title,type:"inspection",ctq:t.ctq,data:r,productionApproved:n,ctqApproved:i,stepCompleted:a,inspectionParameters:t.inspectionParameters,inspectionMetadata:t.inspectionMetadata};return h(s),void u("preview")}}}"completed"!==t.status&&"in-progress"!==t.status&&e!==s||(o(e),u("detail"))}}})}),e.jsx(t,{sx:{width:"300px",overflowY:"auto"},children:e.jsx(ba,{executionData:I,currentStep:C})})]}),"detail"===c&&C&&e.jsx(xa,{step:C,executionData:I,onBackToList:()=>{u("list")},onPreviousStep:()=>{s>0&&o(e=>e-1)},onNextStep:()=>{s<p.length-1&&o(e=>e+1)},onStepComplete:async e=>{if(C&&x)try{const t=(new Date).toISOString(),n=l.current||t;let c=C;if("sequence"===C.type&&C.stepGroup&&C.prcTemplateStepId){const t=e.stepId,n=e.stepGroupId,r=e.prcTemplateStepId;c={...C,stepData:{prcTemplateStepId:r||C.prcTemplateStepId||0,stepGroupId:n||C.stepGroup?.id,stepId:t}}}const d=Be(c,e);let f={};k(c,e)||(f=$e(c,n,t));const g=Xe(c,"dataEnteredBy",a.id),y=He(w(),d),v=x.data,b=Qe(v.stepStartEndTime,f),_=Ke(v.prcAggregatedSteps?.stepApprovedBy,g);if(await S({id:i,data:{prcAggregatedSteps:{...y,stepApprovedBy:_},stepStartEndTime:b}}).unwrap(),l.current=null,m(y),"sequence"===C.type&&C.stepGroup){if(j(C,y)){const e=y[C.prcTemplateStepId?.toString()||""],t=e?.[C.stepGroup?.id.toString()||""],n=[];if(t){Sa(t).forEach(([e,t])=>{const r=C.stepGroup?.steps.find(t=>t.id.toString()===e);let i=t.value||t.data,a=t.minimumAcceptanceValue,s=t.maximumAcceptanceValue,o=t.validationStatus;if(Array.isArray(i)&&i.length>0&&"object"==typeof i[0]&&null!==i[0]&&"value"in i[0]){const e=i[0];i=i.map(e=>e.value),e.validationStatus&&(o=e.validationStatus,a=e.minimumAcceptanceValue,s=e.maximumAcceptanceValue)}else if("object"==typeof i&&null!==i&&"value"in i){const e=i;i=e.value,a=e.minimumAcceptanceValue||a,s=e.maximumAcceptanceValue||s,o=e.validationStatus||o}const l={stepId:e,value:i,parameterDescription:r?.parameterDescription||`Step ${e}`,stepType:r?.stepType||"Unknown",evaluationMethod:r?.evaluationMethod||"Unknown",uom:r?.uom||"",notes:r?.notes||"",ctq:r?.ctq||!1,stepNumber:r?.stepNumber||0,minimumAcceptanceValue:a||r?.minimumAcceptanceValue,maximumAcceptanceValue:s||r?.maximumAcceptanceValue,validationStatus:o,responsiblePersons:[]};let c=null;t.responsiblePersons&&Array.isArray(t.responsiblePersons)?c=t.responsiblePersons:t.data&&"object"==typeof t.data&&t.data.responsiblePersons&&(c=t.data.responsiblePersons),c&&Array.isArray(c)&&(l.responsiblePersons=c),n.push(l)})}let r=!1,i=!1,a=!1;if(C.prcTemplateStepId&&C.stepGroup){const e=y[C.prcTemplateStepId.toString()];if(e&&e[C.stepGroup.id.toString()]){const t=e[C.stepGroup.id.toString()];r=!0===t.productionApproved,i=!0===t.ctqApproved||!0===t.partialCtqApprove,a=!0===t.stepCompleted}}const s=x.data,o=P(C,s.stepStartEndTime);let l="";if(C.prcTemplateStepId&&C.stepGroup){const e=y[C.prcTemplateStepId.toString()];if(e&&e[C.stepGroup.id.toString()]){l=e[C.stepGroup.id.toString()].timingExceededRemarks||""}}const c={stepNumber:C.stepNumber,title:C.title,type:C.type,ctq:C.ctq,data:n,productionApproved:r,ctqApproved:i,stepCompleted:a,timingExceeded:o.timingExceeded,actualDuration:o.actualDuration,expectedDuration:o.expectedDuration,timingExceededRemarks:l};h(c),u("preview")}else u("detail")}else if("inspection"===C.type){const e=C.stepData?.prcTemplateStepId;let t={};if(y&&e){const n=y[e.toString()];n&&(t=n)}let n=!1,r=!1,i=!1;if(y&&e){const t=y[e.toString()];t&&(n=!0===t.productionApproved,r=!C.ctq||!0===t.ctqApproved||!0===t.partialCtqApprove,i=!0===t.stepCompleted)}const a={stepNumber:C.stepNumber,title:C.title,type:"inspection",ctq:C.ctq,data:t,productionApproved:n,ctqApproved:r,stepCompleted:i,inspectionParameters:C.inspectionParameters,inspectionMetadata:C.inspectionMetadata};h(a),u("preview")}else s<p.length-1?(o(e=>e+1),u("list")):r("/prc-execution")}catch(t){}},canGoPrevious:s>0,canGoNext:s<p.length-1}),"preview"===c&&d&&e.jsx(t,{sx:{height:"100%",overflowY:"auto"},children:e.jsx(va,{previewData:d,onBackToStep:()=>{u("detail")},onApproveProduction:async()=>{if(C&&x&&d)try{const e=(new Date).toISOString(),t=Ye(C,"productionApproved",e),n=Xe(C,"productionApprovedBy",a.id),r=x.data,o=Qe(r.stepStartEndTime,t),l=Ke(r.prcAggregatedSteps?.stepApprovedBy,n),c={...C,productionApproved:!0},u=[...p];u[s]=c;const d=w(),g=JSON.parse(JSON.stringify(d));if("sequence"===C.type&&C.prcTemplateStepId&&C.stepGroup){g[C.prcTemplateStepId.toString()]||(g[C.prcTemplateStepId.toString()]={});const e=g[C.prcTemplateStepId.toString()];e[C.stepGroup.id.toString()]||(e[C.stepGroup.id.toString()]={});const t=e[C.stepGroup.id.toString()];e[C.stepGroup.id.toString()]={...t,productionApproved:!0}}else if("inspection"===C.type&&C.stepData?.prcTemplateStepId){const e=C.stepData.prcTemplateStepId;g[e.toString()]||(g[e.toString()]={});const t=g[e.toString()];g[e.toString()]={...t,productionApproved:!0}}await S({id:i,data:{prcAggregatedSteps:{...g,stepApprovedBy:l},stepStartEndTime:o}}).unwrap(),f(u),m(g),h(e=>e?{...e,productionApproved:!0}:null)}catch(e){}},onApproveCTQ:async()=>{if(C&&x&&d)try{const e=(new Date).toISOString(),t=Ye(C,"ctqApproved",e),n=Xe(C,"ctqApprovedBy",a.id),r=x.data,o=Qe(r.stepStartEndTime,t),l=Ke(r.prcAggregatedSteps?.stepApprovedBy,n),c={...C,ctqApproved:!0},u=[...p];u[s]=c;const d=w(),g=JSON.parse(JSON.stringify(d));if("sequence"===C.type&&C.prcTemplateStepId&&C.stepGroup){g[C.prcTemplateStepId.toString()]||(g[C.prcTemplateStepId.toString()]={});const e=g[C.prcTemplateStepId.toString()];e[C.stepGroup.id.toString()]||(e[C.stepGroup.id.toString()]={});const t=e[C.stepGroup.id.toString()];e[C.stepGroup.id.toString()]={...t,ctqApproved:!0}}else if("inspection"===C.type&&C.stepData?.prcTemplateStepId){const e=C.stepData.prcTemplateStepId;g[e.toString()]||(g[e.toString()]={});const t=g[e.toString()];g[e.toString()]={...t,ctqApproved:!0}}await S({id:i,data:{prcAggregatedSteps:{...g,stepApprovedBy:l},stepStartEndTime:o}}).unwrap(),f(u),m(g),h(e=>e?{...e,ctqApproved:!0}:null)}catch(e){}},onPartialApproveCTQ:async()=>{if(C&&x&&d)try{const e=(new Date).toISOString(),t=Ye(C,"ctqApproved",e),n=Xe(C,"ctqApprovedBy",a.id),r=x.data,o=Qe(r.stepStartEndTime,t),l=Ke(r.prcAggregatedSteps?.stepApprovedBy,n),c={...C,partialCtqApprove:!0},u=[...p];u[s]=c;const d=w(),g=JSON.parse(JSON.stringify(d));if("sequence"===C.type&&C.prcTemplateStepId&&C.stepGroup){g[C.prcTemplateStepId.toString()]||(g[C.prcTemplateStepId.toString()]={});const e=g[C.prcTemplateStepId.toString()];e[C.stepGroup.id.toString()]||(e[C.stepGroup.id.toString()]={});const t=e[C.stepGroup.id.toString()];e[C.stepGroup.id.toString()]={...t,partialCtqApprove:!0}}else if("inspection"===C.type&&C.stepData?.prcTemplateStepId){const e=C.stepData.prcTemplateStepId;g[e.toString()]||(g[e.toString()]={});const t=g[e.toString()];g[e.toString()]={...t,partialCtqApprove:!0}}await S({id:i,data:{prcAggregatedSteps:{...g,stepApprovedBy:l},stepStartEndTime:o}}).unwrap(),f(u),m(g),h(e=>e?{...e,partialCtqApprove:!0}:null)}catch(e){}},onProceedToNext:async e=>{if(C&&x)try{const t=(new Date).toISOString(),n=l.current||t,c=(new Date).toISOString(),p=Ye(C,"stepCompleted",c),g=Xe(C,"stepCompletedBy",a.id),y=d?Be(C,d.data):{};let v={};k(C,d?.data)||(v=$e(C,n,t));let b=He(w(),y);const _=x.data;let j=Qe(_.stepStartEndTime,v);j=Qe(j,p);const A=Ke(_.prcAggregatedSteps?.stepApprovedBy,g);if("sequence"===C.type&&C.stepGroup&&C.prcTemplateStepId){b=JSON.parse(JSON.stringify(b)),b[C.prcTemplateStepId.toString()]||(b[C.prcTemplateStepId.toString()]={});const t=b[C.prcTemplateStepId.toString()];t[C.stepGroup.id.toString()]||(t[C.stepGroup.id.toString()]={});const n={...t[C.stepGroup.id.toString()],stepCompleted:!0};d?.timingExceeded&&(n.timingExceeded=!0,e&&(n.timingExceededRemarks=e)),t[C.stepGroup.id.toString()]=n}else if("inspection"===C.type&&C.stepData?.prcTemplateStepId){b=JSON.parse(JSON.stringify(b));const e=C.stepData.prcTemplateStepId;b[e.toString()]||(b[e.toString()]={});const t=b[e.toString()];b[e.toString()]={...t,stepCompleted:!0}}await S({id:i,data:{prcAggregatedSteps:{...b,stepApprovedBy:A},stepStartEndTime:j}}).unwrap(),l.current=null;const P={..._,prcAggregatedSteps:{...b,stepApprovedBy:A},stepStartEndTime:j};m(b);const T=Ge(P);f(T),s<T.length-1?(o(e=>e+1),u("list"),h(null)):r("/prc-execution")}catch(t){}},onBackToStepGroup:"sequence"===C?.type?()=>{C&&"sequence"===C.type&&C.stepGroup&&(u("detail"),h(null))}:void 0})})]})]})]})};export{_a as default};
