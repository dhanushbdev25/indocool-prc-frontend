import{j as e,I as i,br as t,a2 as a,z as r,bg as s,a4 as n,an as l,ao as o,b3 as d,a6 as c,a7 as x,a8 as u,al as p,bN as h,X as m,bn as f,$ as g,U as j,ac as b,ai as y,am as v,ap as C,aj as N,J as I,bQ as w,bT as S,m as R,bq as k,_ as T,ad as W,ae as P,r as q,af as M,ag as z,bR as A,bS as D,aO as O,bU as L,bk as E,bl as F,Z as $,aK as H,aN as U,W as Q,aq as V,bO as B,bC as G,bD as _,E as Y,bF as Z,O as J,aU as K,be as X,w as ee,e as ie}from"./mui-vendor-ThRJoe5u.js";import{r as te,a as ae,f as re,j as se}from"./react-vendor-jVbyDP5c.js";import{C as ne,g as le,i as oe,j as de,k as ce,h as xe,p as ue,l as pe,m as he,f as me,F as fe}from"./form-vendor-DG-ZRlco.js";import{o as ge}from"./yup-lT2MYDzp.js";import{S as je}from"./utils-vendor-S0KZLiBE.js";import{a as be,B as ye,c as ve,s as Ce,C as Ne,D as Ie,E as we,F as Se}from"./index-De03Ly_y.js";import{P as Re}from"./PartImageUpload-BTaO-DQZ.js";import{u as ke}from"./types-BnIy1GbH.js";import"./auth-vendor-BOyMHjHL.js";import"./state-vendor-BxbV2bHq.js";import"./ui-vendor-DL_b4SbO.js";const Te=({control:m,errors:f,gallery:g,onAddImage:j,onRemoveImage:b})=>{const{data:y,isLoading:v}=be();return e.jsxs(i,{children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(t,{sx:{mr:1,color:"#1976d2"}}),e.jsx(a,{variant:"h6",sx:{fontWeight:600,color:"#333"},children:"General Information"})]}),e.jsx(r,{sx:{p:3,borderRadius:2,border:"1px solid #e0e0e0"},children:e.jsxs(s,{container:!0,spacing:3,children:[e.jsx(s,{size:{xs:12,md:6},children:e.jsx(ne,{name:"partNumber",control:m,render:({field:i})=>e.jsx(n,{...i,fullWidth:!0,label:"Part Number",required:!0,placeholder:"e.g., PN-10045",helperText:f.partNumber?.message||"Unique identifier for the part",error:!!f.partNumber,sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px"}}})})}),e.jsx(s,{size:{xs:12,md:6},children:e.jsx(ne,{name:"drawingNumber",control:m,render:({field:i})=>e.jsx(n,{...i,fullWidth:!0,label:"Drawing Number",required:!0,placeholder:"e.g., DR-4521",helperText:f.drawingNumber?.message||"Drawing reference number",error:!!f.drawingNumber,sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px"}}})})}),e.jsx(s,{size:{xs:12,md:6},children:e.jsx(ne,{name:"drawingRevision",control:m,render:({field:i})=>e.jsx(n,{...i,fullWidth:!0,label:"Drawing Revision",type:"number",placeholder:"e.g., 2",helperText:"Drawing revision number ",error:!!f.drawingRevision,slotProps:{htmlInput:{readOnly:!0}},sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px",backgroundColor:"#f5f5f5"}}})})}),e.jsx(s,{size:{xs:12,md:6},children:e.jsx(ne,{name:"partRevision",control:m,render:({field:i})=>e.jsx(n,{...i,fullWidth:!0,label:"Part Revision",type:"number",placeholder:"e.g., 3",helperText:"Part revision number ",error:!!f.partRevision,slotProps:{htmlInput:{readOnly:!0}},sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px",backgroundColor:"#f5f5f5"}}})})}),e.jsx(s,{size:{xs:12,md:6},children:e.jsx(i,{sx:{display:"flex",alignItems:"center",height:"100%"},children:e.jsx(ne,{name:"isActive",control:m,render:({field:t})=>e.jsx(l,{control:e.jsx(o,{checked:t.value,onChange:t.onChange,color:"primary"}),label:e.jsxs(i,{children:[e.jsx(a,{variant:"body1",sx:{fontWeight:500},children:"Active Part"}),e.jsx(a,{variant:"caption",sx:{color:"#666"},children:"Enable this part for use in production"})]})})})})}),e.jsx(s,{size:{xs:12,md:6},children:e.jsx(ne,{name:"customer",control:m,render:({field:i})=>e.jsxs(d,{fullWidth:!0,error:!!f.customer,children:[e.jsx(c,{children:"Customer"}),e.jsx(x,{...i,label:"Customer",disabled:v,sx:{borderRadius:"8px"},children:y?.data?.map(i=>e.jsx(u,{value:i.value,children:i.label},i.value))}),f.customer&&e.jsx(a,{variant:"caption",color:"error",sx:{mt:.5,ml:1.75},children:f.customer.message})]})})}),e.jsx(s,{size:{xs:12},children:e.jsx(ne,{name:"description",control:m,render:({field:i})=>e.jsx(n,{...i,fullWidth:!0,label:"Description",required:!0,placeholder:"e.g., Aluminium Bracket Assembly for Cooling System",helperText:f.description?.message||"Detailed description of the part",error:!!f.description,sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px"}}})})}),e.jsx(s,{size:{xs:12,md:6},children:e.jsx(ne,{name:"layupType",control:m,render:({field:i})=>e.jsx(n,{...i,fullWidth:!0,label:"Layup Type",placeholder:"e.g., PPCORE CSM",helperText:"Material layup type ",error:!!f.layupType,sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px"}}})})}),e.jsx(s,{size:{xs:12,md:6},children:e.jsx(ne,{name:"model",control:m,render:({field:i})=>e.jsx(n,{...i,fullWidth:!0,label:"Model",placeholder:"e.g., RHD (Exterior)",helperText:"Part model or variant ",error:!!f.model,sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px"}}})})}),e.jsx(s,{size:{xs:12,md:6},children:e.jsx(ne,{name:"sapReferenceNumber",control:m,render:({field:i})=>e.jsx(n,{...i,fullWidth:!0,label:"SAP Reference Number",placeholder:"e.g., SAP-12345",helperText:"SAP system reference number ",error:!!f.sapReferenceNumber,sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px"}}})})}),e.jsxs(s,{size:{xs:12},children:[e.jsx(p,{sx:{my:2}}),e.jsx(ne,{name:"notes",control:m,render:({field:i})=>e.jsx(n,{...i,fullWidth:!0,label:"Notes",multiline:!0,rows:4,placeholder:"Additional notes about this part",helperText:f.notes?.message||"Optional notes about usage, special conditions, or other relevant information",error:!!f.notes,sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px"}}})})]})]})}),e.jsxs(r,{sx:{p:3,mt:3,borderRadius:2,border:"1px solid #e0e0e0"},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(h,{sx:{mr:1,color:"#1976d2"}}),e.jsx(a,{variant:"h6",sx:{fontWeight:600,color:"#333"},children:"Part Drawings"})]}),e.jsx(a,{variant:"body2",color:"textSecondary",sx:{mb:2},children:"Upload part drawing images. These will be available for mapping to inspection parameters when a PRC template is linked."}),e.jsx(Re,{gallery:g,onAddImage:j,onRemoveImage:b,view:!1})]})]})},We=le({id:ue().optional(),materialName:xe().required("Material name is required"),materialCode:xe().required("Material code is required"),quantity:xe().required("Quantity is required"),uom:xe().required("UOM is required"),batching:oe().default(!1),splitting:oe().default(!1),splittingConfiguration:ce(le({order:de().required(),splitQuantity:ue().test("is-string-or-number","Split quantity must be a string or number",function(e){return"string"==typeof e||"number"==typeof e}).transform(e=>String(e))})).nullable().optional(),version:de().default(1),isLatest:oe().default(!0)}),Pe=le({id:ue().optional(),characteristics:xe().required("Characteristics is required"),specification:xe().required("Specification is required"),noOfHoles:xe().required("Number of holes is required"),diaOfHoles:xe().required("Diameter of holes is required"),tolerance:xe().required("Tolerance is required"),version:de().default(1),isLatest:oe().default(!0)}),qe=le({id:ue().optional(),characteristics:xe().required("Characteristics is required"),specification:xe().required("Specification is required"),tolerance:xe().required("Tolerance is required"),version:de().default(1),isLatest:oe().default(!0)}),Me=le({fileName:xe().optional(),filePath:xe().optional(),originalFileName:xe().optional()}),ze=le({partId:de().optional(),files:ce(le({inspectionParameterId:de().optional(),fileName:ce(le({fileName:xe().optional(),filePath:xe().optional(),originalFileName:xe().optional()})).optional()})).nullable().default([])}),Ae=le({id:de().optional(),partNumber:xe().required("Part number is required").min(3,"Part number must be at least 3 characters").max(50,"Part number must be less than 50 characters").matches(/^[A-Z0-9-]+$/,"Part number must contain only uppercase letters, numbers, and hyphens"),drawingNumber:xe().required("Drawing number is required").min(3,"Drawing number must be at least 3 characters").max(50,"Drawing number must be less than 50 characters"),drawingRevision:de().default(1),partRevision:de().default(1),isActive:oe().default(!0),customer:xe().required("Customer is required"),description:xe().required("Description is required").min(3,"Description must be at least 3 characters").max(200,"Description must be less than 200 characters"),notes:xe().max(500,"Notes must be less than 500 characters").optional(),layupType:xe().max(100,"Layup type must be less than 100 characters").optional(),model:xe().max(100,"Model must be less than 100 characters").optional(),sapReferenceNumber:xe().max(50,"SAP reference number must be less than 50 characters").optional(),version:de().default(1),isLatest:oe().default(!0),catalyst:de().optional(),prcTemplate:de().optional(),rawMaterials:ce(We).default([]),drilling:ce(Pe).default([]),cutting:ce(qe).default([]),files:ce(Me).default([]),inspectionDiagrams:ze.optional(),createdAt:xe().optional(),updatedAt:xe().optional()}),De={materialName:"",materialCode:"",quantity:"",uom:"",batching:!1,splitting:!1,splittingConfiguration:null,version:1,isLatest:!0},Oe={characteristics:"",specification:"",noOfHoles:"",diaOfHoles:"",tolerance:"",version:1,isLatest:!0},Le={characteristics:"",specification:"",tolerance:"",version:1,isLatest:!0},Ee={partNumber:"",drawingNumber:"",drawingRevision:1,partRevision:1,isActive:!0,customer:"",description:"",notes:"",layupType:"",model:"",sapReferenceNumber:"",version:1,isLatest:!0,catalyst:void 0,prcTemplate:void 0,rawMaterials:[],drilling:[],cutting:[],files:[],inspectionDiagrams:void 0};le({partNumber:xe().required("Part number is required").min(3,"Part number must be at least 3 characters").max(50,"Part number must be less than 50 characters").matches(/^[A-Z0-9-]+$/,"Part number must contain only uppercase letters, numbers, and hyphens"),drawingNumber:xe().required("Drawing number is required").min(3,"Drawing number must be at least 3 characters").max(50,"Drawing number must be less than 50 characters"),isActive:oe().default(!0),customer:xe().required("Customer is required"),description:xe().required("Description is required").min(3,"Description must be at least 3 characters").max(200,"Description must be less than 200 characters"),notes:xe().max(500,"Notes must be less than 500 characters").optional(),layupType:xe().max(100,"Layup type must be less than 100 characters").optional(),model:xe().max(100,"Model must be less than 100 characters").optional(),sapReferenceNumber:xe().max(50,"SAP reference number must be less than 50 characters").optional()}),le({rawMaterials:ce(We)}),le({drilling:ce(Pe),cutting:ce(qe)}),le({catalyst:de().optional(),prcTemplate:de().optional()});const Fe=[{value:"Gelcoat",label:"Gelcoat"},{value:"Resin",label:"Resin"},{value:"Topcoat",label:"Top Coat"},{value:"Others",label:"Others"}],$e=({control:t,errors:s})=>{const[p,h]=te.useState(!1),[A,D]=te.useState(null),[O,L]=te.useState(De),[E,F]=te.useState(""),[$,H]=te.useState(""),[U,Q]=te.useState(new Set),{fields:V,append:B,remove:G,update:_}=pe({control:t,name:"rawMaterials"}),Y=e=>{if(void 0!==e){D(e);const i={...V[e]};i.splittingConfiguration&&(i.splittingConfiguration=i.splittingConfiguration.map(e=>({...e,splitQuantity:String(e.splitQuantity)}))),L(i);const t=V[e].materialCode;Fe.some(e=>e.value===t)?(F(t),H("")):(F("Others"),H(t))}else D(null),L(De),F(""),H("");h(!0)},Z=()=>{h(!1),D(null),L(De),F(""),H("")},J=(e,i)=>{L(t=>({...t,[e]:i}))},K=()=>{if(!O.splitting||!O.splittingConfiguration)return!0;const e=parseFloat(O.quantity)||0,i=O.splittingConfiguration.reduce((e,i)=>e+(parseFloat(String(i.splitQuantity||""))||0),0);return Math.abs(e-i)<.01};return e.jsxs(i,{children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:3},children:[e.jsx(a,{variant:"h6",sx:{fontWeight:600,color:"#333"},children:"Raw Materials"}),e.jsx(m,{variant:"contained",startIcon:e.jsx(f,{}),onClick:()=>Y(),sx:{textTransform:"none",backgroundColor:"#1976d2","&:hover":{backgroundColor:"#1565c0"}},children:"Add Material"})]}),e.jsxs(r,{sx:{p:3,borderRadius:2,border:"1px solid #e0e0e0"},children:[s.rawMaterials&&e.jsx(g,{severity:"error",sx:{mb:3},children:s.rawMaterials.message}),0===V.length?e.jsx(i,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:200,border:"2px dashed #e0e0e0",borderRadius:2,backgroundColor:"#fafafa"},children:e.jsxs(a,{color:"textSecondary",textAlign:"center",children:["No raw materials added yet.",e.jsx("br",{}),'Click "Add Material" to add raw materials for this part.']})}):e.jsx(j,{children:e.jsxs(b,{children:[e.jsx(y,{children:e.jsxs(v,{sx:{backgroundColor:"#f8f9fa"},children:[e.jsx(C,{sx:{fontWeight:600,color:"#333",width:50}}),e.jsx(C,{sx:{fontWeight:600,color:"#333"},children:"Material Name"}),e.jsx(C,{sx:{fontWeight:600,color:"#333"},children:"Material Code"}),e.jsx(C,{sx:{fontWeight:600,color:"#333"},children:"Quantity"}),e.jsx(C,{sx:{fontWeight:600,color:"#333"},children:"UOM"}),e.jsx(C,{sx:{fontWeight:600,color:"#333"},children:"Batching"}),e.jsx(C,{sx:{fontWeight:600,color:"#333"},children:"Splitting"}),e.jsx(C,{sx:{fontWeight:600,color:"#333",width:120},children:"Actions"})]})}),e.jsx(N,{children:V.map((t,r)=>e.jsxs(ae.Fragment,{children:[e.jsxs(v,{sx:{"&:hover":{backgroundColor:"#f5f5f5"}},children:[e.jsx(C,{children:t.splitting&&t.splittingConfiguration&&t.splittingConfiguration.length>0&&e.jsx(I,{size:"small",onClick:()=>(e=>{const i=new Set(U);i.has(e)?i.delete(e):i.add(e),Q(i)})(r),sx:{color:"#1976d2"},children:U.has(r)?e.jsx(w,{}):e.jsx(S,{})})}),e.jsx(C,{sx:{fontWeight:500,color:"#333"},children:t.materialName}),e.jsx(C,{sx:{color:"#666"},children:t.materialCode}),e.jsx(C,{sx:{color:"#666"},children:t.quantity}),e.jsx(C,{sx:{color:"#666"},children:t.uom}),e.jsx(C,{sx:{color:"#666"},children:t.batching?"Yes":"No"}),e.jsx(C,{sx:{color:"#666"},children:t.splitting?"Yes":"No"}),e.jsx(C,{children:e.jsxs(i,{sx:{display:"flex",gap:1},children:[e.jsx(I,{size:"small",onClick:()=>Y(r),sx:{color:"#1976d2"},children:e.jsx(R,{fontSize:"small"})}),e.jsx(I,{size:"small",onClick:()=>(e=>{G(e)})(r),sx:{color:"#d32f2f"},children:e.jsx(k,{fontSize:"small"})})]})})]}),t.splitting&&t.splittingConfiguration&&t.splittingConfiguration.length>0&&e.jsx(v,{children:e.jsx(C,{colSpan:8,sx:{py:0},children:e.jsx(T,{in:U.has(r),timeout:"auto",unmountOnExit:!0,children:e.jsxs(i,{sx:{margin:1},children:[e.jsx(a,{variant:"h6",gutterBottom:!0,component:"div",sx:{fontSize:"0.9rem",fontWeight:600},children:"Split Configuration"}),e.jsxs(b,{size:"small",children:[e.jsx(y,{children:e.jsxs(v,{children:[e.jsx(C,{sx:{fontWeight:600,color:"#333"},children:"Order"}),e.jsx(C,{sx:{fontWeight:600,color:"#333"},children:"Split Quantity"})]})}),e.jsx(N,{children:t.splittingConfiguration.map((i,t)=>e.jsxs(v,{children:[e.jsx(C,{sx:{color:"#666"},children:i.order}),e.jsx(C,{sx:{color:"#666"},children:String(i.splitQuantity??"")})]},t))})]})]})})})})]},t.id))})]})})]}),e.jsxs(W,{open:p,onClose:Z,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(P,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:2},children:[e.jsx(a,{variant:"h6",children:null!==A?"Edit Raw Material":"Add Raw Material"}),e.jsx(I,{onClick:Z,size:"small",children:e.jsx(q,{})})]}),e.jsx(M,{sx:{pt:1,pb:2},children:e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:3,mt:1},children:[e.jsx(n,{fullWidth:!0,label:"Material Name",value:O.materialName,onChange:e=>J("materialName",e.target.value),placeholder:"e.g., Aluminium Sheet 6061",required:!0,sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px"}}}),e.jsxs(d,{fullWidth:!0,children:[e.jsx(c,{children:"Material Code"}),e.jsx(x,{value:E,onChange:e=>{return i=e.target.value,F(i),void("Others"!==i&&H(""));var i},label:"Material Code",required:!0,sx:{borderRadius:"8px"},children:Fe.map(i=>e.jsx(u,{value:i.value,children:i.label},i.value))})]}),"Others"===E&&e.jsx(n,{fullWidth:!0,label:"Custom Material Code",value:$,onChange:e=>H(e.target.value),placeholder:"Enter custom material code",required:!0,sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px"}}}),e.jsx(n,{fullWidth:!0,label:"Quantity",type:"number",value:O.quantity,onChange:e=>J("quantity",e.target.value),placeholder:"e.g., 2.5",required:!0,sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px"}}}),e.jsxs(d,{fullWidth:!0,children:[e.jsx(c,{children:"Unit of Measure"}),e.jsx(x,{value:O.uom,onChange:e=>J("uom",e.target.value),label:"Unit of Measure",sx:{borderRadius:"8px"},children:ke.map(i=>e.jsx(u,{value:i.value,children:i.label},i.value))})]}),e.jsxs(i,{sx:{display:"flex",gap:3,mt:1},children:[e.jsx(l,{control:e.jsx(o,{checked:O.batching,onChange:e=>{return i=e.target.checked,void L(e=>({...e,batching:i}));var i},color:"primary"}),label:"Batching"}),e.jsx(l,{control:e.jsx(o,{checked:O.splitting,onChange:e=>{return i=e.target.checked,void L(e=>({...e,splitting:i,splittingConfiguration:i?[{order:1,splitQuantity:""}]:null}));var i},color:"primary"}),label:"Splitting"})]}),O.splitting&&e.jsxs(i,{sx:{mt:2,p:2,border:"1px solid #e0e0e0",borderRadius:1},children:[e.jsx(a,{variant:"subtitle2",sx:{mb:2,fontWeight:600},children:"Split Configuration"}),O.splittingConfiguration?.map((t,a)=>e.jsxs(i,{sx:{display:"flex",gap:2,mb:2,alignItems:"center"},children:[e.jsx(n,{label:"Order",value:t.order,disabled:!0,size:"small",sx:{width:80}}),e.jsx(n,{label:"Split Quantity",type:"number",value:t.splitQuantity,onChange:e=>((e,i)=>{L(t=>({...t,splittingConfiguration:t.splittingConfiguration?.map((t,a)=>a===e?{...t,splitQuantity:i}:t)||null}))})(a,e.target.value),size:"small",sx:{flexGrow:1}}),e.jsx(I,{size:"small",onClick:()=>(e=>{L(i=>({...i,splittingConfiguration:i.splittingConfiguration?.filter((i,t)=>t!==e)||null}))})(a),sx:{color:"#d32f2f"},children:e.jsx(k,{})})]},a)),e.jsx(m,{variant:"outlined",startIcon:e.jsx(f,{}),onClick:()=>{const e=(O.splittingConfiguration?.length||0)+1;L(i=>({...i,splittingConfiguration:[...i.splittingConfiguration||[],{order:e,splitQuantity:""}]}))},size:"small",sx:{textTransform:"none"},children:"Add Split"}),!K()&&e.jsx(g,{severity:"error",sx:{mt:1},children:"Sum of split quantities must equal total quantity"})]})]})}),e.jsxs(z,{sx:{p:3,pt:1},children:[e.jsx(m,{onClick:Z,variant:"outlined",children:"Cancel"}),e.jsxs(m,{onClick:()=>{const e="Others"===E?$:E,i={...O,materialCode:e};null!==A?_(A,i):B(i),Z()},variant:"contained",disabled:!(O.materialName&&E&&("Others"!==E||$)&&O.quantity&&O.uom&&K()),sx:{textTransform:"none",backgroundColor:"#1976d2","&:hover":{backgroundColor:"#1565c0"}},children:[null!==A?"Update":"Add"," Material"]})]})]})]})};function He(t){const{children:a,value:r,index:s,...n}=t;return e.jsx("div",{role:"tabpanel",hidden:r!==s,id:`technical-tabpanel-${s}`,"aria-labelledby":`technical-tab-${s}`,...n,children:r===s&&e.jsx(i,{sx:{py:2},children:a})})}const Ue=({control:t,errors:l})=>{const[o,d]=te.useState(0),[c,x]=te.useState(!1),[u,p]=te.useState(!1),[h,w]=te.useState(null),[S,T]=te.useState(null),[E,F]=te.useState(Oe),[$,H]=te.useState(Le),{fields:U,append:Q,remove:V,update:B}=pe({control:t,name:"drilling"}),{fields:G,append:_,remove:Y,update:Z}=pe({control:t,name:"cutting"}),J=e=>{void 0!==e?(w(e),F(U[e])):(w(null),F(Oe)),x(!0)},K=()=>{x(!1),w(null),F(Oe)},X=(e,i)=>{F(t=>({...t,[e]:i}))},ee=e=>{void 0!==e?(T(e),H(G[e])):(T(null),H(Le)),p(!0)},ie=()=>{p(!1),T(null),H(Le)},ae=(e,i)=>{H(t=>({...t,[e]:i}))};return e.jsxs(i,{children:[e.jsx(i,{sx:{display:"flex",alignItems:"center",mb:3},children:e.jsx(a,{variant:"h6",sx:{fontWeight:600,color:"#333"},children:"Technical Data"})}),e.jsxs(r,{sx:{p:3,borderRadius:2,border:"1px solid #e0e0e0"},children:[(l.drilling||l.cutting)&&e.jsx(g,{severity:"error",sx:{mb:3},children:l.drilling?.message||l.cutting?.message}),e.jsx(i,{sx:{borderBottom:1,borderColor:"divider",mb:3},children:e.jsxs(A,{value:o,onChange:(e,i)=>{d(i)},"aria-label":"technical data tabs",children:[e.jsx(D,{label:`Drilling (${U.length})`,id:"technical-tab-0","aria-controls":"technical-tabpanel-0",icon:e.jsx(O,{}),iconPosition:"start"}),e.jsx(D,{label:`Cutting (${G.length})`,id:"technical-tab-1","aria-controls":"technical-tabpanel-1",icon:e.jsx(L,{}),iconPosition:"start"})]})}),e.jsxs(He,{value:o,index:0,children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:3},children:[e.jsx(a,{variant:"subtitle1",sx:{fontWeight:600,color:"#333"},children:"Drilling Specifications"}),e.jsx(m,{variant:"contained",startIcon:e.jsx(f,{}),onClick:()=>J(),sx:{textTransform:"none",backgroundColor:"#1976d2","&:hover":{backgroundColor:"#1565c0"}},children:"Add Drilling"})]}),0===U.length?e.jsx(i,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:150,border:"2px dashed #e0e0e0",borderRadius:2,backgroundColor:"#fafafa"},children:e.jsxs(a,{color:"textSecondary",textAlign:"center",children:["No drilling specifications added yet.",e.jsx("br",{}),'Click "Add Drilling" to add drilling details.']})}):e.jsx(j,{children:e.jsxs(b,{children:[e.jsx(y,{children:e.jsxs(v,{sx:{backgroundColor:"#f8f9fa"},children:[e.jsx(C,{sx:{fontWeight:600,color:"#333"},children:"Characteristics"}),e.jsx(C,{sx:{fontWeight:600,color:"#333"},children:"Specification"}),e.jsx(C,{sx:{fontWeight:600,color:"#333"},children:"No. of Holes"}),e.jsx(C,{sx:{fontWeight:600,color:"#333"},children:"Diameter (mm)"}),e.jsx(C,{sx:{fontWeight:600,color:"#333"},children:"Tolerance"}),e.jsx(C,{sx:{fontWeight:600,color:"#333",width:120},children:"Actions"})]})}),e.jsx(N,{children:U.map((t,a)=>e.jsxs(v,{sx:{"&:hover":{backgroundColor:"#f5f5f5"}},children:[e.jsx(C,{sx:{fontWeight:500,color:"#333"},children:t.characteristics}),e.jsx(C,{sx:{color:"#666"},children:t.specification}),e.jsx(C,{sx:{color:"#666"},children:t.noOfHoles}),e.jsx(C,{sx:{color:"#666"},children:t.diaOfHoles}),e.jsx(C,{sx:{color:"#666"},children:t.tolerance}),e.jsx(C,{children:e.jsxs(i,{sx:{display:"flex",gap:1},children:[e.jsx(I,{size:"small",onClick:()=>J(a),sx:{color:"#1976d2"},children:e.jsx(R,{fontSize:"small"})}),e.jsx(I,{size:"small",onClick:()=>(e=>{V(e)})(a),sx:{color:"#d32f2f"},children:e.jsx(k,{fontSize:"small"})})]})})]},t.id))})]})})]}),e.jsxs(He,{value:o,index:1,children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:3},children:[e.jsx(a,{variant:"subtitle1",sx:{fontWeight:600,color:"#333"},children:"Cutting Specifications"}),e.jsx(m,{variant:"contained",startIcon:e.jsx(f,{}),onClick:()=>ee(),sx:{textTransform:"none",backgroundColor:"#1976d2","&:hover":{backgroundColor:"#1565c0"}},children:"Add Cutting"})]}),0===G.length?e.jsx(i,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:150,border:"2px dashed #e0e0e0",borderRadius:2,backgroundColor:"#fafafa"},children:e.jsxs(a,{color:"textSecondary",textAlign:"center",children:["No cutting specifications added yet.",e.jsx("br",{}),'Click "Add Cutting" to add cutting details.']})}):e.jsx(j,{children:e.jsxs(b,{children:[e.jsx(y,{children:e.jsxs(v,{sx:{backgroundColor:"#f8f9fa"},children:[e.jsx(C,{sx:{fontWeight:600,color:"#333"},children:"Characteristics"}),e.jsx(C,{sx:{fontWeight:600,color:"#333"},children:"Specification"}),e.jsx(C,{sx:{fontWeight:600,color:"#333"},children:"Tolerance"}),e.jsx(C,{sx:{fontWeight:600,color:"#333",width:120},children:"Actions"})]})}),e.jsx(N,{children:G.map((t,a)=>e.jsxs(v,{sx:{"&:hover":{backgroundColor:"#f5f5f5"}},children:[e.jsx(C,{sx:{fontWeight:500,color:"#333"},children:t.characteristics}),e.jsx(C,{sx:{color:"#666"},children:t.specification}),e.jsx(C,{sx:{color:"#666"},children:t.tolerance}),e.jsx(C,{children:e.jsxs(i,{sx:{display:"flex",gap:1},children:[e.jsx(I,{size:"small",onClick:()=>ee(a),sx:{color:"#1976d2"},children:e.jsx(R,{fontSize:"small"})}),e.jsx(I,{size:"small",onClick:()=>(e=>{Y(e)})(a),sx:{color:"#d32f2f"},children:e.jsx(k,{fontSize:"small"})})]})})]},t.id))})]})})]})]}),e.jsxs(W,{open:c,onClose:K,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(P,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:2},children:[e.jsx(a,{variant:"h6",children:null!==h?"Edit Drilling Specification":"Add Drilling Specification"}),e.jsx(I,{onClick:K,size:"small",children:e.jsx(q,{})})]}),e.jsx(M,{sx:{pt:1,pb:2},children:e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:3,mt:1},children:[e.jsx(n,{fullWidth:!0,label:"Characteristics",value:E.characteristics,onChange:e=>X("characteristics",e.target.value),placeholder:"e.g., Mounting Holes",required:!0,sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px"}}}),e.jsx(n,{fullWidth:!0,label:"Specification",value:E.specification,onChange:e=>X("specification",e.target.value),placeholder:"e.g., 6mm holes for M6 bolts",required:!0,sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px"}}}),e.jsxs(s,{container:!0,spacing:2,children:[e.jsx(s,{size:{xs:6},children:e.jsx(n,{fullWidth:!0,label:"Number of Holes",value:E.noOfHoles,onChange:e=>X("noOfHoles",e.target.value),placeholder:"e.g., 4",required:!0,sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px"}}})}),e.jsx(s,{size:{xs:6},children:e.jsx(n,{fullWidth:!0,label:"Diameter of Holes (mm)",value:E.diaOfHoles,onChange:e=>X("diaOfHoles",e.target.value),placeholder:"e.g., 6",required:!0,sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px"}}})})]}),e.jsx(n,{fullWidth:!0,label:"Tolerance",value:E.tolerance,onChange:e=>X("tolerance",e.target.value),placeholder:"e.g., 0.1",required:!0,sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px"}}})]})}),e.jsxs(z,{sx:{p:3,pt:1},children:[e.jsx(m,{onClick:K,variant:"outlined",children:"Cancel"}),e.jsxs(m,{onClick:()=>{null!==h?B(h,E):Q(E),K()},variant:"contained",disabled:!(E.characteristics&&E.specification&&E.noOfHoles&&E.diaOfHoles&&E.tolerance),sx:{textTransform:"none",backgroundColor:"#1976d2","&:hover":{backgroundColor:"#1565c0"}},children:[null!==h?"Update":"Add"," Drilling"]})]})]}),e.jsxs(W,{open:u,onClose:ie,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(P,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:2},children:[e.jsx(a,{variant:"h6",children:null!==S?"Edit Cutting Specification":"Add Cutting Specification"}),e.jsx(I,{onClick:ie,size:"small",children:e.jsx(q,{})})]}),e.jsx(M,{sx:{pt:1,pb:2},children:e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:3,mt:1},children:[e.jsx(n,{fullWidth:!0,label:"Characteristics",value:$.characteristics,onChange:e=>ae("characteristics",e.target.value),placeholder:"e.g., Laser Cut Edges",required:!0,sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px"}}}),e.jsx(n,{fullWidth:!0,label:"Specification",value:$.specification,onChange:e=>ae("specification",e.target.value),placeholder:"e.g., Â±0.5mm tolerance on outer profile",required:!0,sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px"}}}),e.jsx(n,{fullWidth:!0,label:"Tolerance",value:$.tolerance,onChange:e=>ae("tolerance",e.target.value),placeholder:"e.g., 0.5",required:!0,sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px"}}})]})}),e.jsxs(z,{sx:{p:3,pt:1},children:[e.jsx(m,{onClick:ie,variant:"outlined",children:"Cancel"}),e.jsxs(m,{onClick:()=>{null!==S?Z(S,$):_($),ie()},variant:"contained",disabled:!$.characteristics||!$.specification||!$.tolerance,sx:{textTransform:"none",backgroundColor:"#1976d2","&:hover":{backgroundColor:"#1565c0"}},children:[null!==S?"Update":"Add"," Cutting"]})]})]})]})},Qe=e=>"chartId"in e,Ve=e=>"templateId"in e,Be=({item:t,onClick:r,isSelected:s,onRemove:n})=>{const l=Qe(t),o=Ve(t),d=()=>l?"#1976d2":"#4caf50";return e.jsx(E,{sx:{cursor:"pointer",border:s?"2px solid #1976d2":"1px solid #e0e0e0",borderRadius:"12px",boxShadow:s?"0 4px 12px rgba(25, 118, 210, 0.15)":"0 2px 4px rgba(0,0,0,0.1)",backgroundColor:s?"#f3f8ff":"white",transition:"all 0.2s ease-in-out","&:hover":{borderColor:"#1976d2",boxShadow:"0 4px 12px rgba(25, 118, 210, 0.15)",transform:"translateY(-2px)"}},onClick:()=>r(t),children:e.jsxs(F,{sx:{p:2},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",mb:1},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(i,{sx:{color:d(),display:"flex",alignItems:"center"},children:l?e.jsx(H,{}):e.jsx(U,{})}),e.jsx($,{label:(l?"catalyst":o?"template":"").toUpperCase(),size:"small",sx:{backgroundColor:d(),color:"white",fontSize:"0.7rem",fontWeight:600,height:20}})]}),s&&n&&e.jsx(I,{size:"small",onClick:e=>{e.stopPropagation(),n()},sx:{color:"#d32f2f","&:hover":{backgroundColor:"rgba(211, 47, 47, 0.04)"}},children:e.jsx(q,{fontSize:"small"})})]}),e.jsx(a,{variant:"h6",sx:{fontSize:"1rem",fontWeight:600,color:"#333",mb:.5,lineHeight:1.3},children:l?`${t.chartId} - ${t.chartSupplier}`:o?t.templateName:""}),e.jsxs(a,{variant:"body2",sx:{color:"#666",fontSize:"0.85rem",fontWeight:500,mb:1},children:["ID: ",l?t.chartId:o?t.templateId:""]}),e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx($,{label:t.status,color:(e=>{switch(e){case"ACTIVE":return"success";case"NEW":return"info";case"INACTIVE":return"error";default:return"default"}})(t.status),size:"small",variant:"outlined",sx:{fontSize:"0.7rem"}}),e.jsxs(a,{variant:"caption",sx:{color:"#999",fontSize:"0.75rem"},children:["v",t.version]})]})]})})},Ge=({control:t,setValue:s,gallery:n})=>{const[l,o]=te.useState([]),p=he({control:t,name:"prcTemplate"}),m=he({control:t,name:"inspectionDiagrams"}),{data:f,isLoading:j}=ye({id:p},{skip:!p});te.useEffect(()=>{if(f?.detail?.prcTemplateSteps){const e=f.detail.prcTemplateSteps.filter(e=>"inspection"===e.type&&e.data?.inspectionParameters);if(e.length>0){const i=[];e.forEach(e=>{if(e.data?.inspection&&e.data?.inspectionParameters){const t=e.data.inspection,a=e.data.inspectionParameters.map(e=>({id:e.id||0,order:e.order,parameterName:e.parameterName,specification:e.specification||void 0,tolerance:"string"==typeof e.tolerance?e.tolerance:void 0,type:e.type,role:e.role,ctq:e.ctq}));i.push({inspectionId:t.id,inspectionName:t.inspectionName,inspectionType:t.type,parameters:a})}}),setTimeout(()=>{o(i)},0)}else setTimeout(()=>{o([])},0)}else setTimeout(()=>{o([])},0)},[f]);return p?j?e.jsx(r,{sx:{p:3,mt:3,borderRadius:2,border:"1px solid #e0e0e0"},children:e.jsx(a,{children:"Loading inspection parameters..."})}):0===n.length?e.jsx(r,{sx:{p:3,mt:3,borderRadius:2,border:"1px solid #e0e0e0"},children:e.jsx(g,{severity:"info",children:"No part drawings uploaded. Please upload images in the General Information tab first."})}):j?e.jsxs(r,{sx:{p:3,mt:3,borderRadius:2,border:"1px solid #e0e0e0"},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(Q,{size:20}),e.jsx(a,{variant:"h6",color:"text.secondary",children:"Loading inspection parameters..."})]}),e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(V,{variant:"rectangular",height:60}),e.jsx(V,{variant:"rectangular",height:60}),e.jsx(V,{variant:"rectangular",height:60})]})]}):0===l.length?e.jsx(r,{sx:{p:3,mt:3,borderRadius:2,border:"1px solid #e0e0e0"},children:e.jsx(g,{severity:"info",children:"No inspection parameters found for the selected PRC template."})}):e.jsxs(r,{sx:{p:3,mt:3,borderRadius:2,border:"1px solid #e0e0e0"},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(B,{sx:{mr:1,color:"#1976d2"}}),e.jsx(a,{variant:"h6",sx:{fontWeight:600,color:"#333"},children:"Image Mapping"})]}),e.jsx(a,{variant:"body2",color:"textSecondary",sx:{mb:3},children:"Map uploaded part drawings to inspection parameters. Multiple images can be mapped to the same parameter."}),0===n.length&&e.jsx(g,{severity:"warning",sx:{mb:3},children:"No part drawings uploaded. Please upload images in the General Information tab first."}),e.jsx(i,{sx:{display:"flex",flexDirection:"column",gap:2},children:l.map(t=>e.jsxs(G,{defaultExpanded:!0,children:[e.jsx(_,{expandIcon:e.jsx(Y,{}),children:e.jsxs(i,{sx:{display:"flex",alignItems:"center",width:"100%"},children:[e.jsx(a,{variant:"h6",sx:{fontWeight:600,mr:2},children:t.inspectionName}),e.jsx($,{label:t.inspectionType,size:"small",color:"secondary",variant:"outlined"})]})}),e.jsx(Z,{children:e.jsx(i,{sx:{display:"flex",flexDirection:"column",gap:2},children:t.parameters.map(t=>{const r=(e=>{const i=m?.files?.find(i=>i.inspectionParameterId===e);return i&&i.fileName?i.fileName.map(e=>{if("object"==typeof e&&e.originalFileName){const i=n.find(i=>i.fileName===e.originalFileName);return i?.image}if("string"==typeof e){const i=n.find(i=>i.fileName===e);return i?.image}return null}).filter(e=>null!=e):[]})(t.id);return e.jsxs(i,{sx:{p:2,border:"1px solid #e0e0e0",borderRadius:2},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(a,{variant:"subtitle1",sx:{fontWeight:600,mr:2},children:t.parameterName}),t.ctq&&e.jsx($,{label:"CTQ",size:"small",color:"error",variant:"outlined"}),e.jsx($,{label:t.role,size:"small",color:"primary",variant:"outlined",sx:{ml:1}})]}),t.specification&&e.jsxs(a,{variant:"body2",color:"textSecondary",sx:{mb:2},children:["Specification: ",t.specification]}),e.jsxs(d,{fullWidth:!0,size:"small",children:[e.jsx(c,{children:"Select Images"}),e.jsx(x,{multiple:!0,value:r,onChange:e=>{const i=e.target.value;((e,i)=>{const t=m||{partId:0,files:[]},a=i.map(e=>{const i=n.find(i=>i.image===e);return i?{fileName:i.fileName||i.file?.name||`Image ${i.id}`,filePath:i.image,originalFileName:i.fileName||i.file?.name||`Image ${i.id}`}:null}).filter(e=>null!==e),r=(t.files||[]).filter(i=>i.inspectionParameterId!==e);a.length>0&&r.push({inspectionParameterId:e,fileName:a});const l={partId:t.partId||0,files:r};s("inspectionDiagrams",l)})(t.id,i)},input:e.jsx(X,{label:"Select Images"}),renderValue:t=>e.jsx(i,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:t.map(i=>{const t=n.find(e=>e.image===i);return e.jsx($,{label:t?.fileName||t?.file?.name||`Image ${t?.id}`,size:"small"},i)})}),children:n.map(i=>e.jsxs(u,{value:i.image,children:[e.jsx(J,{checked:r.indexOf(i.image)>-1}),e.jsx(K,{primary:i.fileName||i.file?.name||`Image ${i.id}`})]},i.id))})]}),r.length>0&&e.jsxs(i,{sx:{mt:2},children:[e.jsx(a,{variant:"body2",color:"textSecondary",sx:{mb:1},children:"Mapped Images:"}),e.jsx(i,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:r.map(i=>{const t=n.find(e=>e.image===i);return e.jsx($,{icon:e.jsx(h,{}),label:t?.fileName||t?.file?.name||`Image ${t?.id}`,variant:"outlined",size:"small"},i)})})]})]},t.id)})})})]},t.inspectionId))})]}):null},_e=({control:t,errors:n,setValue:l,gallery:o})=>{const[d,c]=te.useState(!1),[x,u]=te.useState("catalyst"),[p,h]=te.useState(0),{data:j,isLoading:b}=ve(),{data:y,isLoading:v}=Ce(),C=t._formValues.catalyst,N=t._formValues.prcTemplate,w=(j?.detail||[]).map(e=>({id:e.catalyst.id,chartId:e.catalyst.chartId,chartSupplier:e.catalyst.chartSupplier,status:e.catalyst.status,version:e.catalyst.version,isLatest:e.catalyst.isLatest})),S=(y?.detail||[]).map(e=>({id:e.prcTemplate.id,templateId:e.prcTemplate.templateId,templateName:e.prcTemplate.templateName,status:e.prcTemplate.status,version:e.prcTemplate.version,isLatest:e.prcTemplate.isLatest})),R=e=>{u(e),h("catalyst"===e?0:1),c(!0)},k=()=>{c(!1)},T=e=>{Qe(e)?l("catalyst",e.id):Ve(e)&&l("prcTemplate",e.id),k()},O=e=>{l("catalyst"===e?"catalyst":"prcTemplate",void 0)},L=0===p?w:S,E=w.find(e=>e.id===C),F=S.find(e=>e.id===N);return e.jsxs(i,{children:[e.jsx(i,{sx:{display:"flex",alignItems:"center",mb:3},children:e.jsx(a,{variant:"h6",sx:{fontWeight:600,color:"#333"},children:"Linked Masters"})}),e.jsxs(r,{sx:{p:3,borderRadius:2,border:"1px solid #e0e0e0"},children:[(n.catalyst||n.prcTemplate)&&e.jsx(g,{severity:"error",sx:{mb:3},children:n.catalyst?.message||n.prcTemplate?.message}),e.jsxs(s,{container:!0,spacing:3,children:[e.jsxs(s,{size:{xs:12,md:6},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[e.jsx(a,{variant:"subtitle1",sx:{fontWeight:600,color:"#333"},children:"Catalyst Chart"}),b?e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Q,{size:16}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Loading..."})]}):e.jsxs(m,{variant:"outlined",startIcon:e.jsx(f,{}),onClick:()=>R("catalyst"),sx:{textTransform:"none",borderColor:"#1976d2",color:"#1976d2","&:hover":{borderColor:"#1565c0",backgroundColor:"rgba(25, 118, 210, 0.04)"}},children:[E?"Change":"Select"," Catalyst"]})]}),E?e.jsx(i,{sx:{position:"relative"},children:e.jsx(Be,{item:E,onClick:()=>R("catalyst"),isSelected:!0,onRemove:()=>O("catalyst")})}):e.jsx(i,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:120,border:"2px dashed #e0e0e0",borderRadius:2,backgroundColor:"#fafafa"},children:e.jsxs(a,{color:"textSecondary",textAlign:"center",children:["No catalyst chart selected",e.jsx("br",{}),e.jsx(m,{size:"small",onClick:()=>R("catalyst"),sx:{textTransform:"none",mt:1},children:"Select Catalyst"})]})})]}),e.jsxs(s,{size:{xs:12,md:6},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[e.jsx(a,{variant:"subtitle1",sx:{fontWeight:600,color:"#333"},children:"PRC Template"}),v?e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Q,{size:16}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Loading..."})]}):e.jsxs(m,{variant:"outlined",startIcon:e.jsx(f,{}),onClick:()=>R("prcTemplate"),sx:{textTransform:"none",borderColor:"#1976d2",color:"#1976d2","&:hover":{borderColor:"#1565c0",backgroundColor:"rgba(25, 118, 210, 0.04)"}},children:[F?"Change":"Select"," Template"]})]}),F?e.jsx(i,{sx:{position:"relative"},children:e.jsx(Be,{item:F,onClick:()=>R("prcTemplate"),isSelected:!0,onRemove:()=>O("prcTemplate")})}):e.jsx(i,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:120,border:"2px dashed #e0e0e0",borderRadius:2,backgroundColor:"#fafafa"},children:e.jsxs(a,{color:"textSecondary",textAlign:"center",children:["No PRC template selected",e.jsx("br",{}),e.jsx(m,{size:"small",onClick:()=>R("prcTemplate"),sx:{textTransform:"none",mt:1},children:"Select Template"})]})})]})]})]}),e.jsxs(W,{open:d,onClose:k,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:2}},children:[e.jsxs(P,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:2},children:[e.jsxs(a,{variant:"h6",sx:{fontWeight:600,color:"#333"},children:["Select ","catalyst"===x?"Catalyst Chart":"PRC Template"]}),e.jsx(I,{onClick:k,size:"small",children:e.jsx(q,{})})]}),e.jsx(M,{sx:{p:0},children:e.jsxs(i,{sx:{p:2,mt:1},children:[e.jsxs(A,{value:p,onChange:(e,i)=>h(i),sx:{mb:2,borderBottom:"1px solid #e0e0e0"},children:[e.jsx(D,{label:`Catalyst Charts (${w.length})`,sx:{textTransform:"none",fontWeight:500},icon:e.jsx(H,{}),iconPosition:"start"}),e.jsx(D,{label:`PRC Templates (${S.length})`,sx:{textTransform:"none",fontWeight:500},icon:e.jsx(U,{}),iconPosition:"start"})]}),b||v?e.jsx(i,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:200},children:e.jsx(a,{color:"textSecondary",children:"Loading items..."})}):0===L.length?e.jsx(i,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:200},children:e.jsxs(a,{color:"textSecondary",children:["No ",0===p?"catalyst charts":"PRC templates"," available"]})}):e.jsx(s,{container:!0,spacing:2,sx:{maxHeight:400,overflow:"auto"},children:L.map(i=>e.jsx(s,{size:{xs:12,sm:6},children:e.jsx(Be,{item:i,onClick:T,isSelected:!1})},i.id))})]})}),e.jsx(z,{sx:{p:2,pt:1},children:e.jsx(m,{onClick:k,variant:"outlined",children:"Done"})})]}),e.jsx(Ge,{control:t,setValue:l,gallery:o})]})};const Ye=async(e,i,t,a,r,s)=>{if(0===i.length)return[];const n=i.map(e=>e.file).filter(Boolean),l=i.filter(e=>!e.file&&e.fileName).map(e=>{let i=e.filePath;if(!i&&e.image){const t="https://indocool-prc-backend.onrender.com/";i=e.image.startsWith(t)?e.image.substring(t.length):e.image}return{fileName:e.fileName||"",filePath:i||"",originalFileName:e.originalFileName||e.fileName||""}});if(0===n.length)return l;s(!0);try{const{uploads:s,errors:o}=await(async e=>{const i=Ne.getToken();if(!i)throw new Error("Missing Authorization token");const t=[],a=[];for(const s of e)try{const e=new FormData;e.append("file",s);const a=await fetch("https://indocool-prc-backend.onrender.com/web/files/part_drawings",{method:"POST",headers:{Authorization:`Bearer ${i}`},body:e});if(!a.ok)throw new Error(`Upload failed with status: ${a.status}`);const r=await a.json();t.push({fileName:r.fileName,filePath:r.filePath,originalFileName:s.name})}catch(r){a.push({fileName:s.name,error:r instanceof Error?r.message:"Unknown error occurred"})}return{uploads:t,errors:a}})(n);if(o.length>0){return r(`Some images failed to upload:\n${o.map(e=>`${e.fileName}: ${e.error}`).join("\n")}`),null}return Ze(i,s,t),Je(e,s,a),[...l,...s]}catch{return r("Failed to upload images. Please try again."),null}finally{s(!1)}},Ze=(e,i,t)=>{t(e.map((e,t)=>{const a=i[t];return a?.fileName?{...e,fileName:a.fileName}:e}))},Je=(e,i,t)=>{if(!e.inspectionDiagrams?.files)return;t("inspectionDiagrams",{...e.inspectionDiagrams,files:e.inspectionDiagrams.files.map(e=>({...e,fileName:e.fileName?.map(e=>{if("object"==typeof e&&e.originalFileName){const t=i.find(i=>i.originalFileName===e.originalFileName);if(t)return{fileName:t.fileName,filePath:t.filePath,originalFileName:t.originalFileName}}else if("string"==typeof e){const t=i.find(i=>i.originalFileName===e);if(t)return{fileName:t.fileName,filePath:t.filePath,originalFileName:t.originalFileName}}return e})||[]}))})},Ke=(e,i)=>(e||[]).map(e=>{const{id:t,...a}=e;return{...i&&t&&"number"==typeof t?{id:t}:{},...a,version:e.version||1,isLatest:e.isLatest??!0}}),Xe=e=>{if(e)return{files:e.files?.map(e=>({inspectionParameterId:e.inspectionParameterId||0,fileName:(e.fileName||[]).filter(e=>null!=e&&"object"==typeof e)}))||[]}};function ei(t){const{children:a,value:r,index:s,...n}=t;return e.jsx("div",{role:"tabpanel",hidden:r!==s,id:`part-tabpanel-${s}`,"aria-labelledby":`part-tab-${s}`,...n,children:r===s&&e.jsx(i,{sx:{py:3},children:a})})}const ii=()=>{const t=re(),{id:s}=se(),n=Boolean(s),{gallery:l,handleAddImage:o,handleRemoveImage:d,setGallery:c}=function(){const[e,i]=te.useState([]),[t,a]=te.useState([]);return{gallery:e,remove:t,handleAddImage:e=>{const t={id:Math.floor(5001*Math.random())+5e3,file:e,image:URL.createObjectURL(e),fileName:e.name};i(e=>[...e,t])},handleRemoveImage:e=>{i(i=>i.filter(i=>i.id!==e)),a(i=>[...i,e])},setGallery:i}}(),[x,u]=te.useState(0),[p,h]=te.useState(null),[f,j]=te.useState(!1),[b,y]=te.useState(!1),{data:v,isLoading:C,isSuccess:N}=Ie({id:Number(s)},{skip:!n||!s}),{data:w}=be(),[S,{isLoading:R}]=we(),[k,{isLoading:T}]=Se(),O=me({resolver:ge(Ae),defaultValues:Ee,mode:"onChange",reValidateMode:"onChange"}),{control:L,handleSubmit:E,formState:{errors:F},reset:$,trigger:H,setValue:U,getValues:B}=O;te.useEffect(()=>{Object.keys(F).length},[F]),te.useEffect(()=>{if(n&&N&&v&&w){const{partMaster:e,rawMaterials:i,drilling:t,cutting:a}=v.detail,r={id:e.id,partNumber:e.partNumber,drawingNumber:e.drawingNumber,drawingRevision:e.drawingRevision,partRevision:e.partRevision,isActive:"ACTIVE"===e.status,customer:e.customer,description:e.description,notes:e.notes||"",layupType:e.layupType||"",model:e.model||"",sapReferenceNumber:e.sapReferenceNumber||"",version:e.version,isLatest:e.isLatest,catalyst:e.catalyst||void 0,prcTemplate:e.prcTemplate||void 0,rawMaterials:i.map(e=>({id:e.id,materialName:e.materialName,materialCode:e.materialCode,quantity:e.quantity,uom:e.uom,batching:e.batching,splitting:e.splitting,splittingConfiguration:e.splittingConfiguration?e.splittingConfiguration.map(e=>({order:e.order,splitQuantity:String(e.splitQuantity)})):null,version:e.version,isLatest:e.isLatest})),drilling:t.map(e=>({id:e.id,characteristics:e.characteristics,specification:e.specification,noOfHoles:e.noOfHoles,diaOfHoles:e.diaOfHoles,tolerance:e.tolerance,version:e.version,isLatest:e.isLatest})),cutting:a.map(e=>({id:e.id,characteristics:e.characteristics,specification:e.specification,tolerance:e.tolerance,version:e.version,isLatest:e.isLatest})),files:e.files||[],inspectionDiagrams:e.inspectionDiagrams?Array.isArray(e.inspectionDiagrams)?e.inspectionDiagrams[0]:e.inspectionDiagrams:void 0,createdAt:e.createdAt||void 0,updatedAt:e.updatedAt||void 0};if($(r),e.files&&e.files.length>0){const i=e.files.map((e,i)=>({id:`existing-${i}`,file:null,image:e.filePath?`https://indocool-prc-backend.onrender.com/${e.filePath.replace(/\\/g,"/")}`:"",fileName:e.fileName||e.originalFileName||`Image ${i}`,filePath:e.filePath?e.filePath.replace(/\\/g,"/"):void 0,originalFileName:e.originalFileName||e.fileName||`Image ${i}`}));c(i)}}},[n,N,v,w,$,c]);const G=()=>{j(!1)};return n&&C?e.jsx(i,{sx:{minHeight:"100vh"},children:e.jsxs(r,{sx:{p:4,borderRadius:2,boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",mb:4},children:[e.jsx(V,{variant:"rectangular",width:80,height:36,sx:{mr:2,borderRadius:1}}),e.jsx(V,{variant:"text",width:300,height:40})]}),e.jsx(i,{sx:{mb:4},children:e.jsx(V,{variant:"rectangular",width:"100%",height:60,sx:{borderRadius:1}})}),e.jsx(i,{sx:{mb:4},children:e.jsx(V,{variant:"rectangular",width:"100%",height:400,sx:{borderRadius:1}})}),e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",pt:3,borderTop:"1px solid #e0e0e0"},children:[e.jsx(V,{variant:"rectangular",width:80,height:36,sx:{borderRadius:1}}),e.jsxs(i,{sx:{display:"flex",gap:2},children:[e.jsx(V,{variant:"rectangular",width:100,height:36,sx:{borderRadius:1}}),e.jsx(V,{variant:"rectangular",width:120,height:36,sx:{borderRadius:1}})]})]})]})}):e.jsxs(fe,{...O,children:[e.jsx(i,{sx:{minHeight:"100vh"},children:e.jsxs(r,{sx:{p:4,borderRadius:2,boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:4},children:[e.jsx(a,{variant:"h4",sx:{fontWeight:600,color:"#333"},children:n?"Edit Part":"Create New Part"}),e.jsxs(i,{sx:{display:"flex",gap:2},children:[e.jsx(m,{variant:"outlined",startIcon:e.jsx(ee,{}),onClick:()=>{j(!0)},sx:{textTransform:"none"},children:"Cancel"}),e.jsx(m,{variant:"contained",startIcon:b?e.jsx(Q,{size:20,color:"inherit"}):e.jsx(ie,{}),onClick:E(async e=>{h(null);try{if(!(await H()))return void h("Please fix all validation errors before submitting");const i=await Ye(e,l,c,U,h,y);if(!i)return;const a=((e,i,t)=>({partMaster:{...t&&e.id?{id:e.id}:{},partNumber:e.partNumber,drawingNumber:e.drawingNumber,drawingRevision:e.drawingRevision,partRevision:e.partRevision,status:e.isActive?"ACTIVE":"INACTIVE",customer:e.customer,description:e.description,notes:e.notes||"",layupType:e.layupType||"",model:e.model||"",sapReferenceNumber:e.sapReferenceNumber||"",version:e.version||1,isLatest:e.isLatest??!0,catalyst:e.catalyst,prcTemplate:e.prcTemplate,files:i,inspectionDiagrams:Xe(e.inspectionDiagrams)},rawMaterials:Ke(e.rawMaterials,t),bom:Ke(e.bom,t),drilling:Ke(e.drilling,t),cutting:Ke(e.cutting,t)}))(B(),i,n);if(n&&e.id){const i={id:e.id,data:a};await k(i).unwrap(),je.fire({icon:"success",title:"Success!",text:"Part updated successfully",timer:2e3,showConfirmButton:!1})}else await S({data:a}).unwrap(),je.fire({icon:"success",title:"Success!",text:"Part created successfully",timer:2e3,showConfirmButton:!1});t("/part-master")}catch(i){const e=i&&"object"==typeof i&&"data"in i&&i.data&&"object"==typeof i.data&&"message"in i.data?i.data.message:i&&"object"==typeof i&&"message"in i?i.message:`Failed to ${n?"update":"create"} part`;h(e)}}),disabled:R||T||b,sx:{textTransform:"none",backgroundColor:"#1976d2","&:hover":{backgroundColor:"#1565c0"}},children:b?"Uploading Images...":R||T?n?"Updating...":"Creating...":n?"Update Part":"Create Part"})]})]}),p&&e.jsx(g,{severity:"error",sx:{mb:3},children:p}),e.jsx(i,{sx:{borderBottom:1,borderColor:"divider",mb:3},children:e.jsxs(A,{value:x,onChange:(e,i)=>{u(i)},"aria-label":"part tabs",children:[e.jsx(D,{label:"General Info",id:"part-tab-0","aria-controls":"part-tabpanel-0"}),e.jsx(D,{label:"Raw Materials",id:"part-tab-1","aria-controls":"part-tabpanel-1"}),e.jsx(D,{label:"Technical Data",id:"part-tab-2","aria-controls":"part-tabpanel-2"}),e.jsx(D,{label:"Linked Masters",id:"part-tab-3","aria-controls":"part-tabpanel-3"})]})}),e.jsx(ei,{value:x,index:0,children:e.jsx(Te,{control:L,errors:F,gallery:l,onAddImage:o,onRemoveImage:d})}),e.jsx(ei,{value:x,index:1,children:e.jsx($e,{control:L,errors:F})}),e.jsx(ei,{value:x,index:2,children:e.jsx(Ue,{control:L,errors:F})}),e.jsx(ei,{value:x,index:3,children:e.jsx(_e,{control:L,errors:F,setValue:U,gallery:l})})]})}),e.jsxs(W,{open:f,onClose:G,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(P,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(a,{variant:"h6",children:"Exit Without Saving"}),e.jsx(I,{onClick:G,size:"small",children:e.jsx(q,{})})]}),e.jsx(M,{children:e.jsx(a,{children:"Are you sure you want to exit without saving? All unsaved changes will be lost."})}),e.jsxs(z,{children:[e.jsx(m,{onClick:G,children:"Cancel"}),e.jsx(m,{onClick:()=>{t("/part-master")},color:"error",variant:"contained",children:"Exit"})]})]})]})};export{ii as default};
