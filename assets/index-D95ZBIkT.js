import{j as e,I as s,br as r,a2 as t,z as a,bg as n,a4 as o,b3 as i,a6 as l,a7 as c,a8 as p,an as u,ao as d,al as x,bB as m,X as h,bn as j,bC as b,bD as g,bE as f,J as S,bq as y,E as v,bF as q,Z as C,bk as M,bl as I,O as T,bh as w,w as A,bG as G,U as k,ac as V,ai as N,am as z,ap as P,aj as R,aq as W,$,bs as D,bt as E,bu as O,e as L}from"./mui-vendor-ThRJoe5u.js";import{r as F,f as B,j as H}from"./react-vendor-jVbyDP5c.js";import{C as U,l as Q,m as K,g as Y,h as Z,i as J,j as X,k as _,f as ee,F as se}from"./form-vendor-DG-ZRlco.js";import{o as re}from"./yup-lT2MYDzp.js";import{S as te}from"./utils-vendor-S0KZLiBE.js";import{s as ae,t as ne,u as oe}from"./types-BnIy1GbH.js";import{j as ie,k as le,l as ce}from"./index-CgzbgTp3.js";import"./auth-vendor-BOyMHjHL.js";import"./state-vendor-BxbV2bHq.js";import"./ui-vendor-DL_b4SbO.js";const pe=({control:m,errors:h})=>e.jsxs(s,{children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(r,{sx:{mr:1,color:"#1976d2"}}),e.jsx(t,{variant:"h6",sx:{fontWeight:600,color:"#333"},children:"Basic Information"})]}),e.jsx(a,{sx:{p:3,borderRadius:2,border:"1px solid #e0e0e0"},children:e.jsxs(n,{container:!0,spacing:3,children:[e.jsx(n,{size:{xs:12,md:6},children:e.jsx(U,{name:"sequenceId",control:m,render:({field:s})=>e.jsx(o,{...s,fullWidth:!0,label:"Sequence ID",required:!0,placeholder:"e.g., SEQ-001",helperText:h.sequenceId?.message||"Unique identifier for the process sequence",error:!!h.sequenceId,sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px"}}})})}),e.jsx(n,{size:{xs:12,md:6},children:e.jsx(U,{name:"sequenceName",control:m,render:({field:s})=>e.jsx(o,{...s,fullWidth:!0,label:"Sequence Name",required:!0,placeholder:"e.g., Composite Molding Line - Phase 1",helperText:h.sequenceName?.message||"Descriptive name for the process sequence",error:!!h.sequenceName,sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px"}}})})}),e.jsx(n,{size:{xs:12,md:6},children:e.jsx(U,{name:"category",control:m,render:({field:s})=>e.jsx(o,{...s,fullWidth:!0,label:"Category",required:!0,placeholder:"e.g., Production",helperText:h.category?.message||"Category classification for the sequence",error:!!h.category,sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px"}}})})}),e.jsx(n,{size:{xs:12,md:6},children:e.jsx(U,{name:"type",control:m,render:({field:s})=>e.jsxs(i,{fullWidth:!0,error:!!h.type,children:[e.jsx(l,{children:"Type"}),e.jsxs(c,{...s,label:"Type",sx:{borderRadius:"8px"},children:[e.jsx(p,{value:"Layout",children:"Layout"}),e.jsx(p,{value:"ISP",children:"ISP"})]}),h.type&&e.jsx(t,{variant:"caption",sx:{color:"error.main",mt:.5,ml:1.75},children:h.type.message})]})})}),e.jsx(n,{size:{xs:12,md:6},children:e.jsx(s,{sx:{display:"flex",alignItems:"center",height:"100%",pt:2},children:e.jsx(U,{name:"status",control:m,render:({field:r})=>e.jsx(u,{control:e.jsx(d,{checked:r.value,onChange:r.onChange,color:"primary"}),label:e.jsxs(s,{children:[e.jsx(t,{variant:"body1",sx:{fontWeight:500},children:"Active Status"}),e.jsx(t,{variant:"caption",sx:{color:"#666"},children:"Enable this sequence for use in production"})]})})})})}),e.jsxs(n,{size:{xs:12},children:[e.jsx(x,{sx:{my:2}}),e.jsx(U,{name:"notes",control:m,render:({field:s})=>e.jsx(o,{...s,fullWidth:!0,label:"Notes",multiline:!0,rows:4,placeholder:"Additional notes about this process sequence...",helperText:h.notes?.message||"Optional notes about usage, special conditions, or other relevant information",error:!!h.notes,sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px"}}})})]})]})})]}),ue=({control:r,errors:n})=>{const{fields:o,append:i,remove:l}=Q({control:r,name:"processStepGroups"}),[c,p]=F.useState(()=>o.map((e,s)=>s)),u=()=>{i({processName:"",processDescription:"",sequenceTiming:"00:01",processSteps:[{parameterDescription:"",stepNumber:1,stepType:"Measurement",evaluationMethod:"",targetValueType:"range",minimumAcceptanceValue:null,maximumAcceptanceValue:null,multipleMeasurements:!1,multipleMeasurementMaxCount:null,uom:"",ctq:!1,allowAttachments:!1,responsiblePerson:!1,notes:""}]})};return e.jsxs(s,{children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:3},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(m,{sx:{mr:1,color:"#1976d2",fontSize:"1.5rem"}}),e.jsx(t,{variant:"h6",sx:{fontWeight:600,color:"#333"},children:"Process Step Groups & Steps"})]}),e.jsx(h,{variant:"contained",startIcon:e.jsx(j,{}),onClick:u,sx:{textTransform:"none",backgroundColor:"#1976d2",borderRadius:"8px",px:3,py:1,"&:hover":{backgroundColor:"#1565c0"}},children:"Add Step Group"})]}),o.map((a,o)=>e.jsxs(b,{expanded:c.includes(o),onChange:()=>(e=>{p(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e])})(o),sx:{mb:3,borderRadius:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)","&:before":{display:"none"},"&.Mui-expanded":{margin:"0 0 24px 0"}},children:[e.jsx(g,{component:"div",expandIcon:e.jsx(v,{}),sx:{backgroundColor:"#f8f9fa",borderRadius:"12px 12px 0 0","&.Mui-expanded":{borderRadius:"12px 12px 0 0"},cursor:"pointer"},children:e.jsxs(s,{sx:{display:"flex",alignItems:"center",width:"100%"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",flex:1},children:[e.jsx(f,{sx:{mr:1,color:"#1976d2"}}),e.jsxs(t,{variant:"h6",sx:{fontWeight:600,color:"#333"},children:["Step Group ",o+1]})]}),e.jsx(s,{sx:{ml:"auto",mr:2},children:e.jsx(S,{size:"small","data-delete-button":!0,onClick:e=>{e.stopPropagation(),l(o)},sx:{color:"error.main","&:hover":{backgroundColor:"rgba(244, 67, 54, 0.1)"}},children:e.jsx(y,{})})})]})}),e.jsx(q,{sx:{p:3},children:e.jsx(de,{control:r,errors:n,groupIndex:o})})]},a.id)),0===o.length&&e.jsxs(a,{sx:{p:4,textAlign:"center",border:"2px dashed #e0e0e0",borderRadius:"12px",backgroundColor:"#fafafa"},children:[e.jsx(m,{sx:{fontSize:"3rem",color:"#ccc",mb:2}}),e.jsx(t,{variant:"h6",sx:{color:"#666",mb:1,fontWeight:500},children:"No Step Groups Added"}),e.jsx(t,{variant:"body2",sx:{color:"#999",mb:3},children:"Create your first step group to define process sequences"}),e.jsx(h,{variant:"contained",startIcon:e.jsx(j,{}),onClick:u,sx:{textTransform:"none",borderRadius:"8px",px:3,py:1},children:"Add First Step Group"})]})]})},de=({control:r,errors:d,groupIndex:x})=>{const{fields:m,append:b,remove:g}=Q({control:r,name:`processStepGroups.${x}.processSteps`});F.useEffect(()=>{m.forEach(()=>{})},[m]);const v=()=>{b({parameterDescription:"",stepNumber:m.length+1,stepType:"Measurement",evaluationMethod:"",targetValueType:"range",minimumAcceptanceValue:null,maximumAcceptanceValue:null,multipleMeasurements:!1,multipleMeasurementMaxCount:null,uom:"",ctq:!1,allowAttachments:!1,notes:""})};return e.jsxs(s,{children:[e.jsxs(a,{sx:{p:3,mb:3,backgroundColor:"#f8f9fa",borderRadius:"8px"},children:[e.jsx(t,{variant:"subtitle1",sx:{fontWeight:600,color:"#333",mb:2},children:"Process Information"}),e.jsxs(n,{container:!0,spacing:3,children:[e.jsx(n,{size:{xs:12},children:e.jsx(U,{name:`processStepGroups.${x}.processName`,control:r,render:({field:s})=>e.jsx(o,{...s,fullWidth:!0,label:"Process Name",required:!0,placeholder:"e.g., Gelcoat Preparation",helperText:d.processStepGroups?.[x]?.processName?.message,error:!!d.processStepGroups?.[x]?.processName,sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px",backgroundColor:"white"}}})})}),e.jsx(n,{size:{xs:12},children:e.jsx(U,{name:`processStepGroups.${x}.processDescription`,control:r,render:({field:s})=>e.jsx(o,{...s,fullWidth:!0,label:"Process Description",required:!0,multiline:!0,rows:2,placeholder:"e.g., Mixing and preparing gelcoat with proper viscosity",helperText:d.processStepGroups?.[x]?.processDescription?.message,error:!!d.processStepGroups?.[x]?.processDescription,sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px",backgroundColor:"white"}}})})}),e.jsx(n,{size:{xs:12,md:6},children:e.jsx(U,{name:`processStepGroups.${x}.sequenceTiming`,control:r,render:({field:s})=>e.jsx(o,{...s,fullWidth:!0,label:"Expected Duration",required:!0,type:"time",placeholder:"HH:MM",helperText:d.processStepGroups?.[x]?.sequenceTiming?.message||"Enter expected duration in HH:MM format",error:!!d.processStepGroups?.[x]?.sequenceTiming,InputLabelProps:{shrink:!0},inputProps:{step:60},sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px",backgroundColor:"white"}}})})})]})]}),e.jsxs(s,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:3},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(f,{sx:{mr:1,color:"#1976d2"}}),e.jsx(t,{variant:"h6",sx:{fontWeight:600,color:"#333"},children:"Process Steps"}),e.jsx(C,{label:`${m.length} steps`,size:"small",sx:{ml:2,backgroundColor:"#e3f2fd",color:"#1976d2"}})]}),e.jsx(h,{variant:"contained",size:"small",startIcon:e.jsx(j,{}),onClick:v,sx:{textTransform:"none",borderRadius:"8px",px:2,py:1},children:"Add Step"})]}),m.map((a,m)=>e.jsx(M,{sx:{mb:2,border:"1px solid #e0e0e0",borderRadius:"12px",boxShadow:"0 1px 4px rgba(0,0,0,0.1)"},children:e.jsxs(I,{sx:{p:3},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:3},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(s,{sx:{width:32,height:32,borderRadius:"50%",backgroundColor:"#1976d2",display:"flex",alignItems:"center",justifyContent:"center",mr:2},children:e.jsx(t,{variant:"body2",sx:{color:"white",fontWeight:600},children:m+1})}),e.jsxs(t,{variant:"subtitle1",sx:{fontWeight:600,color:"#333"},children:["Step ",m+1]})]}),e.jsx(S,{size:"small",onClick:()=>g(m),sx:{color:"error.main","&:hover":{backgroundColor:"rgba(244, 67, 54, 0.1)"}},children:e.jsx(y,{})})]}),e.jsxs(n,{container:!0,spacing:2,children:[e.jsx(n,{size:{xs:12,md:6},children:e.jsx(U,{name:`processStepGroups.${x}.processSteps.${m}.parameterDescription`,control:r,render:({field:s})=>e.jsx(o,{...s,fullWidth:!0,label:"Parameter Description",required:!0,placeholder:"e.g., Check MEKP Ratio",helperText:d.processStepGroups?.[x]?.processSteps?.[m]?.parameterDescription?.message,error:!!d.processStepGroups?.[x]?.processSteps?.[m]?.parameterDescription,sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px"}}})})}),e.jsx(n,{size:{xs:12,md:2},children:e.jsx(o,{fullWidth:!0,label:"Step #",value:m+1,disabled:!0,helperText:"Auto-calculated",sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px",backgroundColor:"#f5f5f5"}}})}),e.jsx(n,{size:{xs:12,md:4},children:e.jsx(U,{name:`processStepGroups.${x}.processSteps.${m}.stepType`,control:r,render:({field:s})=>e.jsxs(i,{fullWidth:!0,error:!!d.processStepGroups?.[x]?.processSteps?.[m]?.stepType,children:[e.jsx(l,{children:"Step Type"}),e.jsx(c,{...s,label:"Step Type",sx:{borderRadius:"8px"},children:ae.map(s=>e.jsx(p,{value:s.value,children:s.label},s.value))})]})})}),e.jsx(n,{size:{xs:12,md:6},children:e.jsx(U,{name:`processStepGroups.${x}.processSteps.${m}.evaluationMethod`,control:r,render:({field:s})=>e.jsx(o,{...s,fullWidth:!0,label:"Evaluation Method",required:!0,placeholder:"e.g., Visual, Wet film thickness Gauge",helperText:d.processStepGroups?.[x]?.processSteps?.[m]?.evaluationMethod?.message,error:!!d.processStepGroups?.[x]?.processSteps?.[m]?.evaluationMethod,sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px"}}})})}),e.jsx(n,{size:{xs:12,md:6},children:e.jsx(U,{name:`processStepGroups.${x}.processSteps.${m}.targetValueType`,control:r,render:({field:s})=>e.jsxs(i,{fullWidth:!0,error:!!d.processStepGroups?.[x]?.processSteps?.[m]?.targetValueType,children:[e.jsx(l,{children:"Target Value Type"}),e.jsx(c,{...s,label:"Target Value Type",sx:{borderRadius:"8px"},children:ne.map(s=>e.jsx(p,{value:s.value,children:s.label},s.value))})]})})}),e.jsx(U,{name:`processStepGroups.${x}.processSteps.${m}.targetValueType`,control:r,render:({field:{value:s}})=>"ok/not ok"===s?e.jsx(e.Fragment,{}):e.jsxs(e.Fragment,{children:[e.jsx(n,{size:{xs:12,md:6},children:e.jsx(U,{name:`processStepGroups.${x}.processSteps.${m}.minimumAcceptanceValue`,control:r,render:({field:s})=>e.jsx(o,{...s,value:s.value??"",onChange:e=>{const r=e.target.value;s.onChange(""===r?null:parseFloat(r))},fullWidth:!0,label:"Minimum Value",required:!0,type:"number",placeholder:"e.g., 1.8",helperText:d.processStepGroups?.[x]?.processSteps?.[m]?.minimumAcceptanceValue?.message,error:!!d.processStepGroups?.[x]?.processSteps?.[m]?.minimumAcceptanceValue,sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px"}}})})}),e.jsx(n,{size:{xs:12,md:6},children:e.jsx(U,{name:`processStepGroups.${x}.processSteps.${m}.maximumAcceptanceValue`,control:r,render:({field:s})=>e.jsx(o,{...s,value:s.value??"",onChange:e=>{const r=e.target.value;s.onChange(""===r?null:parseFloat(r))},fullWidth:!0,label:"Maximum Value",required:!0,type:"number",placeholder:"e.g., 2.2",helperText:d.processStepGroups?.[x]?.processSteps?.[m]?.maximumAcceptanceValue?.message,error:!!d.processStepGroups?.[x]?.processSteps?.[m]?.maximumAcceptanceValue,sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px"}}})})})]})}),e.jsxs(n,{size:{xs:12,md:6},children:[e.jsx(U,{name:`processStepGroups.${x}.processSteps.${m}.multipleMeasurements`,control:r,render:({field:s})=>e.jsx(u,{control:e.jsx(T,{checked:s.value,onChange:s.onChange,color:"primary"}),label:"Allow Multiple Measurements"})}),e.jsx(U,{name:`processStepGroups.${x}.processSteps.${m}.multipleMeasurements`,control:r,render:({field:{value:t}})=>t?e.jsx(s,{sx:{mt:1},children:e.jsx(U,{name:`processStepGroups.${x}.processSteps.${m}.multipleMeasurementMaxCount`,control:r,render:({field:s})=>e.jsx(o,{...s,value:s.value??"",onChange:e=>{const r=e.target.value;s.onChange(""===r?null:parseInt(r,10))},label:"Max Count",type:"number",size:"small",fullWidth:!0,required:!0,placeholder:"e.g., 3",helperText:d.processStepGroups?.[x]?.processSteps?.[m]?.multipleMeasurementMaxCount?.message,error:!!d.processStepGroups?.[x]?.processSteps?.[m]?.multipleMeasurementMaxCount,sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px"}}})})}):e.jsx(e.Fragment,{})})]}),e.jsx(n,{size:{xs:12,md:6},children:e.jsx(U,{name:`processStepGroups.${x}.processSteps.${m}.uom`,control:r,render:({field:s})=>e.jsxs(i,{fullWidth:!0,error:!!d.processStepGroups?.[x]?.processSteps?.[m]?.uom,children:[e.jsx(l,{children:"Unit of Measurement"}),e.jsx(c,{...s,label:"Unit of Measurement",sx:{borderRadius:"8px"},children:oe.map(s=>e.jsx(p,{value:s.value,children:s.label},s.value))})]})})}),e.jsx(n,{size:{xs:12,md:6},children:e.jsxs(s,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsx(U,{name:`processStepGroups.${x}.processSteps.${m}.ctq`,control:r,render:({field:r})=>e.jsx(u,{control:e.jsx(T,{checked:r.value,onChange:r.onChange,color:"primary"}),label:e.jsxs(s,{children:[e.jsx(t,{variant:"body1",sx:{fontWeight:500},children:"Critical to Quality (CTQ)"}),e.jsx(t,{variant:"caption",sx:{color:"#666"},children:"Mark this parameter as critical for quality control"})]})})}),e.jsx(U,{name:`processStepGroups.${x}.processSteps.${m}.allowAttachments`,control:r,render:({field:s})=>e.jsx(u,{control:e.jsx(T,{checked:s.value,onChange:s.onChange,color:"primary"}),label:"Allow Attachments"})}),e.jsx(U,{name:`processStepGroups.${x}.processSteps.${m}.responsiblePerson`,control:r,render:({field:s})=>e.jsx(u,{control:e.jsx(T,{checked:s.value,onChange:s.onChange,color:"primary"}),label:"Get Responsible Person"})})]})}),e.jsx(n,{size:{xs:12},children:e.jsx(U,{name:`processStepGroups.${x}.processSteps.${m}.notes`,control:r,render:({field:s})=>e.jsx(o,{...s,fullWidth:!0,label:"Notes",multiline:!0,rows:2,placeholder:"Additional notes for this step...",helperText:d.processStepGroups?.[x]?.processSteps?.[m]?.notes?.message,error:!!d.processStepGroups?.[x]?.processSteps?.[m]?.notes,sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px"}}})})})]})]})},a.id)),0===m.length&&e.jsxs(a,{sx:{p:4,textAlign:"center",border:"2px dashed #e0e0e0",borderRadius:"12px",backgroundColor:"#fafafa"},children:[e.jsx(f,{sx:{fontSize:"3rem",color:"#ccc",mb:2}}),e.jsx(t,{variant:"h6",sx:{color:"#666",mb:1,fontWeight:500},children:"No Steps Added"}),e.jsx(t,{variant:"body2",sx:{color:"#999",mb:3},children:"Add process steps to define the sequence workflow"}),e.jsx(h,{variant:"contained",size:"small",startIcon:e.jsx(j,{}),onClick:v,sx:{textTransform:"none",borderRadius:"8px",px:3,py:1},children:"Add First Step"})]})]})},xe=({control:r})=>{const o=K({control:r});return e.jsxs(s,{children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(w,{sx:{mr:1,color:"#4caf50"}}),e.jsx(t,{variant:"h6",sx:{fontWeight:600,color:"#333"},children:"Review & Submit"})]}),e.jsxs(a,{sx:{p:3,mb:3,borderRadius:2,border:"1px solid #e0e0e0"},children:[e.jsx(t,{variant:"h6",sx:{fontWeight:600,mb:2,color:"#333"},children:"Basic Information"}),e.jsxs(n,{container:!0,spacing:3,children:[e.jsx(n,{size:{xs:12,md:6},children:e.jsxs(s,{children:[e.jsx(t,{variant:"body2",sx:{color:"#666",mb:.5},children:"Sequence ID"}),e.jsx(t,{variant:"body1",sx:{fontWeight:500},children:o?.sequenceId||"Not specified"})]})}),e.jsx(n,{size:{xs:12,md:6},children:e.jsxs(s,{children:[e.jsx(t,{variant:"body2",sx:{color:"#666",mb:.5},children:"Sequence Name"}),e.jsx(t,{variant:"body1",sx:{fontWeight:500},children:o?.sequenceName||"Not specified"})]})}),e.jsx(n,{size:{xs:12,md:6},children:e.jsxs(s,{children:[e.jsx(t,{variant:"body2",sx:{color:"#666",mb:.5},children:"Category"}),e.jsx(t,{variant:"body1",sx:{fontWeight:500},children:o?.category||"Not specified"})]})}),e.jsx(n,{size:{xs:12,md:6},children:e.jsxs(s,{children:[e.jsx(t,{variant:"body2",sx:{color:"#666",mb:.5},children:"Type"}),e.jsx(t,{variant:"body1",sx:{fontWeight:500},children:o?.type||"Not specified"})]})}),e.jsx(n,{size:{xs:12,md:6},children:e.jsxs(s,{children:[e.jsx(t,{variant:"body2",sx:{color:"#666",mb:.5},children:"Status"}),e.jsx(C,{icon:o?.status?e.jsx(w,{}):e.jsx(A,{}),label:o?.status?"ACTIVE":"INACTIVE",size:"small",sx:{backgroundColor:o?.status?"#4caf50":"#9e9e9e",color:"white",fontSize:"0.75rem","& .MuiChip-icon":{color:"white"}}})]})}),o?.notes&&e.jsx(n,{size:{xs:12},children:e.jsxs(s,{children:[e.jsx(t,{variant:"body2",sx:{color:"#666",mb:.5},children:"Notes"}),e.jsx(t,{variant:"body1",sx:{fontWeight:500},children:o.notes})]})})]})]}),e.jsxs(a,{sx:{p:3,mb:3,borderRadius:2,border:"1px solid #e0e0e0"},children:[e.jsx(t,{variant:"h6",sx:{fontWeight:600,mb:2,color:"#333"},children:"Process Step Groups"}),o?.processStepGroups?.map((r,a)=>e.jsxs(b,{sx:{mb:2},children:[e.jsx(g,{expandIcon:e.jsx(v,{}),children:e.jsxs(s,{sx:{display:"flex",alignItems:"center",width:"100%"},children:[e.jsx(t,{variant:"subtitle1",sx:{fontWeight:500},children:r.processName||`Step Group ${a+1}`}),e.jsx(C,{label:`${r.processSteps?.length||0} steps`,size:"small",sx:{ml:2,backgroundColor:"#e3f2fd",color:"#1976d2"}})]})}),e.jsxs(q,{children:[e.jsxs(s,{sx:{mb:2},children:[e.jsx(t,{variant:"body2",sx:{color:"#666",mb:1},children:"Description"}),e.jsx(t,{variant:"body1",sx:{fontWeight:500},children:r.processDescription||"No description provided"})]}),e.jsxs(s,{sx:{mb:2},children:[e.jsx(t,{variant:"body2",sx:{color:"#666",mb:1},children:"Expected Duration"}),e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(G,{sx:{mr:1,color:"#2e7d32",fontSize:"1.2rem"}}),e.jsx(t,{variant:"body1",sx:{fontWeight:500},children:r.sequenceTiming||"00:00"})]})]}),r.processSteps&&r.processSteps.length>0&&e.jsx(k,{children:e.jsxs(V,{size:"small",children:[e.jsx(N,{children:e.jsxs(z,{children:[e.jsx(P,{children:"Step #"}),e.jsx(P,{children:"Parameter"}),e.jsx(P,{children:"Type"}),e.jsx(P,{children:"Target Value"}),e.jsx(P,{children:"UOM"}),e.jsx(P,{children:"CTQ"}),e.jsx(P,{children:"Attachments"}),e.jsx(P,{children:"Get Responsible Person"})]})}),e.jsx(R,{children:r.processSteps.map((s,r)=>e.jsxs(z,{children:[e.jsx(P,{children:s.stepNumber}),e.jsxs(P,{children:[e.jsx(t,{variant:"body2",sx:{fontWeight:500},children:s.parameterDescription}),s.evaluationMethod&&e.jsxs(t,{variant:"caption",sx:{color:"#666"},children:["Method: ",s.evaluationMethod]})]}),e.jsx(P,{children:e.jsx(C,{label:s.stepType,size:"small",sx:{backgroundColor:"#f5f5f5",color:"#333",fontSize:"0.75rem"}})}),e.jsx(P,{children:"ok/not ok"===s.targetValueType?e.jsx(t,{variant:"body2",children:"OK/Not OK"}):"exact value"===s.targetValueType?e.jsx(t,{variant:"body2",children:s.minimumAcceptanceValue}):e.jsxs(t,{variant:"body2",children:[s.minimumAcceptanceValue," - ",s.maximumAcceptanceValue]})}),e.jsx(P,{children:s.uom||"N/A"}),e.jsx(P,{children:e.jsx(C,{icon:s.ctq?e.jsx(w,{}):e.jsx(A,{}),label:s.ctq?"Yes":"No",size:"small",sx:{backgroundColor:s.ctq?"#4caf50":"#9e9e9e",color:"white",fontSize:"0.75rem","& .MuiChip-icon":{color:"white"}}})}),e.jsx(P,{children:e.jsx(C,{icon:s.allowAttachments?e.jsx(w,{}):e.jsx(A,{}),label:s.allowAttachments?"Yes":"No",size:"small",sx:{backgroundColor:s.allowAttachments?"#4caf50":"#9e9e9e",color:"white",fontSize:"0.75rem","& .MuiChip-icon":{color:"white"}}})}),e.jsx(P,{children:e.jsx(C,{icon:s.responsiblePerson?e.jsx(w,{}):e.jsx(A,{}),label:s.responsiblePerson?"Yes":"No",size:"small",sx:{backgroundColor:s.responsiblePerson?"#4caf50":"#9e9e9e",color:"white",fontSize:"0.75rem","& .MuiChip-icon":{color:"white"}}})})]},r))})]})})]})]},a))]}),e.jsxs(a,{sx:{p:3,borderRadius:2,border:"1px solid #e0e0e0"},children:[e.jsx(t,{variant:"h6",sx:{fontWeight:600,mb:2,color:"#333"},children:"Summary Statistics"}),e.jsxs(n,{container:!0,spacing:3,children:[e.jsx(n,{size:{xs:12,md:4},children:e.jsx(M,{sx:{backgroundColor:"#e3f2fd"},children:e.jsxs(I,{sx:{textAlign:"center"},children:[e.jsx(t,{variant:"h4",sx:{fontWeight:700,color:"#1976d2"},children:o?.processStepGroups?.length||0}),e.jsx(t,{variant:"body2",sx:{color:"#1976d2"},children:"Step Groups"})]})})}),e.jsx(n,{size:{xs:12,md:4},children:e.jsx(M,{sx:{backgroundColor:"#f3e5f5"},children:e.jsxs(I,{sx:{textAlign:"center"},children:[e.jsx(t,{variant:"h4",sx:{fontWeight:700,color:"#7b1fa2"},children:o?.processStepGroups?.reduce((e,s)=>e+(s.processSteps?.length||0),0)||0}),e.jsx(t,{variant:"body2",sx:{color:"#7b1fa2"},children:"Total Steps"})]})})}),e.jsx(n,{size:{xs:12,md:4},children:e.jsx(M,{sx:{backgroundColor:"#ffebee"},children:e.jsxs(I,{sx:{textAlign:"center"},children:[e.jsx(t,{variant:"h4",sx:{fontWeight:700,color:"#c62828"},children:o?.processStepGroups?.reduce((e,s)=>e+(s.processSteps?.filter(e=>e.ctq)?.length||0),0)||0}),e.jsx(t,{variant:"body2",sx:{color:"#c62828"},children:"CTQ Steps"})]})})})]})]})]})},me=Y({parameterDescription:Z().required("Parameter description is required").min(3,"Parameter description must be at least 3 characters").max(200,"Parameter description must be less than 200 characters"),stepNumber:X().required("Step number is required").min(1,"Step number must be at least 1").integer("Step number must be a whole number"),stepType:Z().required("Step type is required").oneOf(["Measurement","Check","Inspection","Operation"],"Invalid step type"),evaluationMethod:Z().required("Evaluation method is required").min(2,"Evaluation method must be at least 2 characters").max(100,"Evaluation method must be less than 100 characters"),targetValueType:Z().required("Target value type is required").oneOf(["range","exact value","ok/not ok"],"Invalid target value type"),minimumAcceptanceValue:X().nullable().when("targetValueType",{is:e=>"range"===e||"exact value"===e,then:e=>e.required("Minimum acceptance value is required for this target value type"),otherwise:e=>e.nullable()}),maximumAcceptanceValue:X().nullable().when("targetValueType",{is:e=>"range"===e||"exact value"===e,then:e=>e.required("Maximum acceptance value is required for this target value type"),otherwise:e=>e.nullable()}),multipleMeasurements:J(),multipleMeasurementMaxCount:X().nullable().when("multipleMeasurements",{is:!0,then:e=>e.required("Maximum count is required when multiple measurements is enabled").min(1,"Maximum count must be at least 1"),otherwise:e=>e.nullable()}),uom:Z().optional().max(20,"Unit of measurement must be less than 20 characters"),ctq:J(),allowAttachments:J(),responsiblePerson:J(),notes:Z().max(500,"Notes must be less than 500 characters").optional()}).test("min-max-validation","Minimum value must be less than or equal to maximum value",function(e){const{minimumAcceptanceValue:s,maximumAcceptanceValue:r,targetValueType:t}=e;return"range"===t&&s&&r&&s>r?this.createError({path:"minimumAcceptanceValue",message:"Minimum value must be less than or equal to maximum value"}):"exact value"!==t||!s||!r||s===r||this.createError({path:"minimumAcceptanceValue",message:"Minimum and maximum values must be equal for exact value type"})}),he=Y({processName:Z().required("Process name is required").min(3,"Process name must be at least 3 characters").max(100,"Process name must be less than 100 characters"),processDescription:Z().required("Process description is required").min(10,"Process description must be at least 10 characters").max(500,"Process description must be less than 500 characters"),sequenceTiming:Z().required("Expected duration is required").matches(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/,"Please enter a valid time format (HH:MM)").test("min-duration","Duration must be at least 1 minute",function(e){if(!e)return!1;const[s,r]=e.split(":").map(Number);return 60*s+r>=1}),processSteps:_(me).test("unique-step-numbers","Step numbers must be unique within each group",function(e){if(!e)return!0;const s=e.map(e=>e.stepNumber),r=new Set(s);return s.length===r.size})}),je=Y({id:X().optional(),sequenceId:Z().required("Sequence ID is required").min(3,"Sequence ID must be at least 3 characters").max(50,"Sequence ID must be less than 50 characters").matches(/^[A-Z0-9-]+$/,"Sequence ID must contain only uppercase letters, numbers, and hyphens"),sequenceName:Z().required("Sequence name is required").min(3,"Sequence name must be at least 3 characters").max(100,"Sequence name must be less than 100 characters"),category:Z().required("Category is required").min(2,"Category must be at least 2 characters").max(50,"Category must be less than 50 characters"),type:Z().required("Type is required").oneOf(["Layout","ISP"],"Type must be either Layout or ISP"),status:J(),notes:Z().max(500,"Notes must be less than 500 characters").optional(),processStepGroups:_(he),totalSteps:X().optional(),ctqSteps:X().optional(),createdAt:Z().optional(),updatedAt:Z().optional()}),be={sequenceId:"",sequenceName:"",category:"",type:"Layout",status:!0,notes:"",processStepGroups:[]};Y({sequenceId:Z().required("Sequence ID is required").min(3,"Sequence ID must be at least 3 characters").max(50,"Sequence ID must be less than 50 characters").matches(/^[A-Z0-9-]+$/,"Sequence ID must contain only uppercase letters, numbers, and hyphens"),sequenceName:Z().required("Sequence name is required").min(3,"Sequence name must be at least 3 characters").max(100,"Sequence name must be less than 100 characters"),category:Z().required("Category is required").min(2,"Category must be at least 2 characters").max(50,"Category must be less than 50 characters"),type:Z().required("Type is required").oneOf(["Layout","ISP"],"Type must be either Layout or ISP"),status:J(),notes:Z().max(500,"Notes must be less than 500 characters").optional()}),Y({processStepGroups:_(he)});const ge=["Basic Information","Step Groups & Steps","Review & Submit"],fe=e=>{if(!e)return 0;const[s,r]=e.split(":").map(Number);return 60*(60*s+r)},Se=e=>{if(0===e)return"00:01";const s=Math.floor(e/60),r=s%60;return`${Math.floor(s/60).toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`},ye=()=>{const r=B(),{id:n}=H(),o=Boolean(n),[i,l]=F.useState(0),[c,p]=F.useState(null),{data:u,isLoading:d,isSuccess:x}=ie({id:Number(n)},{skip:!o||!n}),[m,{isLoading:j}]=le(),[b,{isLoading:g}]=ce(),f=ee({resolver:re(je),defaultValues:be,mode:"onChange",reValidateMode:"onChange"}),{control:S,handleSubmit:y,formState:{errors:v},reset:q,trigger:C,watch:M}=f,I=F.useRef(M);F.useEffect(()=>{I.current=M;const e=()=>{const e=f.getValues("processStepGroups");if(e){const s=e.reduce((e,s)=>e+(s.processSteps?.length||0),0),r=e.reduce((e,s)=>e+(s.processSteps?.filter(e=>e.ctq)?.length||0),0);f.setValue("totalSteps",s),f.setValue("ctqSteps",r)}};e();const s=I.current((s,{name:r})=>{"processStepGroups"===r&&e()});return()=>s.unsubscribe()},[f,M]),F.useEffect(()=>{Object.keys(v).length},[v]),F.useEffect(()=>{if(o&&x&&u){const e={id:u.detail.id,sequenceId:u.detail.sequenceId,sequenceName:u.detail.sequenceName,category:u.detail.category,type:u.detail.type,status:"ACTIVE"===u.detail.status,notes:u.detail.notes||"",totalSteps:u.detail.totalSteps,ctqSteps:u.detail.ctqSteps,processStepGroups:u.detail.stepGroups.map(e=>({processName:e.processName,processDescription:e.processDescription,sequenceTiming:Se(e.sequenceTiming||60),processSteps:e.steps.map(e=>({parameterDescription:e.parameterDescription,stepNumber:e.stepNumber,stepType:e.stepType,evaluationMethod:e.evaluationMethod,targetValueType:e.targetValueType,minimumAcceptanceValue:e.minimumAcceptanceValue?Number(e.minimumAcceptanceValue):null,maximumAcceptanceValue:e.maximumAcceptanceValue?Number(e.maximumAcceptanceValue):null,multipleMeasurements:e.multipleMeasurements??!1,multipleMeasurementMaxCount:e.multipleMeasurementMaxCount,uom:e.uom,ctq:e.ctq??!1,allowAttachments:e.allowAttachments??!1,responsiblePerson:e.responsiblePerson??!1,notes:e.notes}))})),createdAt:u.detail.createdAt,updatedAt:u.detail.updatedAt};q(e)}},[o,x,u,q]);return o&&d?e.jsx(s,{sx:{minHeight:"100vh"},children:e.jsxs(a,{sx:{p:4,borderRadius:2,boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:4},children:[e.jsx(W,{variant:"rectangular",width:80,height:36,sx:{mr:2,borderRadius:1}}),e.jsx(W,{variant:"text",width:300,height:40})]}),e.jsx(s,{sx:{mb:4},children:e.jsx(W,{variant:"rectangular",width:"100%",height:60,sx:{borderRadius:1}})}),e.jsx(s,{sx:{mb:4},children:e.jsx(W,{variant:"rectangular",width:"100%",height:400,sx:{borderRadius:1}})}),e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",pt:3,borderTop:"1px solid #e0e0e0"},children:[e.jsx(W,{variant:"rectangular",width:80,height:36,sx:{borderRadius:1}}),e.jsxs(s,{sx:{display:"flex",gap:2},children:[e.jsx(W,{variant:"rectangular",width:100,height:36,sx:{borderRadius:1}}),e.jsx(W,{variant:"rectangular",width:120,height:36,sx:{borderRadius:1}})]})]})]})}):e.jsx(se,{...f,children:e.jsx(s,{sx:{minHeight:"100vh"},children:e.jsxs(a,{sx:{p:4,borderRadius:2,boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsx(s,{sx:{display:"flex",alignItems:"center",mb:4},children:e.jsx(t,{variant:"h4",sx:{fontWeight:600,color:"#333"},children:o?"Edit Process Sequence":"Create New Process Sequence"})}),c&&e.jsx($,{severity:"error",sx:{mb:3},children:c}),e.jsx(s,{sx:{mb:4},children:e.jsx(D,{activeStep:i,alternativeLabel:!0,children:ge.map(s=>e.jsx(E,{children:e.jsx(O,{children:s})},s))})}),e.jsx(s,{sx:{mb:4},children:(s=>{switch(s){case 0:return e.jsx(pe,{control:S,errors:v});case 1:return e.jsx(ue,{control:S,errors:v});case 2:return e.jsx(xe,{control:S,errors:v});default:return null}})(i)}),e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",pt:3,borderTop:"1px solid #e0e0e0"},children:[e.jsx(h,{onClick:()=>{0===i?r("/sequence-master"):l(e=>e-1)},sx:{textTransform:"none"},children:"Back"}),e.jsxs(s,{sx:{display:"flex",gap:2},children:[e.jsx(h,{variant:"outlined",startIcon:e.jsx(A,{}),onClick:()=>{r("/sequence-master")},sx:{textTransform:"none"},children:"Cancel"}),i===ge.length-1?e.jsx(h,{variant:"contained",startIcon:e.jsx(L,{}),onClick:y(async e=>{p(null);try{if(!(await C()))return void p("Please fix all validation errors before submitting");const s={data:{processSequence:{status:e.status?"ACTIVE":"INACTIVE",sequenceId:e.sequenceId,sequenceName:e.sequenceName,version:o&&u?u.detail.version:1,isLatest:!o||!u||u.detail.isLatest,category:e.category,type:e.type,notes:e.notes||"",totalSteps:e.totalSteps||0,ctqSteps:e.ctqSteps||0},processStepGroups:(e.processStepGroups||[]).map(e=>({processName:e.processName,processDescription:e.processDescription,sequenceTiming:fe(e.sequenceTiming),processSteps:(e.processSteps||[]).map((e,s)=>({parameterDescription:e.parameterDescription,stepNumber:s+1,stepType:e.stepType,evaluationMethod:e.evaluationMethod,targetValueType:e.targetValueType,minimumAcceptanceValue:e.minimumAcceptanceValue??null,maximumAcceptanceValue:e.maximumAcceptanceValue??null,multipleMeasurements:e.multipleMeasurements??!1,multipleMeasurementMaxCount:e.multipleMeasurementMaxCount??null,uom:e.uom,ctq:e.ctq??!1,allowAttachments:e.allowAttachments??!1,responsiblePerson:e.responsiblePerson??!1,notes:e.notes||""}))}))}};o&&e.id?(await b({id:e.id,data:s.data}).unwrap(),te.fire({icon:"success",title:"Success!",text:"Process sequence updated successfully",timer:2e3,showConfirmButton:!1})):(await m(s).unwrap(),te.fire({icon:"success",title:"Success!",text:"Process sequence created successfully",timer:2e3,showConfirmButton:!1})),r("/sequence-master")}catch(s){const e=s&&"object"==typeof s&&"data"in s&&s.data&&"object"==typeof s.data&&"message"in s.data?s.data.message:s&&"object"==typeof s&&"message"in s?s.message:`Failed to ${o?"update":"create"} process sequence`;p(e)}}),disabled:j||g,sx:{textTransform:"none",backgroundColor:"#1976d2","&:hover":{backgroundColor:"#1565c0"}},children:j||g?"Saving...":o?"Update Sequence":"Create Sequence"}):e.jsx(h,{variant:"contained",onClick:async()=>{const e={0:["sequenceId","sequenceName","category","type","status","notes"],1:["processStepGroups"]}[i];if(e)try{if(await C([...e]))l(e=>e+1);else{const e=document.querySelector(".Mui-error");e&&e.scrollIntoView({behavior:"smooth",block:"center"})}}catch(s){}else l(e=>e+1)},sx:{textTransform:"none",backgroundColor:"#1976d2","&:hover":{backgroundColor:"#1565c0"}},children:"Next"})]})]})]})})})};export{ye as default};
