import{j as e,I as s,br as t,a2 as r,z as i,bg as n,a4 as a,an as o,ao as l,al as c,bk as d,bl as x,Z as p,aL as m,aM as h,J as u,bP as j,bQ as b,bq as f,O as g,$ as y,X as v,bn as S,ad as I,ae as C,r as T,af as q,bR as k,bS as w,ag as A,bh as N,w as R,aP as W,aq as z,bs as L,bt as M,bu as D,e as P}from"./mui-vendor-ThRJoe5u.js";import{r as V,f as B,j as E}from"./react-vendor-jVbyDP5c.js";import{C as $,l as O,m as U,g as F,h as H,i as Z,j as J,k as Q,f as X,F as Y}from"./form-vendor-DG-ZRlco.js";import{o as G}from"./yup-lT2MYDzp.js";import{S as K}from"./utils-vendor-S0KZLiBE.js";import{i as _,n as ee,w as se,x as te,y as re}from"./index-hUIVqX27.js";import"./auth-vendor-BOyMHjHL.js";import"./state-vendor-BxbV2bHq.js";import"./ui-vendor-DL_b4SbO.js";const ie=({control:d,errors:x})=>e.jsxs(s,{children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(t,{sx:{mr:1,color:"#1976d2"}}),e.jsx(r,{variant:"h6",sx:{fontWeight:600,color:"#333"},children:"Basic Information"})]}),e.jsx(i,{sx:{p:3,borderRadius:2,border:"1px solid #e0e0e0"},children:e.jsxs(n,{container:!0,spacing:3,children:[e.jsx(n,{size:{xs:12,md:6},children:e.jsx($,{name:"templateId",control:d,render:({field:s})=>e.jsx(a,{...s,fullWidth:!0,label:"Template ID",required:!0,placeholder:"e.g., TMP-001",helperText:x.templateId?.message||"Unique identifier for the PRC template",error:!!x.templateId,sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px"}}})})}),e.jsx(n,{size:{xs:12,md:6},children:e.jsx($,{name:"templateName",control:d,render:({field:s})=>e.jsx(a,{...s,fullWidth:!0,label:"Template Name",required:!0,placeholder:"e.g., Catalyst Preparation Template",helperText:x.templateName?.message||"Descriptive name for the template",error:!!x.templateName,sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px"}}})})}),e.jsx(n,{size:{xs:12,md:6},children:e.jsx(s,{sx:{display:"flex",alignItems:"center",height:"100%",pt:2},children:e.jsx($,{name:"isActive",control:d,render:({field:t})=>e.jsx(o,{control:e.jsx(l,{checked:t.value,onChange:t.onChange,color:"primary"}),label:e.jsxs(s,{children:[e.jsx(r,{variant:"body1",sx:{fontWeight:500},children:"Active Template"}),e.jsx(r,{variant:"caption",sx:{color:"#666"},children:"Enable this template for use in production"})]})})})})}),e.jsxs(n,{size:{xs:12},children:[e.jsx(c,{sx:{my:2}}),e.jsx($,{name:"notes",control:d,render:({field:s})=>e.jsx(a,{...s,fullWidth:!0,label:"Notes",multiline:!0,rows:4,placeholder:"Additional notes about this PRC template",helperText:x.notes?.message||"Optional notes about usage, special conditions, or other relevant information",error:!!x.notes,sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px"}}})})]})]})})]}),ne=e=>"sequenceId"in e&&"sequenceName"in e,ae=e=>"inspectionId"in e&&"inspectionName"in e,oe=({item:t,onClick:i,isSelected:n})=>{const a=ne(t),o=ae(t),l=()=>a?"#1976d2":"#4caf50";return e.jsx(d,{sx:{cursor:"pointer",border:n?"2px solid #1976d2":"1px solid #e0e0e0",borderRadius:"12px",boxShadow:n?"0 4px 12px rgba(25, 118, 210, 0.15)":"0 2px 4px rgba(0,0,0,0.1)",backgroundColor:n?"#f3f8ff":"white",transition:"all 0.2s ease-in-out","&:hover":{borderColor:"#1976d2",boxShadow:"0 4px 12px rgba(25, 118, 210, 0.15)",transform:"translateY(-2px)"}},onClick:()=>i(t),children:e.jsxs(x,{sx:{p:2},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",mb:1},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(s,{sx:{color:l(),display:"flex",alignItems:"center"},children:a?e.jsx(m,{}):e.jsx(h,{})}),e.jsx(p,{label:(a?"sequence":o?"inspection":"").toUpperCase(),size:"small",sx:{backgroundColor:l(),color:"white",fontSize:"0.7rem",fontWeight:600,height:20}})]}),n&&e.jsx(s,{sx:{width:20,height:20,borderRadius:"50%",backgroundColor:"#1976d2",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"0.8rem",fontWeight:"bold"},children:"✓"})]}),e.jsx(r,{variant:"h6",sx:{fontSize:"1rem",fontWeight:600,color:"#333",mb:.5,lineHeight:1.3},children:a?t.sequenceName:o?t.inspectionName:""}),e.jsxs(r,{variant:"body2",sx:{color:"#666",fontSize:"0.85rem",fontWeight:500},children:["ID: ",a?t.sequenceId:o?t.inspectionId:""]}),e.jsxs(r,{variant:"caption",sx:{color:"#999",fontSize:"0.75rem",display:"block",mt:1},children:["Version ",t.version," • ",t.status]})]})})},le=({step:t,index:i,totalSteps:n,onReorder:a,onRemove:l,onUpdateStep:c,control:d})=>{const x=i>0,m=i<n-1,h=()=>"sequence"===t.itemType?"#1976d2":"#4caf50";return e.jsxs(s,{sx:{border:"1px solid #e0e0e0",borderRadius:"8px",p:2,mb:2,backgroundColor:"white",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(s,{sx:{width:32,height:32,borderRadius:"50%",backgroundColor:h(),color:"white",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"bold",fontSize:"0.9rem"},children:i+3}),e.jsxs(s,{children:[e.jsx(r,{variant:"subtitle1",sx:{fontWeight:600,color:"#333"},children:t.itemName}),e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1,mt:.5},children:[e.jsx(p,{label:t.itemType.toUpperCase(),size:"small",sx:{backgroundColor:h(),color:"white",fontSize:"0.7rem",height:20}}),e.jsxs(r,{variant:"caption",color:"textSecondary",children:["ID: ",t.itemId]})]})]})]}),e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(u,{size:"small",onClick:()=>{x&&a(i,i-1)},disabled:!x,sx:{color:x?"#666":"#ccc","&:hover":{backgroundColor:x?"#f5f5f5":"transparent"}},children:e.jsx(j,{})}),e.jsx(u,{size:"small",onClick:()=>{m&&a(i,i+1)},disabled:!m,sx:{color:m?"#666":"#ccc","&:hover":{backgroundColor:m?"#f5f5f5":"transparent"}},children:e.jsx(b,{})}),e.jsx(u,{size:"small",onClick:()=>{l(i)},sx:{color:"#f44336","&:hover":{backgroundColor:"#ffebee"}},children:e.jsx(f,{})})]})]}),e.jsxs(s,{sx:{display:"flex",gap:3,flexWrap:"wrap"},children:[e.jsx($,{name:`prcTemplateSteps.${i}.blockCatalystMixing`,control:d,render:({field:s})=>e.jsx(o,{control:e.jsx(g,{...s,checked:s.value||!1,color:"primary",size:"small"}),label:"Block Catalyst Mixing",sx:{"& .MuiFormControlLabel-label":{fontSize:"0.85rem",color:"#666"}}})}),e.jsx($,{name:`prcTemplateSteps.${i}.requestSupervisorApproval`,control:d,render:({field:s})=>e.jsx(o,{control:e.jsx(g,{...s,checked:s.value||!1,color:"primary",size:"small"}),label:"Request Supervisor Approval",sx:{"& .MuiFormControlLabel-label":{fontSize:"0.85rem",color:"#666"}}})})]})]})},ce=({stepNumber:t,stepName:n,stepDescription:a})=>e.jsx(i,{elevation:0,sx:{p:2,mb:2,border:"1px solid #e0e0e0",borderRadius:2,backgroundColor:"#f8f9fa",position:"relative"},children:e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(s,{sx:{width:32,height:32,borderRadius:"50%",backgroundColor:"#6c757d",color:"white",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"bold",fontSize:"0.9rem"},children:t}),e.jsxs(s,{sx:{flex:1},children:[e.jsx(r,{variant:"subtitle1",sx:{fontWeight:600,color:"#333"},children:n}),e.jsx(r,{variant:"body2",color:"textSecondary",sx:{mt:.5},children:a})]}),e.jsx(s,{sx:{px:1.5,py:.5,backgroundColor:"#e9ecef",borderRadius:1,border:"1px solid #dee2e6"},children:e.jsx(r,{variant:"caption",sx:{color:"#6c757d",fontWeight:500},children:"Default"})})]})}),de=({control:t,errors:a,setValue:o})=>{const[l,c]=V.useState(!1),[d,x]=V.useState("sequence"),[p,m]=V.useState(0),{data:h,isLoading:j}=_(),{data:b,isLoading:f}=ee(),{fields:g,append:N,remove:R,move:W}=O({control:t,name:"prcTemplateSteps"}),z=[...(h?.detail||[]).map(e=>({id:e.id,sequenceId:e.sequenceId,sequenceName:e.sequenceName,status:e.status,category:e.category,type:e.type,version:e.version,isLatest:e.isLatest})),...(b?.detail||[]).filter(e=>void 0!==e.inspection.id).map(e=>({id:e.inspection.id,inspectionId:e.inspection.inspectionId,inspectionName:e.inspection.inspectionName,status:e.inspection.status,type:e.inspection.type,version:e.inspection.version,isLatest:e.inspection.isLatest}))],L=z.filter(ne),M=z.filter(ae),D=e=>{x(e),m("sequence"===e?0:1),c(!0)},P=()=>{c(!1)},B=e=>{if(g.some(s=>{const t=s;return t.stepId===e.id&&t.itemType===(ne(e)?"sequence":"inspection")})){const s=g.findIndex(s=>{const t=s;return t.stepId===e.id&&t.itemType===(ne(e)?"sequence":"inspection")});-1!==s&&(R(s),setTimeout(()=>U(),0))}else{const s=ne(e)?"sequence":"inspection",t={version:1,isLatest:!0,sequence:g.length+3,stepId:e.id,type:s,blockCatalystMixing:!1,requestSupervisorApproval:!1,itemName:ne(e)?e.sequenceName:e.inspectionName,itemId:ne(e)?e.sequenceId:e.inspectionId,itemType:s};N(t),setTimeout(()=>U(),0)}},E=(e,s)=>{W(e,s),setTimeout(()=>U(),0)},$=e=>{R(e),setTimeout(()=>U(),0)},U=()=>{o&&g.forEach((e,s)=>{const t=s+3;e.sequence!==t&&o(`prcTemplateSteps.${s}.sequence`,t)})},F=(e,s)=>{},H=e=>g.some(s=>{const t=s;return t.stepId===e.id&&t.itemType===(ne(e)?"sequence":"inspection")}),Z=0===p?L:M;return e.jsxs(s,{children:[e.jsx(s,{sx:{display:"flex",alignItems:"center",mb:3},children:e.jsx(r,{variant:"h6",sx:{fontWeight:600,color:"#333"},children:"Template Steps Configuration"})}),e.jsxs(i,{sx:{p:3,borderRadius:2,border:"1px solid #e0e0e0"},children:[a.prcTemplateSteps&&e.jsx(y,{severity:"error",sx:{mb:3},children:a.prcTemplateSteps.message}),e.jsxs(s,{sx:{display:"flex",gap:2,mb:3},children:[e.jsxs(v,{variant:"outlined",startIcon:e.jsx(S,{}),onClick:()=>D("sequence"),sx:{borderColor:"#1976d2",color:"#1976d2","&:hover":{borderColor:"#1565c0",backgroundColor:"rgba(25, 118, 210, 0.04)"}},children:["Add Sequence (",L.length,")"]}),e.jsxs(v,{variant:"outlined",startIcon:e.jsx(S,{}),onClick:()=>D("inspection"),sx:{borderColor:"#1976d2",color:"#1976d2","&:hover":{borderColor:"#1565c0",backgroundColor:"rgba(25, 118, 210, 0.04)"}},children:["Add Inspection (",M.length,")"]})]}),e.jsxs(r,{variant:"subtitle1",sx:{mb:2,fontWeight:600,color:"#333"},children:["Template Steps (",g.length+2,")"]}),e.jsxs(s,{children:[e.jsx(ce,{stepNumber:1,stepName:"Raw Materials",stepDescription:"Preparation and verification of raw materials"}),e.jsx(ce,{stepNumber:2,stepName:"Catalyst Mixing",stepDescription:"Mixing of catalyst components"}),g.map((s,r)=>e.jsx(le,{step:s,index:r,totalSteps:g.length+2,onReorder:E,onRemove:$,onUpdateStep:F,control:t},s.id)),0===g.length&&e.jsx(s,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:120,border:"2px dashed #e0e0e0",borderRadius:2,backgroundColor:"#fafafa",mt:2},children:e.jsxs(r,{color:"textSecondary",textAlign:"center",children:["No additional steps selected yet.",e.jsx("br",{}),'Click "Add Sequence" or "Add Inspection" to add more steps.']})})]})]}),e.jsxs(I,{open:l,onClose:P,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:2}},children:[e.jsxs(C,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:1},children:[e.jsxs(r,{variant:"h6",sx:{fontWeight:600,color:"#333"},children:["Select ","sequence"===d?"Sequences":"Inspections"]}),e.jsx(u,{onClick:P,size:"small",children:e.jsx(T,{})})]}),e.jsx(q,{sx:{p:0},children:e.jsxs(s,{sx:{p:2},children:[e.jsxs(k,{value:p,onChange:(e,s)=>m(s),sx:{mb:2,borderBottom:"1px solid #e0e0e0"},children:[e.jsx(w,{label:`Sequences (${L.length})`,sx:{textTransform:"none",fontWeight:500}}),e.jsx(w,{label:`Inspections (${M.length})`,sx:{textTransform:"none",fontWeight:500}})]}),j||f?e.jsx(s,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:200},children:e.jsx(r,{color:"textSecondary",children:"Loading items..."})}):0===Z.length?e.jsx(s,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:200},children:e.jsxs(r,{color:"textSecondary",children:["No ",0===p?"sequences":"inspections"," available"]})}):e.jsx(n,{container:!0,spacing:2,sx:{maxHeight:400,overflow:"auto"},children:Z.map(s=>e.jsx(n,{size:{xs:12,sm:6},children:e.jsx(oe,{item:s,onClick:B,isSelected:H(s)})},s.id))})]})}),e.jsx(A,{sx:{p:2,pt:1},children:e.jsx(v,{onClick:P,variant:"outlined",children:"Done"})})]})]})},xe=({control:a})=>{const o=U({control:a});return e.jsxs(s,{children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(N,{sx:{mr:1,color:"#4caf50"}}),e.jsx(r,{variant:"h6",sx:{fontWeight:600,color:"#333"},children:"Review & Submit"})]}),e.jsxs(i,{sx:{p:3,mb:3,borderRadius:2,border:"1px solid #e0e0e0"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(t,{sx:{mr:1,color:"#1976d2"}}),e.jsx(r,{variant:"h6",sx:{fontWeight:600,color:"#333"},children:"Basic Information"})]}),e.jsxs(n,{container:!0,spacing:3,children:[e.jsx(n,{size:{xs:12,md:6},children:e.jsxs(s,{children:[e.jsx(r,{variant:"body2",sx:{color:"#666",mb:.5},children:"Template ID"}),e.jsx(r,{variant:"body1",sx:{fontWeight:500},children:o.templateId||"N/A"})]})}),e.jsx(n,{size:{xs:12,md:6},children:e.jsxs(s,{children:[e.jsx(r,{variant:"body2",sx:{color:"#666",mb:.5},children:"Template Name"}),e.jsx(r,{variant:"body1",sx:{fontWeight:500},children:o.templateName||"N/A"})]})}),e.jsx(n,{size:{xs:12,md:6},children:e.jsxs(s,{children:[e.jsx(r,{variant:"body2",sx:{color:"#666",mb:.5},children:"Status"}),e.jsx(p,{label:o.isActive?"Active":"Inactive",color:o.isActive?"success":"default",size:"small",icon:o.isActive?e.jsx(N,{}):e.jsx(R,{})})]})}),e.jsx(n,{size:{xs:12,md:6},children:e.jsxs(s,{children:[e.jsx(r,{variant:"body2",sx:{color:"#666",mb:.5},children:"Version"}),e.jsx(r,{variant:"body1",sx:{fontWeight:500},children:o.version||1})]})}),o.notes&&e.jsx(n,{size:{xs:12},children:e.jsxs(s,{children:[e.jsx(r,{variant:"body2",sx:{color:"#666",mb:.5},children:"Notes"}),e.jsx(r,{variant:"body1",sx:{fontWeight:500},children:o.notes})]})})]})]}),e.jsxs(i,{sx:{p:3,mb:3,borderRadius:2,border:"1px solid #e0e0e0"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(W,{sx:{mr:1,color:"#1976d2"}}),e.jsx(r,{variant:"h6",sx:{fontWeight:600,color:"#333"},children:"Template Steps Configuration"})]}),e.jsxs(s,{sx:{mb:3},children:[e.jsx(r,{variant:"subtitle1",sx:{fontWeight:600,mb:2,color:"#333"},children:"Default Steps"}),e.jsxs(s,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(d,{sx:{backgroundColor:"#f8f9fa",border:"1px solid #e0e0e0"},children:e.jsx(x,{sx:{py:2},children:e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(s,{sx:{width:32,height:32,borderRadius:"50%",backgroundColor:"#6c757d",color:"white",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"bold",fontSize:"0.9rem"},children:"1"}),e.jsxs(s,{sx:{flex:1},children:[e.jsx(r,{variant:"subtitle1",sx:{fontWeight:600,color:"#333"},children:"Raw Materials"}),e.jsx(r,{variant:"body2",color:"textSecondary",children:"Preparation and verification of raw materials"})]}),e.jsx(p,{label:"Default",size:"small",color:"default"})]})})}),e.jsx(d,{sx:{backgroundColor:"#f8f9fa",border:"1px solid #e0e0e0"},children:e.jsx(x,{sx:{py:2},children:e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(s,{sx:{width:32,height:32,borderRadius:"50%",backgroundColor:"#6c757d",color:"white",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"bold",fontSize:"0.9rem"},children:"2"}),e.jsxs(s,{sx:{flex:1},children:[e.jsx(r,{variant:"subtitle1",sx:{fontWeight:600,color:"#333"},children:"Catalyst Mixing"}),e.jsx(r,{variant:"body2",color:"textSecondary",children:"Mixing of catalyst components"})]}),e.jsx(p,{label:"Default",size:"small",color:"default"})]})})})]})]}),o.prcTemplateSteps&&o.prcTemplateSteps.length>0?e.jsxs(s,{children:[e.jsxs(r,{variant:"subtitle1",sx:{fontWeight:600,mb:2,color:"#333"},children:["Additional Steps (",o.prcTemplateSteps.length,")"]}),e.jsx(s,{sx:{display:"flex",flexDirection:"column",gap:2},children:o.prcTemplateSteps.map((t,i)=>e.jsx(d,{sx:{border:"1px solid #e0e0e0"},children:e.jsx(x,{sx:{py:2},children:e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(s,{sx:{width:32,height:32,borderRadius:"50%",backgroundColor:"sequence"===t.type?"#1976d2":"#4caf50",color:"white",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"bold",fontSize:"0.9rem"},children:i+3}),e.jsxs(s,{sx:{flex:1},children:[e.jsx(r,{variant:"subtitle1",sx:{fontWeight:600,color:"#333"},children:"sequence"===t.type?"Process Sequence":"Inspection Task"}),e.jsx(r,{variant:"body2",color:"textSecondary",children:"sequence"===t.type?"Process Sequence":"Inspection Task"})]}),e.jsxs(s,{sx:{display:"flex",gap:1},children:[e.jsx(p,{label:"sequence"===t.type?"Sequence":"Inspection",size:"small",color:"sequence"===t.type?"primary":"success"}),t.blockCatalystMixing&&e.jsx(p,{label:"Block Catalyst",size:"small",color:"warning"}),t.requestSupervisorApproval&&e.jsx(p,{label:"Supervisor Approval",size:"small",color:"info"})]})]})})},t.stepId||i))})]}):e.jsx(s,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:120,border:"2px dashed #e0e0e0",borderRadius:2,backgroundColor:"#fafafa"},children:e.jsx(r,{color:"textSecondary",textAlign:"center",children:"No additional steps configured"})})]}),e.jsxs(i,{sx:{p:3,borderRadius:2,border:"1px solid #e0e0e0",backgroundColor:"#f8f9fa"},children:[e.jsx(r,{variant:"h6",sx:{fontWeight:600,mb:2,color:"#333"},children:"Summary"}),e.jsxs(n,{container:!0,spacing:2,children:[e.jsx(n,{size:{xs:12,sm:6,md:3},children:e.jsxs(s,{sx:{textAlign:"center"},children:[e.jsx(r,{variant:"h4",sx:{fontWeight:"bold",color:"#1976d2"},children:2+(o.prcTemplateSteps?.length||0)}),e.jsx(r,{variant:"body2",color:"textSecondary",children:"Total Steps"})]})}),e.jsx(n,{size:{xs:12,sm:6,md:3},children:e.jsxs(s,{sx:{textAlign:"center"},children:[e.jsx(r,{variant:"h4",sx:{fontWeight:"bold",color:"#4caf50"},children:"2"}),e.jsx(r,{variant:"body2",color:"textSecondary",children:"Default Steps"})]})}),e.jsx(n,{size:{xs:12,sm:6,md:3},children:e.jsxs(s,{sx:{textAlign:"center"},children:[e.jsx(r,{variant:"h4",sx:{fontWeight:"bold",color:"#ff9800"},children:o.prcTemplateSteps?.filter(e=>"sequence"===e.type).length||0}),e.jsx(r,{variant:"body2",color:"textSecondary",children:"Sequences"})]})}),e.jsx(n,{size:{xs:12,sm:6,md:3},children:e.jsxs(s,{sx:{textAlign:"center"},children:[e.jsx(r,{variant:"h4",sx:{fontWeight:"bold",color:"#9c27b0"},children:o.prcTemplateSteps?.filter(e=>"inspection"===e.type).length||0}),e.jsx(r,{variant:"body2",color:"textSecondary",children:"Inspections"})]})})]})]})]})},pe=F({id:J().optional(),version:J().required("Version is required"),isLatest:Z().required("Is latest flag is required"),sequence:J().required("Sequence number is required").min(1,"Sequence must be at least 1"),stepId:J().required("Step ID is required"),type:H().required("Step type is required").oneOf(["sequence","inspection"],"Type must be either sequence or inspection"),blockCatalystMixing:Z().default(!1),requestSupervisorApproval:Z().default(!1),createdAt:H().optional(),updatedAt:H().optional()}),me=F({id:J().optional(),templateId:H().required("Template ID is required").min(3,"Template ID must be at least 3 characters").max(50,"Template ID must be less than 50 characters").matches(/^[A-Z0-9-]+$/,"Template ID must contain only uppercase letters, numbers, and hyphens"),templateName:H().required("Template name is required").min(3,"Template name must be at least 3 characters").max(100,"Template name must be less than 100 characters"),notes:H().max(500,"Notes must be less than 500 characters").optional(),version:J().required("Version is required").min(1,"Version must be at least 1"),isLatest:Z().default(!0),isActive:Z().default(!0),prcTemplateSteps:Q(pe).min(1,"At least one step is required"),createdAt:H().optional(),updatedAt:H().optional()}),he={templateId:"",templateName:"",notes:"",version:1,isLatest:!0,isActive:!0,prcTemplateSteps:[]};F({templateId:H().required("Template ID is required").min(3,"Template ID must be at least 3 characters").max(50,"Template ID must be less than 50 characters").matches(/^[A-Z0-9-]+$/,"Template ID must contain only uppercase letters, numbers, and hyphens"),templateName:H().required("Template name is required").min(3,"Template name must be at least 3 characters").max(100,"Template name must be less than 100 characters"),notes:H().max(500,"Notes must be less than 500 characters").optional(),isActive:Z()}),F({prcTemplateSteps:Q(pe).min(1,"At least one step is required")});const ue=["Basic Information","Template Steps","Review & Submit"],je=()=>{const t=B(),{id:n}=E(),a=Boolean(n),[o,l]=V.useState(0),[c,d]=V.useState(null),{data:x,isLoading:p,isSuccess:m}=se({id:Number(n)},{skip:!a||!n}),{data:h}=_(),{data:u}=ee(),[j,{isLoading:b}]=te(),[f,{isLoading:g}]=re(),S=X({resolver:G(me),defaultValues:he,mode:"onChange",reValidateMode:"onChange"}),{control:I,handleSubmit:C,formState:{errors:T},reset:q,trigger:k,setValue:w}=S;V.useEffect(()=>{Object.keys(T).length},[T]),V.useEffect(()=>{if(a&&m&&x&&h&&u){const e=new Map;(h.detail||[]).forEach(s=>{e.set(s.id,s)});const s=new Map;(u.detail||[]).forEach(e=>{s.set(e.inspection.id,e.inspection)});const t={id:x.detail.prcTemplate.id,templateId:x.detail.prcTemplate.templateId,templateName:x.detail.prcTemplate.templateName,notes:x.detail.prcTemplate.notes||"",version:x.detail.prcTemplate.version,isLatest:x.detail.prcTemplate.isLatest,isActive:x.detail.prcTemplate.isActive,prcTemplateSteps:x.detail.prcTemplateSteps.map(t=>{let r="",i="",n=t.type;if("sequence"===t.type){const s=e.get(t.stepId);s&&(r=s.sequenceName,i=s.sequenceId)}else if("inspection"===t.type){const e=s.get(t.stepId);e&&(r=e.inspectionName,i=e.inspectionId)}return{id:t.id,version:t.version,isLatest:t.isLatest,sequence:t.sequence,stepId:t.stepId||0,type:t.type,blockCatalystMixing:t.blockCatalystMixing,requestSupervisorApproval:t.requestSupervisorApproval,createdAt:t.createdAt,updatedAt:t.updatedAt,itemName:r,itemId:i,itemType:n}}),createdAt:x.detail.prcTemplate.createdAt,updatedAt:x.detail.prcTemplate.updatedAt};q(t)}},[a,m,x,h,u,q]);return a&&p?e.jsx(s,{sx:{minHeight:"100vh"},children:e.jsxs(i,{sx:{p:4,borderRadius:2,boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:4},children:[e.jsx(z,{variant:"rectangular",width:80,height:36,sx:{mr:2,borderRadius:1}}),e.jsx(z,{variant:"text",width:300,height:40})]}),e.jsx(s,{sx:{mb:4},children:e.jsx(z,{variant:"rectangular",width:"100%",height:60,sx:{borderRadius:1}})}),e.jsx(s,{sx:{mb:4},children:e.jsx(z,{variant:"rectangular",width:"100%",height:400,sx:{borderRadius:1}})}),e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",pt:3,borderTop:"1px solid #e0e0e0"},children:[e.jsx(z,{variant:"rectangular",width:80,height:36,sx:{borderRadius:1}}),e.jsxs(s,{sx:{display:"flex",gap:2},children:[e.jsx(z,{variant:"rectangular",width:100,height:36,sx:{borderRadius:1}}),e.jsx(z,{variant:"rectangular",width:120,height:36,sx:{borderRadius:1}})]})]})]})}):e.jsx(Y,{...S,children:e.jsx(s,{sx:{minHeight:"100vh"},children:e.jsxs(i,{sx:{p:4,borderRadius:2,boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsx(s,{sx:{display:"flex",alignItems:"center",mb:4},children:e.jsx(r,{variant:"h4",sx:{fontWeight:600,color:"#333"},children:a?"Edit PRC Template":"Create New PRC Template"})}),c&&e.jsx(y,{severity:"error",sx:{mb:3},children:c}),e.jsx(s,{sx:{mb:4},children:e.jsx(L,{activeStep:o,alternativeLabel:!0,children:ue.map(s=>e.jsx(M,{children:e.jsx(D,{children:s})},s))})}),e.jsx(s,{sx:{mb:4},children:(s=>{switch(s){case 0:return e.jsx(ie,{control:I,errors:T});case 1:return e.jsx(de,{control:I,errors:T,setValue:w});case 2:return e.jsx(xe,{control:I});default:return null}})(o)}),e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",pt:3,borderTop:"1px solid #e0e0e0"},children:[e.jsx(v,{onClick:()=>{0===o?t("/prc-template-master"):l(e=>e-1)},sx:{textTransform:"none"},children:"Back"}),e.jsxs(s,{sx:{display:"flex",gap:2},children:[e.jsx(v,{variant:"outlined",startIcon:e.jsx(R,{}),onClick:()=>{t("/prc-template-master")},sx:{textTransform:"none"},children:"Cancel"}),o===ue.length-1?e.jsx(v,{variant:"contained",startIcon:e.jsx(P,{}),onClick:C(async e=>{d(null);try{if(!(await k()))return void d("Please fix all validation errors before submitting");const s={status:e.isActive?"ACTIVE":"INACTIVE",templateId:e.templateId,templateName:e.templateName,notes:e.notes||"",version:e.version||1,isLatest:e.isLatest??!0,isActive:e.isActive??!0},r=(e.prcTemplateSteps||[]).map((e,s)=>({version:e.version,isLatest:e.isLatest,sequence:s+3,stepId:e.stepId,type:e.type,blockCatalystMixing:e.blockCatalystMixing??!1,requestSupervisorApproval:e.requestSupervisorApproval??!1}));if(a&&e.id){const t={id:e.id,prcTemplate:{id:e.id,...s},prcTemplateSteps:r};await f(t).unwrap(),K.fire({icon:"success",title:"Success!",text:"PRC template updated successfully",timer:2e3,showConfirmButton:!1})}else{const e={prcTemplate:s,prcTemplateSteps:r};await j(e).unwrap(),K.fire({icon:"success",title:"Success!",text:"PRC template created successfully",timer:2e3,showConfirmButton:!1})}t("/prc-template-master")}catch(s){const e=s&&"object"==typeof s&&"data"in s&&s.data&&"object"==typeof s.data&&"message"in s.data?s.data.message:s&&"object"==typeof s&&"message"in s?s.message:`Failed to ${a?"update":"create"} PRC template`;d(e)}}),disabled:b||g,sx:{textTransform:"none",backgroundColor:"#1976d2","&:hover":{backgroundColor:"#1565c0"}},children:b||g?"Saving...":a?"Update Template":"Create Template"}):e.jsx(v,{variant:"contained",onClick:async()=>{const e={0:["templateId","templateName","notes","isActive"],1:["prcTemplateSteps"]}[o];if(e)try{if(await k([...e]))l(e=>e+1);else{const e=document.querySelector(".Mui-error");e&&e.scrollIntoView({behavior:"smooth",block:"center"})}}catch(s){}else l(e=>e+1)},sx:{textTransform:"none",backgroundColor:"#1976d2","&:hover":{backgroundColor:"#1565c0"}},children:"Next"})]})]})]})})})};export{je as default};
